<div class="page">
  <div class='page__body'>
    [[#if (hasPermission "forms:ldp:*")]]

    <h2 style="margin-bottom: 0.8em;">To Do</h2>

    <bs-tabs id='todo-tabs' default-active-key='1' unmount-on-exit=true>

        <bs-tab event-key='1' title='Group Members'>
            <bs-row>

            <bs-col sm="4">
                <semantic-chart type='donut' types='["pie", "donut"]'
                      query='SELECT ?status_order ?status (COUNT(?member) AS ?membercount)
                      WHERE {
                          ?group rdf:type/rdfs:subClassOf* crm:E74_Group ;
                              crm:P107_has_current_or_former_member ?member.
                          FILTER(CONTAINS(STR(?group), "/a/"))
                          FILTER(?member != <http://data.performing-arts.ch/a/9e1a6aff-7181-4931-bb72-219947dfe1fc>) # exclude "et al."
                          ?member rdfs:label ?memberlabel .
                          OPTIONAL {
                              ?person rdfs:label ?memberlabel; 
                                  a crm:E21_Person.
                              FILTER(?person != ?member)
                              FILTER(CONTAINS(STR(?person), "/a/"))
                            }
                        BIND(IF(CONTAINS(STR(?member), "/a/"), "matched", IF(BOUND(?person), "matchable?", "unmatched")) AS ?status)
                        VALUES (?status ?status_order) {
                          ("matched" 1)
                          ("matchable?" 2)
                          ("unmatched" 3)
                        }
                      } GROUP BY ?status_order ?status
                      ORDER BY ?status_order'
                      sets='[{"dataSetName": "Members", "category": "status", "value": "membercount"}]'
                      styles='[{
                        "provider": "chartjs",
                        "style": {
                            "data": {
                                "datasets": [
                                    { "backgroundColor": ["rgba(18, 64, 98, 0.7)", "rgba(58, 54, 78, 0.5)", "rgba(220, 20, 20, 0.7)"],
                                    "borderColor": "rgb(255, 255, 255, 1)",
                                    "borderWidth": "4"
                                    }
                                ]
                            },
                            "options": {
                                "layout": {
                                    "padding": {
                                        "top": "20"
                                    }
                                },
                                "legend": {
                                    "position": "bottom",
                                    "labels": {
                                        "fontSize": 14,
                                        "padding": 20
                                    }
                                }
                            }
                        }
                       }]'
                    ></semantic-chart>
          
            </bs-col>
            <bs-col sm="8">

                <bs-tabs id='group-members' default-active-key='2.1' unmount-on-exit=true>

                    <bs-tab event-key='2.1' title='Matched Members'>
                        <semantic-table 
                        query='SELECT DISTINCT ?group ?member
                          WHERE {
                            ?group rdf:type/rdfs:subClassOf* crm:E74_Group ;
                                crm:P107_has_current_or_former_member ?member.
                            FILTER(CONTAINS(STR(?group), "/a/"))
                            FILTER(?member != <http://data.performing-arts.ch/a/9e1a6aff-7181-4931-bb72-219947dfe1fc>) # exclude "et al."
                            FILTER(CONTAINS(STR(?member), "/a/"))
                          }'
                        column-configuration='[
                            {"variableName": "group", "displayName": "Group"}, 
                            {"variableName": "member", "displayName": "Member"}
                        ]'
                        number-of-displayed-rows=20
                        no-result-template='No results found.'
                        options='{"showFilter": true}'>
                        </semantic-table>          
                    </bs-tab>

                    <bs-tab event-key='2.2' title='Matchable with Persons?'>
                        <semantic-table 
                        query='SELECT DISTINCT ?group ?person
                        WHERE {
                            ?group rdf:type/rdfs:subClassOf* crm:E74_Group ;
                                crm:P107_has_current_or_former_member ?member.
                            FILTER(CONTAINS(STR(?group), "/a/"))
                            FILTER(CONTAINS(STR(?member), "/u/"))
                            ?member rdfs:label ?memberlabel.
                            ?person rdfs:label ?memberlabel ;
                                a crm:E21_Person.
                                FILTER(CONTAINS(STR(?person), "/a/"))
                        }'
                        column-configuration='[
                            {"variableName": "group", "displayName": "Group"}, 
                            {"variableName": "person", "displayName": "Member/Person"}
                        ]'
                        number-of-displayed-rows=20
                        no-result-template='No results found.'
                        options='{"showFilter": false}'>
                        </semantic-table>          
                    </bs-tab>

                    <bs-tab event-key='2.3' title='Unmatched Members'>
                        <semantic-table 
                        query='SELECT DISTINCT ?group ?grouplabel ?memberlabel 
                            WHERE {
                                ?group rdf:type/rdfs:subClassOf* crm:E74_Group ;
                                    crm:P107_has_current_or_former_member ?member.
                                FILTER (CONTAINS(STR(?group), "/a/"))
                                FILTER (CONTAINS(STR(?member), "/u/"))
                                ?member rdfs:label ?memberlabel .
                            }'
                        column-configuration='[
                            {"variableName": "group", "displayName": "Group"}, 
                            {"variableName": "memberlabel", "displayName": "Member"}
                        ]'
                        number-of-displayed-rows=20
                        no-result-template='No results found.'
                        options='{"showFilter": true}'>
                        </semantic-table>          
                    </bs-tab>

                </bs-tabsid='group-venues' default-active-key='1.1' unmount-on-exit=true>
              
            </bs-col>

            </bs-row>        
        </bs-tab>

        <bs-tab event-key='2' title='Producers'>
            <bs-row>

            <bs-col sm="4">
                <semantic-chart type='donut' types='["pie", "donut"]'
                      query='
                      SELECT ?status (COUNT(?producer) AS ?producercount)
                      WHERE {
                        ?production crm:P2_has_type spav:muwgo ;
                            crm:P14_carried_out_by ?producer .
                        BIND(IF(CONTAINS(STR(?producer), "/u/"), "unmatched", "matched") AS ?status)
                      } GROUP BY ?status
                      ORDER BY ?status
                      '
                      sets='[{"dataSetName": "Producers", "category": "status", "value": "producercount"}]'
                      styles='[{
                        "provider": "chartjs",
                        "style": {
                            "data": {
                                "datasets": [
                                    { "backgroundColor": ["rgba(18, 64, 98, 0.7)", "rgba(220, 20, 20, 0.7)"],
                                    "borderColor": "rgb(255, 255, 255, 1)",
                                    "borderWidth": "4"
                                    }
                                ]
                            },
                            "options": {
                                "layout": {
                                    "padding": {
                                        "top": "20"
                                    }
                                },
                                "legend": {
                                    "position": "bottom",
                                    "labels": {
                                        "fontSize": 14,
                                        "padding": 20
                                    }
                                }
                            }
                        }
                       }]'
                    ></semantic-chart>
          
                    </bs-col>
                    <bs-col sm="8">

                        <bs-tabs id='producers' default-active-key='2.1' unmount-on-exit=true>
                            <bs-tab event-key='2.1' title='Unmatched Producers'>

                                <semantic-table 
                                query='SELECT DISTINCT ?plan ?producer_label 
                                    WHERE {
                                        ?production crm:P2_has_type spav:muwgo ;
                                            crm:P14_carried_out_by ?producer .
                                        FILTER(CONTAINS(STR(?producer), "/u/"))
                                        ?producer rdfs:label ?producer_label .
                                        [ crm:P9_consists_of ?production ;
                                            frbroo:R17_created ?plan ] .
                                    } LIMIT 5000' 
                                column-configuration='[
                                    {"variableName": "plan", "displayName": "Production"}, 
                                    {"variableName": "producer_label", "displayName": "Producer"}
                                ]'
                                number-of-displayed-rows=20
                                no-result-template='No results found.'
                                options='{"showFilter": true}'>
                                </semantic-table>
        
                            </bs-tab>

                            <bs-tab event-key='2.2' title='Ranking CH'>

                                <semantic-table 
                                query='SELECT ?producer_label (COUNT(?producer) AS ?producer_count)
                                WHERE {
                                    ?production crm:P2_has_type spav:muwgo ;
                                        crm:P14_carried_out_by ?producer .
                                    FILTER(CONTAINS(STR(?producer), "/u/"))
                                        ?producer rdfs:label ?producer_label .
                                    FILTER(STRSTARTS(?producer_label, "CH:"))
                                } GROUP BY ?producer_label
                                ORDER BY DESC(?producer_count)' 
                                column-configuration='[
                                    {"variableName": "producer_label", "displayName": "Producer", "cellTemplate":"{{>productions}}"},
                                    {"variableName": "producer_count", "displayName": "Count"}
                                ]'
                                number-of-displayed-rows=20
                                options='{"showFilter": true}'>

                                <template id='productions'>
                                    <semantic-query 
                                        query='SELECT ?producer_label ?productions WHERE { VALUES (?producer_label) { ("{{producer_label.value}}") } BIND (ENCODE_FOR_URI(?producer_label) AS ?productions) }'
                                        template = '{{>productions-link}} '>
                                        <template id='productions-link'>
                                            <div>{{#each bindings}}<a href="/sparql?query=PREFIX%20crm%3A%20%3Chttp%3A%2F%2Fwww.cidoc-crm.org%2Fcidoc-crm%2F%3E%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0APREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX%20spav%3A%20%3Chttp%3A%2F%2Fvocab.performing-arts.ch%2F%3E%0APREFIX%20frbroo%3A%20%3Chttp%3A%2F%2Fiflastandards.info%2Fns%2Ffr%2Ffrbr%2Ffrbroo%2F%3E%0APREFIX%20%3A%20%3Chttp%3A%2F%2Fwww.metaphacts.com%2Fresource%2F%3E%0A%0ASELECT%20DISTINCT%20%3Frepid%20%3Fproductionplan%20%3Fdate%20WHERE%20%7B%0A%20%20%3Fproduction%20crm%3AP14_carried_out_by%20%5B%20rdfs%3Alabel%20%22{{productions.value}}%22%20%5D%20%3B%0A%20%20%20%20crm%3AP2_has_type%20spav%3Amuwgo%20.%0A%20%20%5B%20crm%3AP9_consists_of%20%3Fproduction%20%3B%0A%20%20%20%20frbroo%3AR17_created%20%3Fproductionplan%20%5D%20.%0A%20%20%3Fproductionplan%20crm%3AP1_is_identified_by%20%5B%20a%20crm%3AE42_Identifier%20%3B%0A%20%20%20%20%20%20rdf%3Avalue%20%3Frepid%20%0A%20%20%5D%20.%0A%20%20OPTIONAL%20%7B%0A%20%20%5B%20frbroo%3AR25_performed%20%3Fproductionplan%20%3B%0A%20%20%20%20crm%3AP9_consists_of%20%3Fpremiere%20%5D%20.%0A%20%20%3Fpremiere%20crm%3AP4_has_time-span%20%5B%20crm%3AP82a_begin_of_the_begin%20%3Fdate%20%5D%20.%0A%20%20%7D%0A%7D" target="_blank">{{producer_label.value}}</a>{{/each}}</div>
                                        </template>
                                    </semantic-query>
                                </template>

                                </semantic-table>
                                    
                            </bs-tab>

                            <bs-tab event-key='2.3' title='Ranking International'>

                                <semantic-table 
                                query='SELECT ?producer_label (COUNT(?producer) AS ?producer_count)
                                WHERE {
                                    ?production crm:P2_has_type spav:muwgo ;
                                        crm:P14_carried_out_by ?producer .
                                    FILTER(CONTAINS(STR(?producer), "/u/"))
                                        ?producer rdfs:label ?producer_label .
                                    FILTER(!STRSTARTS(?producer_label, "CH:"))
                                    FILTER(!STRSTARTS(?producer_label, "00:"))
                                    } GROUP BY ?producer_label
                                ORDER BY DESC(?producer_count)' 
                                column-configuration='[
                                    {"variableName": "producer_label", "displayName": "Producer", "cellTemplate":"{{>productions}}"},
                                    {"variableName": "producer_count", "displayName": "Count"}
                                ]'
                                number-of-displayed-rows=20
                                options='{"showFilter": true}'>

                                <template id='productions'>
                                    <semantic-query 
                                        query='SELECT ?producer_label ?productions WHERE { VALUES (?producer_label) { ("{{producer_label.value}}") } BIND (ENCODE_FOR_URI(?producer_label) AS ?productions) }'
                                        template = '{{>productions-link}} '>
                                        <template id='productions-link'>
                                            <div>{{#each bindings}}<a href="/sparql?query=PREFIX%20crm%3A%20%3Chttp%3A%2F%2Fwww.cidoc-crm.org%2Fcidoc-crm%2F%3E%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0APREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX%20spav%3A%20%3Chttp%3A%2F%2Fvocab.performing-arts.ch%2F%3E%0APREFIX%20frbroo%3A%20%3Chttp%3A%2F%2Fiflastandards.info%2Fns%2Ffr%2Ffrbr%2Ffrbroo%2F%3E%0APREFIX%20%3A%20%3Chttp%3A%2F%2Fwww.metaphacts.com%2Fresource%2F%3E%0A%0ASELECT%20DISTINCT%20%3Frepid%20%3Fproductionplan%20%3Fdate%20WHERE%20%7B%0A%20%20%3Fproduction%20crm%3AP14_carried_out_by%20%5B%20rdfs%3Alabel%20%22{{productions.value}}%22%20%5D%20%3B%0A%20%20%20%20crm%3AP2_has_type%20spav%3Amuwgo%20.%0A%20%20%5B%20crm%3AP9_consists_of%20%3Fproduction%20%3B%0A%20%20%20%20frbroo%3AR17_created%20%3Fproductionplan%20%5D%20.%0A%20%20%3Fproductionplan%20crm%3AP1_is_identified_by%20%5B%20a%20crm%3AE42_Identifier%20%3B%0A%20%20%20%20%20%20rdf%3Avalue%20%3Frepid%20%0A%20%20%5D%20.%0A%20%20OPTIONAL%20%7B%0A%20%20%5B%20frbroo%3AR25_performed%20%3Fproductionplan%20%3B%0A%20%20%20%20crm%3AP9_consists_of%20%3Fpremiere%20%5D%20.%0A%20%20%3Fpremiere%20crm%3AP4_has_time-span%20%5B%20crm%3AP82a_begin_of_the_begin%20%3Fdate%20%5D%20.%0A%20%20%7D%0A%7D" target="_blank">{{producer_label.value}}</a>{{/each}}</div>
                                        </template>
                                    </semantic-query>
                                </template>

                            </semantic-table>
                                    
                            </bs-tab>

                            <bs-tab event-key='2.4' title='Ranking 00'>

                                <semantic-table 
                                query='SELECT ?producer_label (COUNT(?producer) AS ?producer_count)
                                WHERE {
                                    ?production crm:P2_has_type spav:muwgo ;
                                        crm:P14_carried_out_by ?producer .
                                    FILTER(CONTAINS(STR(?producer), "/u/"))
                                        ?producer rdfs:label ?producer_label .
                                    FILTER(STRSTARTS(?producer_label, "00:"))
                                } GROUP BY ?producer_label
                                ORDER BY DESC(?producer_count)' 
                                column-configuration='[
                                    {"variableName": "producer_label", "displayName": "Producer", "cellTemplate":"{{>productions}}"},
                                    {"variableName": "producer_count", "displayName": "Count"}
                                ]'
                                number-of-displayed-rows=20
                                options='{"showFilter": true}'>
                                <template id='productions'>
                                    <semantic-query 
                                        query='SELECT ?producer_label ?productions WHERE { VALUES (?producer_label) { ("{{producer_label.value}}") } BIND (ENCODE_FOR_URI(?producer_label) AS ?productions) }'
                                        template = '{{>productions-link}} '>
                                        <template id='productions-link'>
                                            <div>{{#each bindings}}<a href="/sparql?query=PREFIX%20crm%3A%20%3Chttp%3A%2F%2Fwww.cidoc-crm.org%2Fcidoc-crm%2F%3E%0APREFIX%20skos%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0APREFIX%20rdf%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0APREFIX%20rdfs%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX%20spav%3A%20%3Chttp%3A%2F%2Fvocab.performing-arts.ch%2F%3E%0APREFIX%20frbroo%3A%20%3Chttp%3A%2F%2Fiflastandards.info%2Fns%2Ffr%2Ffrbr%2Ffrbroo%2F%3E%0APREFIX%20%3A%20%3Chttp%3A%2F%2Fwww.metaphacts.com%2Fresource%2F%3E%0A%0ASELECT%20DISTINCT%20%3Frepid%20%3Fproductionplan%20%3Fdate%20WHERE%20%7B%0A%20%20%3Fproduction%20crm%3AP14_carried_out_by%20%5B%20rdfs%3Alabel%20%22{{productions.value}}%22%20%5D%20%3B%0A%20%20%20%20crm%3AP2_has_type%20spav%3Amuwgo%20.%0A%20%20%5B%20crm%3AP9_consists_of%20%3Fproduction%20%3B%0A%20%20%20%20frbroo%3AR17_created%20%3Fproductionplan%20%5D%20.%0A%20%20%3Fproductionplan%20crm%3AP1_is_identified_by%20%5B%20a%20crm%3AE42_Identifier%20%3B%0A%20%20%20%20%20%20rdf%3Avalue%20%3Frepid%20%0A%20%20%5D%20.%0A%20%20OPTIONAL%20%7B%0A%20%20%5B%20frbroo%3AR25_performed%20%3Fproductionplan%20%3B%0A%20%20%20%20crm%3AP9_consists_of%20%3Fpremiere%20%5D%20.%0A%20%20%3Fpremiere%20crm%3AP4_has_time-span%20%5B%20crm%3AP82a_begin_of_the_begin%20%3Fdate%20%5D%20.%0A%20%20%7D%0A%7D" target="_blank">{{producer_label.value}}</a>{{/each}}</div>
                                        </template>
                                    </semantic-query>
                                </template>
                            </semantic-table>
                                    
                    </bs-tab>
                </bs-col> 
            </bs-row>         
        </bs-tab>

        <bs-tab event-key='4' title='Production Venues'>
            <bs-row>
            <bs-col sm="4">
                <semantic-chart type='donut' types='["pie", "donut"]'
                      query='
                      SELECT ?status (COUNT(?venue) AS ?venuecount) WHERE {
                        ?performance a frbroo:F31_Performance ;
                                       crm:P8_took_place_on_or_within ?venue ;
                                       frbroo:R25_performed ?plan .
                        BIND(IF(CONTAINS(STR(?venue), "/u/"), "unmatched", "matched") AS ?status)
                      } GROUP BY ?status
                      ORDER BY ?status
                      '
                      sets='[{"dataSetName": "Venues", "category": "status", "value": "venuecount"}]'
                      styles='[{
                        "provider": "chartjs",
                        "style": {
                            "data": {
                                "datasets": [
                                    { "backgroundColor": ["rgba(18, 64, 98, 0.7)", "rgba(220, 20, 20, 0.7)"],
                                    "borderColor": "rgb(255, 255, 255, 1)",
                                    "borderWidth": "4"
                                    }
                                ]
                            },
                            "options": {
                                "layout": {
                                    "padding": {
                                        "top": "20"
                                    }
                                },
                                "legend": {
                                    "position": "bottom",
                                    "labels": {
                                        "fontSize": 14,
                                        "padding": 20
                                    }
                                }
                            }
                        }
                       }]'
                    ></semantic-chart>
            </bs-col>
            <bs-col sm="8">

                <semantic-table 
                    query='SELECT ?venuelabel ?group (COUNT(?venue) AS ?venuecount) WHERE {
                        ?performance a frbroo:F31_Performance ;
                            crm:P8_took_place_on_or_within ?venue .
                        FILTER(CONTAINS(STR(?venue), "/u/"))
                        ?venue a crm:E22_Man-Made_Object ;
                            rdfs:label ?venuelabel .
                        ?performance frbroo:R25_performed ?plan .
                        ?expressioncreation frbroo:R17_created ?plan ;
                            crm:P10_falls_within ?directorship.
                        ?directorship crm:P14_carried_out_by ?group .
                        ?group rdf:type/rdfs:subClassOf* crm:E74_Group .
                    } GROUP BY ?venuelabel ?group
                    ORDER BY DESC(?venuecount)' 
                    column-configuration='[
                    {"variableName": "venuelabel", "displayName": "Venue"}, 
                    {"variableName": "group", "displayName": "Group"}, 
                    {"variableName": "venuecount", "displayName": "Count"}
                    ]'
                    number-of-displayed-rows=20
                    no-result-template='No results found.'
                    options='{"showFilter": true}'>
                </semantic-table>

            </bs-col>
            </bs-row>
        </bs-tab>

        <bs-tab event-key='5' title='Record Sets'>

            <bs-row>
                <bs-col sm="3">
                    <semantic-query 
                        query='SELECT (COUNT(DISTINCT ?record) AS ?count) WHERE {
                            ?record <http://temp.performing-arts.ch/isVirtual> true ;
                            rdf:type/rdfs:subClassOf* rico:RecordResource .
                        }' 
                        template='<h5 style="padding: 1.5em 1em;">{{#each bindings}}{{count.value}} virtual record sets{{/each}}</h5>'>
                </bs-col>
                <bs-col sm="9">
                    <semantic-table 
                        query='SELECT DISTINCT ?rr WHERE {
                                ?rr <http://temp.performing-arts.ch/isVirtual> true ;
                                rdf:type/rdfs:subClassOf* rico:RecordResource .
                            }' 
                        column-configuration='[
                            {"displayName": "Record Resource", "variableName": "rr"},
                            {"displayName": "Subjects", "cellTemplate": "{{>subjects}}"}
                            ]'
                        number-of-displayed-rows=20
                        no-result-template='No results found.'
                        options='{"showFilter": true}'>
                        <template id='subjects'> 
                            <semantic-query 
                            query='SELECT DISTINCT ?subject WHERE { <{{rr.value}}> rico:hasOrHadSubject ?subject . }'
                            template = '{{>subject-list}} '>           
                            <template id='subject-list'> 
                                <div>{{#each bindings}}{{#if @first}}<semantic-link iri="{{subject.value}}"></semantic-link>{{else}}, <semantic-link iri="{{subject.value}}"></semantic-link>{{/if}}{{/each}}</div>
                            </template>
                            </semantic-query>   
                        </template>
                    </semantic-table>           
                </bs-col>
            </bs-row>

        </bs-tab>

        <bs-tab event-key='6' title='Dates'>

            <bs-row>
                <bs-col sm="3">
                    <semantic-query 
                        query='SELECT (COUNT(DISTINCT ?record) AS ?count) WHERE {
                            ?record spao:legacyDate ?date .
                            BIND(REPLACE(?date, "[\\(\\)\\?]", "") AS ?cleandate)
                            BIND(REPLACE(?cleandate, "\\d{4}", "YYYY" ) AS ?pattern)
                        }' 
                        template='<h5 style="padding: 1.5em 1em;">{{#each bindings}}{{count.value}} entries with legacy dates{{/each}}</h5>'>
                </bs-col>
                <bs-col sm="9">
                    <semantic-table
                        query='SELECT DISTINCT ?record ?date ?pattern WHERE {
                            ?record spao:legacyDate ?date .
                            BIND(REPLACE(?date, "[\\(\\)\\?]", "") AS ?cleandate)
                            BIND(REPLACE(?cleandate, "\\d{4}", "YYYY" ) AS ?pattern)
                        }'
                        options='{
                            "enableGrouping": true,
                            "groupingOptions": {"groupedBy": ["pattern"]}
                        }'
                        column-configuration='[
                            {"variableName": "date", "displayName": "Date"},
                            {
                                "variableName": "record",
                                "displayName": "Record",
                                "aggregation": "count",
                                "aggregationCellTemplate": "Count: {{value}}"
                            },
                            {"variableName": "pattern", "displayName": "Pattern"}
                        ]'
                    ></semantic-table>
                </bs-col>
            </bs-row>

        </bs-tab>

        <bs-tab event-key='7' title='Extends'>

            <bs-row>
                <bs-col sm="3">
                    <semantic-query 
                        query='SELECT (COUNT(DISTINCT ?record) AS ?count) WHERE { ?record rico:recordResourceExtent ?extent . }' 
                        template='<h5 style="padding: 1.5em 1em;">{{#each bindings}}{{count.value}} entries with legacy extents{{/each}}</h5>'>
                </bs-col>
                <bs-col sm="9">
                    <semantic-table 
                    query='SELECT DISTINCT ?record ?extent WHERE { ?record rico:recordResourceExtent ?extent . }' 
                    column-configuration='[
                        {"displayName": "Record Resource", "variableName": "record"},
                        {"displayName": "Extent", "variableName": "extent"}
                        ]'
                    number-of-displayed-rows=20
                    no-result-template='No results found.'>
                    </semantic-table>           
                </bs-col>
            </bs-row>

        </bs-tab>

        <bs-tab event-key='8' title='Wikidata'>

            <bs-row>
                <bs-col sm="4">
                    <h5 style="padding: 0.4em 1em;">Multiple entries that point to the same Wikidata entry.</h5>
                </bs-col>
                <bs-col sm="8">
                    <semantic-table 
                    query='SELECT DISTINCT ?wikidata ?q (COUNT(?sapa) AS ?count) WHERE {
                        ?sapa owl:sameAs ?wikidata .
                        FILTER(CONTAINS(STR(?wikidata), "wikidata.org/entity"))
                        BIND(SUBSTR(STR(?wikidata), 32) AS ?q)
                    } GROUP BY (?wikidata) (?q)
                    HAVING (COUNT(?sapa)>1)' 
                    column-configuration='[
                        {"variableName": "wikidata", "displayName": "Wikidata", "cellTemplate": "<a href=\"http://www.wikidata.org/entity/{{q.value}}\" target=\"_blank\">{{q.value}}</a>"},
                        {"displayName": "Items", "cellTemplate": "{{>items}}"},
                        {"displayName": "Editors", "cellTemplate": "{{>editors}}"}
                    ]'
                    number-of-displayed-rows=20
                    no-result-template='No results found.'
                    options='{"showFilter": false}'>
                    <template id='items'>
                        <semantic-query 
                            query='SELECT DISTINCT ?item WHERE { ?item owl:sameAs <{{wikidata.value}}> . } ORDER BY ASC (?item)'
                            template = '{{>item-link}} '>
                            <template id='item-link'>
                                <div>{{#each bindings}}<div><semantic-link iri="{{item.value}}" target="_blank"></semantic-link></div>{{/each}}</div>
                            </template>
                        </semantic-query>
                    </template>
                    <template id='editors'>
                        <semantic-query 
                            query='SELECT ?item ?editor WHERE {
                                GRAPH ?graph {
                                  ?item owl:sameAs <{{wikidata.value}}> . 
                                  Platform:formContainer <http://www.w3.org/ns/ldp#contains> ?container .
                                  ?container prov:wasAttributedTo ?user .
                                }
                                BIND(STRAFTER(STR(?user), "/user/") AS ?editor)
                              } ORDER BY ASC (?item)'
                            template = '{{>item-link}} '>
                            <template id='item-link'>
                                <div>{{#each bindings}}<div>{{editor.value}}</div>{{/each}}</div>
                            </template>
                        </semantic-query>
                    </template>
                    </semantic-table>
                </bs-col>
            </bs-row>

        </bs-tab>

        <bs-tab event-key='9' title='Images'>

            <bs-row>
                <bs-col sm="4">

                    <h5 style="padding: 0.4em 1em;">Images without subject</h5>
        
                    <semantic-chart type='donut' types='["pie", "donut"]'
                        query='SELECT ?status (COUNT(DISTINCT ?record) AS ?recordcount) WHERE {
                                ?record a rico:Record ;
                                    rico:hasInstantiation ?instantiation .
                                ?instantiation spao:hasArchivalStatus spav:asarm ;
                                    rico:hasCarrierType ?carrier .
                                FILTER EXISTS { spav:fvese skos:narrower* ?carrier . }
                                OPTIONAL { ?record rico:hasOrHadSubject ?subject . }
                                BIND(IF(BOUND(?subject), "with subject", "without subject") AS ?status)
                            } GROUP BY ?status
                            ORDER BY ?status'
                          sets='[{"dataSetName": "Images", "category": "status", "value": "recordcount"}]'
                          styles='[{
                            "provider": "chartjs",
                            "style": {
                                "data": {
                                    "datasets": [
                                        { "backgroundColor": ["rgba(18, 64, 98, 0.7)", "rgba(220, 20, 20, 0.7)"],
                                        "borderColor": "rgb(255, 255, 255, 1)",
                                        "borderWidth": "4"
                                        }
                                    ]
                                },
                                "options": {
                                    "layout": {
                                        "padding": {
                                            "top": "20"
                                        }
                                    },
                                    "legend": {
                                        "position": "bottom",
                                        "labels": {
                                            "fontSize": 14,
                                            "padding": 20
                                        }
                                    }
                                }
                            }
                           }]'
                        ></semantic-chart>
                    </bs-col>
                    <bs-col sm="8">
        
                        <semantic-table 
                        query='SELECT DISTINCT ?record ?iiif ?has_iiif WHERE {
                                ?record a rico:Record ;
                                    rico:hasInstantiation ?instantiation .
                                ?instantiation spao:hasArchivalStatus spav:asarm ;
                                            rico:hasCarrierType ?carrier .
                                FILTER EXISTS { spav:fvese skos:narrower* ?carrier . }
                                FILTER NOT EXISTS { ?record rico:hasOrHadSubject ?subject . }
                                OPTIONAL {
                                    ?record rico:hasInstantiation ?iiif .
                                    FILTER(CONTAINS(STR(?iiif), "http://media.performing-arts.ch/iiif"))
                                }
                                BIND(IF(BOUND(?iiif), "IIIF", "") AS ?has_iiif)
                            }' 
                        column-configuration='[
                            {"variableName": "record", "displayName": "Record"}, 
                            {"variableName": "has_iiif", "displayName": "IIIF"}
                        ]'
                        number-of-displayed-rows=20
                        no-result-template='No results found.'
                        options='{"showFilter": true}'>
                        </semantic-table>
        
                    </bs-col>
                </bs-row>            

        </bs-tab>

        <bs-tab event-key='10' title='Videos'>

            <bs-row>
                <bs-col sm="4">

                    <semantic-query 
                        query='SELECT ?count ?icon WHERE {
                        {
                            SELECT (COUNT(DISTINCT ?instantiation) AS ?count) WHERE {
                                {
                                    SELECT ?record (COUNT(DISTINCT ?instantiation) AS ?instantiations) {
                                    ?record rico:hasInstantiation ?instantiation .
                                    {
                                        ?instantiation a ebucore:MediaResource . 
                                    } UNION { 
                                        ?file premis:isIncludedIn ?instantiation ;
                                            a ebucore:MediaResource .
                                    }
                                    } GROUP BY (?record)
                                    HAVING (?instantiations > 1)
                                }
                                ?record rico:hasInstantiation ?instantiation .
                                MINUS { ?original rico:hasDerivedInstantiation ?instantiation . }
                                FILTER NOT EXISTS { ?instantiation spao:hasArchivalStatus spav:asarm . }
                                FILTER(!CONTAINS(STR(?instantiation), "/iiif"))
                                ?instantiation rico:identifier ?identifier .
                                FILTER(CONTAINS(?identifier, "SKD") || CONTAINS(?identifier, "SKB") || CONTAINS(?identifier, "DIG-NK") || CONTAINS(?identifier, "DIGK-NK"))
                                OPTIONAL {
                                    ?instantiation rico:history ?history . 
                                    FILTER(!CONTAINS(LCASE(?history), "kein archivmaster"))
                                }                                        
                            }
                        }
                        BIND(IF(?count = 0, "🥳", "😱") AS ?icon)
                    }' 
                    template='<div style="padding: 6em;">{{#each bindings}}<h1>{{count.value}} video copies without source … {{icon.value}}</h1>{{/each}}</div>'>
                  </semantic-query>
                    
                </bs-col>
                <bs-col sm="8">

                    <semantic-table 
                    query='SELECT DISTINCT ?instantiation WHERE {
                        {
                            SELECT ?record (COUNT(DISTINCT ?instantiation) AS ?instantiations) {
                            ?record rico:hasInstantiation ?instantiation .
                            {
                                ?instantiation a ebucore:MediaResource . 
                            } UNION { 
                                ?file premis:isIncludedIn ?instantiation ;
                                    a ebucore:MediaResource .
                            }
                            } GROUP BY (?record)
                            HAVING (?instantiations > 1)
                        }
                        ?record rico:hasInstantiation ?instantiation .
                        MINUS { ?original rico:hasDerivedInstantiation ?instantiation . }
                        FILTER NOT EXISTS { ?instantiation spao:hasArchivalStatus spav:asarm . }
                        FILTER(!CONTAINS(STR(?instantiation), "/iiif"))
                        ?instantiation rico:identifier ?identifier .
                        FILTER(CONTAINS(?identifier, "SKD") || CONTAINS(?identifier, "SKB") || CONTAINS(?identifier, "DIG-NK") || CONTAINS(?identifier, "DIGK-NK"))
                        OPTIONAL {
                            ?instantiation rico:history ?history . 
                            FILTER(!CONTAINS(LCASE(?history), "kein archivmaster"))
                        }
                        } ORDER BY ASC(?identifier)' 
                    column-configuration='[
                        {"variableName": "instantiation", "displayName": "Instantiation"}
                    ]'
                    number-of-displayed-rows=20
                    no-result-template='No results found.'
                    options='{"showFilter": true}'>
                    </semantic-table>

                </bs-col>
            </bs-row>            

        </bs-tab>

        <bs-tab event-key='11' title='Places'>

            <bs-row>
                <bs-col sm="4">
                    <h5 style="padding: 0.4em 1em;">Places without labels in all 4 languages</h5>
                </bs-col>
                <bs-col sm="8">

                    <semantic-table 
                    query='SELECT ?place (COUNT(?place_label) as ?labels) WHERE {
                        ?place a crm:E53_Place .
                        FILTER(CONTAINS(STR(?place), "/p/"))
                        ?place rdfs:label ?place_label .
                        BIND(LANG(?place_label) AS ?lang)
                        FILTER(?lang IN ("en", "de", "fr", "it"))
                    } GROUP BY (?place)
                    HAVING (?labels < 4)' 
                    column-configuration='[
                        {"variableName": "place", "displayName": "Place"}
                    ]'
                    number-of-displayed-rows=20
                    no-result-template='No results found.'
                    options='{"showFilter": false}'>
                    </semantic-table>

                </bs-col>
            </bs-row>            

        </bs-tab>

    </bs-tabs>

  [[/if]]
  </div>
</div>