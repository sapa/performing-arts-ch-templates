<ol class="page-breadcrumb">
  <li>
    <mp-link title="Home" url="/">Home</mp-link>
  </li>
</ol>

<div class="page">

  <div class="sapa-component panel-home-search page__header">
    
      <div class="page__body">
        <h3>[[i18n "SearchGeneric" bundle="performing-arts-ch"]]</h3>
        [[> component-search]]
      </div>
    
  </div>

  <div class='sapa-component panel-home-browse page__body'>

    <bs-tab-container default-active-key="search">
      <h3>[[i18n "BrowseGeneric" bundle="performing-arts-ch"]]</h3>


    <div class="sapa-component domain-cards-tabs">
      <bs-nav variant="pills">
        <!-- TODO: recycle buttons with icons-->
          [[#> component-domain-cards-holder]]
          <bs-nav-item>
            <bs-nav-link event-key="productions">
              [[> component-domain-card 
                label=(i18n "BrowseProductions" bundle="performing-arts-ch")
                thumbnail="../assets/icons/solid/theater-masks.svg"
              ]]
            </bs-nav-link>
          </bs-nav-item>
          <bs-nav-item>
            <bs-nav-link event-key="persons">
              [[> component-domain-card
                label=(i18n "BrowsePersons" bundle="performing-arts-ch")
                thumbnail="../assets/icons/solid/user.svg"
              ]]
            </bs-nav-link>
          </bs-nav-item>
          <bs-nav-item>
            <bs-nav-link event-key="groups">
              [[> component-domain-card
                label=(i18n "BrowseGroups" bundle="performing-arts-ch")
                thumbnail="../assets/icons/solid/users.svg"
              ]]
            </bs-nav-link>
          </bs-nav-item>
          <bs-nav-item>
            <bs-nav-link event-key="venues">
              [[> component-domain-card
                label=(i18n "BrowseVenues" bundle="performing-arts-ch")
                thumbnail="../assets/icons/solid/landmark.svg"
              ]]
            </bs-nav-link>
          </bs-nav-item>
          <bs-nav-item>
            <bs-nav-link event-key="places">
              [[> component-domain-card
                label=(i18n "BrowsePlaces" bundle="performing-arts-ch")
                thumbnail="../assets/icons/solid/map-marker-alt.svg"
              ]]
            </bs-nav-link>
          </bs-nav-item>
          [[/ component-domain-cards-holder]]
      </bs-nav>
      <bs-tab-content>
        <bs-tab-pane event-key="productions">
          [[> component-browse domain="frbroo:F25_Performance_Plan" id="browse-productions"]]
        </bs-tab-pane>
        <bs-tab-pane event-key="persons">
          [[> component-browse domain="crm:E21_Person" id="browse-persons"]]
        </bs-tab-pane>
        <bs-tab-pane event-key="groups">
          <!-- TODO: Groups also include E40-->
          [[> component-browse domain="crm:E74_Group" id="browse-groups"]]
        </bs-tab-pane>
        <bs-tab-pane event-key="venues">
          <!-- TODO: E22 has a specifier in query-->
          [[> component-browse domain="crm:E22_Man-Made_Object" id="browse-venues"]]
        </bs-tab-pane>
        <bs-tab-pane event-key="places">
          [[> component-browse domain="crm:E53_Place" id="browse-places"]]
        </bs-tab-pane>
      </bs-tab-content>
    </bs-tab-container>
  </div>
</div>

[[#*inline "component-browse"]]

    [[#> sapaModule:BaseSearch id=id]] 

      [[> component-keyword-search domain=domain]]
      
      <semantic-search-query-constant
        query="SELECT DISTINCT ?subject WHERE {
          ?subject a [[domain]] .
        }"
        domain='<[[resolvePrefix domain]]>'>
        </semantic-search-query-constant>
    [[/ sapaModule:BaseSearch]]

[[/inline]]

[[#*inline "component-domain-card"]]
  <div class="domainCardItem">
    <button type=button class='btn btn-secondary domainCard'>
      <div class='domainCardThumbnail'>
        [[#if thumbnail]]
          <img src='[[thumbnail]]' alt='[[label]]' /> 
        [[else]]
          <i class='fa fa-edit fa-lg'></i>
        [[/if]]
      </div>
      <h4>[[label]]</h4>
      [[#if count]]<div>[[count]]</div>[[/if]]
    </button>
  </div>
[[/inline]]

[[#*inline "component-domain-cards-holder"]]
  <div class="domainCards">
    <div data-flex-layout="rows stretch-stretch">
      [[> @partial-block]]
    </div>
  </div>
[[/inline]]

[[#*inline "component-search"]]

[[#> sapaModule:BaseSearch searchAllDomains="true"]]    
    [[> component-keyword-search]]
[[/ sapaModule:BaseSearch]]

[[/inline]]

[[#*inline "component-keyword-search"]]

<semantic-search-query-keyword 
id='keywordQuery-[[#if domain]][[domain]][[else]]global[[/if]]'
domain="[[#if domain]]<[[resolvePrefix domain]]>[[else]]<http://www.cidoc-crm.org/cidoc-crm/E1_CRM_Entity>[[/if]]"
query='SELECT DISTINCT ?subject WHERE {
  [[#if domain]]
    BIND([[domain]] as ?__domain__)
  [[else]]
    VALUES(?__domain__) {
      (frbroo:F25_Performance_Plan)
      (crm:E21_Person)
      (crm:E74_Group)
      (crm:E40_Legal_Body)
      (crm:E22_Man-Made_Object)
      (crm:E53_Place)
    }
  [[/if]]
  ?subject rdf:type|rdf:type/rdfs:subClassOf ?__domain__ . 
  FILTER(!CONTAINS(STR(?subject), "/u/") && !CONTAINS(STR(?subject), "/x/"))
  OPTIONAL { 
    ?subject crm:P2_has_type ?crmtype . 
    FILTER(?__domain__ != crm:E22_Man-Made_Object || ?crmtype = spav:dwmkn )
  }
  ?subject rdfs:label|(crm:P131_is_identified_by/rdf:value)|(crm:P102_has_title/rdf:value) ?label .
  SERVICE <http://www.bigdata.com/rdf/search#search> {
    ?label bds:search ?__token__ ;
    bds:minRelevance "0.1" ;
    bds:relevance ?score ; 
    bds:matchAllTerms "true" .
  }
}'
placeholder='[[i18n "SearchPrompt" bundle="performing-arts-ch" escapeHTML=false]]'
min-search-term-length='1'
debounce='600'
>

</semantic-search-query-keyword>
[[/inline]]