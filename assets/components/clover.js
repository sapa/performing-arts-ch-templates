(function(Sr){typeof define=="function"&&define.amd?define(Sr):Sr()})(function(){"use strict";var Fr=Object.defineProperty;var Br=(Sr,et,_e)=>et in Sr?Fr(Sr,et,{enumerable:!0,configurable:!0,writable:!0,value:_e}):Sr[et]=_e;var Tr=(Sr,et,_e)=>(Br(Sr,typeof et!="symbol"?et+"":et,_e),_e);var Sr;var n$2,l$2,u$3,i$2,o$3,r$2,f$2,e$2,c$2={},s$3=[],a$3=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,h$2=Array.isArray;function v$3(et,_e){for(var tt in _e)et[tt]=_e[tt];return et}function p$3(et){var _e=et.parentNode;_e&&_e.removeChild(et)}function y$3(et,_e,tt){var rt,nt,it,st={};for(it in _e)it=="key"?rt=_e[it]:it=="ref"?nt=_e[it]:st[it]=_e[it];if(arguments.length>2&&(st.children=arguments.length>3?n$2.call(arguments,2):tt),typeof et=="function"&&et.defaultProps!=null)for(it in et.defaultProps)st[it]===void 0&&(st[it]=et.defaultProps[it]);return d$2(et,st,rt,nt,null)}function d$2(et,_e,tt,rt,nt){var it={type:et,props:_e,key:tt,ref:rt,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:nt??++u$3,__i:-1,__u:0};return nt==null&&l$2.vnode!=null&&l$2.vnode(it),it}function _$1(){return{current:null}}function g$3(et){return et.children}function b$2(et,_e){this.props=et,this.context=_e}function m$2(et,_e){if(_e==null)return et.__?m$2(et.__,et.__i+1):null;for(var tt;_e<et.__k.length;_e++)if((tt=et.__k[_e])!=null&&tt.__e!=null)return tt.__e;return typeof et.type=="function"?m$2(et):null}function w$3(et,_e,tt){var rt,nt=et.__v,it=nt.__e,st=et.__P;if(st)return(rt=v$3({},nt)).__v=nt.__v+1,l$2.vnode&&l$2.vnode(rt),M$3(st,rt,nt,et.__n,st.ownerSVGElement!==void 0,32&nt.__u?[it]:null,_e,it??m$2(nt),!!(32&nt.__u),tt),rt.__v=nt.__v,rt.__.__k[rt.__i]=rt,rt.__d=void 0,rt.__e!=it&&k$3(rt),rt}function k$3(et){var _e,tt;if((et=et.__)!=null&&et.__c!=null){for(et.__e=et.__c.base=null,_e=0;_e<et.__k.length;_e++)if((tt=et.__k[_e])!=null&&tt.__e!=null){et.__e=et.__c.base=tt.__e;break}return k$3(et)}}function x$4(et){(!et.__d&&(et.__d=!0)&&i$2.push(et)&&!C$4.__r++||o$3!==l$2.debounceRendering)&&((o$3=l$2.debounceRendering)||r$2)(C$4)}function C$4(){var et,_e,tt,rt=[],nt=[];for(i$2.sort(f$2);et=i$2.shift();)et.__d&&(tt=i$2.length,_e=w$3(et,rt,nt)||_e,tt===0||i$2.length>tt?(j$3(rt,_e,nt),nt.length=rt.length=0,_e=void 0,i$2.sort(f$2)):_e&&l$2.__c&&l$2.__c(_e,s$3));_e&&j$3(rt,_e,nt),C$4.__r=0}function P$4(et,_e,tt,rt,nt,it,st,ot,at,lt,ut){var ct,dt,ft,pt,mt,ht=rt&&rt.__k||s$3,gt=_e.length;for(tt.__d=at,S$2(tt,_e,ht),at=tt.__d,ct=0;ct<gt;ct++)(ft=tt.__k[ct])!=null&&typeof ft!="boolean"&&typeof ft!="function"&&(dt=ft.__i===-1?c$2:ht[ft.__i]||c$2,ft.__i=ct,M$3(et,ft,dt,nt,it,st,ot,at,lt,ut),pt=ft.__e,ft.ref&&dt.ref!=ft.ref&&(dt.ref&&N$3(dt.ref,null,ft),ut.push(ft.ref,ft.__c||pt,ft)),mt==null&&pt!=null&&(mt=pt),65536&ft.__u||dt.__k===ft.__k?at=$$3(ft,at,et):typeof ft.type=="function"&&ft.__d!==void 0?at=ft.__d:pt&&(at=pt.nextSibling),ft.__d=void 0,ft.__u&=-196609);tt.__d=at,tt.__e=mt}function S$2(et,_e,tt){var rt,nt,it,st,ot,at=_e.length,lt=tt.length,ut=lt,ct=0;for(et.__k=[],rt=0;rt<at;rt++)st=rt+ct,(nt=et.__k[rt]=(nt=_e[rt])==null||typeof nt=="boolean"||typeof nt=="function"?null:typeof nt=="string"||typeof nt=="number"||typeof nt=="bigint"||nt.constructor==String?d$2(null,nt,null,null,null):h$2(nt)?d$2(g$3,{children:nt},null,null,null):nt.constructor===void 0&&nt.__b>0?d$2(nt.type,nt.props,nt.key,nt.ref?nt.ref:null,nt.__v):nt)!=null?(nt.__=et,nt.__b=et.__b+1,ot=I$3(nt,tt,st,ut),nt.__i=ot,it=null,ot!==-1&&(ut--,(it=tt[ot])&&(it.__u|=131072)),it==null||it.__v===null?(ot==-1&&ct--,typeof nt.type!="function"&&(nt.__u|=65536)):ot!==st&&(ot===st+1?ct++:ot>st?ut>at-st?ct+=ot-st:ct--:ot<st?ot==st-1&&(ct=ot-st):ct=0,ot!==rt+ct&&(nt.__u|=65536))):(it=tt[st])&&it.key==null&&it.__e&&!(131072&it.__u)&&(it.__e==et.__d&&(et.__d=m$2(it)),O$3(it,it,!1),tt[st]=null,ut--);if(ut)for(rt=0;rt<lt;rt++)(it=tt[rt])!=null&&!(131072&it.__u)&&(it.__e==et.__d&&(et.__d=m$2(it)),O$3(it,it))}function $$3(et,_e,tt){var rt,nt;if(typeof et.type=="function"){for(rt=et.__k,nt=0;rt&&nt<rt.length;nt++)rt[nt]&&(rt[nt].__=et,_e=$$3(rt[nt],_e,tt));return _e}et.__e!=_e&&(tt.insertBefore(et.__e,_e||null),_e=et.__e);do _e=_e&&_e.nextSibling;while(_e!=null&&_e.nodeType===8);return _e}function H$3(et,_e){return _e=_e||[],et==null||typeof et=="boolean"||(h$2(et)?et.some(function(tt){H$3(tt,_e)}):_e.push(et)),_e}function I$3(et,_e,tt,rt){var nt=et.key,it=et.type,st=tt-1,ot=tt+1,at=_e[tt];if(at===null||at&&nt==at.key&&it===at.type&&!(131072&at.__u))return tt;if(rt>(at!=null&&!(131072&at.__u)?1:0))for(;st>=0||ot<_e.length;){if(st>=0){if((at=_e[st])&&!(131072&at.__u)&&nt==at.key&&it===at.type)return st;st--}if(ot<_e.length){if((at=_e[ot])&&!(131072&at.__u)&&nt==at.key&&it===at.type)return ot;ot++}}return-1}function T$4(et,_e,tt){_e[0]==="-"?et.setProperty(_e,tt??""):et[_e]=tt==null?"":typeof tt!="number"||a$3.test(_e)?tt:tt+"px"}function A$4(et,_e,tt,rt,nt){var it;e:if(_e==="style")if(typeof tt=="string")et.style.cssText=tt;else{if(typeof rt=="string"&&(et.style.cssText=rt=""),rt)for(_e in rt)tt&&_e in tt||T$4(et.style,_e,"");if(tt)for(_e in tt)rt&&tt[_e]===rt[_e]||T$4(et.style,_e,tt[_e])}else if(_e[0]==="o"&&_e[1]==="n")it=_e!==(_e=_e.replace(/(PointerCapture)$|Capture$/i,"$1")),_e=_e.toLowerCase()in et?_e.toLowerCase().slice(2):_e.slice(2),et.l||(et.l={}),et.l[_e+it]=tt,tt?rt?tt.u=rt.u:(tt.u=Date.now(),et.addEventListener(_e,it?L$3:D$4,it)):et.removeEventListener(_e,it?L$3:D$4,it);else{if(nt)_e=_e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(_e!=="width"&&_e!=="height"&&_e!=="href"&&_e!=="list"&&_e!=="form"&&_e!=="tabIndex"&&_e!=="download"&&_e!=="rowSpan"&&_e!=="colSpan"&&_e!=="role"&&_e in et)try{et[_e]=tt??"";break e}catch{}typeof tt=="function"||(tt==null||tt===!1&&_e[4]!=="-"?et.removeAttribute(_e):et.setAttribute(_e,tt))}}function D$4(et){if(this.l){var _e=this.l[et.type+!1];if(et.t){if(et.t<=_e.u)return}else et.t=Date.now();return _e(l$2.event?l$2.event(et):et)}}function L$3(et){if(this.l)return this.l[et.type+!0](l$2.event?l$2.event(et):et)}function M$3(et,_e,tt,rt,nt,it,st,ot,at,lt){var ut,ct,dt,ft,pt,mt,ht,gt,vt,yt,bt,xt,_t,wt,Ct,kt=_e.type;if(_e.constructor!==void 0)return null;128&tt.__u&&(at=!!(32&tt.__u),it=[ot=_e.__e=tt.__e]),(ut=l$2.__b)&&ut(_e);e:if(typeof kt=="function")try{if(gt=_e.props,vt=(ut=kt.contextType)&&rt[ut.__c],yt=ut?vt?vt.props.value:ut.__:rt,tt.__c?ht=(ct=_e.__c=tt.__c).__=ct.__E:("prototype"in kt&&kt.prototype.render?_e.__c=ct=new kt(gt,yt):(_e.__c=ct=new b$2(gt,yt),ct.constructor=kt,ct.render=q$3),vt&&vt.sub(ct),ct.props=gt,ct.state||(ct.state={}),ct.context=yt,ct.__n=rt,dt=ct.__d=!0,ct.__h=[],ct._sb=[]),ct.__s==null&&(ct.__s=ct.state),kt.getDerivedStateFromProps!=null&&(ct.__s==ct.state&&(ct.__s=v$3({},ct.__s)),v$3(ct.__s,kt.getDerivedStateFromProps(gt,ct.__s))),ft=ct.props,pt=ct.state,ct.__v=_e,dt)kt.getDerivedStateFromProps==null&&ct.componentWillMount!=null&&ct.componentWillMount(),ct.componentDidMount!=null&&ct.__h.push(ct.componentDidMount);else{if(kt.getDerivedStateFromProps==null&&gt!==ft&&ct.componentWillReceiveProps!=null&&ct.componentWillReceiveProps(gt,yt),!ct.__e&&(ct.shouldComponentUpdate!=null&&ct.shouldComponentUpdate(gt,ct.__s,yt)===!1||_e.__v===tt.__v)){for(_e.__v!==tt.__v&&(ct.props=gt,ct.state=ct.__s,ct.__d=!1),_e.__e=tt.__e,_e.__k=tt.__k,_e.__k.forEach(function(At){At&&(At.__=_e)}),bt=0;bt<ct._sb.length;bt++)ct.__h.push(ct._sb[bt]);ct._sb=[],ct.__h.length&&st.push(ct);break e}ct.componentWillUpdate!=null&&ct.componentWillUpdate(gt,ct.__s,yt),ct.componentDidUpdate!=null&&ct.__h.push(function(){ct.componentDidUpdate(ft,pt,mt)})}if(ct.context=yt,ct.props=gt,ct.__P=et,ct.__e=!1,xt=l$2.__r,_t=0,"prototype"in kt&&kt.prototype.render){for(ct.state=ct.__s,ct.__d=!1,xt&&xt(_e),ut=ct.render(ct.props,ct.state,ct.context),wt=0;wt<ct._sb.length;wt++)ct.__h.push(ct._sb[wt]);ct._sb=[]}else do ct.__d=!1,xt&&xt(_e),ut=ct.render(ct.props,ct.state,ct.context),ct.state=ct.__s;while(ct.__d&&++_t<25);ct.state=ct.__s,ct.getChildContext!=null&&(rt=v$3(v$3({},rt),ct.getChildContext())),dt||ct.getSnapshotBeforeUpdate==null||(mt=ct.getSnapshotBeforeUpdate(ft,pt)),P$4(et,h$2(Ct=ut!=null&&ut.type===g$3&&ut.key==null?ut.props.children:ut)?Ct:[Ct],_e,tt,rt,nt,it,st,ot,at,lt),ct.base=_e.__e,_e.__u&=-161,ct.__h.length&&st.push(ct),ht&&(ct.__E=ct.__=null)}catch(At){_e.__v=null,at||it!=null?(_e.__e=ot,_e.__u|=at?160:32,it[it.indexOf(ot)]=null):(_e.__e=tt.__e,_e.__k=tt.__k),l$2.__e(At,_e,tt)}else it==null&&_e.__v===tt.__v?(_e.__k=tt.__k,_e.__e=tt.__e):_e.__e=z$4(tt.__e,_e,tt,rt,nt,it,st,at,lt);(ut=l$2.diffed)&&ut(_e)}function j$3(et,_e,tt){for(var rt=0;rt<tt.length;rt++)N$3(tt[rt],tt[++rt],tt[++rt]);l$2.__c&&l$2.__c(_e,et),et.some(function(nt){try{et=nt.__h,nt.__h=[],et.some(function(it){it.call(nt)})}catch(it){l$2.__e(it,nt.__v)}})}function z$4(et,_e,tt,rt,nt,it,st,ot,at){var lt,ut,ct,dt,ft,pt,mt,ht=tt.props,gt=_e.props,vt=_e.type;if(vt==="svg"&&(nt=!0),it!=null){for(lt=0;lt<it.length;lt++)if((ft=it[lt])&&"setAttribute"in ft==!!vt&&(vt?ft.localName===vt:ft.nodeType===3)){et=ft,it[lt]=null;break}}if(et==null){if(vt===null)return document.createTextNode(gt);et=nt?document.createElementNS("http://www.w3.org/2000/svg",vt):document.createElement(vt,gt.is&&gt),it=null,ot=!1}if(vt===null)ht===gt||ot&&et.data===gt||(et.data=gt);else{if(it=it&&n$2.call(et.childNodes),ht=tt.props||c$2,!ot&&it!=null)for(ht={},lt=0;lt<et.attributes.length;lt++)ht[(ft=et.attributes[lt]).name]=ft.value;for(lt in ht)ft=ht[lt],lt=="children"||(lt=="dangerouslySetInnerHTML"?ct=ft:lt==="key"||lt in gt||A$4(et,lt,null,ft,nt));for(lt in gt)ft=gt[lt],lt=="children"?dt=ft:lt=="dangerouslySetInnerHTML"?ut=ft:lt=="value"?pt=ft:lt=="checked"?mt=ft:lt==="key"||ot&&typeof ft!="function"||ht[lt]===ft||A$4(et,lt,ft,ht[lt],nt);if(ut)ot||ct&&(ut.__html===ct.__html||ut.__html===et.innerHTML)||(et.innerHTML=ut.__html),_e.__k=[];else if(ct&&(et.innerHTML=""),P$4(et,h$2(dt)?dt:[dt],_e,tt,rt,nt&&vt!=="foreignObject",it,st,it?it[0]:tt.__k&&m$2(tt,0),ot,at),it!=null)for(lt=it.length;lt--;)it[lt]!=null&&p$3(it[lt]);ot||(lt="value",pt!==void 0&&(pt!==et[lt]||vt==="progress"&&!pt||vt==="option"&&pt!==ht[lt])&&A$4(et,lt,pt,ht[lt],!1),lt="checked",mt!==void 0&&mt!==et[lt]&&A$4(et,lt,mt,ht[lt],!1))}return et}function N$3(et,_e,tt){try{typeof et=="function"?et(_e):et.current=_e}catch(rt){l$2.__e(rt,tt)}}function O$3(et,_e,tt){var rt,nt;if(l$2.unmount&&l$2.unmount(et),(rt=et.ref)&&(rt.current&&rt.current!==et.__e||N$3(rt,null,_e)),(rt=et.__c)!=null){if(rt.componentWillUnmount)try{rt.componentWillUnmount()}catch(it){l$2.__e(it,_e)}rt.base=rt.__P=null,et.__c=void 0}if(rt=et.__k)for(nt=0;nt<rt.length;nt++)rt[nt]&&O$3(rt[nt],_e,tt||typeof et.type!="function");tt||et.__e==null||p$3(et.__e),et.__=et.__e=et.__d=void 0}function q$3(et,_e,tt){return this.constructor(et,tt)}function B$4(et,_e,tt){var rt,nt,it,st;l$2.__&&l$2.__(et,_e),nt=(rt=typeof tt=="function")?null:tt&&tt.__k||_e.__k,it=[],st=[],M$3(_e,et=(!rt&&tt||_e).__k=y$3(g$3,null,[et]),nt||c$2,c$2,_e.ownerSVGElement!==void 0,!rt&&tt?[tt]:nt?null:_e.firstChild?n$2.call(_e.childNodes):null,it,!rt&&tt?tt:nt?nt.__e:_e.firstChild,rt,st),et.__d=void 0,j$3(it,et,st)}function E$3(et,_e){B$4(et,_e,E$3)}function F$3(et,_e,tt){var rt,nt,it,st,ot=v$3({},et.props);for(it in et.type&&et.type.defaultProps&&(st=et.type.defaultProps),_e)it=="key"?rt=_e[it]:it=="ref"?nt=_e[it]:ot[it]=_e[it]===void 0&&st!==void 0?st[it]:_e[it];return arguments.length>2&&(ot.children=arguments.length>3?n$2.call(arguments,2):tt),d$2(et.type,ot,rt||et.key,nt||et.ref,null)}function G$3(et,_e){var tt={__c:_e="__cC"+e$2++,__:et,Consumer:function(rt,nt){return rt.children(nt)},Provider:function(rt){var nt,it;return this.getChildContext||(nt=[],(it={})[_e]=this,this.getChildContext=function(){return it},this.shouldComponentUpdate=function(st){this.props.value!==st.value&&nt.some(function(ot){ot.__e=!0,x$4(ot)})},this.sub=function(st){nt.push(st);var ot=st.componentWillUnmount;st.componentWillUnmount=function(){nt.splice(nt.indexOf(st),1),ot&&ot.call(st)}}),rt.children}};return tt.Provider.__=tt.Consumer.contextType=tt}n$2=s$3.slice,l$2={__e:function(et,_e,tt,rt){for(var nt,it,st;_e=_e.__;)if((nt=_e.__c)&&!nt.__)try{if((it=nt.constructor)&&it.getDerivedStateFromError!=null&&(nt.setState(it.getDerivedStateFromError(et)),st=nt.__d),nt.componentDidCatch!=null&&(nt.componentDidCatch(et,rt||{}),st=nt.__d),st)return nt.__E=nt}catch(ot){et=ot}throw et}},u$3=0,b$2.prototype.setState=function(et,_e){var tt;tt=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=v$3({},this.state),typeof et=="function"&&(et=et(v$3({},tt),this.props)),et&&v$3(tt,et),et!=null&&this.__v&&(_e&&this._sb.push(_e),x$4(this))},b$2.prototype.forceUpdate=function(et){this.__v&&(this.__e=!0,et&&this.__h.push(et),x$4(this))},b$2.prototype.render=g$3,i$2=[],r$2=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,f$2=function(et,_e){return et.__v.__b-_e.__v.__b},C$4.__r=0,e$2=0;var t$2,r$1,u$2,i$1,o$2=0,f$1=[],c$1=[],e$1=l$2,a$2=e$1.__b,v$2=e$1.__r,l$1=e$1.diffed,m$1=e$1.__c,s$2=e$1.unmount,d$1=e$1.__;function h$1(et,_e){e$1.__h&&e$1.__h(r$1,et,o$2||_e),o$2=0;var tt=r$1.__H||(r$1.__H={__:[],__h:[]});return et>=tt.__.length&&tt.__.push({__V:c$1}),tt.__[et]}function p$2(et){return o$2=1,y$2(D$3,et)}function y$2(et,_e,tt){var rt=h$1(t$2++,2);if(rt.t=et,!rt.__c&&(rt.__=[tt?tt(_e):D$3(void 0,_e),function(ot){var at=rt.__N?rt.__N[0]:rt.__[0],lt=rt.t(at,ot);at!==lt&&(rt.__N=[lt,rt.__[1]],rt.__c.setState({}))}],rt.__c=r$1,!r$1.u)){var nt=function(ot,at,lt){if(!rt.__c.__H)return!0;var ut=rt.__c.__H.__.filter(function(dt){return!!dt.__c});if(ut.every(function(dt){return!dt.__N}))return!it||it.call(this,ot,at,lt);var ct=!1;return ut.forEach(function(dt){if(dt.__N){var ft=dt.__[0];dt.__=dt.__N,dt.__N=void 0,ft!==dt.__[0]&&(ct=!0)}}),!(!ct&&rt.__c.props===ot)&&(!it||it.call(this,ot,at,lt))};r$1.u=!0;var it=r$1.shouldComponentUpdate,st=r$1.componentWillUpdate;r$1.componentWillUpdate=function(ot,at,lt){if(this.__e){var ut=it;it=void 0,nt(ot,at,lt),it=ut}st&&st.call(this,ot,at,lt)},r$1.shouldComponentUpdate=nt}return rt.__N||rt.__}function _(et,_e){var tt=h$1(t$2++,3);!e$1.__s&&C$3(tt.__H,_e)&&(tt.__=et,tt.i=_e,r$1.__H.__h.push(tt))}function A$3(et,_e){var tt=h$1(t$2++,4);!e$1.__s&&C$3(tt.__H,_e)&&(tt.__=et,tt.i=_e,r$1.__h.push(tt))}function F$2(et){return o$2=5,q$2(function(){return{current:et}},[])}function T$3(et,_e,tt){o$2=6,A$3(function(){return typeof et=="function"?(et(_e()),function(){return et(null)}):et?(et.current=_e(),function(){return et.current=null}):void 0},tt==null?tt:tt.concat(et))}function q$2(et,_e){var tt=h$1(t$2++,7);return C$3(tt.__H,_e)?(tt.__V=et(),tt.i=_e,tt.__h=et,tt.__V):tt.__}function x$3(et,_e){return o$2=8,q$2(function(){return et},_e)}function P$3(et){var _e=r$1.context[et.__c],tt=h$1(t$2++,9);return tt.c=et,_e?(tt.__==null&&(tt.__=!0,_e.sub(r$1)),_e.props.value):et.__}function V$3(et,_e){e$1.useDebugValue&&e$1.useDebugValue(_e?_e(et):et)}function b$1(et){var _e=h$1(t$2++,10),tt=p$2();return _e.__=et,r$1.componentDidCatch||(r$1.componentDidCatch=function(rt,nt){_e.__&&_e.__(rt,nt),tt[1](rt)}),[tt[0],function(){tt[1](void 0)}]}function g$2(){var et=h$1(t$2++,11);if(!et.__){for(var _e=r$1.__v;_e!==null&&!_e.__m&&_e.__!==null;)_e=_e.__;var tt=_e.__m||(_e.__m=[0,0]);et.__="P"+tt[0]+"-"+tt[1]++}return et.__}function j$2(){for(var et;et=f$1.shift();)if(et.__P&&et.__H)try{et.__H.__h.forEach(z$3),et.__H.__h.forEach(B$3),et.__H.__h=[]}catch(_e){et.__H.__h=[],e$1.__e(_e,et.__v)}}e$1.__b=function(et){r$1=null,a$2&&a$2(et)},e$1.__=function(et,_e){et&&_e.__k&&_e.__k.__m&&(et.__m=_e.__k.__m),d$1&&d$1(et,_e)},e$1.__r=function(et){v$2&&v$2(et),t$2=0;var _e=(r$1=et.__c).__H;_e&&(u$2===r$1?(_e.__h=[],r$1.__h=[],_e.__.forEach(function(tt){tt.__N&&(tt.__=tt.__N),tt.__V=c$1,tt.__N=tt.i=void 0})):(_e.__h.forEach(z$3),_e.__h.forEach(B$3),_e.__h=[],t$2=0)),u$2=r$1},e$1.diffed=function(et){l$1&&l$1(et);var _e=et.__c;_e&&_e.__H&&(_e.__H.__h.length&&(f$1.push(_e)!==1&&i$1===e$1.requestAnimationFrame||((i$1=e$1.requestAnimationFrame)||w$2)(j$2)),_e.__H.__.forEach(function(tt){tt.i&&(tt.__H=tt.i),tt.__V!==c$1&&(tt.__=tt.__V),tt.i=void 0,tt.__V=c$1})),u$2=r$1=null},e$1.__c=function(et,_e){_e.some(function(tt){try{tt.__h.forEach(z$3),tt.__h=tt.__h.filter(function(rt){return!rt.__||B$3(rt)})}catch(rt){_e.some(function(nt){nt.__h&&(nt.__h=[])}),_e=[],e$1.__e(rt,tt.__v)}}),m$1&&m$1(et,_e)},e$1.unmount=function(et){s$2&&s$2(et);var _e,tt=et.__c;tt&&tt.__H&&(tt.__H.__.forEach(function(rt){try{z$3(rt)}catch(nt){_e=nt}}),tt.__H=void 0,_e&&e$1.__e(_e,tt.__v))};var k$2=typeof requestAnimationFrame=="function";function w$2(et){var _e,tt=function(){clearTimeout(rt),k$2&&cancelAnimationFrame(_e),setTimeout(et)},rt=setTimeout(tt,100);k$2&&(_e=requestAnimationFrame(tt))}function z$3(et){var _e=r$1,tt=et.__c;typeof tt=="function"&&(et.__c=void 0,tt()),r$1=_e}function B$3(et){var _e=r$1;et.__c=et.__(),r$1=_e}function C$3(et,_e){return!et||et.length!==_e.length||_e.some(function(tt,rt){return tt!==et[rt]})}function D$3(et,_e){return typeof _e=="function"?_e(et):_e}function g$1(et,_e){for(var tt in _e)et[tt]=_e[tt];return et}function C$2(et,_e){for(var tt in et)if(tt!=="__source"&&!(tt in _e))return!0;for(var rt in _e)if(rt!=="__source"&&et[rt]!==_e[rt])return!0;return!1}function E$2(et,_e){this.props=et,this.context=_e}function w$1(et,_e){function tt(nt){var it=this.props.ref,st=it==nt.ref;return!st&&it&&(it.call?it(null):it.current=null),_e?!_e(this.props,nt)||!st:C$2(this.props,nt)}function rt(nt){return this.shouldComponentUpdate=tt,y$3(et,nt)}return rt.displayName="Memo("+(et.displayName||et.name)+")",rt.prototype.isReactComponent=!0,rt.__f=!0,rt}(E$2.prototype=new b$2).isPureReactComponent=!0,E$2.prototype.shouldComponentUpdate=function(et,_e){return C$2(this.props,et)||C$2(this.state,_e)};var x$2=l$2.__b;l$2.__b=function(et){et.type&&et.type.__f&&et.ref&&(et.props.ref=et.ref,et.ref=null),x$2&&x$2(et)};var R$2=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function N$2(et){function _e(tt){var rt=g$1({},tt);return delete rt.ref,et(rt,tt.ref||null)}return _e.$$typeof=R$2,_e.render=_e,_e.prototype.isReactComponent=_e.__f=!0,_e.displayName="ForwardRef("+(et.displayName||et.name)+")",_e}var k$1=function(et,_e){return et==null?null:H$3(H$3(et).map(_e))},A$2={map:k$1,forEach:k$1,count:function(et){return et?H$3(et).length:0},only:function(et){var _e=H$3(et);if(_e.length!==1)throw"Children.only";return _e[0]},toArray:H$3},O$2=l$2.__e;l$2.__e=function(et,_e,tt,rt){if(et.then){for(var nt,it=_e;it=it.__;)if((nt=it.__c)&&nt.__c)return _e.__e==null&&(_e.__e=tt.__e,_e.__k=tt.__k),nt.__c(et,_e)}O$2(et,_e,tt,rt)};var T$2=l$2.unmount;function F$1(et,_e,tt){return et&&(et.__c&&et.__c.__H&&(et.__c.__H.__.forEach(function(rt){typeof rt.__c=="function"&&rt.__c()}),et.__c.__H=null),(et=g$1({},et)).__c!=null&&(et.__c.__P===tt&&(et.__c.__P=_e),et.__c=null),et.__k=et.__k&&et.__k.map(function(rt){return F$1(rt,_e,tt)})),et}function I$2(et,_e,tt){return et&&tt&&(et.__v=null,et.__k=et.__k&&et.__k.map(function(rt){return I$2(rt,_e,tt)}),et.__c&&et.__c.__P===_e&&(et.__e&&tt.appendChild(et.__e),et.__c.__e=!0,et.__c.__P=tt)),et}function L$2(){this.__u=0,this.t=null,this.__b=null}function U$2(et){var _e=et.__.__c;return _e&&_e.__a&&_e.__a(et)}function D$2(et){var _e,tt,rt;function nt(it){if(_e||(_e=et()).then(function(st){tt=st.default||st},function(st){rt=st}),rt)throw rt;if(!tt)throw _e;return y$3(tt,it)}return nt.displayName="Lazy",nt.__f=!0,nt}function M$2(){this.u=null,this.o=null}l$2.unmount=function(et){var _e=et.__c;_e&&_e.__R&&_e.__R(),_e&&32&et.__u&&(et.type=null),T$2&&T$2(et)},(L$2.prototype=new b$2).__c=function(et,_e){var tt=_e.__c,rt=this;rt.t==null&&(rt.t=[]),rt.t.push(tt);var nt=U$2(rt.__v),it=!1,st=function(){it||(it=!0,tt.__R=null,nt?nt(ot):ot())};tt.__R=st;var ot=function(){if(!--rt.__u){if(rt.state.__a){var at=rt.state.__a;rt.__v.__k[0]=I$2(at,at.__c.__P,at.__c.__O)}var lt;for(rt.setState({__a:rt.__b=null});lt=rt.t.pop();)lt.forceUpdate()}};rt.__u++||32&_e.__u||rt.setState({__a:rt.__b=rt.__v.__k[0]}),et.then(st,st)},L$2.prototype.componentWillUnmount=function(){this.t=[]},L$2.prototype.render=function(et,_e){if(this.__b){if(this.__v.__k){var tt=document.createElement("div"),rt=this.__v.__k[0].__c;this.__v.__k[0]=F$1(this.__b,tt,rt.__O=rt.__P)}this.__b=null}var nt=_e.__a&&y$3(g$3,null,et.fallback);return nt&&(nt.__u&=-33),[y$3(g$3,null,_e.__a?null:et.children),nt]};var V$2=function(et,_e,tt){if(++tt[1]===tt[0]&&et.o.delete(_e),et.props.revealOrder&&(et.props.revealOrder[0]!=="t"||!et.o.size))for(tt=et.u;tt;){for(;tt.length>3;)tt.pop()();if(tt[1]<tt[0])break;et.u=tt=tt[2]}};function W$2(et){return this.getChildContext=function(){return et.context},et.children}function P$2(et){var _e=this,tt=et.i;_e.componentWillUnmount=function(){B$4(null,_e.l),_e.l=null,_e.i=null},_e.i&&_e.i!==tt&&_e.componentWillUnmount(),_e.l||(_e.i=tt,_e.l={nodeType:1,parentNode:tt,childNodes:[],appendChild:function(rt){this.childNodes.push(rt),_e.i.appendChild(rt)},insertBefore:function(rt,nt){this.childNodes.push(rt),_e.i.appendChild(rt)},removeChild:function(rt){this.childNodes.splice(this.childNodes.indexOf(rt)>>>1,1),_e.i.removeChild(rt)}}),B$4(y$3(W$2,{context:_e.context},et.__v),_e.l)}function j$1(et,_e){var tt=y$3(P$2,{__v:et,i:_e});return tt.containerInfo=_e,tt}(M$2.prototype=new b$2).__a=function(et){var _e=this,tt=U$2(_e.__v),rt=_e.o.get(et);return rt[0]++,function(nt){var it=function(){_e.props.revealOrder?(rt.push(nt),V$2(_e,et,rt)):nt()};tt?tt(it):it()}},M$2.prototype.render=function(et){this.u=null,this.o=new Map;var _e=H$3(et.children);et.revealOrder&&et.revealOrder[0]==="b"&&_e.reverse();for(var tt=_e.length;tt--;)this.o.set(_e[tt],this.u=[1,0,this.u]);return et.children},M$2.prototype.componentDidUpdate=M$2.prototype.componentDidMount=function(){var et=this;this.o.forEach(function(_e,tt){V$2(et,tt,_e)})};var z$2=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,B$2=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,H$2=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Z$1=/[A-Z0-9]/g,Y$2=typeof document<"u",$$2=function(et){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(et)};function q$1(et,_e,tt){return _e.__k==null&&(_e.textContent=""),B$4(et,_e),typeof tt=="function"&&tt(),et?et.__c:null}function G$2(et,_e,tt){return E$3(et,_e),typeof tt=="function"&&tt(),et?et.__c:null}b$2.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(et){Object.defineProperty(b$2.prototype,et,{configurable:!0,get:function(){return this["UNSAFE_"+et]},set:function(_e){Object.defineProperty(this,et,{configurable:!0,writable:!0,value:_e})}})});var J$1=l$2.event;function K$2(){}function Q$2(){return this.cancelBubble}function X$2(){return this.defaultPrevented}l$2.event=function(et){return J$1&&(et=J$1(et)),et.persist=K$2,et.isPropagationStopped=Q$2,et.isDefaultPrevented=X$2,et.nativeEvent=et};var nn,tn={enumerable:!1,configurable:!0,get:function(){return this.class}},en=l$2.vnode;l$2.vnode=function(et){typeof et.type=="string"&&function(_e){var tt=_e.props,rt=_e.type,nt={};for(var it in tt){var st=tt[it];if(!(it==="value"&&"defaultValue"in tt&&st==null||Y$2&&it==="children"&&rt==="noscript"||it==="class"||it==="className")){var ot=it.toLowerCase();it==="defaultValue"&&"value"in tt&&tt.value==null?it="value":it==="download"&&st===!0?st="":ot==="translate"&&st==="no"?st=!1:ot==="ondoubleclick"?it="ondblclick":ot!=="onchange"||rt!=="input"&&rt!=="textarea"||$$2(tt.type)?ot==="onfocus"?it="onfocusin":ot==="onblur"?it="onfocusout":H$2.test(it)?it=ot:rt.indexOf("-")===-1&&B$2.test(it)?it=it.replace(Z$1,"-$&").toLowerCase():st===null&&(st=void 0):ot=it="oninput",ot==="oninput"&&nt[it=ot]&&(it="oninputCapture"),nt[it]=st}}rt=="select"&&nt.multiple&&Array.isArray(nt.value)&&(nt.value=H$3(tt.children).forEach(function(at){at.props.selected=nt.value.indexOf(at.props.value)!=-1})),rt=="select"&&nt.defaultValue!=null&&(nt.value=H$3(tt.children).forEach(function(at){at.props.selected=nt.multiple?nt.defaultValue.indexOf(at.props.value)!=-1:nt.defaultValue==at.props.value})),tt.class&&!tt.className?(nt.class=tt.class,Object.defineProperty(nt,"className",tn)):(tt.className&&!tt.class||tt.class&&tt.className)&&(nt.class=nt.className=tt.className),_e.props=nt}(et),et.$$typeof=z$2,en&&en(et)};var rn=l$2.__r;l$2.__r=function(et){rn&&rn(et),nn=et.__c};var un=l$2.diffed;l$2.diffed=function(et){un&&un(et);var _e=et.props,tt=et.__e;tt!=null&&et.type==="textarea"&&"value"in _e&&_e.value!==tt.value&&(tt.value=_e.value==null?"":_e.value),nn=null};var on={ReactCurrentDispatcher:{current:{readContext:function(et){return nn.__n[et.__c].props.value}}}},ln="17.0.2";function cn(et){return y$3.bind(null,et)}function fn(et){return!!et&&et.$$typeof===z$2}function an(et){return fn(et)&&et.type===g$3}function sn(et){return fn(et)?F$3.apply(null,arguments):et}function hn(et){return!!et.__k&&(B$4(null,et),!0)}function vn(et){return et&&(et.base||et.nodeType===1&&et)||null}var dn=function(et,_e){return et(_e)},pn=function(et,_e){return et(_e)},mn=g$3;function yn(et){et()}function _n(et){return et}function bn(){return[!1,yn]}var Sn=A$3,gn=fn;function Cn(et,_e){var tt=_e(),rt=p$2({h:{__:tt,v:_e}}),nt=rt[0].h,it=rt[1];return A$3(function(){nt.__=tt,nt.v=_e,En(nt)&&it({h:nt})},[et,tt,_e]),_(function(){return En(nt)&&it({h:nt}),et(function(){En(nt)&&it({h:nt})})},[et]),tt}function En(et){var _e,tt,rt=et.v,nt=et.__;try{var it=rt();return!((_e=nt)===(tt=it)&&(_e!==0||1/_e==1/tt)||_e!=_e&&tt!=tt)}catch{return!0}}var wn={useState:p$2,useId:g$2,useReducer:y$2,useEffect:_,useLayoutEffect:A$3,useInsertionEffect:Sn,useTransition:bn,useDeferredValue:_n,useSyncExternalStore:Cn,startTransition:yn,useRef:F$2,useImperativeHandle:T$3,useMemo:q$2,useCallback:x$3,useContext:P$3,useDebugValue:V$3,version:"17.0.2",Children:A$2,render:q$1,hydrate:G$2,unmountComponentAtNode:hn,createPortal:j$1,createElement:y$3,createContext:G$3,createFactory:cn,cloneElement:sn,createRef:_$1,Fragment:g$3,isValidElement:fn,isElement:gn,isFragment:an,findDOMNode:vn,Component:b$2,PureComponent:E$2,memo:w$1,forwardRef:N$2,flushSync:pn,unstable_batchedUpdates:dn,StrictMode:mn,Suspense:L$2,SuspenseList:M$2,lazy:D$2,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:on};const $2AODx$react=Object.freeze(Object.defineProperty({__proto__:null,Children:A$2,Component:b$2,Fragment:g$3,PureComponent:E$2,StrictMode:mn,Suspense:L$2,SuspenseList:M$2,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:on,cloneElement:sn,createContext:G$3,createElement:y$3,createFactory:cn,createPortal:j$1,createRef:_$1,default:wn,findDOMNode:vn,flushSync:pn,forwardRef:N$2,hydrate:G$2,isElement:gn,isFragment:an,isValidElement:fn,lazy:D$2,memo:w$1,render:q$1,startTransition:yn,unmountComponentAtNode:hn,unstable_batchedUpdates:dn,useCallback:x$3,useContext:P$3,useDebugValue:V$3,useDeferredValue:_n,useEffect:_,useErrorBoundary:b$1,useId:g$2,useImperativeHandle:T$3,useInsertionEffect:Sn,useLayoutEffect:A$3,useMemo:q$2,useReducer:y$2,useRef:F$2,useState:p$2,useSyncExternalStore:Cn,useTransition:bn,version:ln},Symbol.toStringTag,{value:"Module"}));var __defProp=Object.defineProperty,__defNormalProp=(et,_e,tt)=>_e in et?__defProp(et,_e,{enumerable:!0,configurable:!0,writable:!0,value:tt}):et[_e]=tt,__publicField=(et,_e,tt)=>(__defNormalProp(et,typeof _e!="symbol"?_e+"":_e,tt),tt);const EMPTY=[];Object.freeze(EMPTY);const emptyAnnotationPage={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:EMPTY,motivation:null,label:null,thumbnail:EMPTY,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,provider:EMPTY,items:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,rendering:EMPTY,service:EMPTY},emptyCanvas={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,duration:0,height:0,width:0},emptyCollection={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,services:EMPTY},emptyManifest={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:EMPTY,behavior:EMPTY,homepage:EMPTY,items:EMPTY,label:null,logo:EMPTY,metadata:EMPTY,motivation:null,navDate:null,provider:EMPTY,partOf:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:EMPTY,requiredStatement:null,rights:null,seeAlso:EMPTY,service:EMPTY,services:EMPTY,start:null,structures:EMPTY,summary:null,thumbnail:EMPTY,viewingDirection:"left-to-right"},emptyRange={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,start:null,supplementary:null,viewingDirection:"left-to-right"},emptyAgent={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:EMPTY,seeAlso:EMPTY,homepage:EMPTY};function ensureArray$1(et){return Array.isArray(et)?et:[et]}const types$1=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function identifyResource$1(et){if(typeof et>"u"||et===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(et))throw new Error("Array is not a valid entity");if(typeof et!="object")throw new Error(`${typeof et} is not a valid entity`);if(typeof et.type=="string"){const _e=types$1.indexOf(et.type);if(_e!==-1)return types$1[_e]}if(et.profile)return"Service";throw new Error("Resource type is not known")}class Traverse$1{constructor(_e,tt={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],..._e},this.options={allowUndefinedReturn:!1,...tt}}static all(_e){return new Traverse$1({collection:[_e],manifest:[_e],canvas:[_e],annotationCollection:[_e],annotationPage:[_e],annotation:[_e],contentResource:[_e],choice:[_e],range:[_e],service:[_e]})}traverseDescriptive(_e){return _e.thumbnail&&(_e.thumbnail=_e.thumbnail.map(tt=>this.traverseType(tt,this.traversals.contentResource))),_e.provider&&(_e.provider=_e.provider.map(tt=>this.traverseAgent(tt))),_e}traverseLinking(_e){return _e.seeAlso&&(_e.seeAlso=_e.seeAlso.map(tt=>this.traverseType(tt,this.traversals.contentResource))),_e.service&&(_e.service=ensureArray$1(_e.service).map(tt=>this.traverseType(tt,this.traversals.service))),_e.services&&(_e.services=_e.services.map(tt=>this.traverseType(tt,this.traversals.service))),_e.logo&&(_e.logo=_e.logo.map(tt=>this.traverseType(tt,this.traversals.contentResource))),_e.homepage&&(_e.homepage=_e.homepage.map(tt=>this.traverseType(tt,this.traversals.contentResource))),_e.partOf&&(_e.partOf=_e.partOf.map(tt=>typeof tt=="string"||!tt.type?this.traverseType(tt,this.traversals.contentResource):tt.type==="Canvas"?this.traverseType(tt,this.traversals.canvas):tt.type==="AnnotationCollection"?this.traverseType(tt,this.traversals.annotationCollection):tt.type==="Collection"?this.traverseType(tt,this.traversals.collection):this.traverseType(tt,this.traversals.contentResource))),_e.start&&(_e.start=_e.start?this.traverseType(_e.start,this.traversals.canvas):null),_e.rendering&&(_e.rendering=_e.rendering.map(tt=>this.traverseType(tt,this.traversals.contentResource))),_e.supplementary&&(_e.supplementary=_e.supplementary.map(tt=>this.traverseType(tt,this.traversals.contentResource))),_e}traverseCollectionItems(_e){return _e.items&&_e.items.map(tt=>tt.type==="Collection"?this.traverseCollection(tt):this.traverseManifest(tt)),_e}traverseCollection(_e){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(_e))))),this.traversals.collection)}traverseManifestItems(_e){return _e.items&&(_e.items=_e.items.map(tt=>this.traverseCanvas(tt))),_e}traverseManifestStructures(_e){return _e.structures&&(_e.structures=_e.structures.map(tt=>this.traverseRange(tt))),_e}traverseManifest(_e){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(_e)))))),this.traversals.manifest)}traverseCanvasItems(_e){return _e.items=(_e.items||[]).map(tt=>this.traverseAnnotationPage(tt)),_e}traverseInlineAnnotationPages(_e){return typeof _e=="string"||!_e||_e.annotations&&(_e.annotations=_e.annotations.map(tt=>this.traverseAnnotationPage(tt))),_e}traverseCanvas(_e){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(_e))))),this.traversals.canvas)}traverseAnnotationPageItems(_e){return _e.items&&(_e.items=_e.items.map(tt=>this.traverseAnnotation(tt))),_e}traverseAnnotationPage(_e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(_e))),this.traversals.annotationPage)}traverseAnnotationBody(_e){return Array.isArray(_e.body)?_e.body=_e.body.map(tt=>this.traverseContentResource(tt)):_e.body&&(_e.body=this.traverseContentResource(_e.body)),_e}traversePosterCanvas(_e){return _e.posterCanvas&&(_e.posterCanvas=this.traverseCanvas(_e.posterCanvas)),_e.placeholderCanvas&&(_e.placeholderCanvas=this.traverseCanvas(_e.placeholderCanvas)),_e.accompanyingCanvas&&(_e.accompanyingCanvas=this.traverseCanvas(_e.accompanyingCanvas)),_e}traverseAnnotation(_e){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(_e)),this.traversals.annotation)}traverseContentResourceLinking(_e){return typeof _e=="string"||!_e||_e&&_e.service&&(_e.service=ensureArray$1(_e.service||[]).map(tt=>this.traverseType(tt,this.traversals.service))),_e}traverseContentResource(_e){return _e.type==="Choice"&&(_e.items=_e.items.map(tt=>this.traverseContentResource(tt))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(_e)),this.traversals.contentResource)}traverseRangeRanges(_e){return _e.items&&(_e.items=_e.items.map(tt=>typeof tt=="string"?this.traverseCanvas({id:tt,type:"Canvas"}):tt.type==="Manifest"?this.traverseManifest(tt):this.traverseRange(tt))),_e}traverseRange(_e){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(_e)))),this.traversals.range)}traverseAgent(_e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(_e)),this.traversals.agent)}traverseType(_e,tt){return tt.reduce((rt,nt)=>{const it=nt(rt);return typeof it>"u"&&!this.options.allowUndefinedReturn?rt:it},_e)}traverseService(_e){return this.traverseType(_e,this.traversals.service)}traverseUnknown(_e){const tt=identifyResource$1(_e);switch(tt){case"Collection":return this.traverseCollection(_e);case"Manifest":return this.traverseManifest(_e);case"Canvas":return this.traverseCanvas(_e);case"AnnotationPage":return this.traverseAnnotationPage(_e);case"Annotation":return this.traverseAnnotation(_e);case"ContentResource":return this.traverseContentResource(_e);case"Range":return this.traverseRange(_e);case"Service":return this.traverseService(_e);case"Agent":return this.traverseAgent(_e);default:throw new Error(`Unknown or unsupported resource type of ${tt}`)}}}const types=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function identifyResource(et){if(typeof et>"u"||et===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(et))throw new Error("Array is not a valid entity");if(typeof et!="object")throw new Error(`${typeof et} is not a valid entity`);if(typeof et["@type"]=="string"){const _e=types.indexOf(et["@type"]);if(_e!==-1)return types[_e]}if(et.profile)return"Service";if(et.format||et["@type"])return"ContentResource";throw new Error("Resource type is not known")}class Traverse{constructor(_e,tt={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],..._e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...tt}}static all(_e){return new Traverse({collection:[_e],manifest:[_e],canvas:[_e],annotationList:[_e],sequence:[_e],annotation:[_e],contentResource:[_e],choice:[_e],range:[_e],service:[_e],layer:[_e]})}traverseCollection(_e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(_e))),this.traversals.collection)}traverseCollectionItems(_e){if(this.options.mergeMemberProperties){const tt=[...(_e.manifests||[]).map(rt=>typeof rt=="string"?{"@id":rt,"@type":"sc:Manifest"}:rt),...(_e.collections||[]).map(rt=>typeof rt=="string"?{"@id":rt,"@type":"sc:Collection"}:rt),..._e.members||[]];delete _e.collections,delete _e.manifests,_e.members=tt}return _e.manifests&&(_e.manifests=_e.manifests.map(tt=>this.traverseManifest(typeof tt=="string"?{"@id":tt,"@type":"sc:Manifest"}:tt))),_e.collections&&(_e.collections=_e.collections.map(tt=>this.traverseCollection(typeof tt=="string"?{"@id":tt,"@type":"sc:Collection"}:tt))),_e.members&&(_e.members=_e.members.map(tt=>typeof tt=="string"?tt:this.traverseUnknown(tt))),_e}traverseManifest(_e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(_e))),this.traversals.manifest)}traverseManifestItems(_e){return _e.sequences&&(_e.sequences=_e.sequences.map(tt=>this.traverseSequence(tt))),_e.structures&&(_e.structures=_e.structures.map(tt=>this.traverseRange(tt))),_e}traverseSequence(_e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(_e))),this.traversals.sequence)}traverseSequenceItems(_e){return _e.canvases&&(_e.canvases=_e.canvases.map(tt=>this.traverseCanvas(tt))),_e}traverseCanvas(_e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(_e))),this.traversals.canvas)}traverseCanvasItems(_e){return _e.images&&(_e.images=_e.images.map(tt=>this.traverseAnnotation(tt))),_e.otherContent&&(_e.otherContent=_e.otherContent.map(tt=>this.traverseAnnotationList(tt))),_e}traverseRange(_e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(_e))),this.traversals.range)}traverseRangeItems(_e){if(this.options.mergeMemberProperties){const tt=[...(_e.ranges||[]).map(rt=>typeof rt=="string"?{"@id":rt,"@type":"sc:Range"}:rt),...(_e.canvases||[]).map(rt=>typeof rt=="string"?{"@id":rt,"@type":"sc:Canvas"}:rt),..._e.members||[]];delete _e.ranges,delete _e.canvases,_e.members=tt.length?tt.map(rt=>this.traverseUnknown(rt)):void 0}return _e}traverseAnnotationList(_e){const tt=typeof _e=="string"?{"@id":_e,"@type":"sc:AnnotationList"}:_e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(tt)),this.traversals.annotationList)}traverseAnnotationListItems(_e){return _e.resources&&(_e.resources=_e.resources.map(tt=>this.traverseAnnotation(tt))),_e}traverseAnnotation(_e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(_e))),this.traversals.annotation)}traverseAnnotationItems(_e){return _e.resource&&(Array.isArray(_e.resource)?_e.resource=_e.resource.map(tt=>this.traverseContentResource(tt)):_e.resource=this.traverseContentResource(_e.resource)),_e.on,_e}traverseLayer(_e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(_e)),this.traversals.layer)}traverseLayerItems(_e){return _e.otherContent&&(_e.otherContent=_e.otherContent.map(tt=>this.traverseAnnotationList(tt))),_e}traverseChoice(_e){return this.traverseType(this.traverseChoiceItems(_e),this.traversals.choice)}traverseChoiceItems(_e){return _e.default&&_e.default!=="rdf:nil"&&(_e.default=this.traverseContentResource(_e.default)),_e.item&&_e.item!=="rdf:nil"&&(_e.item=_e.item.map(tt=>this.traverseContentResource(tt))),_e}traverseService(_e){return this.traverseType(this.traverseLinking(_e),this.traversals.service)}traverseContentResource(_e){return _e["@type"]==="oa:Choice"?this.traverseChoice(_e):this.traverseType(this.traverseDescriptive(this.traverseLinking(_e)),this.traversals.contentResource)}traverseUnknown(_e){if(!_e["@type"]||typeof _e=="string")return _e;switch(identifyResource(_e)){case"sc:Collection":return this.traverseCollection(_e);case"sc:Manifest":return this.traverseManifest(_e);case"sc:Canvas":return this.traverseCanvas(_e);case"sc:Sequence":return this.traverseSequence(_e);case"sc:Range":return this.traverseRange(_e);case"oa:Annotation":return this.traverseAnnotation(_e);case"sc:AnnotationList":return this.traverseAnnotationList(_e);case"sc:Layer":return this.traverseLayer(_e);case"Service":return this.traverseService(_e);case"oa:Choice":return this.traverseChoice(_e);case"ContentResource":return this.traverseContentResource(_e)}return _e.profile?this.traverseService(_e):_e}traverseImageResource(_e){const tt=Array.isArray(_e),rt=Array.isArray(_e)?_e:[_e],nt=[];for(const it of rt)typeof it=="string"?nt.push(this.traverseContentResource({"@id":it,"@type":"dctypes:Image"})):nt.push(this.traverseContentResource(it));return!tt&&!this.options.convertPropsToArray?nt[0]:nt}traverseDescriptive(_e){return _e.thumbnail&&(_e.thumbnail=this.traverseImageResource(_e.thumbnail)),_e.logo&&(_e.logo=this.traverseImageResource(_e.logo)),_e}traverseOneOrMoreServices(_e){const tt=Array.isArray(_e),rt=Array.isArray(_e)?_e:[_e],nt=[];for(const it of rt)nt.push(this.traverseService(it));return!tt&&!this.options.convertPropsToArray?nt[0]:nt}traverseLinking(_e){return _e.related&&(_e.related=this.traverseOneOrManyType(_e.related,this.traversals.contentResource)),_e.rendering&&(_e.rendering=this.traverseOneOrManyType(_e.rendering,this.traversals.contentResource)),_e.service&&(_e.service=this.traverseOneOrMoreServices(_e.service)),_e.seeAlso&&(_e.seeAlso=this.traverseOneOrManyType(_e.seeAlso,this.traversals.contentResource)),_e.within&&(typeof _e.within=="string"||(_e.within=this.traverseOneOrManyType(_e.within,this.traversals.contentResource))),_e.startCanvas&&(typeof _e.startCanvas=="string"?_e.startCanvas=this.traverseType({"@id":_e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):_e.startCanvas&&this.traverseType(_e.startCanvas,this.traversals.canvas)),_e.contentLayer&&(typeof _e.contentLayer=="string"?_e.contentLayer=this.traverseLayer({"@id":_e.contentLayer,"@type":"sc:Layer"}):_e.contentLayer=this.traverseLayer(_e.contentLayer)),_e}traverseOneOrManyType(_e,tt){if(!Array.isArray(_e))if(this.options.convertPropsToArray)_e=[_e];else return this.traverseType(_e,tt);return _e.map(rt=>this.traverseType(rt,tt))}traverseType(_e,tt){return tt.reduce((rt,nt)=>{const it=nt(rt);return typeof it>"u"&&!this.options.allowUndefinedReturn?rt:it},_e)}}const STANFORD_IIIF_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",STANFORD_IIIF_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",STANFORD_IIIF_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",STANFORD_IIIF_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",STANFORD_IIIF_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",STANFORD_IIIF_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",STANFORD_IIIF_1_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",STANFORD_IIIF_1_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",STANFORD_IIIF_1_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",STANFORD_IIIF_1_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",STANFORD_IIIF_1_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",STANFORD_IIIF_1_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",IIIF_1_IMAGE_LEVEL_0="http://iiif.io/api/image/1/level0.json",IIIF_1_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/1/profiles/level0.json",IIIF_1_IMAGE_LEVEL_1="http://iiif.io/api/image/1/level1.json",IIIF_1_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/1/profiles/level1.json",IIIF_1_IMAGE_LEVEL_2="http://iiif.io/api/image/1/level2.json",IIIF_1_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/1/profiles/level2.json",IIIF_2_IMAGE_LEVEL_0="http://iiif.io/api/image/2/level0.json",IIIF_2_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/2/profiles/level0.json",IIIF_2_IMAGE_LEVEL_1="http://iiif.io/api/image/2/level1.json",IIIF_2_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/2/profiles/level1.json",IIIF_2_IMAGE_LEVEL_2="http://iiif.io/api/image/2/level2.json",IIIF_2_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/2/profiles/level2.json",IIIF_3_IMAGE_LEVEL_0="level0",IIIF_3_IMAGE_LEVEL_1="level1",IIIF_3_IMAGE_LEVEL_2="level2",IIIF_2_IMAGE_LEVEL_0_NO_JSON="http://iiif.io/api/image/2/level0",IIIF_2_IMAGE_LEVEL_1_NO_JSON="http://iiif.io/api/image/2/level1",IIIF_2_IMAGE_LEVEL_2_NO_JSON="http://iiif.io/api/image/2/level2",level1Support=[IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],imageServiceProfiles=[IIIF_2_IMAGE_LEVEL_0_NO_JSON,IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_0,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_0,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_0,IIIF_1_IMAGE_LEVEL_0_PROFILE,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_0,IIIF_2_IMAGE_LEVEL_0_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_0,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],configuration={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function convertLanguageMapping(et,_e="none"){if(!et)return{};const tt=Array.isArray(et)?et:[et],rt={};for(const nt of tt){if(typeof nt=="string"){rt[_e]=rt[_e]?rt[_e]:[],rt[_e].push(nt||"");continue}if(!nt["@language"]){rt[_e]=rt[_e]?rt[_e]:[],rt[_e].push(nt["@value"]||"");continue}const it=nt["@language"];rt[it]=rt[it]?rt[it]:[],rt[it].push(nt["@value"]||"")}return rt}function getProfile(et){if(Array.isArray(et))return getProfile(et.find(_e=>typeof _e=="string"));if(imageServiceProfiles.indexOf(et)!==-1)return"level2";if(level1Support.indexOf(et)!==-1)return"level1";if(typeof et=="string")return et}function getTypeFromContext(et){const _e=Array.isArray(et)?et:[et];for(const tt of _e)switch(tt){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function getTypeFromProfile(et){switch(et){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function removePrefix(et){for(const _e of["sc","oa","dcterms","dctypes","iiif"])if(et.startsWith(`${_e}:`))return et.slice(_e.length+1);return et}const knownTypes=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function getNewType(et){const _e=et["@id"]||et.id;let tt=et["@type"]||et.type;const rt=et.profile||void 0,nt=et["@context"]||void 0;if(rt){const it=getTypeFromProfile(rt);if(it)return it}if(nt){const it=getTypeFromContext(nt);if(it)return it}if(tt){if(Array.isArray(tt)){if(tt.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(tt.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";tt=tt[0]}for(const it of["sc","oa","dcterms","dctypes","iiif"])if(tt.startsWith(`${it}:`)){tt=tt.slice(it.length+1);break}switch(tt){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(tt&&knownTypes.indexOf(tt)!==-1)return tt;if(et.format){if(et.format.startsWith("image/"))return"Image";if(et.format.startsWith("text/")||et.format==="application/pdf")return"Text";if(et.format.startsWith("application/"))return"Dataset"}return _e&&(_e.endsWith(".jpg")||_e.endsWith(".png")||_e.endsWith(".jpeg"))?"Image":tt||"unknown"}const licenseRegex=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function extractLicense(et){const _e=et.match(licenseRegex);return _e?_e[0]:et}function fixLicense(et,_e="Rights/License",tt="none"){let rt=null;const nt=[],it=Array.isArray(et)?et:[et];for(const st of it){const ot=st?extractLicense(st):void 0;if(ot&&(ot.indexOf("creativecommons.org")!==-1||ot.indexOf("rightsstatements.org")!==-1)){ot.startsWith("https://")?rt=`http://${ot.slice(8)}`:rt=ot;continue}ot&&nt.push({label:{[tt]:[_e]},value:{[tt]:[ot]}})}return[rt,nt]}const removeContexts=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function fixContext(et){if(et){const _e=Array.isArray(et)?et:[et],tt=[];for(const rt of _e)rt==="http://iiif.io/api/presentation/2/context.json"&&tt.push("http://iiif.io/api/presentation/3/context.json"),removeContexts.indexOf(rt)===-1&&tt.push(rt);if(_e.length)return tt.length===1?tt[0]:tt}}function convertMetadata(et){return et?et.map(_e=>({label:convertLanguageMapping(_e.label),value:convertLanguageMapping(_e.value)})):[]}function removeUndefinedProperties(et){for(const _e in et)(typeof et[_e]>"u"||et[_e]===null)&&delete et[_e];return et}let mintedIdCounter=0;function mintNewIdFromResource(et,_e){const tt=encodeURI(et.id||et["@id"]||"").trim();return tt&&_e?`${tt}/${_e}`:tt||(mintedIdCounter++,`http://example.org/${et["@type"]}${_e?`/${_e}`:""}/${mintedIdCounter}`)}function technicalProperties$2(et){const _e=[...et.behavior||[]];et.viewingHint&&_e.push(et.viewingHint);let tt;return Array.isArray(et.motivation)?tt=et.motivation.map(removePrefix):et.motivation&&(tt=removePrefix(et.motivation)),{"@context":et["@context"]?fixContext(et["@context"]):void 0,id:(et["@id"]||mintNewIdFromResource(et)).trim(),type:getNewType(et),behavior:_e.length?_e:void 0,height:et.height?et.height:void 0,width:et.width?et.width:void 0,motivation:tt,viewingDirection:et.viewingDirection,profile:et.profile,format:et.format?et.format:void 0,duration:void 0,timeMode:void 0}}function descriptiveProperties$2(et){const[_e,tt]=fixLicense(et.license),rt=[...et.metadata?convertMetadata(et.metadata):[],...tt];return{rights:_e,metadata:rt.length?rt:void 0,label:et.label?convertLanguageMapping(et.label):void 0,requiredStatement:et.attribution?{label:convertLanguageMapping(configuration.attributionLabel),value:convertLanguageMapping(et.attribution)}:void 0,navDate:et.navDate,summary:et.description?convertLanguageMapping(et.description):void 0,thumbnail:et.thumbnail}}function parseWithin(et){if(!et.within)return;const _e=Array.isArray(et.within)?et.within:[et.within],tt=[];for(const rt of _e)if(typeof rt=="string"){if(rt)switch(et["@type"]){case"sc:Manifest":tt.push({id:rt,type:"Collection"});break}}else rt["@id"]&&tt.push({id:rt["@id"],type:getNewType(rt)});return tt.length?tt:void 0}function linkingProperties$2(et){const _e=et.related?Array.isArray(et.related)?et.related:[et.related]:[],tt=et.contentLayer;return{provider:et.logo||_e.length?[{id:configuration.providerId,type:"Agent",homepage:_e.length?[_e[0]]:void 0,logo:et.logo?Array.isArray(et.logo)?et.logo:[et.logo]:void 0,label:convertLanguageMapping(configuration.providerName)}]:void 0,partOf:parseWithin(et),rendering:et.rendering,seeAlso:et.seeAlso,start:et.startCanvas,service:et.service?ensureArray$1(et.service):void 0,supplementary:tt?[tt]:void 0}}function embeddedContentProperties(et){return{chars:et.chars,format:et.format?et.format:void 0,language:et.language}}function upgradeCollection(et){return removeUndefinedProperties({...technicalProperties$2(et),...descriptiveProperties$2(et),...linkingProperties$2(et),items:et.members})}function upgradeManifest(et){const _e=[],tt=[];for(const nt of et.sequences||[])nt.canvases.length&&_e.push(...nt.canvases),nt.behavior&&tt.push(...nt.behavior);const rt=technicalProperties$2(et);return tt.length&&(rt.behavior?rt.behavior.push(...tt):rt.behavior=tt),removeUndefinedProperties({...rt,...descriptiveProperties$2(et),...linkingProperties$2(et),items:_e,structures:et.structures})}function upgradeCanvas(et){return removeUndefinedProperties({...technicalProperties$2(et),...descriptiveProperties$2(et),...linkingProperties$2(et),annotations:et.otherContent&&et.otherContent.length?et.otherContent:void 0,items:et.images&&et.images.length?[{id:mintNewIdFromResource(et,"annotation-page"),type:"AnnotationPage",items:et.images}]:void 0})}function upgradeAnnotationList(et){return removeUndefinedProperties({...technicalProperties$2(et),...descriptiveProperties$2(et),...linkingProperties$2(et),items:et.resources&&et.resources.length?et.resources:void 0})}function upgradeSequence(et){return!et.canvases||et.canvases.length===0?{canvases:[],behavior:[]}:{canvases:et.canvases,behavior:et.viewingHint?[et.viewingHint]:[]}}function upgradeAnnotation(et){function _e(tt){if(Array.isArray(tt)){if(tt.length>1)return{type:"List",items:tt.map(_e)};tt=tt[0]}if(typeof tt=="string")return encodeURI(tt).trim();if("@type"in tt){let rt;if(typeof tt.full=="string")rt=tt.full;else if(tt.full["@type"]==="dctypes:Image")rt={id:tt.full["@id"],type:"Image"};else if(tt.full["@type"]==="sc:Canvas")rt={id:tt.full["@id"],type:"Canvas"};else throw new Error(`Unsupported source type on annotation: ${tt.full["@type"]}`);return{type:"SpecificResource",source:rt,selector:upgradeSelector(tt.selector)}}else return encodeURI(tt["@id"]).trim()}return removeUndefinedProperties({...technicalProperties$2(et),...descriptiveProperties$2(et),...linkingProperties$2(et),target:_e(et.on),body:Array.isArray(et.resource)?et.resource.map(upgradeContentResource):upgradeContentResource(et.resource)})}function upgradeContentResource(et){const _e=et;return removeUndefinedProperties({...technicalProperties$2(_e),...descriptiveProperties$2(_e),...linkingProperties$2(_e),...embeddedContentProperties(_e)})}function upgradeChoice(et){const _e=[];return et.default&&et.default!=="rdf:nil"&&_e.push(et.default),et.item&&et.item!=="rdf:nil"&&_e.push(...et.item),{...technicalProperties$2(et),...descriptiveProperties$2(et),items:_e}}function upgradeRange(et){return removeUndefinedProperties({...technicalProperties$2(et),...descriptiveProperties$2(et),...linkingProperties$2(et),items:et.members})}function upgradeService(et){const{"@id":_e,"@type":tt,"@context":rt,profile:nt,...it}=et,st={};return _e&&(st["@id"]=_e),st["@type"]=getNewType(et),st["@type"]==="unknown"&&(rt&&rt.length&&(st["@context"]=rt),st["@type"]="Service"),nt&&(st.profile=getProfile(nt)),removeUndefinedProperties({...st,...it})}function upgradeLayer(et){return removeUndefinedProperties({...technicalProperties$2(et),...descriptiveProperties$2(et),...linkingProperties$2(et)})}const presentation2to3=new Traverse({collection:[upgradeCollection],manifest:[upgradeManifest],canvas:[upgradeCanvas],annotationList:[upgradeAnnotationList],sequence:[upgradeSequence],annotation:[upgradeAnnotation],contentResource:[upgradeContentResource],choice:[upgradeChoice],range:[upgradeRange],service:[upgradeService],layer:[upgradeLayer]});function convertPresentation2(et){return et&&et["@context"]&&(et["@context"]==="http://iiif.io/api/presentation/2/context.json"||et["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||et["@context"]==="http://www.shared-canvas.org/ns/context.json")||et["@context"]==="http://iiif.io/api/image/2/context.json"?presentation2to3.traverseUnknown(et):et}function upgradeSelector(et){if((Array.isArray(et["@type"])&&et["@type"].includes("oa:SvgSelector")||et["@type"]=="oa:SvgSelector")&&("chars"in et||"value"in et))return{type:"SvgSelector",value:"chars"in et?et.chars:et.value};if(et["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:et.value};if(et["@type"]==="oa:Choice")return[upgradeSelector(et.default),...(Array.isArray(et.item)?et.item:[et.item]).map(upgradeSelector)];if(et["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in et?et.region:void 0,rotation:"rotation"in et?et.rotation:void 0};throw new Error(`Unsupported selector type: ${et["@type"]}`)}function getDefaultEntities$1(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function getResource(et,_e){if(typeof et=="string")return{id:et,type:_e};if(!et.id)throw new Error(`Invalid resource does not have an ID (${_e})`);return et}function mapToEntities(et){return(_e,tt)=>{const rt=et[_e]?et[_e]:{};return nt=>{const it=getResource(nt,tt||_e);return it&&it.id&&_e?(rt[it.id]=rt[it.id]?mergeEntities(rt[it.id],it):Object.assign({},it),{id:it.id,type:_e==="ContentResource"?_e:it.type}):it}}}function merge(et,_e){if(!_e)return et;if(Array.isArray(et)){if(!Array.isArray(_e))throw new Error("Cannot merge array with non-array");const tt=[...et];for(const rt of _e)if(rt!=null)if(Array.isArray(rt))tt.push(rt);else if(typeof rt=="object"&&rt.id&&rt.type){const nt=tt.findIndex(it=>it.id===rt.id&&it.type===rt.type);nt>=0&&(tt[nt]=merge(tt[nt],rt))}else et.indexOf(rt)===-1&&tt.push(rt);return tt}else if(typeof et=="object"){if(Array.isArray(_e)||typeof _e!="object")throw new Error("Cannot merge object with non-object");const tt={...et};for(const[rt,nt]of Object.entries(_e)){const it=tt[rt];it===EMPTY||!it?tt[rt]=nt:tt[rt]=merge(it,nt)}return tt}else if(et)return et;return _e}function mergeEntities(et,_e){if(typeof et=="string")return et;if(_e.id!==et.id||_e.type!==et.type)throw new Error("Can only merge entities with identical identifiers and type!");return merge({...et},_e)}function recordTypeInMapping(et){return(_e,tt)=>rt=>{const{id:nt,type:it}=getResource(rt,tt||_e);if(typeof nt>"u")throw new Error("Found invalid entity without an ID.");return _e==="ContentResource"?et[nt]=_e:et[nt]=it,rt}}function hash$1(et){const _e=JSON.stringify(et);let tt=5381,rt=_e.length;for(;rt;)tt=tt*33^_e.charCodeAt(--rt);const it=(tt>>>0).toString(16);return it.length%2?"0"+it:it}function addMissingIdToContentResource(et){return _e=>typeof _e=="string"?{id:_e,type:et}:_e.id?_e.type?_e:{type:et,..._e}:{id:`vault://${hash$1(_e)}`,type:et,..._e}}function ensureDefaultFields(et){return _e=>({...et,..._e})}function ensureArray(et){return Array.isArray(et)?et:[et]}function ensureArrayOnAnnotation(et){return et.body&&(et.body=ensureArray(et.body)),et.seeAlso&&(et.seeAlso=ensureArray(et.seeAlso)),et.body&&(et.body=ensureArray(et.body)),et.audience&&(et.audience=ensureArray(et.audience)),et.accessibility&&(et.accessibility=ensureArray(et.accessibility)),et.motivation&&(et.motivation=ensureArray(et.motivation)),et}function normalize(et){const _e=convertPresentation2(et),tt=getDefaultEntities$1(),rt={},nt=mapToEntities(tt),it=recordTypeInMapping(rt),ot=new Traverse$1({collection:[ensureDefaultFields(emptyCollection),it("Collection"),nt("Collection")],manifest:[ensureDefaultFields(emptyManifest),it("Manifest"),nt("Manifest")],canvas:[ensureDefaultFields(emptyCanvas),it("Canvas"),nt("Canvas")],annotationPage:[addMissingIdToContentResource("AnnotationPage"),ensureDefaultFields(emptyAnnotationPage),it("AnnotationPage"),nt("AnnotationPage")],annotation:[addMissingIdToContentResource("Annotation"),ensureArrayOnAnnotation,it("Annotation"),nt("Annotation")],contentResource:[addMissingIdToContentResource("ContentResource"),it("ContentResource"),nt("ContentResource")],range:[ensureDefaultFields(emptyRange),it("Range","Canvas"),nt("Range","Canvas")],agent:[ensureDefaultFields(emptyAgent),it("Agent"),nt("Agent")]}).traverseUnknown(_e);return{entities:tt,resource:ot,mapping:rt}}const UNSET="__$UNSET$__",UNWRAP="__$UNWRAP$__";function resolveIfExists$1(et,_e){const tt=et.requests[_e],rt=et.mapping[_e];if(!(!rt||tt&&tt.resourceUri&&!et.entities[rt][tt.resourceUri]))return et.entities[rt][tt?tt.resourceUri:_e]}function serializedFieldsToObject(et){const _e={};for(const[tt,rt]of et){if(tt===UNWRAP&&rt!==UNSET)return rt;rt!==UNSET&&typeof rt<"u"&&rt!==null&&(_e[tt]=rt)}return _e}function serialize(et,_e,tt){if(!_e.type||!_e.id)throw new Error("Unknown entity");if(!tt[_e.type])throw new Error(`Serializer not found for ${_e.type}`);function rt(nt){const it=tt[nt.type];if(!it)return UNSET;const st=resolveIfExists$1(et,nt.id)||(nt.id&&nt.type?nt:null);if(!st)return UNSET;const ot=it(st,et,{isTopLevel:_e.id===nt.id});let at=ot.next();for(;!at.done;){const lt=at.value;let ut=UNSET;if(lt)if(Array.isArray(lt)){const ct=[];for(const dt of lt)ct.push(rt(dt));ut=ct}else ut=rt(lt);at=ot.next(ut)}return at.value===UNSET?UNSET:serializedFieldsToObject(at.value)}return rt(_e)}function languageString2to3(et){if(!et)return;const _e=Object.keys(et);if(_e.length!==0){if(_e.length===1){const tt=_e[0];if(!tt)return"";const rt=(et[tt]||[]).join("");return tt==="@none"||tt==="none"||tt==="en"?rt:{"@language":tt,"@value":rt}}return _e.map(tt=>({"@language":tt,"@value":(et[tt]||[]).join("")}))}}function parseCanvasTarget(et){return Array.isArray(et)?et.map(_e=>parseCanvasTarget(_e)):typeof et=="string"?et:et.type&&et.type==="Canvas"?et.id:et}function unNestArray(et,_e=!1){if(et)return et.length>1&&!_e?et:et[0]||void 0}function convertService(et){if(et){if(typeof et=="string")return{"@id":et};if("@id"in et){const _e={...et};return delete _e["@type"],_e}return{"@context":"http://iiif.io/api/image/2/context.json","@id":et.id,profile:`http://iiif.io/api/image/2/profiles/${et.profile}.json`}}}function technicalProperties$1(et,_e){return[["@id",et.id],["@type",_e],["format",et.format],["height",et.height],["width",et.width],["viewingDirection",et.viewingDirection!=="left-to-right"?et.viewingDirection:void 0]]}function*descriptiveProperties$1(et){const _e=et.provider?yield et.provider[0]:void 0;return[["label",languageString2to3(et.label)],["metadata",et.metadata&&et.metadata.length?et.metadata.map(tt=>({label:languageString2to3(tt.label)||"",value:languageString2to3(tt.value)||""})):void 0],["description",languageString2to3(et.summary)],["thumbnail",unNestArray(yield et.thumbnail)],["navDate",et.navDate],["logo",_e?unNestArray(_e.logo):void 0],["homepage",_e?_e.homepage:void 0],["attribution",et.requiredStatement?languageString2to3(et.requiredStatement.value):void 0]]}function*linkingProperties$1(et){return[["seeAlso",unNestArray(yield et.seeAlso)],["service",unNestArray((et.service||[]).map(convertService))],["rendering",unNestArray(yield et.rendering)],["startCanvas",et.start?et.start.id:void 0]]}const serializeConfigPresentation2={Manifest:function*(et){return[...technicalProperties$1(et,"sc:Manifest"),...yield*descriptiveProperties$1(et),...yield*linkingProperties$1(et),["sequences",[{"@id":`${et.id}/sequence0`,"@type":"sc:Sequence",canvases:yield et.items}]],["structures",yield et.structures]]},Canvas:function*(et){const tt=(yield et.items)[0];return[...technicalProperties$1(et,"sc:Canvas"),...yield*descriptiveProperties$1(et),...yield*linkingProperties$1(et),["images",tt?[tt.resources]:void 0],["annotations",et.annotations&&et.annotations.length?unNestArray(yield et.annotations):void 0]]},AnnotationPage:function*(et){return[...technicalProperties$1(et,"sc:AnnotationList"),...yield*descriptiveProperties$1(et),["resources",et.items&&et.items.length?unNestArray(yield et.items):void 0]]},Annotation:function*(et){return[["@id",et.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",parseCanvasTarget(et.target)],["resource",unNestArray(yield et.body,!0)]]},ContentResource:function*(et){switch(et.type){case"Image":return[...technicalProperties$1(et,"dctypes:Image"),...yield*descriptiveProperties$1(et),...yield*linkingProperties$1(et)];case"Text":case"Dataset":default:return[...technicalProperties$1(et,void 0),...yield*descriptiveProperties$1(et)]}},AnnotationCollection:function*(et){return[["@id",et.id],["@type","sc:Layer"],["label",languageString2to3(et.label)]]},Collection:function*(et){return[...technicalProperties$1(et,"sc:Collection"),...yield*descriptiveProperties$1(et),...yield*linkingProperties$1(et),["members",yield*et.items]]},Range:function*(et){const _e=[],tt=[];if(et.items)for(const rt of et.items){const nt=yield rt;_e.push({"@id":rt.id,"@type":rt.type,label:nt?nt.label:void 0,within:et.id}),rt.type==="Canvas"&&tt.push(rt.id)}return[...technicalProperties$1(et,"sc:Range"),...yield*descriptiveProperties$1(et),...yield*linkingProperties$1(et),["canvases",tt.length===_e.length?tt:void 0],["members",tt.length!==_e.length?_e:void 0]]}};function technicalProperties(et){var _e;return[["id",(_e=et.id)!=null&&_e.startsWith("vault://")?void 0:et.id],["type",et.type],["format",et.format],["profile",et.profile],["height",et.height],["width",et.width],["duration",et.duration||void 0],["viewingDirection",et.viewingDirection!=="left-to-right"?et.viewingDirection:void 0],["behavior",et.behavior&&et.behavior.length?et.behavior:void 0],["timeMode",et.timeMode],["motivation",Array.isArray(et.motivation)?et.motivation[0]:et.motivation]]}function filterEmpty(et){if(!(!et||et.length===0))return et}function service2compat(et){if(et&&et.type&&et.type==="ImageService2"){const{id:_e,type:tt,profile:rt,...nt}=et,it=typeof rt=="string"?rt:Array.isArray(rt)?rt.find(st=>typeof st=="string"):"";return{"@id":_e,"@type":tt,profile:it?it.startsWith("http")?it:`http://iiif.io/api/image/2/${it}.json`:"http://iiif.io/api/image/2/level0.json",...nt}}return et}function filterService2Compat(et){if(!(!et||et.length===0))return et.map(service2compat)}function*descriptiveProperties(et){return[["label",et.label],["metadata",filterEmpty(et.metadata)],["summary",et.summary],["requiredStatement",et.requiredStatement],["rights",et.rights],["navDate",et.navDate],["language",et.language],["thumbnail",filterEmpty(yield et.thumbnail)],["placeholderCanvas",yield et.placeholderCanvas],["accompanyingCanvas",yield et.accompanyingCanvas],["provider",filterEmpty(yield et.provider)]]}function*linkingProperties(et){return[["seeAlso",filterEmpty(yield et.seeAlso)],["service",filterService2Compat(et.service)],["services",filterService2Compat(et.services)],["rendering",filterEmpty(yield et.rendering)],["supplementary",filterEmpty(yield et.supplementary)],["homepage",filterEmpty(yield et.homepage)],["logo",filterEmpty(yield et.logo)],["partOf",filterEmpty(yield et.partOf)],["start",et.start]]}const serializeConfigPresentation3={Manifest:function*(et,_e,{isTopLevel:tt}){return tt?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(et),...yield*descriptiveProperties(et),...yield*linkingProperties(et),["items",yield et.items],["structures",filterEmpty(yield et.structures)],["annotations",filterEmpty(yield et.annotations)]]:[...technicalProperties(et),...yield*descriptiveProperties(et)]},Canvas:function*(et){return[...technicalProperties(et),...yield*descriptiveProperties(et),...yield*linkingProperties(et),["items",yield et.items],["annotations",filterEmpty(yield et.annotations)]]},Agent:function*(et){return[["id",et.id],["type","Agent"],["label",et.label],...yield*linkingProperties(et)]},AnnotationPage:function*(et){return[...Object.entries(et).map(([tt,rt])=>[tt,Array.isArray(rt)?filterEmpty(rt):rt]).filter(([tt,rt])=>tt!=="items"),...yield*linkingProperties(et),["items",yield et.items]]},Service:function*(et){return[[UNWRAP,service2compat(et)]]},Annotation:function*(et){const _e=Object.entries(et).map(([rt,nt])=>rt==="motivation"?[rt,Array.isArray(nt)?nt[0]:nt]:[rt,Array.isArray(nt)?filterEmpty(nt):nt]).filter(([rt])=>rt!=="body"),tt=yield et.body;return[..._e,["body",tt.length===1?tt[0]:tt]]},ContentResource:function*(et){return[...technicalProperties(et),...yield*descriptiveProperties(et),...yield*linkingProperties(et),["annotations",filterEmpty(yield et.annotations)],["items",filterEmpty(yield et.items)]]},AnnotationCollection:function*(et){return[["id",et.id],["type","AnnotationCollection"],["label",et.label]]},Collection:function*(et,_e,{isTopLevel:tt}){return tt?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(et),...yield*descriptiveProperties(et),...yield*linkingProperties(et),["items",filterEmpty(yield et.items)]]:[...technicalProperties(et),...yield*descriptiveProperties(et)]},Range:function*(et){const _e=[];for(const tt of et.items)tt.type==="Range"?_e.push(yield tt):_e.push(tt);return[...technicalProperties(et),...yield*descriptiveProperties(et),...yield*linkingProperties(et),["items",_e],["annotations",filterEmpty(yield et.annotations)]]}};function n$1(et){return et==null}function t$1(et){throw new Error("Argument "+et+" is empty.")}function o$1(et){return typeof et=="string"||typeof et=="symbol"}function u$1(et){return!o$1(et)}function a$1(et){throw new Error("Argument "+et+" is invalid, it should be an action type of type: string | symbol")}function s$1(et,_e){return n$1(et)&&t$1(1),u$1(et)&&a$1(1),Object.assign(function(){var tt=_e!=null?_e.apply(void 0,arguments):void 0;return Object.assign({type:et},tt)},{getType:function(){return et},toString:function(){return et}})}function y$1(et,_e,tt){return n$1(et)&&t$1(1),u$1(et)&&a$1(1),function(){return s$1(et,function(){var rt=arguments.length<=0?void 0:arguments[0],nt=arguments.length<=1?void 0:arguments[1];return _e==null&&tt==null||(rt=_e!=null?_e.apply(void 0,arguments):void 0,nt=tt!=null?tt.apply(void 0,arguments):void 0),Object.assign({},rt!==void 0&&{payload:rt},{},nt!==void 0&&{meta:nt})})}}function _typeof(et){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_e){return typeof _e}:function(_e){return _e&&typeof Symbol=="function"&&_e.constructor===Symbol&&_e!==Symbol.prototype?"symbol":typeof _e},_typeof(et)}function toPrimitive(et,_e){if(_typeof(et)!="object"||!et)return et;var tt=et[Symbol.toPrimitive];if(tt!==void 0){var rt=tt.call(et,_e||"default");if(_typeof(rt)!="object")return rt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_e==="string"?String:Number)(et)}function toPropertyKey(et){var _e=toPrimitive(et,"string");return _typeof(_e)=="symbol"?_e:String(_e)}function _defineProperty$1(et,_e,tt){return _e=toPropertyKey(_e),_e in et?Object.defineProperty(et,_e,{value:tt,enumerable:!0,configurable:!0,writable:!0}):et[_e]=tt,et}function ownKeys$1(et,_e){var tt=Object.keys(et);if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(et);_e&&(rt=rt.filter(function(nt){return Object.getOwnPropertyDescriptor(et,nt).enumerable})),tt.push.apply(tt,rt)}return tt}function _objectSpread2$1(et){for(var _e=1;_e<arguments.length;_e++){var tt=arguments[_e]!=null?arguments[_e]:{};_e%2?ownKeys$1(Object(tt),!0).forEach(function(rt){_defineProperty$1(et,rt,tt[rt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(et,Object.getOwnPropertyDescriptors(tt)):ownKeys$1(Object(tt)).forEach(function(rt){Object.defineProperty(et,rt,Object.getOwnPropertyDescriptor(tt,rt))})}return et}function formatProdErrorMessage(et){return"Minified Redux error #"+et+"; visit https://redux.js.org/Errors?code="+et+" for the full message or use the non-minified dev environment for full errors. "}var $$observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject$3(et){if(typeof et!="object"||et===null)return!1;for(var _e=et;Object.getPrototypeOf(_e)!==null;)_e=Object.getPrototypeOf(_e);return Object.getPrototypeOf(et)===_e}function createStore$1(et,_e,tt){var rt;if(typeof _e=="function"&&typeof tt=="function"||typeof tt=="function"&&typeof arguments[3]=="function")throw new Error(formatProdErrorMessage(0));if(typeof _e=="function"&&typeof tt>"u"&&(tt=_e,_e=void 0),typeof tt<"u"){if(typeof tt!="function")throw new Error(formatProdErrorMessage(1));return tt(createStore$1)(et,_e)}if(typeof et!="function")throw new Error(formatProdErrorMessage(2));var nt=et,it=_e,st=[],ot=st,at=!1;function lt(){ot===st&&(ot=st.slice())}function ut(){if(at)throw new Error(formatProdErrorMessage(3));return it}function ct(mt){if(typeof mt!="function")throw new Error(formatProdErrorMessage(4));if(at)throw new Error(formatProdErrorMessage(5));var ht=!0;return lt(),ot.push(mt),function(){if(ht){if(at)throw new Error(formatProdErrorMessage(6));ht=!1,lt();var vt=ot.indexOf(mt);ot.splice(vt,1),st=null}}}function dt(mt){if(!isPlainObject$3(mt))throw new Error(formatProdErrorMessage(7));if(typeof mt.type>"u")throw new Error(formatProdErrorMessage(8));if(at)throw new Error(formatProdErrorMessage(9));try{at=!0,it=nt(it,mt)}finally{at=!1}for(var ht=st=ot,gt=0;gt<ht.length;gt++){var vt=ht[gt];vt()}return mt}function ft(mt){if(typeof mt!="function")throw new Error(formatProdErrorMessage(10));nt=mt,dt({type:ActionTypes.REPLACE})}function pt(){var mt,ht=ct;return mt={subscribe:function(vt){if(typeof vt!="object"||vt===null)throw new Error(formatProdErrorMessage(11));function yt(){vt.next&&vt.next(ut())}yt();var bt=ht(yt);return{unsubscribe:bt}}},mt[$$observable]=function(){return this},mt}return dt({type:ActionTypes.INIT}),rt={dispatch:dt,subscribe:ct,getState:ut,replaceReducer:ft},rt[$$observable]=pt,rt}function assertReducerShape(et){Object.keys(et).forEach(function(_e){var tt=et[_e],rt=tt(void 0,{type:ActionTypes.INIT});if(typeof rt>"u")throw new Error(formatProdErrorMessage(12));if(typeof tt(void 0,{type:ActionTypes.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(formatProdErrorMessage(13))})}function combineReducers(et){for(var _e=Object.keys(et),tt={},rt=0;rt<_e.length;rt++){var nt=_e[rt];typeof et[nt]=="function"&&(tt[nt]=et[nt])}var it=Object.keys(tt),st;try{assertReducerShape(tt)}catch(ot){st=ot}return function(at,lt){if(at===void 0&&(at={}),st)throw st;for(var ut=!1,ct={},dt=0;dt<it.length;dt++){var ft=it[dt],pt=tt[ft],mt=at[ft],ht=pt(mt,lt);if(typeof ht>"u")throw lt&&lt.type,new Error(formatProdErrorMessage(14));ct[ft]=ht,ut=ut||ht!==mt}return ut=ut||it.length!==Object.keys(at).length,ut?ct:at}}function compose(){for(var et=arguments.length,_e=new Array(et),tt=0;tt<et;tt++)_e[tt]=arguments[tt];return _e.length===0?function(rt){return rt}:_e.length===1?_e[0]:_e.reduce(function(rt,nt){return function(){return rt(nt.apply(void 0,arguments))}})}function applyMiddleware(){for(var et=arguments.length,_e=new Array(et),tt=0;tt<et;tt++)_e[tt]=arguments[tt];return function(rt){return function(){var nt=rt.apply(void 0,arguments),it=function(){throw new Error(formatProdErrorMessage(15))},st={getState:nt.getState,dispatch:function(){return it.apply(void 0,arguments)}},ot=_e.map(function(at){return at(st)});return it=compose.apply(void 0,ot)(nt.dispatch),_objectSpread2$1(_objectSpread2$1({},nt),{},{dispatch:it})}}}const IMPORT_ENTITIES="@iiif/IMPORT_ENTITIES",MODIFY_ENTITY_FIELD="@iiif/MODIFY_ENTITY_FIELD",REORDER_ENTITY_FIELD="@iiif/REORDER_ENTITY_FIELD",ADD_REFERENCE="@iiif/ADD_REFERENCE",REMOVE_REFERENCE="@iiif/REMOVE_REFERENCE",importEntities=y$1(IMPORT_ENTITIES)(),modifyEntityField=y$1(MODIFY_ENTITY_FIELD)(),reorderEntityField=y$1(REORDER_ENTITY_FIELD)(),addReference=y$1(ADD_REFERENCE)(),removeReference=y$1(REMOVE_REFERENCE)(),entityActions={importEntities,modifyEntityField,reorderEntityField,addReference,removeReference},ADD_MAPPING="@iiif/ADD_MAPPING",ADD_MAPPINGS="@iiif/ADD_MAPPINGS",addMapping=y$1(ADD_MAPPING)(),addMappings=y$1(ADD_MAPPINGS)(),SET_META_VALUE="@iiif/SET_META_VALUE",SET_META_VALUE_DYNAMIC="@iiif/SET_META_VALUE_DYNAMIC",UNSET_META_VALUE="@iiif/UNSET_META_VALUE",setMetaValue=y$1(SET_META_VALUE)(),setMetaValueDynamic=y$1(SET_META_VALUE_DYNAMIC)(),unsetMetaValue=y$1(UNSET_META_VALUE)(),metaActions={setMetaValue,setMetaValueDynamic,unsetMetaValue},RESOURCE_ERROR="RESOURCE_ERROR",RESOURCE_LOADING="RESOURCE_LOADING",RESOURCE_READY="RESOURCE_READY",REQUEST_RESOURCE="@iiif/REQUEST_RESOURCE",REQUEST_ERROR="@iiif/REQUEST_ERROR",REQUEST_MISMATCH="@iiif/REQUEST_MISMATCH",REQUEST_COMPLETE="@iiif/REQUEST_COMPLETE",REQUEST_OFFLINE_RESOURCE="@iiif/REQUEST_OFFLINE_RESOURCE",requestResource=y$1(REQUEST_RESOURCE)(),requestError=y$1(REQUEST_ERROR)(),requestMismatch=y$1(REQUEST_MISMATCH)(),requestComplete=y$1(REQUEST_COMPLETE)();y$1(REQUEST_OFFLINE_RESOURCE)();const BATCH_ACTIONS="@iiif/BATCH",BATCH_IMPORT="@iiif/BATCH_IMPORT",batchActions=y$1(BATCH_ACTIONS)();y$1(BATCH_IMPORT)();const actionListFromResource=(et,_e)=>{const{entities:tt,resource:rt,mapping:nt}=normalize(_e);if(rt.id===void 0)return[requestError({id:et,message:"ID is not defined in resource."})];const it=[importEntities({entities:tt}),addMappings({mapping:nt})];return rt.id!==et&&(it.push(addMapping({id:et,type:rt.type})),it.push(requestMismatch({requestId:et,actualId:rt.id}))),it.push(requestComplete({id:et})),it},safeIsNaN=Number.isNaN||function(_e){return typeof _e=="number"&&_e!==_e};function isEqual(et,_e){return!!(et===_e||safeIsNaN(et)&&safeIsNaN(_e))}function areInputsEqual(et,_e){if(!Array.isArray(et)||!Array.isArray(_e))return et===_e;if(et.length!==_e.length)return!1;for(let tt=0;tt<et.length;tt++)if(!isEqual(et[tt],_e[tt]))return!1;return!0}function resolveIfExists(et,_e){const tt=et.iiif.requests[_e],rt=et.iiif.mapping[_e];if(!(!rt||!et.iiif.entities[rt][tt.resourceUri]))return et.iiif.entities[rt][tt.resourceUri]}function createFetchHelper(et,_e,{waitTimeout:tt=30}={}){return async(rt,nt)=>{const it=et.getState(),st=it.iiif.requests[rt];if(st)switch(st.loadingState){case RESOURCE_ERROR:break;case RESOURCE_LOADING:{let ot,at=!1;try{const lt=await Promise.race([new Promise((ut,ct)=>{at||(ot=et.subscribe(()=>{const dt=et.getState();if(dt.iiif.requests[rt].loadingState===RESOURCE_ERROR){ct();return}if(dt.iiif.requests[rt].loadingState===RESOURCE_READY){const ft=resolveIfExists(dt,rt);ft?ut(ft):ct()}}))}),new Promise((ut,ct)=>setTimeout(()=>{at=!0,ct()},tt*60))]);if(ot&&ot(),lt)return lt}catch{ot&&ot();break}break}case RESOURCE_READY:{const ot=resolveIfExists(it,rt);if(ot)return ot;break}}et.dispatch(requestResource({id:rt}));try{const ot=await _e(rt,nt);!ot.id&&!ot["@id"]&&(ot["@type"]&&(ot["@id"]=rt),ot.id=rt);const at=actionListFromResource(rt,ot);return et.dispatch(batchActions({actions:at})),resolveIfExists(et.getState(),rt)}catch(ot){throw et.dispatch(requestError({id:rt,message:ot.toString()})),ot}}}function getDefaultEntities(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const mappingReducer=(et={},_e)=>{switch(_e.type){case ADD_MAPPING:return{...et,[_e.payload.id]:_e.payload.type};case ADD_MAPPINGS:return{...et,..._e.payload.mapping};default:return et}};function isReferenceList(et,_e,tt,rt){return!(!et[tt]||!et[tt][_e]||!et[tt][_e][rt]||!Array.isArray(et[tt][_e][rt]))}function quickMerge(et,_e){const tt={},rt=[];for(const[nt,it]of Object.entries(et||{})){rt.push(nt);const st=(_e||{})[nt];if(!st||st.length===0){tt[nt]=it;continue}tt[nt]=st}for(const[nt,it]of Object.entries(_e||{}))rt.indexOf(nt)===-1&&(tt[nt]=it);return tt}const entitiesReducer=(et=getDefaultEntities(),_e)=>{var tt;switch(_e.type){case MODIFY_ENTITY_FIELD:{if(!et[_e.payload.type]||!et[_e.payload.type][_e.payload.id])return et;const rt=et[_e.payload.type][_e.payload.id];return typeof rt=="string"?et:{...et,[_e.payload.type]:{...et[_e.payload.type],[_e.payload.id]:{...rt,[_e.payload.key]:_e.payload.value}}}}case REORDER_ENTITY_FIELD:{if(!isReferenceList(et,_e.payload.id,_e.payload.type,_e.payload.key))return et;const rt=et[_e.payload.type][_e.payload.id];if(typeof rt=="string")return et;const nt=Array.from(rt[_e.payload.key]),[it]=nt.splice(_e.payload.startIndex,1);return nt.splice(_e.payload.endIndex,0,it),{...et,[_e.payload.type]:{...et[_e.payload.type],[_e.payload.id]:{...rt,[_e.payload.key]:nt}}}}case IMPORT_ENTITIES:{const rt=Object.keys(_e.payload.entities),nt={...et};for(const it of rt){const st=_e.payload.entities[it],ot={...et[it]||{}};let at=!1;const lt=Object.keys(st||{})||[];if(st&&lt){for(const ut of lt)at=!0,ot[ut]=et[it][ut]?quickMerge(et[it][ut],st[ut]):st[ut];at&&(nt[it]=ot)}}return nt}case ADD_REFERENCE:{if(!isReferenceList(et,_e.payload.id,_e.payload.type,_e.payload.key))return et;const rt=et[_e.payload.type][_e.payload.id],nt=Array.from(rt[_e.payload.key]);return nt.splice(_e.payload.index||nt.length+1,0,_e.payload.reference),{...et,[_e.payload.type]:{...et[_e.payload.type],[_e.payload.id]:{...rt,[_e.payload.key]:nt}}}}case REMOVE_REFERENCE:{if(!isReferenceList(et,_e.payload.id,_e.payload.type,_e.payload.key))return et;const rt=et[_e.payload.type][_e.payload.id],nt=Array.from(rt[_e.payload.key]),it=_e.payload.index||nt.findIndex(st=>st&&st.id===_e.payload.reference.id);return it===-1||((tt=nt[it])==null?void 0:tt.id)!==_e.payload.reference.id?et:(nt.splice(it,1),{...et,[_e.payload.type]:{...et[_e.payload.type],[_e.payload.id]:{...rt,[_e.payload.key]:nt}}})}default:return et}},requestReducer=(et={},_e)=>{switch(_e.type){case REQUEST_RESOURCE:case REQUEST_OFFLINE_RESOURCE:return{...et,[_e.payload.id]:{requestUri:_e.payload.id,loadingState:RESOURCE_LOADING,uriMismatch:!1,resourceUri:_e.payload.id}};case REQUEST_MISMATCH:return{...et,[_e.payload.requestId]:{...et[_e.payload.requestId]||{},uriMismatch:!0,resourceUri:_e.payload.actualId},[_e.payload.actualId]:{requestUri:_e.payload.requestId,loadingState:et[_e.payload.requestId].loadingState,uriMismatch:!0,resourceUri:_e.payload.actualId}};case REQUEST_ERROR:return{...et,[_e.payload.id]:{...et[_e.payload.id]||{},loadingState:RESOURCE_ERROR,error:_e.payload.message}};case REQUEST_COMPLETE:return{...et,[_e.payload.id]:{...et[_e.payload.id]||{},loadingState:RESOURCE_READY,error:void 0}}}return et},metaReducer=(et={},_e)=>{const{id:tt,updateValue:rt,value:nt,meta:it,key:st}=_e&&_e.payload||{};switch(_e.type){case SET_META_VALUE:return{...et,[tt]:{...et[tt]||{},[it]:{...et[tt]?et[tt][it]||{}:{},[st]:nt}}};case SET_META_VALUE_DYNAMIC:return{...et,[tt]:{...et[tt]||{},[it]:{...et[tt]?et[tt][it]||{}:{},[st]:et[tt]&&et[tt][it]?rt(et[tt][it][st]):rt(void 0)}}};case UNSET_META_VALUE:return et[tt]&&et[tt][it]&&et[tt][it][st]?{...et,[tt]:{...et[tt]||{},[it]:{...et[tt]?et[tt][it]||{}:{},[st]:void 0}}}:et;default:return et}};function createBatchReducer(et){return(_e,tt)=>tt&&tt.type===BATCH_ACTIONS?tt.payload.actions.reduce(et,_e):tt&&tt.type===BATCH_IMPORT?tt.payload.state:et(_e,tt)}const reducers=combineReducers({mapping:mappingReducer,entities:entitiesReducer,requests:requestReducer,meta:metaReducer}),composeEnhancers=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||compose;function createStore(et={}){const{enableDevtools:_e=!0,iiifStoreName:tt="iiif",defaultState:rt={},extraMiddleware:nt=[],customReducers:it={}}=et,st=combineReducers({[tt]:reducers,...it});return createStore$1(createBatchReducer(st),rt,_e?composeEnhancers(applyMiddleware(...nt)):compose(applyMiddleware(...nt)))}function mitt(et){return{all:et=et||new Map,on:function(_e,tt){var rt=et.get(_e);rt?rt.push(tt):et.set(_e,[tt])},off:function(_e,tt){var rt=et.get(_e);rt&&(tt?rt.splice(rt.indexOf(tt)>>>0,1):et.set(_e,[]))},emit:function(_e,tt){var rt=et.get(_e);rt&&rt.slice().map(function(nt){nt(tt)}),(rt=et.get("*"))&&rt.slice().map(function(nt){nt(_e,tt)})}}}class Vault{constructor(_e,tt){Tr(this,"options");Tr(this,"store");Tr(this,"emitter");Tr(this,"isBatching",!1);Tr(this,"batchQueue",[]);Tr(this,"remoteFetcher");Tr(this,"staticFetcher");Tr(this,"defaultFetcher",_e=>fetch(_e).then(tt=>tt.json()));Tr(this,"middleware",_e=>tt=>rt=>{if(rt.type===BATCH_ACTIONS){for(const st of rt.payload.actions)this.emitter.emit(st.type,{realAction:st,state:_e.getState()});const it=tt(rt);for(const st of rt.payload.actions)this.emitter.emit(`after:${rt.type}`,{action:rt,state:it});return it}this.emitter.emit(rt.type,{action:rt,state:_e.getState()});const nt=tt(rt);return this.emitter.emit(`after:${rt.type}`,{action:rt,state:nt}),nt});this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},_e||{}),this.store=tt||createStore({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=mitt(),this.remoteFetcher=createFetchHelper(this.store,this.options.customFetcher),this.staticFetcher=createFetchHelper(this.store,(rt,nt)=>nt)}batch(_e){this.isBatching=!0;try{_e(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(tt){throw this.batchQueue=[],this.isBatching=!1,tt}this.batchQueue=[],this.isBatching=!1}async asyncBatch(_e){this.isBatching=!0;try{await _e(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(tt){throw this.batchQueue=[],this.isBatching=!1,tt}this.batchQueue=[],this.isBatching=!1}modifyEntityField(_e,tt,rt){this.dispatch(entityActions.modifyEntityField({id:_e.id,type:_e.type,key:tt,value:rt}))}dispatch(_e){this.isBatching?this.batchQueue.push(_e):this.store.dispatch(_e)}serialize(_e,tt){return serialize(this.getState().iiif,_e,tt)}toPresentation2(_e){return this.serialize(_e,serializeConfigPresentation2)}toPresentation3(_e){return this.serialize(_e,serializeConfigPresentation3)}hydrate(_e,tt){return this.get(_e,tt,{skipSelfReturn:!1})}get(_e,tt,rt={}){typeof tt!="string"&&(rt=tt||{},tt=void 0);const{skipSelfReturn:nt=!0}=rt||{};if(Array.isArray(_e))return _e.map(lt=>this.get(lt,rt));const it=this.getState();if(typeof _e=="string"){const lt=tt||it.iiif.mapping[_e];if(!lt)return nt?null:{id:_e,type:"unknown"};_e={id:_e,type:lt}}const st=tt||_e.type,ot=_e.id,at=it.iiif.entities[st];if(!at){const lt=it.iiif.requests[ot];return lt&&lt.resourceUri!==ot?this.get(lt.resourceUri,rt):nt?null:_e}return at[_e.id]||(nt?null:_e)}select(_e){return _e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(_e,tt){const rt=typeof _e=="string"?_e:_e.id;return this.load(rt,tt)}loadCollection(_e,tt){const rt=typeof _e=="string"?_e:_e.id;return this.load(rt,tt)}load(_e,tt){const rt=typeof _e=="string"?_e:_e.id;return tt?this.staticFetcher(rt,tt):this.remoteFetcher(rt)}areInputsEqual(_e,tt){return areInputsEqual(_e,tt)}subscribe(_e,tt,rt){typeof rt>"u"&&(typeof tt>"u"||tt===!1||tt===!0)&&(rt=tt,tt=_e,_e=it=>it);let nt=rt?null:_e(this.store.getState());return rt||tt(nt,this),this.store.subscribe(()=>{const it=this.store.getState(),st=_e(it);nt!==st&&!areInputsEqual(nt,st)&&tt(st,this),nt=st})}async ensureLoaded(_e){const tt=typeof _e=="string"?_e:_e.id;this.requestStatus(tt)||await this.load(tt)}requestStatus(_e){return this.select(tt=>tt.iiif.requests[_e])}getResourceMeta(_e,tt){const rt=this.getState().iiif.meta[_e];if(rt)return tt?rt[tt]:rt}setMetaValue([_e,tt,rt],nt){this.dispatch(typeof nt=="function"?metaActions.setMetaValueDynamic({id:_e,meta:tt,key:rt,updateValue:nt}):metaActions.setMetaValue({id:_e,meta:tt,key:rt,value:nt}))}}const cleanTime=et=>{const _e=et.toString().split(":"),tt=Math.ceil(parseInt(_e[0])),rt=Math.ceil(parseInt(_e[1])),nt=zeroPad(Math.ceil(parseInt(_e[2])),2);let st=`${tt!==0&&rt<10?(rt+"").padStart(2,"0"):rt}:${nt}`;return tt!==0&&(st=`${tt}:${st}`),st},convertTime=et=>{const _e=new Date(et*1e3).toISOString().substr(11,8);return cleanTime(_e)},deepMerge=(et,_e)=>{if(typeof et!="object"||et===null)return _e;for(const tt in _e)typeof _e[tt]=="object"&&_e[tt]!==null&&!Array.isArray(_e[tt])?(et[tt]||(et[tt]={}),et[tt]=deepMerge(et[tt],_e[tt])):et[tt]=_e[tt];return et},getRealPropertyValue$1=(et,_e)=>Object.hasOwn(et,_e)?et[_e].toString():void 0,zeroPad=(et,_e)=>String(et).padStart(_e,"0"),defaultConfigOptions={annotationOverlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"61.8vh",ignoreCaptionLabels:[],informationPanel:{open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showIIIFBadge:!0,showTitle:!0,withCredentials:!1},defaultState$1={activeCanvas:"",activeManifest:"",collection:{},configOptions:defaultConfigOptions,customDisplays:[],informationOpen:(Sr=defaultConfigOptions==null?void 0:defaultConfigOptions.informationPanel)==null?void 0:Sr.open,isLoaded:!1,vault:new Vault,openSeadragonViewer:null},ViewerStateContext=wn.createContext(defaultState$1),ViewerDispatchContext=wn.createContext(defaultState$1);function viewerReducer(et,_e){switch(_e.type){case"updateActiveCanvas":return _e.canvasId||(_e.canvasId=""),{...et,activeCanvas:_e.canvasId};case"updateActiveManifest":return{...et,activeManifest:_e.manifestId};case"updateCollection":return{...et,collection:_e.collection};case"updateConfigOptions":return{...et,configOptions:deepMerge(et.configOptions,_e.configOptions)};case"updateInformationOpen":return{...et,informationOpen:_e.informationOpen};case"updateIsLoaded":return{...et,isLoaded:_e.isLoaded};case"updateOpenSeadragonViewer":return{...et,openSeadragonViewer:_e.openSeadragonViewer};default:throw new Error(`Unhandled action type: ${_e.type}`)}}const ViewerProvider=({initialState:et=defaultState$1,children:_e})=>{const[tt,rt]=y$2(viewerReducer,et);return y$3(ViewerStateContext.Provider,{value:tt},y$3(ViewerDispatchContext.Provider,{value:rt},_e))};function useViewerState(){const et=wn.useContext(ViewerStateContext);if(et===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return et}function useViewerDispatch(){const et=wn.useContext(ViewerDispatchContext);if(et===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return et}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(et){for(var _e=1;_e<arguments.length;_e++){var tt=arguments[_e];for(var rt in tt)Object.prototype.hasOwnProperty.call(tt,rt)&&(et[rt]=tt[rt])}return et},_extends$1.apply(this,arguments)}function $e42e1063c40fb3ef$export$b9ecd428b558ff10(et,_e,{checkForDefaultPrevented:tt=!0}={}){return function(nt){if(et==null||et(nt),tt===!1||!nt.defaultPrevented)return _e==null?void 0:_e(nt)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(et,_e=[]){let tt=[];function rt(it,st){const ot=G$3(st),at=tt.length;tt=[...tt,st];function lt(ct){const{scope:dt,children:ft,...pt}=ct,mt=(dt==null?void 0:dt[et][at])||ot,ht=q$2(()=>pt,Object.values(pt));return y$3(mt.Provider,{value:ht},ft)}function ut(ct,dt){const ft=(dt==null?void 0:dt[et][at])||ot,pt=P$3(ft);if(pt)return pt;if(st!==void 0)return st;throw new Error(`\`${ct}\` must be used within \`${it}\``)}return lt.displayName=it+"Provider",[lt,ut]}const nt=()=>{const it=tt.map(st=>G$3(st));return function(ot){const at=(ot==null?void 0:ot[et])||it;return q$2(()=>({[`__scope${et}`]:{...ot,[et]:at}}),[ot,at])}};return nt.scopeName=et,[rt,$c512c27ab02ef895$var$composeContextScopes(nt,..._e)]}function $c512c27ab02ef895$var$composeContextScopes(...et){const _e=et[0];if(et.length===1)return _e;const tt=()=>{const rt=et.map(nt=>({useScope:nt(),scopeName:nt.scopeName}));return function(it){const st=rt.reduce((ot,{useScope:at,scopeName:lt})=>{const ct=at(it)[`__scope${lt}`];return{...ot,...ct}},{});return q$2(()=>({[`__scope${_e.scopeName}`]:st}),[st])}};return tt.scopeName=_e.scopeName,tt}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(et){const _e=F$2(et);return _(()=>{_e.current=et}),q$2(()=>(...tt)=>{var rt;return(rt=_e.current)===null||rt===void 0?void 0:rt.call(_e,...tt)},[])}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:et,defaultProp:_e,onChange:tt=()=>{}}){const[rt,nt]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:_e,onChange:tt}),it=et!==void 0,st=it?et:rt,ot=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt),at=x$3(lt=>{if(it){const ct=typeof lt=="function"?lt(et):lt;ct!==et&&ot(ct)}else nt(lt)},[it,et,nt,ot]);return[st,at]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:et,onChange:_e}){const tt=p$2(et),[rt]=tt,nt=F$2(rt),it=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_e);return _(()=>{nt.current!==rt&&(it(rt),nt.current=rt)},[rt,nt,it]),tt}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?A$3:()=>{};function $6ed0406888f73fc4$var$setRef(et,_e){typeof et=="function"?et(_e):et!=null&&(et.current=_e)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...et){return _e=>et.forEach(tt=>$6ed0406888f73fc4$var$setRef(tt,_e))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...et){return x$3($6ed0406888f73fc4$export$43e446d32b3d21af(...et),et)}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(et){return et&&et.__esModule&&Object.prototype.hasOwnProperty.call(et,"default")?et.default:et}function getAugmentedNamespace(et){if(et.__esModule)return et;var _e=et.default;if(typeof _e=="function"){var tt=function rt(){return this instanceof rt?Reflect.construct(_e,arguments,this.constructor):_e.apply(this,arguments)};tt.prototype=_e.prototype}else tt={};return Object.defineProperty(tt,"__esModule",{value:!0}),Object.keys(et).forEach(function(rt){var nt=Object.getOwnPropertyDescriptor(et,rt);Object.defineProperty(tt,rt,nt.get?nt:{enumerable:!0,get:function(){return et[rt]}})}),tt}var reactDom={exports:{}},reactDom_production_min={};const require$$0=getAugmentedNamespace($2AODx$react);var scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(et){function _e(Ft,Ut){var Ht=Ft.length;Ft.push(Ut);e:for(;0<Ht;){var jt=Ht-1>>>1,Gt=Ft[jt];if(0<nt(Gt,Ut))Ft[jt]=Ut,Ft[Ht]=Gt,Ht=jt;else break e}}function tt(Ft){return Ft.length===0?null:Ft[0]}function rt(Ft){if(Ft.length===0)return null;var Ut=Ft[0],Ht=Ft.pop();if(Ht!==Ut){Ft[0]=Ht;e:for(var jt=0,Gt=Ft.length,tr=Gt>>>1;jt<tr;){var Yt=2*(jt+1)-1,Jt=Ft[Yt],rr=Yt+1,qt=Ft[rr];if(0>nt(Jt,Ht))rr<Gt&&0>nt(qt,Jt)?(Ft[jt]=qt,Ft[rr]=Ht,jt=rr):(Ft[jt]=Jt,Ft[Yt]=Ht,jt=Yt);else if(rr<Gt&&0>nt(qt,Ht))Ft[jt]=qt,Ft[rr]=Ht,jt=rr;else break e}}return Ut}function nt(Ft,Ut){var Ht=Ft.sortIndex-Ut.sortIndex;return Ht!==0?Ht:Ft.id-Ut.id}if(typeof performance=="object"&&typeof performance.now=="function"){var it=performance;et.unstable_now=function(){return it.now()}}else{var st=Date,ot=st.now();et.unstable_now=function(){return st.now()-ot}}var at=[],lt=[],ut=1,ct=null,dt=3,ft=!1,pt=!1,mt=!1,ht=typeof setTimeout=="function"?setTimeout:null,gt=typeof clearTimeout=="function"?clearTimeout:null,vt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function yt(Ft){for(var Ut=tt(lt);Ut!==null;){if(Ut.callback===null)rt(lt);else if(Ut.startTime<=Ft)rt(lt),Ut.sortIndex=Ut.expirationTime,_e(at,Ut);else break;Ut=tt(lt)}}function bt(Ft){if(mt=!1,yt(Ft),!pt)if(tt(at)!==null)pt=!0,Nt(xt);else{var Ut=tt(lt);Ut!==null&&It(bt,Ut.startTime-Ft)}}function xt(Ft,Ut){pt=!1,mt&&(mt=!1,gt(Ct),Ct=-1),ft=!0;var Ht=dt;try{for(yt(Ut),ct=tt(at);ct!==null&&(!(ct.expirationTime>Ut)||Ft&&!$t());){var jt=ct.callback;if(typeof jt=="function"){ct.callback=null,dt=ct.priorityLevel;var Gt=jt(ct.expirationTime<=Ut);Ut=et.unstable_now(),typeof Gt=="function"?ct.callback=Gt:ct===tt(at)&&rt(at),yt(Ut)}else rt(at);ct=tt(at)}if(ct!==null)var tr=!0;else{var Yt=tt(lt);Yt!==null&&It(bt,Yt.startTime-Ut),tr=!1}return tr}finally{ct=null,dt=Ht,ft=!1}}var _t=!1,wt=null,Ct=-1,kt=5,At=-1;function $t(){return!(et.unstable_now()-At<kt)}function Lt(){if(wt!==null){var Ft=et.unstable_now();At=Ft;var Ut=!0;try{Ut=wt(!0,Ft)}finally{Ut?Mt():(_t=!1,wt=null)}}else _t=!1}var Mt;if(typeof vt=="function")Mt=function(){vt(Lt)};else if(typeof MessageChannel<"u"){var Bt=new MessageChannel,Pt=Bt.port2;Bt.port1.onmessage=Lt,Mt=function(){Pt.postMessage(null)}}else Mt=function(){ht(Lt,0)};function Nt(Ft){wt=Ft,_t||(_t=!0,Mt())}function It(Ft,Ut){Ct=ht(function(){Ft(et.unstable_now())},Ut)}et.unstable_IdlePriority=5,et.unstable_ImmediatePriority=1,et.unstable_LowPriority=4,et.unstable_NormalPriority=3,et.unstable_Profiling=null,et.unstable_UserBlockingPriority=2,et.unstable_cancelCallback=function(Ft){Ft.callback=null},et.unstable_continueExecution=function(){pt||ft||(pt=!0,Nt(xt))},et.unstable_forceFrameRate=function(Ft){0>Ft||125<Ft?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):kt=0<Ft?Math.floor(1e3/Ft):5},et.unstable_getCurrentPriorityLevel=function(){return dt},et.unstable_getFirstCallbackNode=function(){return tt(at)},et.unstable_next=function(Ft){switch(dt){case 1:case 2:case 3:var Ut=3;break;default:Ut=dt}var Ht=dt;dt=Ut;try{return Ft()}finally{dt=Ht}},et.unstable_pauseExecution=function(){},et.unstable_requestPaint=function(){},et.unstable_runWithPriority=function(Ft,Ut){switch(Ft){case 1:case 2:case 3:case 4:case 5:break;default:Ft=3}var Ht=dt;dt=Ft;try{return Ut()}finally{dt=Ht}},et.unstable_scheduleCallback=function(Ft,Ut,Ht){var jt=et.unstable_now();switch(typeof Ht=="object"&&Ht!==null?(Ht=Ht.delay,Ht=typeof Ht=="number"&&0<Ht?jt+Ht:jt):Ht=jt,Ft){case 1:var Gt=-1;break;case 2:Gt=250;break;case 5:Gt=1073741823;break;case 4:Gt=1e4;break;default:Gt=5e3}return Gt=Ht+Gt,Ft={id:ut++,callback:Ut,priorityLevel:Ft,startTime:Ht,expirationTime:Gt,sortIndex:-1},Ht>jt?(Ft.sortIndex=Ht,_e(lt,Ft),tt(at)===null&&Ft===tt(lt)&&(mt?(gt(Ct),Ct=-1):mt=!0,It(bt,Ht-jt))):(Ft.sortIndex=Gt,_e(at,Ft),pt||ft||(pt=!0,Nt(xt))),Ft},et.unstable_shouldYield=$t,et.unstable_wrapCallback=function(Ft){var Ut=dt;return function(){var Ht=dt;dt=Ut;try{return Ft.apply(this,arguments)}finally{dt=Ht}}}})(scheduler_production_min),scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=require$$0,ca=schedulerExports;function p$1(et){for(var _e="https://reactjs.org/docs/error-decoder.html?invariant="+et,tt=1;tt<arguments.length;tt++)_e+="&args[]="+encodeURIComponent(arguments[tt]);return"Minified React error #"+et+"; visit "+_e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(et,_e){ha(et,_e),ha(et+"Capture",_e)}function ha(et,_e){for(ea[et]=_e,et=0;et<_e.length;et++)da.add(_e[et])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(et){return ja.call(ma,et)?!0:ja.call(la,et)?!1:ka.test(et)?ma[et]=!0:(la[et]=!0,!1)}function pa(et,_e,tt,rt){if(tt!==null&&tt.type===0)return!1;switch(typeof _e){case"function":case"symbol":return!0;case"boolean":return rt?!1:tt!==null?!tt.acceptsBooleans:(et=et.toLowerCase().slice(0,5),et!=="data-"&&et!=="aria-");default:return!1}}function qa(et,_e,tt,rt){if(_e===null||typeof _e>"u"||pa(et,_e,tt,rt))return!0;if(rt)return!1;if(tt!==null)switch(tt.type){case 3:return!_e;case 4:return _e===!1;case 5:return isNaN(_e);case 6:return isNaN(_e)||1>_e}return!1}function v$1(et,_e,tt,rt,nt,it,st){this.acceptsBooleans=_e===2||_e===3||_e===4,this.attributeName=rt,this.attributeNamespace=nt,this.mustUseProperty=tt,this.propertyName=et,this.type=_e,this.sanitizeURL=it,this.removeEmptyString=st}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(et){z$1[et]=new v$1(et,0,!1,et,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(et){var _e=et[0];z$1[_e]=new v$1(_e,1,!1,et[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(et){z$1[et]=new v$1(et,2,!1,et.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(et){z$1[et]=new v$1(et,2,!1,et,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(et){z$1[et]=new v$1(et,3,!1,et.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(et){z$1[et]=new v$1(et,3,!0,et,null,!1,!1)}),["capture","download"].forEach(function(et){z$1[et]=new v$1(et,4,!1,et,null,!1,!1)}),["cols","rows","size","span"].forEach(function(et){z$1[et]=new v$1(et,6,!1,et,null,!1,!1)}),["rowSpan","start"].forEach(function(et){z$1[et]=new v$1(et,5,!1,et.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(et){return et[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(et){var _e=et.replace(ra,sa);z$1[_e]=new v$1(_e,1,!1,et,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(et){var _e=et.replace(ra,sa);z$1[_e]=new v$1(_e,1,!1,et,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(et){var _e=et.replace(ra,sa);z$1[_e]=new v$1(_e,1,!1,et,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(et){z$1[et]=new v$1(et,1,!1,et.toLowerCase(),null,!1,!1)}),z$1.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(et){z$1[et]=new v$1(et,1,!1,et.toLowerCase(),null,!0,!0)});function ta(et,_e,tt,rt){var nt=z$1.hasOwnProperty(_e)?z$1[_e]:null;(nt!==null?nt.type!==0:rt||!(2<_e.length)||_e[0]!=="o"&&_e[0]!=="O"||_e[1]!=="n"&&_e[1]!=="N")&&(qa(_e,tt,nt,rt)&&(tt=null),rt||nt===null?oa(_e)&&(tt===null?et.removeAttribute(_e):et.setAttribute(_e,""+tt)):nt.mustUseProperty?et[nt.propertyName]=tt===null?nt.type===3?!1:"":tt:(_e=nt.attributeName,rt=nt.attributeNamespace,tt===null?et.removeAttribute(_e):(nt=nt.type,tt=nt===3||nt===4&&tt===!0?"":""+tt,rt?et.setAttributeNS(rt,_e,tt):et.setAttribute(_e,tt))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(et){return et===null||typeof et!="object"?null:(et=Ja&&et[Ja]||et["@@iterator"],typeof et=="function"?et:null)}var A$1=Object.assign,La;function Ma(et){if(La===void 0)try{throw Error()}catch(tt){var _e=tt.stack.trim().match(/\n( *(at )?)/);La=_e&&_e[1]||""}return`
`+La+et}var Na=!1;function Oa(et,_e){if(!et||Na)return"";Na=!0;var tt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_e)if(_e=function(){throw Error()},Object.defineProperty(_e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_e,[])}catch(lt){var rt=lt}Reflect.construct(et,[],_e)}else{try{_e.call()}catch(lt){rt=lt}et.call(_e.prototype)}else{try{throw Error()}catch(lt){rt=lt}et()}}catch(lt){if(lt&&rt&&typeof lt.stack=="string"){for(var nt=lt.stack.split(`
`),it=rt.stack.split(`
`),st=nt.length-1,ot=it.length-1;1<=st&&0<=ot&&nt[st]!==it[ot];)ot--;for(;1<=st&&0<=ot;st--,ot--)if(nt[st]!==it[ot]){if(st!==1||ot!==1)do if(st--,ot--,0>ot||nt[st]!==it[ot]){var at=`
`+nt[st].replace(" at new "," at ");return et.displayName&&at.includes("<anonymous>")&&(at=at.replace("<anonymous>",et.displayName)),at}while(1<=st&&0<=ot);break}}}finally{Na=!1,Error.prepareStackTrace=tt}return(et=et?et.displayName||et.name:"")?Ma(et):""}function Pa(et){switch(et.tag){case 5:return Ma(et.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return et=Oa(et.type,!1),et;case 11:return et=Oa(et.type.render,!1),et;case 1:return et=Oa(et.type,!0),et;default:return""}}function Qa(et){if(et==null)return null;if(typeof et=="function")return et.displayName||et.name||null;if(typeof et=="string")return et;switch(et){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof et=="object")switch(et.$$typeof){case Ca:return(et.displayName||"Context")+".Consumer";case Ba:return(et._context.displayName||"Context")+".Provider";case Da:var _e=et.render;return et=et.displayName,et||(et=_e.displayName||_e.name||"",et=et!==""?"ForwardRef("+et+")":"ForwardRef"),et;case Ga:return _e=et.displayName||null,_e!==null?_e:Qa(et.type)||"Memo";case Ha:_e=et._payload,et=et._init;try{return Qa(et(_e))}catch{}}return null}function Ra(et){var _e=et.type;switch(et.tag){case 24:return"Cache";case 9:return(_e.displayName||"Context")+".Consumer";case 10:return(_e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return et=_e.render,et=et.displayName||et.name||"",_e.displayName||(et!==""?"ForwardRef("+et+")":"ForwardRef");case 7:return"Fragment";case 5:return _e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(_e);case 8:return _e===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _e=="function")return _e.displayName||_e.name||null;if(typeof _e=="string")return _e}return null}function Sa(et){switch(typeof et){case"boolean":case"number":case"string":case"undefined":return et;case"object":return et;default:return""}}function Ta(et){var _e=et.type;return(et=et.nodeName)&&et.toLowerCase()==="input"&&(_e==="checkbox"||_e==="radio")}function Ua(et){var _e=Ta(et)?"checked":"value",tt=Object.getOwnPropertyDescriptor(et.constructor.prototype,_e),rt=""+et[_e];if(!et.hasOwnProperty(_e)&&typeof tt<"u"&&typeof tt.get=="function"&&typeof tt.set=="function"){var nt=tt.get,it=tt.set;return Object.defineProperty(et,_e,{configurable:!0,get:function(){return nt.call(this)},set:function(st){rt=""+st,it.call(this,st)}}),Object.defineProperty(et,_e,{enumerable:tt.enumerable}),{getValue:function(){return rt},setValue:function(st){rt=""+st},stopTracking:function(){et._valueTracker=null,delete et[_e]}}}}function Va(et){et._valueTracker||(et._valueTracker=Ua(et))}function Wa(et){if(!et)return!1;var _e=et._valueTracker;if(!_e)return!0;var tt=_e.getValue(),rt="";return et&&(rt=Ta(et)?et.checked?"true":"false":et.value),et=rt,et!==tt?(_e.setValue(et),!0):!1}function Xa(et){if(et=et||(typeof document<"u"?document:void 0),typeof et>"u")return null;try{return et.activeElement||et.body}catch{return et.body}}function Ya(et,_e){var tt=_e.checked;return A$1({},_e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:tt??et._wrapperState.initialChecked})}function Za(et,_e){var tt=_e.defaultValue==null?"":_e.defaultValue,rt=_e.checked!=null?_e.checked:_e.defaultChecked;tt=Sa(_e.value!=null?_e.value:tt),et._wrapperState={initialChecked:rt,initialValue:tt,controlled:_e.type==="checkbox"||_e.type==="radio"?_e.checked!=null:_e.value!=null}}function ab(et,_e){_e=_e.checked,_e!=null&&ta(et,"checked",_e,!1)}function bb(et,_e){ab(et,_e);var tt=Sa(_e.value),rt=_e.type;if(tt!=null)rt==="number"?(tt===0&&et.value===""||et.value!=tt)&&(et.value=""+tt):et.value!==""+tt&&(et.value=""+tt);else if(rt==="submit"||rt==="reset"){et.removeAttribute("value");return}_e.hasOwnProperty("value")?cb(et,_e.type,tt):_e.hasOwnProperty("defaultValue")&&cb(et,_e.type,Sa(_e.defaultValue)),_e.checked==null&&_e.defaultChecked!=null&&(et.defaultChecked=!!_e.defaultChecked)}function db(et,_e,tt){if(_e.hasOwnProperty("value")||_e.hasOwnProperty("defaultValue")){var rt=_e.type;if(!(rt!=="submit"&&rt!=="reset"||_e.value!==void 0&&_e.value!==null))return;_e=""+et._wrapperState.initialValue,tt||_e===et.value||(et.value=_e),et.defaultValue=_e}tt=et.name,tt!==""&&(et.name=""),et.defaultChecked=!!et._wrapperState.initialChecked,tt!==""&&(et.name=tt)}function cb(et,_e,tt){(_e!=="number"||Xa(et.ownerDocument)!==et)&&(tt==null?et.defaultValue=""+et._wrapperState.initialValue:et.defaultValue!==""+tt&&(et.defaultValue=""+tt))}var eb=Array.isArray;function fb(et,_e,tt,rt){if(et=et.options,_e){_e={};for(var nt=0;nt<tt.length;nt++)_e["$"+tt[nt]]=!0;for(tt=0;tt<et.length;tt++)nt=_e.hasOwnProperty("$"+et[tt].value),et[tt].selected!==nt&&(et[tt].selected=nt),nt&&rt&&(et[tt].defaultSelected=!0)}else{for(tt=""+Sa(tt),_e=null,nt=0;nt<et.length;nt++){if(et[nt].value===tt){et[nt].selected=!0,rt&&(et[nt].defaultSelected=!0);return}_e!==null||et[nt].disabled||(_e=et[nt])}_e!==null&&(_e.selected=!0)}}function gb(et,_e){if(_e.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},_e,{value:void 0,defaultValue:void 0,children:""+et._wrapperState.initialValue})}function hb(et,_e){var tt=_e.value;if(tt==null){if(tt=_e.children,_e=_e.defaultValue,tt!=null){if(_e!=null)throw Error(p$1(92));if(eb(tt)){if(1<tt.length)throw Error(p$1(93));tt=tt[0]}_e=tt}_e==null&&(_e=""),tt=_e}et._wrapperState={initialValue:Sa(tt)}}function ib(et,_e){var tt=Sa(_e.value),rt=Sa(_e.defaultValue);tt!=null&&(tt=""+tt,tt!==et.value&&(et.value=tt),_e.defaultValue==null&&et.defaultValue!==tt&&(et.defaultValue=tt)),rt!=null&&(et.defaultValue=""+rt)}function jb(et){var _e=et.textContent;_e===et._wrapperState.initialValue&&_e!==""&&_e!==null&&(et.value=_e)}function kb(et){switch(et){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(et,_e){return et==null||et==="http://www.w3.org/1999/xhtml"?kb(_e):et==="http://www.w3.org/2000/svg"&&_e==="foreignObject"?"http://www.w3.org/1999/xhtml":et}var mb,nb=function(et){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_e,tt,rt,nt){MSApp.execUnsafeLocalFunction(function(){return et(_e,tt,rt,nt)})}:et}(function(et,_e){if(et.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in et)et.innerHTML=_e;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+_e.valueOf().toString()+"</svg>",_e=mb.firstChild;et.firstChild;)et.removeChild(et.firstChild);for(;_e.firstChild;)et.appendChild(_e.firstChild)}});function ob(et,_e){if(_e){var tt=et.firstChild;if(tt&&tt===et.lastChild&&tt.nodeType===3){tt.nodeValue=_e;return}}et.textContent=_e}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(et){qb.forEach(function(_e){_e=_e+et.charAt(0).toUpperCase()+et.substring(1),pb[_e]=pb[et]})});function rb(et,_e,tt){return _e==null||typeof _e=="boolean"||_e===""?"":tt||typeof _e!="number"||_e===0||pb.hasOwnProperty(et)&&pb[et]?(""+_e).trim():_e+"px"}function sb(et,_e){et=et.style;for(var tt in _e)if(_e.hasOwnProperty(tt)){var rt=tt.indexOf("--")===0,nt=rb(tt,_e[tt],rt);tt==="float"&&(tt="cssFloat"),rt?et.setProperty(tt,nt):et[tt]=nt}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(et,_e){if(_e){if(tb[et]&&(_e.children!=null||_e.dangerouslySetInnerHTML!=null))throw Error(p$1(137,et));if(_e.dangerouslySetInnerHTML!=null){if(_e.children!=null)throw Error(p$1(60));if(typeof _e.dangerouslySetInnerHTML!="object"||!("__html"in _e.dangerouslySetInnerHTML))throw Error(p$1(61))}if(_e.style!=null&&typeof _e.style!="object")throw Error(p$1(62))}}function vb(et,_e){if(et.indexOf("-")===-1)return typeof _e.is=="string";switch(et){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(et){return et=et.target||et.srcElement||window,et.correspondingUseElement&&(et=et.correspondingUseElement),et.nodeType===3?et.parentNode:et}var yb=null,zb=null,Ab=null;function Bb(et){if(et=Cb(et)){if(typeof yb!="function")throw Error(p$1(280));var _e=et.stateNode;_e&&(_e=Db(_e),yb(et.stateNode,et.type,_e))}}function Eb(et){zb?Ab?Ab.push(et):Ab=[et]:zb=et}function Fb(){if(zb){var et=zb,_e=Ab;if(Ab=zb=null,Bb(et),_e)for(et=0;et<_e.length;et++)Bb(_e[et])}}function Gb(et,_e){return et(_e)}function Hb(){}var Ib=!1;function Jb(et,_e,tt){if(Ib)return et(_e,tt);Ib=!0;try{return Gb(et,_e,tt)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(et,_e){var tt=et.stateNode;if(tt===null)return null;var rt=Db(tt);if(rt===null)return null;tt=rt[_e];e:switch(_e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(rt=!rt.disabled)||(et=et.type,rt=!(et==="button"||et==="input"||et==="select"||et==="textarea")),et=!rt;break e;default:et=!1}if(et)return null;if(tt&&typeof tt!="function")throw Error(p$1(231,_e,typeof tt));return tt}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(et,_e,tt,rt,nt,it,st,ot,at){var lt=Array.prototype.slice.call(arguments,3);try{_e.apply(tt,lt)}catch(ut){this.onError(ut)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(et){Ob=!0,Pb=et}};function Tb(et,_e,tt,rt,nt,it,st,ot,at){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(et,_e,tt,rt,nt,it,st,ot,at){if(Tb.apply(this,arguments),Ob){if(Ob){var lt=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=lt)}}function Vb(et){var _e=et,tt=et;if(et.alternate)for(;_e.return;)_e=_e.return;else{et=_e;do _e=et,_e.flags&4098&&(tt=_e.return),et=_e.return;while(et)}return _e.tag===3?tt:null}function Wb(et){if(et.tag===13){var _e=et.memoizedState;if(_e===null&&(et=et.alternate,et!==null&&(_e=et.memoizedState)),_e!==null)return _e.dehydrated}return null}function Xb(et){if(Vb(et)!==et)throw Error(p$1(188))}function Yb(et){var _e=et.alternate;if(!_e){if(_e=Vb(et),_e===null)throw Error(p$1(188));return _e!==et?null:et}for(var tt=et,rt=_e;;){var nt=tt.return;if(nt===null)break;var it=nt.alternate;if(it===null){if(rt=nt.return,rt!==null){tt=rt;continue}break}if(nt.child===it.child){for(it=nt.child;it;){if(it===tt)return Xb(nt),et;if(it===rt)return Xb(nt),_e;it=it.sibling}throw Error(p$1(188))}if(tt.return!==rt.return)tt=nt,rt=it;else{for(var st=!1,ot=nt.child;ot;){if(ot===tt){st=!0,tt=nt,rt=it;break}if(ot===rt){st=!0,rt=nt,tt=it;break}ot=ot.sibling}if(!st){for(ot=it.child;ot;){if(ot===tt){st=!0,tt=it,rt=nt;break}if(ot===rt){st=!0,rt=it,tt=nt;break}ot=ot.sibling}if(!st)throw Error(p$1(189))}}if(tt.alternate!==rt)throw Error(p$1(190))}if(tt.tag!==3)throw Error(p$1(188));return tt.stateNode.current===tt?et:_e}function Zb(et){return et=Yb(et),et!==null?$b(et):null}function $b(et){if(et.tag===5||et.tag===6)return et;for(et=et.child;et!==null;){var _e=$b(et);if(_e!==null)return _e;et=et.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(et){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,et,void 0,(et.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(et){return et>>>=0,et===0?32:31-(pc(et)/qc|0)|0}var rc=64,sc=4194304;function tc(et){switch(et&-et){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return et&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return et&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return et}}function uc(et,_e){var tt=et.pendingLanes;if(tt===0)return 0;var rt=0,nt=et.suspendedLanes,it=et.pingedLanes,st=tt&268435455;if(st!==0){var ot=st&~nt;ot!==0?rt=tc(ot):(it&=st,it!==0&&(rt=tc(it)))}else st=tt&~nt,st!==0?rt=tc(st):it!==0&&(rt=tc(it));if(rt===0)return 0;if(_e!==0&&_e!==rt&&!(_e&nt)&&(nt=rt&-rt,it=_e&-_e,nt>=it||nt===16&&(it&4194240)!==0))return _e;if(rt&4&&(rt|=tt&16),_e=et.entangledLanes,_e!==0)for(et=et.entanglements,_e&=rt;0<_e;)tt=31-oc(_e),nt=1<<tt,rt|=et[tt],_e&=~nt;return rt}function vc(et,_e){switch(et){case 1:case 2:case 4:return _e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(et,_e){for(var tt=et.suspendedLanes,rt=et.pingedLanes,nt=et.expirationTimes,it=et.pendingLanes;0<it;){var st=31-oc(it),ot=1<<st,at=nt[st];at===-1?(!(ot&tt)||ot&rt)&&(nt[st]=vc(ot,_e)):at<=_e&&(et.expiredLanes|=ot),it&=~ot}}function xc(et){return et=et.pendingLanes&-1073741825,et!==0?et:et&1073741824?1073741824:0}function yc(){var et=rc;return rc<<=1,!(rc&4194240)&&(rc=64),et}function zc(et){for(var _e=[],tt=0;31>tt;tt++)_e.push(et);return _e}function Ac(et,_e,tt){et.pendingLanes|=_e,_e!==536870912&&(et.suspendedLanes=0,et.pingedLanes=0),et=et.eventTimes,_e=31-oc(_e),et[_e]=tt}function Bc(et,_e){var tt=et.pendingLanes&~_e;et.pendingLanes=_e,et.suspendedLanes=0,et.pingedLanes=0,et.expiredLanes&=_e,et.mutableReadLanes&=_e,et.entangledLanes&=_e,_e=et.entanglements;var rt=et.eventTimes;for(et=et.expirationTimes;0<tt;){var nt=31-oc(tt),it=1<<nt;_e[nt]=0,rt[nt]=-1,et[nt]=-1,tt&=~it}}function Cc(et,_e){var tt=et.entangledLanes|=_e;for(et=et.entanglements;tt;){var rt=31-oc(tt),nt=1<<rt;nt&_e|et[rt]&_e&&(et[rt]|=_e),tt&=~nt}}var C$1=0;function Dc(et){return et&=-et,1<et?4<et?et&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(et,_e){switch(et){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(_e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(_e.pointerId)}}function Tc(et,_e,tt,rt,nt,it){return et===null||et.nativeEvent!==it?(et={blockedOn:_e,domEventName:tt,eventSystemFlags:rt,nativeEvent:it,targetContainers:[nt]},_e!==null&&(_e=Cb(_e),_e!==null&&Fc(_e)),et):(et.eventSystemFlags|=rt,_e=et.targetContainers,nt!==null&&_e.indexOf(nt)===-1&&_e.push(nt),et)}function Uc(et,_e,tt,rt,nt){switch(_e){case"focusin":return Lc=Tc(Lc,et,_e,tt,rt,nt),!0;case"dragenter":return Mc=Tc(Mc,et,_e,tt,rt,nt),!0;case"mouseover":return Nc=Tc(Nc,et,_e,tt,rt,nt),!0;case"pointerover":var it=nt.pointerId;return Oc.set(it,Tc(Oc.get(it)||null,et,_e,tt,rt,nt)),!0;case"gotpointercapture":return it=nt.pointerId,Pc.set(it,Tc(Pc.get(it)||null,et,_e,tt,rt,nt)),!0}return!1}function Vc(et){var _e=Wc(et.target);if(_e!==null){var tt=Vb(_e);if(tt!==null){if(_e=tt.tag,_e===13){if(_e=Wb(tt),_e!==null){et.blockedOn=_e,Ic(et.priority,function(){Gc(tt)});return}}else if(_e===3&&tt.stateNode.current.memoizedState.isDehydrated){et.blockedOn=tt.tag===3?tt.stateNode.containerInfo:null;return}}}et.blockedOn=null}function Xc(et){if(et.blockedOn!==null)return!1;for(var _e=et.targetContainers;0<_e.length;){var tt=Yc(et.domEventName,et.eventSystemFlags,_e[0],et.nativeEvent);if(tt===null){tt=et.nativeEvent;var rt=new tt.constructor(tt.type,tt);wb=rt,tt.target.dispatchEvent(rt),wb=null}else return _e=Cb(tt),_e!==null&&Fc(_e),et.blockedOn=tt,!1;_e.shift()}return!0}function Zc(et,_e,tt){Xc(et)&&tt.delete(_e)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(et,_e){et.blockedOn===_e&&(et.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(et){function _e(nt){return ad(nt,et)}if(0<Kc.length){ad(Kc[0],et);for(var tt=1;tt<Kc.length;tt++){var rt=Kc[tt];rt.blockedOn===et&&(rt.blockedOn=null)}}for(Lc!==null&&ad(Lc,et),Mc!==null&&ad(Mc,et),Nc!==null&&ad(Nc,et),Oc.forEach(_e),Pc.forEach(_e),tt=0;tt<Qc.length;tt++)rt=Qc[tt],rt.blockedOn===et&&(rt.blockedOn=null);for(;0<Qc.length&&(tt=Qc[0],tt.blockedOn===null);)Vc(tt),tt.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(et,_e,tt,rt){var nt=C$1,it=cd.transition;cd.transition=null;try{C$1=1,fd(et,_e,tt,rt)}finally{C$1=nt,cd.transition=it}}function gd(et,_e,tt,rt){var nt=C$1,it=cd.transition;cd.transition=null;try{C$1=4,fd(et,_e,tt,rt)}finally{C$1=nt,cd.transition=it}}function fd(et,_e,tt,rt){if(dd){var nt=Yc(et,_e,tt,rt);if(nt===null)hd(et,_e,rt,id,tt),Sc(et,rt);else if(Uc(nt,et,_e,tt,rt))rt.stopPropagation();else if(Sc(et,rt),_e&4&&-1<Rc.indexOf(et)){for(;nt!==null;){var it=Cb(nt);if(it!==null&&Ec(it),it=Yc(et,_e,tt,rt),it===null&&hd(et,_e,rt,id,tt),it===nt)break;nt=it}nt!==null&&rt.stopPropagation()}else hd(et,_e,rt,null,tt)}}var id=null;function Yc(et,_e,tt,rt){if(id=null,et=xb(rt),et=Wc(et),et!==null)if(_e=Vb(et),_e===null)et=null;else if(tt=_e.tag,tt===13){if(et=Wb(_e),et!==null)return et;et=null}else if(tt===3){if(_e.stateNode.current.memoizedState.isDehydrated)return _e.tag===3?_e.stateNode.containerInfo:null;et=null}else _e!==et&&(et=null);return id=et,null}function jd(et){switch(et){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var et,_e=ld,tt=_e.length,rt,nt="value"in kd?kd.value:kd.textContent,it=nt.length;for(et=0;et<tt&&_e[et]===nt[et];et++);var st=tt-et;for(rt=1;rt<=st&&_e[tt-rt]===nt[it-rt];rt++);return md=nt.slice(et,1<rt?1-rt:void 0)}function od(et){var _e=et.keyCode;return"charCode"in et?(et=et.charCode,et===0&&_e===13&&(et=13)):et=_e,et===10&&(et=13),32<=et||et===13?et:0}function pd(){return!0}function qd(){return!1}function rd(et){function _e(tt,rt,nt,it,st){this._reactName=tt,this._targetInst=nt,this.type=rt,this.nativeEvent=it,this.target=st,this.currentTarget=null;for(var ot in et)et.hasOwnProperty(ot)&&(tt=et[ot],this[ot]=tt?tt(it):it[ot]);return this.isDefaultPrevented=(it.defaultPrevented!=null?it.defaultPrevented:it.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(_e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var tt=this.nativeEvent;tt&&(tt.preventDefault?tt.preventDefault():typeof tt.returnValue!="unknown"&&(tt.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var tt=this.nativeEvent;tt&&(tt.stopPropagation?tt.stopPropagation():typeof tt.cancelBubble!="unknown"&&(tt.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),_e}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(et){return et.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(et){return et.relatedTarget===void 0?et.fromElement===et.srcElement?et.toElement:et.fromElement:et.relatedTarget},movementX:function(et){return"movementX"in et?et.movementX:(et!==yd&&(yd&&et.type==="mousemove"?(wd=et.screenX-yd.screenX,xd=et.screenY-yd.screenY):xd=wd=0,yd=et),wd)},movementY:function(et){return"movementY"in et?et.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(et){return"clipboardData"in et?et.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(et){var _e=this.nativeEvent;return _e.getModifierState?_e.getModifierState(et):(et=Od[et])?!!_e[et]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(et){if(et.key){var _e=Md[et.key]||et.key;if(_e!=="Unidentified")return _e}return et.type==="keypress"?(et=od(et),et===13?"Enter":String.fromCharCode(et)):et.type==="keydown"||et.type==="keyup"?Nd[et.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(et){return et.type==="keypress"?od(et):0},keyCode:function(et){return et.type==="keydown"||et.type==="keyup"?et.keyCode:0},which:function(et){return et.type==="keypress"?od(et):et.type==="keydown"||et.type==="keyup"?et.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(et){return"deltaX"in et?et.deltaX:"wheelDeltaX"in et?-et.wheelDeltaX:0},deltaY:function(et){return"deltaY"in et?et.deltaY:"wheelDeltaY"in et?-et.wheelDeltaY:"wheelDelta"in et?-et.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(et,_e){switch(et){case"keyup":return $d.indexOf(_e.keyCode)!==-1;case"keydown":return _e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(et){return et=et.detail,typeof et=="object"&&"data"in et?et.data:null}var ie=!1;function je(et,_e){switch(et){case"compositionend":return he(_e);case"keypress":return _e.which!==32?null:(fe=!0,ee);case"textInput":return et=_e.data,et===ee&&fe?null:et;default:return null}}function ke(et,_e){if(ie)return et==="compositionend"||!ae&&ge(et,_e)?(et=nd(),md=ld=kd=null,ie=!1,et):null;switch(et){case"paste":return null;case"keypress":if(!(_e.ctrlKey||_e.altKey||_e.metaKey)||_e.ctrlKey&&_e.altKey){if(_e.char&&1<_e.char.length)return _e.char;if(_e.which)return String.fromCharCode(_e.which)}return null;case"compositionend":return de&&_e.locale!=="ko"?null:_e.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(et){var _e=et&&et.nodeName&&et.nodeName.toLowerCase();return _e==="input"?!!le[et.type]:_e==="textarea"}function ne(et,_e,tt,rt){Eb(rt),_e=oe(_e,"onChange"),0<_e.length&&(tt=new td("onChange","change",null,tt,rt),et.push({event:tt,listeners:_e}))}var pe=null,qe=null;function re(et){se(et,0)}function te(et){var _e=ue(et);if(Wa(_e))return et}function ve(et,_e){if(et==="change")return _e}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(et){if(et.propertyName==="value"&&te(qe)){var _e=[];ne(_e,qe,et,xb(et)),Jb(re,_e)}}function Ce(et,_e,tt){et==="focusin"?(Ae(),pe=_e,qe=tt,pe.attachEvent("onpropertychange",Be)):et==="focusout"&&Ae()}function De(et){if(et==="selectionchange"||et==="keyup"||et==="keydown")return te(qe)}function Ee(et,_e){if(et==="click")return te(_e)}function Fe(et,_e){if(et==="input"||et==="change")return te(_e)}function Ge(et,_e){return et===_e&&(et!==0||1/et===1/_e)||et!==et&&_e!==_e}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(et,_e){if(He(et,_e))return!0;if(typeof et!="object"||et===null||typeof _e!="object"||_e===null)return!1;var tt=Object.keys(et),rt=Object.keys(_e);if(tt.length!==rt.length)return!1;for(rt=0;rt<tt.length;rt++){var nt=tt[rt];if(!ja.call(_e,nt)||!He(et[nt],_e[nt]))return!1}return!0}function Je(et){for(;et&&et.firstChild;)et=et.firstChild;return et}function Ke(et,_e){var tt=Je(et);et=0;for(var rt;tt;){if(tt.nodeType===3){if(rt=et+tt.textContent.length,et<=_e&&rt>=_e)return{node:tt,offset:_e-et};et=rt}e:{for(;tt;){if(tt.nextSibling){tt=tt.nextSibling;break e}tt=tt.parentNode}tt=void 0}tt=Je(tt)}}function Le(et,_e){return et&&_e?et===_e?!0:et&&et.nodeType===3?!1:_e&&_e.nodeType===3?Le(et,_e.parentNode):"contains"in et?et.contains(_e):et.compareDocumentPosition?!!(et.compareDocumentPosition(_e)&16):!1:!1}function Me(){for(var et=window,_e=Xa();_e instanceof et.HTMLIFrameElement;){try{var tt=typeof _e.contentWindow.location.href=="string"}catch{tt=!1}if(tt)et=_e.contentWindow;else break;_e=Xa(et.document)}return _e}function Ne(et){var _e=et&&et.nodeName&&et.nodeName.toLowerCase();return _e&&(_e==="input"&&(et.type==="text"||et.type==="search"||et.type==="tel"||et.type==="url"||et.type==="password")||_e==="textarea"||et.contentEditable==="true")}function Oe(et){var _e=Me(),tt=et.focusedElem,rt=et.selectionRange;if(_e!==tt&&tt&&tt.ownerDocument&&Le(tt.ownerDocument.documentElement,tt)){if(rt!==null&&Ne(tt)){if(_e=rt.start,et=rt.end,et===void 0&&(et=_e),"selectionStart"in tt)tt.selectionStart=_e,tt.selectionEnd=Math.min(et,tt.value.length);else if(et=(_e=tt.ownerDocument||document)&&_e.defaultView||window,et.getSelection){et=et.getSelection();var nt=tt.textContent.length,it=Math.min(rt.start,nt);rt=rt.end===void 0?it:Math.min(rt.end,nt),!et.extend&&it>rt&&(nt=rt,rt=it,it=nt),nt=Ke(tt,it);var st=Ke(tt,rt);nt&&st&&(et.rangeCount!==1||et.anchorNode!==nt.node||et.anchorOffset!==nt.offset||et.focusNode!==st.node||et.focusOffset!==st.offset)&&(_e=_e.createRange(),_e.setStart(nt.node,nt.offset),et.removeAllRanges(),it>rt?(et.addRange(_e),et.extend(st.node,st.offset)):(_e.setEnd(st.node,st.offset),et.addRange(_e)))}}for(_e=[],et=tt;et=et.parentNode;)et.nodeType===1&&_e.push({element:et,left:et.scrollLeft,top:et.scrollTop});for(typeof tt.focus=="function"&&tt.focus(),tt=0;tt<_e.length;tt++)et=_e[tt],et.element.scrollLeft=et.left,et.element.scrollTop=et.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(et,_e,tt){var rt=tt.window===tt?tt.document:tt.nodeType===9?tt:tt.ownerDocument;Te||Qe==null||Qe!==Xa(rt)||(rt=Qe,"selectionStart"in rt&&Ne(rt)?rt={start:rt.selectionStart,end:rt.selectionEnd}:(rt=(rt.ownerDocument&&rt.ownerDocument.defaultView||window).getSelection(),rt={anchorNode:rt.anchorNode,anchorOffset:rt.anchorOffset,focusNode:rt.focusNode,focusOffset:rt.focusOffset}),Se&&Ie(Se,rt)||(Se=rt,rt=oe(Re,"onSelect"),0<rt.length&&(_e=new td("onSelect","select",null,_e,tt),et.push({event:_e,listeners:rt}),_e.target=Qe)))}function Ve(et,_e){var tt={};return tt[et.toLowerCase()]=_e.toLowerCase(),tt["Webkit"+et]="webkit"+_e,tt["Moz"+et]="moz"+_e,tt}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(et){if(Xe[et])return Xe[et];if(!We[et])return et;var _e=We[et],tt;for(tt in _e)if(_e.hasOwnProperty(tt)&&tt in Ye)return Xe[et]=_e[tt];return et}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(et,_e){df.set(et,_e),fa(_e,[et])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd"),ff(af,"onAnimationIteration"),ff(bf,"onAnimationStart"),ff("dblclick","onDoubleClick"),ff("focusin","onFocus"),ff("focusout","onBlur"),ff(cf,"onTransitionEnd"),ha("onMouseEnter",["mouseout","mouseover"]),ha("onMouseLeave",["mouseout","mouseover"]),ha("onPointerEnter",["pointerout","pointerover"]),ha("onPointerLeave",["pointerout","pointerover"]),fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fa("onBeforeInput",["compositionend","keypress","textInput","paste"]),fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(et,_e,tt){var rt=et.type||"unknown-event";et.currentTarget=tt,Ub(rt,_e,void 0,et),et.currentTarget=null}function se(et,_e){_e=(_e&4)!==0;for(var tt=0;tt<et.length;tt++){var rt=et[tt],nt=rt.event;rt=rt.listeners;e:{var it=void 0;if(_e)for(var st=rt.length-1;0<=st;st--){var ot=rt[st],at=ot.instance,lt=ot.currentTarget;if(ot=ot.listener,at!==it&&nt.isPropagationStopped())break e;nf(nt,ot,lt),it=at}else for(st=0;st<rt.length;st++){if(ot=rt[st],at=ot.instance,lt=ot.currentTarget,ot=ot.listener,at!==it&&nt.isPropagationStopped())break e;nf(nt,ot,lt),it=at}}}if(Qb)throw et=Rb,Qb=!1,Rb=null,et}function D$1(et,_e){var tt=_e[of];tt===void 0&&(tt=_e[of]=new Set);var rt=et+"__bubble";tt.has(rt)||(pf(_e,et,2,!1),tt.add(rt))}function qf(et,_e,tt){var rt=0;_e&&(rt|=4),pf(tt,et,rt,_e)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(et){if(!et[rf]){et[rf]=!0,da.forEach(function(tt){tt!=="selectionchange"&&(mf.has(tt)||qf(tt,!1,et),qf(tt,!0,et))});var _e=et.nodeType===9?et:et.ownerDocument;_e===null||_e[rf]||(_e[rf]=!0,qf("selectionchange",!1,_e))}}function pf(et,_e,tt,rt){switch(jd(_e)){case 1:var nt=ed;break;case 4:nt=gd;break;default:nt=fd}tt=nt.bind(null,_e,tt,et),nt=void 0,!Lb||_e!=="touchstart"&&_e!=="touchmove"&&_e!=="wheel"||(nt=!0),rt?nt!==void 0?et.addEventListener(_e,tt,{capture:!0,passive:nt}):et.addEventListener(_e,tt,!0):nt!==void 0?et.addEventListener(_e,tt,{passive:nt}):et.addEventListener(_e,tt,!1)}function hd(et,_e,tt,rt,nt){var it=rt;if(!(_e&1)&&!(_e&2)&&rt!==null)e:for(;;){if(rt===null)return;var st=rt.tag;if(st===3||st===4){var ot=rt.stateNode.containerInfo;if(ot===nt||ot.nodeType===8&&ot.parentNode===nt)break;if(st===4)for(st=rt.return;st!==null;){var at=st.tag;if((at===3||at===4)&&(at=st.stateNode.containerInfo,at===nt||at.nodeType===8&&at.parentNode===nt))return;st=st.return}for(;ot!==null;){if(st=Wc(ot),st===null)return;if(at=st.tag,at===5||at===6){rt=it=st;continue e}ot=ot.parentNode}}rt=rt.return}Jb(function(){var lt=it,ut=xb(tt),ct=[];e:{var dt=df.get(et);if(dt!==void 0){var ft=td,pt=et;switch(et){case"keypress":if(od(tt)===0)break e;case"keydown":case"keyup":ft=Rd;break;case"focusin":pt="focus",ft=Fd;break;case"focusout":pt="blur",ft=Fd;break;case"beforeblur":case"afterblur":ft=Fd;break;case"click":if(tt.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ft=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ft=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ft=Vd;break;case $e:case af:case bf:ft=Hd;break;case cf:ft=Xd;break;case"scroll":ft=vd;break;case"wheel":ft=Zd;break;case"copy":case"cut":case"paste":ft=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ft=Td}var mt=(_e&4)!==0,ht=!mt&&et==="scroll",gt=mt?dt!==null?dt+"Capture":null:dt;mt=[];for(var vt=lt,yt;vt!==null;){yt=vt;var bt=yt.stateNode;if(yt.tag===5&&bt!==null&&(yt=bt,gt!==null&&(bt=Kb(vt,gt),bt!=null&&mt.push(tf(vt,bt,yt)))),ht)break;vt=vt.return}0<mt.length&&(dt=new ft(dt,pt,null,tt,ut),ct.push({event:dt,listeners:mt}))}}if(!(_e&7)){e:{if(dt=et==="mouseover"||et==="pointerover",ft=et==="mouseout"||et==="pointerout",dt&&tt!==wb&&(pt=tt.relatedTarget||tt.fromElement)&&(Wc(pt)||pt[uf]))break e;if((ft||dt)&&(dt=ut.window===ut?ut:(dt=ut.ownerDocument)?dt.defaultView||dt.parentWindow:window,ft?(pt=tt.relatedTarget||tt.toElement,ft=lt,pt=pt?Wc(pt):null,pt!==null&&(ht=Vb(pt),pt!==ht||pt.tag!==5&&pt.tag!==6)&&(pt=null)):(ft=null,pt=lt),ft!==pt)){if(mt=Bd,bt="onMouseLeave",gt="onMouseEnter",vt="mouse",(et==="pointerout"||et==="pointerover")&&(mt=Td,bt="onPointerLeave",gt="onPointerEnter",vt="pointer"),ht=ft==null?dt:ue(ft),yt=pt==null?dt:ue(pt),dt=new mt(bt,vt+"leave",ft,tt,ut),dt.target=ht,dt.relatedTarget=yt,bt=null,Wc(ut)===lt&&(mt=new mt(gt,vt+"enter",pt,tt,ut),mt.target=yt,mt.relatedTarget=ht,bt=mt),ht=bt,ft&&pt)t:{for(mt=ft,gt=pt,vt=0,yt=mt;yt;yt=vf(yt))vt++;for(yt=0,bt=gt;bt;bt=vf(bt))yt++;for(;0<vt-yt;)mt=vf(mt),vt--;for(;0<yt-vt;)gt=vf(gt),yt--;for(;vt--;){if(mt===gt||gt!==null&&mt===gt.alternate)break t;mt=vf(mt),gt=vf(gt)}mt=null}else mt=null;ft!==null&&wf(ct,dt,ft,mt,!1),pt!==null&&ht!==null&&wf(ct,ht,pt,mt,!0)}}e:{if(dt=lt?ue(lt):window,ft=dt.nodeName&&dt.nodeName.toLowerCase(),ft==="select"||ft==="input"&&dt.type==="file")var xt=ve;else if(me(dt))if(we)xt=Fe;else{xt=De;var _t=Ce}else(ft=dt.nodeName)&&ft.toLowerCase()==="input"&&(dt.type==="checkbox"||dt.type==="radio")&&(xt=Ee);if(xt&&(xt=xt(et,lt))){ne(ct,xt,tt,ut);break e}_t&&_t(et,dt,lt),et==="focusout"&&(_t=dt._wrapperState)&&_t.controlled&&dt.type==="number"&&cb(dt,"number",dt.value)}switch(_t=lt?ue(lt):window,et){case"focusin":(me(_t)||_t.contentEditable==="true")&&(Qe=_t,Re=lt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(ct,tt,ut);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(ct,tt,ut)}var wt;if(ae)e:{switch(et){case"compositionstart":var Ct="onCompositionStart";break e;case"compositionend":Ct="onCompositionEnd";break e;case"compositionupdate":Ct="onCompositionUpdate";break e}Ct=void 0}else ie?ge(et,tt)&&(Ct="onCompositionEnd"):et==="keydown"&&tt.keyCode===229&&(Ct="onCompositionStart");Ct&&(de&&tt.locale!=="ko"&&(ie||Ct!=="onCompositionStart"?Ct==="onCompositionEnd"&&ie&&(wt=nd()):(kd=ut,ld="value"in kd?kd.value:kd.textContent,ie=!0)),_t=oe(lt,Ct),0<_t.length&&(Ct=new Ld(Ct,et,null,tt,ut),ct.push({event:Ct,listeners:_t}),wt?Ct.data=wt:(wt=he(tt),wt!==null&&(Ct.data=wt)))),(wt=ce?je(et,tt):ke(et,tt))&&(lt=oe(lt,"onBeforeInput"),0<lt.length&&(ut=new Ld("onBeforeInput","beforeinput",null,tt,ut),ct.push({event:ut,listeners:lt}),ut.data=wt))}se(ct,_e)})}function tf(et,_e,tt){return{instance:et,listener:_e,currentTarget:tt}}function oe(et,_e){for(var tt=_e+"Capture",rt=[];et!==null;){var nt=et,it=nt.stateNode;nt.tag===5&&it!==null&&(nt=it,it=Kb(et,tt),it!=null&&rt.unshift(tf(et,it,nt)),it=Kb(et,_e),it!=null&&rt.push(tf(et,it,nt))),et=et.return}return rt}function vf(et){if(et===null)return null;do et=et.return;while(et&&et.tag!==5);return et||null}function wf(et,_e,tt,rt,nt){for(var it=_e._reactName,st=[];tt!==null&&tt!==rt;){var ot=tt,at=ot.alternate,lt=ot.stateNode;if(at!==null&&at===rt)break;ot.tag===5&&lt!==null&&(ot=lt,nt?(at=Kb(tt,it),at!=null&&st.unshift(tf(tt,at,ot))):nt||(at=Kb(tt,it),at!=null&&st.push(tf(tt,at,ot)))),tt=tt.return}st.length!==0&&et.push({event:_e,listeners:st})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(et){return(typeof et=="string"?et:""+et).replace(xf,`
`).replace(yf,"")}function Af(et,_e,tt){if(_e=zf(_e),zf(et)!==_e&&tt)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(et,_e){return et==="textarea"||et==="noscript"||typeof _e.children=="string"||typeof _e.children=="number"||typeof _e.dangerouslySetInnerHTML=="object"&&_e.dangerouslySetInnerHTML!==null&&_e.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(et){return Hf.resolve(null).then(et).catch(If)}:Ff;function If(et){setTimeout(function(){throw et})}function Kf(et,_e){var tt=_e,rt=0;do{var nt=tt.nextSibling;if(et.removeChild(tt),nt&&nt.nodeType===8)if(tt=nt.data,tt==="/$"){if(rt===0){et.removeChild(nt),bd(_e);return}rt--}else tt!=="$"&&tt!=="$?"&&tt!=="$!"||rt++;tt=nt}while(tt);bd(_e)}function Lf(et){for(;et!=null;et=et.nextSibling){var _e=et.nodeType;if(_e===1||_e===3)break;if(_e===8){if(_e=et.data,_e==="$"||_e==="$!"||_e==="$?")break;if(_e==="/$")return null}}return et}function Mf(et){et=et.previousSibling;for(var _e=0;et;){if(et.nodeType===8){var tt=et.data;if(tt==="$"||tt==="$!"||tt==="$?"){if(_e===0)return et;_e--}else tt==="/$"&&_e++}et=et.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(et){var _e=et[Of];if(_e)return _e;for(var tt=et.parentNode;tt;){if(_e=tt[uf]||tt[Of]){if(tt=_e.alternate,_e.child!==null||tt!==null&&tt.child!==null)for(et=Mf(et);et!==null;){if(tt=et[Of])return tt;et=Mf(et)}return _e}et=tt,tt=et.parentNode}return null}function Cb(et){return et=et[Of]||et[uf],!et||et.tag!==5&&et.tag!==6&&et.tag!==13&&et.tag!==3?null:et}function ue(et){if(et.tag===5||et.tag===6)return et.stateNode;throw Error(p$1(33))}function Db(et){return et[Pf]||null}var Sf=[],Tf=-1;function Uf(et){return{current:et}}function E$1(et){0>Tf||(et.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(et,_e){Tf++,Sf[Tf]=et.current,et.current=_e}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(et,_e){var tt=et.type.contextTypes;if(!tt)return Vf;var rt=et.stateNode;if(rt&&rt.__reactInternalMemoizedUnmaskedChildContext===_e)return rt.__reactInternalMemoizedMaskedChildContext;var nt={},it;for(it in tt)nt[it]=_e[it];return rt&&(et=et.stateNode,et.__reactInternalMemoizedUnmaskedChildContext=_e,et.__reactInternalMemoizedMaskedChildContext=nt),nt}function Zf(et){return et=et.childContextTypes,et!=null}function $f(){E$1(Wf),E$1(H$1)}function ag(et,_e,tt){if(H$1.current!==Vf)throw Error(p$1(168));G$1(H$1,_e),G$1(Wf,tt)}function bg(et,_e,tt){var rt=et.stateNode;if(_e=_e.childContextTypes,typeof rt.getChildContext!="function")return tt;rt=rt.getChildContext();for(var nt in rt)if(!(nt in _e))throw Error(p$1(108,Ra(et)||"Unknown",nt));return A$1({},tt,rt)}function cg(et){return et=(et=et.stateNode)&&et.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$1(H$1,et),G$1(Wf,Wf.current),!0}function dg(et,_e,tt){var rt=et.stateNode;if(!rt)throw Error(p$1(169));tt?(et=bg(et,_e,Xf),rt.__reactInternalMemoizedMergedChildContext=et,E$1(Wf),E$1(H$1),G$1(H$1,et)):E$1(Wf),G$1(Wf,tt)}var eg=null,fg=!1,gg=!1;function hg(et){eg===null?eg=[et]:eg.push(et)}function ig(et){fg=!0,hg(et)}function jg(){if(!gg&&eg!==null){gg=!0;var et=0,_e=C$1;try{var tt=eg;for(C$1=1;et<tt.length;et++){var rt=tt[et];do rt=rt(!0);while(rt!==null)}eg=null,fg=!1}catch(nt){throw eg!==null&&(eg=eg.slice(et+1)),ac(fc,jg),nt}finally{C$1=_e,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(et,_e){kg[lg++]=ng,kg[lg++]=mg,mg=et,ng=_e}function ug(et,_e,tt){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=et;var rt=rg;et=sg;var nt=32-oc(rt)-1;rt&=~(1<<nt),tt+=1;var it=32-oc(_e)+nt;if(30<it){var st=nt-nt%5;it=(rt&(1<<st)-1).toString(32),rt>>=st,nt-=st,rg=1<<32-oc(_e)+nt|tt<<nt|rt,sg=it+et}else rg=1<<it|tt<<nt|rt,sg=et}function vg(et){et.return!==null&&(tg(et,1),ug(et,1,0))}function wg(et){for(;et===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;et===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(et,_e){var tt=Bg(5,null,null,0);tt.elementType="DELETED",tt.stateNode=_e,tt.return=et,_e=et.deletions,_e===null?(et.deletions=[tt],et.flags|=16):_e.push(tt)}function Cg(et,_e){switch(et.tag){case 5:var tt=et.type;return _e=_e.nodeType!==1||tt.toLowerCase()!==_e.nodeName.toLowerCase()?null:_e,_e!==null?(et.stateNode=_e,xg=et,yg=Lf(_e.firstChild),!0):!1;case 6:return _e=et.pendingProps===""||_e.nodeType!==3?null:_e,_e!==null?(et.stateNode=_e,xg=et,yg=null,!0):!1;case 13:return _e=_e.nodeType!==8?null:_e,_e!==null?(tt=qg!==null?{id:rg,overflow:sg}:null,et.memoizedState={dehydrated:_e,treeContext:tt,retryLane:1073741824},tt=Bg(18,null,null,0),tt.stateNode=_e,tt.return=et,et.child=tt,xg=et,yg=null,!0):!1;default:return!1}}function Dg(et){return(et.mode&1)!==0&&(et.flags&128)===0}function Eg(et){if(I$1){var _e=yg;if(_e){var tt=_e;if(!Cg(et,_e)){if(Dg(et))throw Error(p$1(418));_e=Lf(tt.nextSibling);var rt=xg;_e&&Cg(et,_e)?Ag(rt,tt):(et.flags=et.flags&-4097|2,I$1=!1,xg=et)}}else{if(Dg(et))throw Error(p$1(418));et.flags=et.flags&-4097|2,I$1=!1,xg=et}}}function Fg(et){for(et=et.return;et!==null&&et.tag!==5&&et.tag!==3&&et.tag!==13;)et=et.return;xg=et}function Gg(et){if(et!==xg)return!1;if(!I$1)return Fg(et),I$1=!0,!1;var _e;if((_e=et.tag!==3)&&!(_e=et.tag!==5)&&(_e=et.type,_e=_e!=="head"&&_e!=="body"&&!Ef(et.type,et.memoizedProps)),_e&&(_e=yg)){if(Dg(et))throw Hg(),Error(p$1(418));for(;_e;)Ag(et,_e),_e=Lf(_e.nextSibling)}if(Fg(et),et.tag===13){if(et=et.memoizedState,et=et!==null?et.dehydrated:null,!et)throw Error(p$1(317));e:{for(et=et.nextSibling,_e=0;et;){if(et.nodeType===8){var tt=et.data;if(tt==="/$"){if(_e===0){yg=Lf(et.nextSibling);break e}_e--}else tt!=="$"&&tt!=="$!"&&tt!=="$?"||_e++}et=et.nextSibling}yg=null}}else yg=xg?Lf(et.stateNode.nextSibling):null;return!0}function Hg(){for(var et=yg;et;)et=Lf(et.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(et){zg===null?zg=[et]:zg.push(et)}var Kg=ua.ReactCurrentBatchConfig;function Lg(et,_e){if(et&&et.defaultProps){_e=A$1({},_e),et=et.defaultProps;for(var tt in et)_e[tt]===void 0&&(_e[tt]=et[tt]);return _e}return _e}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(et){var _e=Mg.current;E$1(Mg),et._currentValue=_e}function Sg(et,_e,tt){for(;et!==null;){var rt=et.alternate;if((et.childLanes&_e)!==_e?(et.childLanes|=_e,rt!==null&&(rt.childLanes|=_e)):rt!==null&&(rt.childLanes&_e)!==_e&&(rt.childLanes|=_e),et===tt)break;et=et.return}}function Tg(et,_e){Ng=et,Pg=Og=null,et=et.dependencies,et!==null&&et.firstContext!==null&&(et.lanes&_e&&(Ug=!0),et.firstContext=null)}function Vg(et){var _e=et._currentValue;if(Pg!==et)if(et={context:et,memoizedValue:_e,next:null},Og===null){if(Ng===null)throw Error(p$1(308));Og=et,Ng.dependencies={lanes:0,firstContext:et}}else Og=Og.next=et;return _e}var Wg=null;function Xg(et){Wg===null?Wg=[et]:Wg.push(et)}function Yg(et,_e,tt,rt){var nt=_e.interleaved;return nt===null?(tt.next=tt,Xg(_e)):(tt.next=nt.next,nt.next=tt),_e.interleaved=tt,Zg(et,rt)}function Zg(et,_e){et.lanes|=_e;var tt=et.alternate;for(tt!==null&&(tt.lanes|=_e),tt=et,et=et.return;et!==null;)et.childLanes|=_e,tt=et.alternate,tt!==null&&(tt.childLanes|=_e),tt=et,et=et.return;return tt.tag===3?tt.stateNode:null}var $g=!1;function ah(et){et.updateQueue={baseState:et.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(et,_e){et=et.updateQueue,_e.updateQueue===et&&(_e.updateQueue={baseState:et.baseState,firstBaseUpdate:et.firstBaseUpdate,lastBaseUpdate:et.lastBaseUpdate,shared:et.shared,effects:et.effects})}function ch(et,_e){return{eventTime:et,lane:_e,tag:0,payload:null,callback:null,next:null}}function dh(et,_e,tt){var rt=et.updateQueue;if(rt===null)return null;if(rt=rt.shared,K$1&2){var nt=rt.pending;return nt===null?_e.next=_e:(_e.next=nt.next,nt.next=_e),rt.pending=_e,Zg(et,tt)}return nt=rt.interleaved,nt===null?(_e.next=_e,Xg(rt)):(_e.next=nt.next,nt.next=_e),rt.interleaved=_e,Zg(et,tt)}function eh(et,_e,tt){if(_e=_e.updateQueue,_e!==null&&(_e=_e.shared,(tt&4194240)!==0)){var rt=_e.lanes;rt&=et.pendingLanes,tt|=rt,_e.lanes=tt,Cc(et,tt)}}function fh(et,_e){var tt=et.updateQueue,rt=et.alternate;if(rt!==null&&(rt=rt.updateQueue,tt===rt)){var nt=null,it=null;if(tt=tt.firstBaseUpdate,tt!==null){do{var st={eventTime:tt.eventTime,lane:tt.lane,tag:tt.tag,payload:tt.payload,callback:tt.callback,next:null};it===null?nt=it=st:it=it.next=st,tt=tt.next}while(tt!==null);it===null?nt=it=_e:it=it.next=_e}else nt=it=_e;tt={baseState:rt.baseState,firstBaseUpdate:nt,lastBaseUpdate:it,shared:rt.shared,effects:rt.effects},et.updateQueue=tt;return}et=tt.lastBaseUpdate,et===null?tt.firstBaseUpdate=_e:et.next=_e,tt.lastBaseUpdate=_e}function gh(et,_e,tt,rt){var nt=et.updateQueue;$g=!1;var it=nt.firstBaseUpdate,st=nt.lastBaseUpdate,ot=nt.shared.pending;if(ot!==null){nt.shared.pending=null;var at=ot,lt=at.next;at.next=null,st===null?it=lt:st.next=lt,st=at;var ut=et.alternate;ut!==null&&(ut=ut.updateQueue,ot=ut.lastBaseUpdate,ot!==st&&(ot===null?ut.firstBaseUpdate=lt:ot.next=lt,ut.lastBaseUpdate=at))}if(it!==null){var ct=nt.baseState;st=0,ut=lt=at=null,ot=it;do{var dt=ot.lane,ft=ot.eventTime;if((rt&dt)===dt){ut!==null&&(ut=ut.next={eventTime:ft,lane:0,tag:ot.tag,payload:ot.payload,callback:ot.callback,next:null});e:{var pt=et,mt=ot;switch(dt=_e,ft=tt,mt.tag){case 1:if(pt=mt.payload,typeof pt=="function"){ct=pt.call(ft,ct,dt);break e}ct=pt;break e;case 3:pt.flags=pt.flags&-65537|128;case 0:if(pt=mt.payload,dt=typeof pt=="function"?pt.call(ft,ct,dt):pt,dt==null)break e;ct=A$1({},ct,dt);break e;case 2:$g=!0}}ot.callback!==null&&ot.lane!==0&&(et.flags|=64,dt=nt.effects,dt===null?nt.effects=[ot]:dt.push(ot))}else ft={eventTime:ft,lane:dt,tag:ot.tag,payload:ot.payload,callback:ot.callback,next:null},ut===null?(lt=ut=ft,at=ct):ut=ut.next=ft,st|=dt;if(ot=ot.next,ot===null){if(ot=nt.shared.pending,ot===null)break;dt=ot,ot=dt.next,dt.next=null,nt.lastBaseUpdate=dt,nt.shared.pending=null}}while(!0);if(ut===null&&(at=ct),nt.baseState=at,nt.firstBaseUpdate=lt,nt.lastBaseUpdate=ut,_e=nt.shared.interleaved,_e!==null){nt=_e;do st|=nt.lane,nt=nt.next;while(nt!==_e)}else it===null&&(nt.shared.lanes=0);hh|=st,et.lanes=st,et.memoizedState=ct}}function ih(et,_e,tt){if(et=_e.effects,_e.effects=null,et!==null)for(_e=0;_e<et.length;_e++){var rt=et[_e],nt=rt.callback;if(nt!==null){if(rt.callback=null,rt=tt,typeof nt!="function")throw Error(p$1(191,nt));nt.call(rt)}}}var jh=new aa.Component().refs;function kh(et,_e,tt,rt){_e=et.memoizedState,tt=tt(rt,_e),tt=tt==null?_e:A$1({},_e,tt),et.memoizedState=tt,et.lanes===0&&(et.updateQueue.baseState=tt)}var nh={isMounted:function(et){return(et=et._reactInternals)?Vb(et)===et:!1},enqueueSetState:function(et,_e,tt){et=et._reactInternals;var rt=L$1(),nt=lh(et),it=ch(rt,nt);it.payload=_e,tt!=null&&(it.callback=tt),_e=dh(et,it,nt),_e!==null&&(mh(_e,et,nt,rt),eh(_e,et,nt))},enqueueReplaceState:function(et,_e,tt){et=et._reactInternals;var rt=L$1(),nt=lh(et),it=ch(rt,nt);it.tag=1,it.payload=_e,tt!=null&&(it.callback=tt),_e=dh(et,it,nt),_e!==null&&(mh(_e,et,nt,rt),eh(_e,et,nt))},enqueueForceUpdate:function(et,_e){et=et._reactInternals;var tt=L$1(),rt=lh(et),nt=ch(tt,rt);nt.tag=2,_e!=null&&(nt.callback=_e),_e=dh(et,nt,rt),_e!==null&&(mh(_e,et,rt,tt),eh(_e,et,rt))}};function oh(et,_e,tt,rt,nt,it,st){return et=et.stateNode,typeof et.shouldComponentUpdate=="function"?et.shouldComponentUpdate(rt,it,st):_e.prototype&&_e.prototype.isPureReactComponent?!Ie(tt,rt)||!Ie(nt,it):!0}function ph(et,_e,tt){var rt=!1,nt=Vf,it=_e.contextType;return typeof it=="object"&&it!==null?it=Vg(it):(nt=Zf(_e)?Xf:H$1.current,rt=_e.contextTypes,it=(rt=rt!=null)?Yf(et,nt):Vf),_e=new _e(tt,it),et.memoizedState=_e.state!==null&&_e.state!==void 0?_e.state:null,_e.updater=nh,et.stateNode=_e,_e._reactInternals=et,rt&&(et=et.stateNode,et.__reactInternalMemoizedUnmaskedChildContext=nt,et.__reactInternalMemoizedMaskedChildContext=it),_e}function qh(et,_e,tt,rt){et=_e.state,typeof _e.componentWillReceiveProps=="function"&&_e.componentWillReceiveProps(tt,rt),typeof _e.UNSAFE_componentWillReceiveProps=="function"&&_e.UNSAFE_componentWillReceiveProps(tt,rt),_e.state!==et&&nh.enqueueReplaceState(_e,_e.state,null)}function rh(et,_e,tt,rt){var nt=et.stateNode;nt.props=tt,nt.state=et.memoizedState,nt.refs=jh,ah(et);var it=_e.contextType;typeof it=="object"&&it!==null?nt.context=Vg(it):(it=Zf(_e)?Xf:H$1.current,nt.context=Yf(et,it)),nt.state=et.memoizedState,it=_e.getDerivedStateFromProps,typeof it=="function"&&(kh(et,_e,it,tt),nt.state=et.memoizedState),typeof _e.getDerivedStateFromProps=="function"||typeof nt.getSnapshotBeforeUpdate=="function"||typeof nt.UNSAFE_componentWillMount!="function"&&typeof nt.componentWillMount!="function"||(_e=nt.state,typeof nt.componentWillMount=="function"&&nt.componentWillMount(),typeof nt.UNSAFE_componentWillMount=="function"&&nt.UNSAFE_componentWillMount(),_e!==nt.state&&nh.enqueueReplaceState(nt,nt.state,null),gh(et,tt,nt,rt),nt.state=et.memoizedState),typeof nt.componentDidMount=="function"&&(et.flags|=4194308)}function sh(et,_e,tt){if(et=tt.ref,et!==null&&typeof et!="function"&&typeof et!="object"){if(tt._owner){if(tt=tt._owner,tt){if(tt.tag!==1)throw Error(p$1(309));var rt=tt.stateNode}if(!rt)throw Error(p$1(147,et));var nt=rt,it=""+et;return _e!==null&&_e.ref!==null&&typeof _e.ref=="function"&&_e.ref._stringRef===it?_e.ref:(_e=function(st){var ot=nt.refs;ot===jh&&(ot=nt.refs={}),st===null?delete ot[it]:ot[it]=st},_e._stringRef=it,_e)}if(typeof et!="string")throw Error(p$1(284));if(!tt._owner)throw Error(p$1(290,et))}return et}function th(et,_e){throw et=Object.prototype.toString.call(_e),Error(p$1(31,et==="[object Object]"?"object with keys {"+Object.keys(_e).join(", ")+"}":et))}function uh(et){var _e=et._init;return _e(et._payload)}function vh(et){function _e(gt,vt){if(et){var yt=gt.deletions;yt===null?(gt.deletions=[vt],gt.flags|=16):yt.push(vt)}}function tt(gt,vt){if(!et)return null;for(;vt!==null;)_e(gt,vt),vt=vt.sibling;return null}function rt(gt,vt){for(gt=new Map;vt!==null;)vt.key!==null?gt.set(vt.key,vt):gt.set(vt.index,vt),vt=vt.sibling;return gt}function nt(gt,vt){return gt=wh(gt,vt),gt.index=0,gt.sibling=null,gt}function it(gt,vt,yt){return gt.index=yt,et?(yt=gt.alternate,yt!==null?(yt=yt.index,yt<vt?(gt.flags|=2,vt):yt):(gt.flags|=2,vt)):(gt.flags|=1048576,vt)}function st(gt){return et&&gt.alternate===null&&(gt.flags|=2),gt}function ot(gt,vt,yt,bt){return vt===null||vt.tag!==6?(vt=xh(yt,gt.mode,bt),vt.return=gt,vt):(vt=nt(vt,yt),vt.return=gt,vt)}function at(gt,vt,yt,bt){var xt=yt.type;return xt===ya?ut(gt,vt,yt.props.children,bt,yt.key):vt!==null&&(vt.elementType===xt||typeof xt=="object"&&xt!==null&&xt.$$typeof===Ha&&uh(xt)===vt.type)?(bt=nt(vt,yt.props),bt.ref=sh(gt,vt,yt),bt.return=gt,bt):(bt=yh(yt.type,yt.key,yt.props,null,gt.mode,bt),bt.ref=sh(gt,vt,yt),bt.return=gt,bt)}function lt(gt,vt,yt,bt){return vt===null||vt.tag!==4||vt.stateNode.containerInfo!==yt.containerInfo||vt.stateNode.implementation!==yt.implementation?(vt=zh(yt,gt.mode,bt),vt.return=gt,vt):(vt=nt(vt,yt.children||[]),vt.return=gt,vt)}function ut(gt,vt,yt,bt,xt){return vt===null||vt.tag!==7?(vt=Ah(yt,gt.mode,bt,xt),vt.return=gt,vt):(vt=nt(vt,yt),vt.return=gt,vt)}function ct(gt,vt,yt){if(typeof vt=="string"&&vt!==""||typeof vt=="number")return vt=xh(""+vt,gt.mode,yt),vt.return=gt,vt;if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case va:return yt=yh(vt.type,vt.key,vt.props,null,gt.mode,yt),yt.ref=sh(gt,null,vt),yt.return=gt,yt;case wa:return vt=zh(vt,gt.mode,yt),vt.return=gt,vt;case Ha:var bt=vt._init;return ct(gt,bt(vt._payload),yt)}if(eb(vt)||Ka(vt))return vt=Ah(vt,gt.mode,yt,null),vt.return=gt,vt;th(gt,vt)}return null}function dt(gt,vt,yt,bt){var xt=vt!==null?vt.key:null;if(typeof yt=="string"&&yt!==""||typeof yt=="number")return xt!==null?null:ot(gt,vt,""+yt,bt);if(typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case va:return yt.key===xt?at(gt,vt,yt,bt):null;case wa:return yt.key===xt?lt(gt,vt,yt,bt):null;case Ha:return xt=yt._init,dt(gt,vt,xt(yt._payload),bt)}if(eb(yt)||Ka(yt))return xt!==null?null:ut(gt,vt,yt,bt,null);th(gt,yt)}return null}function ft(gt,vt,yt,bt,xt){if(typeof bt=="string"&&bt!==""||typeof bt=="number")return gt=gt.get(yt)||null,ot(vt,gt,""+bt,xt);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case va:return gt=gt.get(bt.key===null?yt:bt.key)||null,at(vt,gt,bt,xt);case wa:return gt=gt.get(bt.key===null?yt:bt.key)||null,lt(vt,gt,bt,xt);case Ha:var _t=bt._init;return ft(gt,vt,yt,_t(bt._payload),xt)}if(eb(bt)||Ka(bt))return gt=gt.get(yt)||null,ut(vt,gt,bt,xt,null);th(vt,bt)}return null}function pt(gt,vt,yt,bt){for(var xt=null,_t=null,wt=vt,Ct=vt=0,kt=null;wt!==null&&Ct<yt.length;Ct++){wt.index>Ct?(kt=wt,wt=null):kt=wt.sibling;var At=dt(gt,wt,yt[Ct],bt);if(At===null){wt===null&&(wt=kt);break}et&&wt&&At.alternate===null&&_e(gt,wt),vt=it(At,vt,Ct),_t===null?xt=At:_t.sibling=At,_t=At,wt=kt}if(Ct===yt.length)return tt(gt,wt),I$1&&tg(gt,Ct),xt;if(wt===null){for(;Ct<yt.length;Ct++)wt=ct(gt,yt[Ct],bt),wt!==null&&(vt=it(wt,vt,Ct),_t===null?xt=wt:_t.sibling=wt,_t=wt);return I$1&&tg(gt,Ct),xt}for(wt=rt(gt,wt);Ct<yt.length;Ct++)kt=ft(wt,gt,Ct,yt[Ct],bt),kt!==null&&(et&&kt.alternate!==null&&wt.delete(kt.key===null?Ct:kt.key),vt=it(kt,vt,Ct),_t===null?xt=kt:_t.sibling=kt,_t=kt);return et&&wt.forEach(function($t){return _e(gt,$t)}),I$1&&tg(gt,Ct),xt}function mt(gt,vt,yt,bt){var xt=Ka(yt);if(typeof xt!="function")throw Error(p$1(150));if(yt=xt.call(yt),yt==null)throw Error(p$1(151));for(var _t=xt=null,wt=vt,Ct=vt=0,kt=null,At=yt.next();wt!==null&&!At.done;Ct++,At=yt.next()){wt.index>Ct?(kt=wt,wt=null):kt=wt.sibling;var $t=dt(gt,wt,At.value,bt);if($t===null){wt===null&&(wt=kt);break}et&&wt&&$t.alternate===null&&_e(gt,wt),vt=it($t,vt,Ct),_t===null?xt=$t:_t.sibling=$t,_t=$t,wt=kt}if(At.done)return tt(gt,wt),I$1&&tg(gt,Ct),xt;if(wt===null){for(;!At.done;Ct++,At=yt.next())At=ct(gt,At.value,bt),At!==null&&(vt=it(At,vt,Ct),_t===null?xt=At:_t.sibling=At,_t=At);return I$1&&tg(gt,Ct),xt}for(wt=rt(gt,wt);!At.done;Ct++,At=yt.next())At=ft(wt,gt,Ct,At.value,bt),At!==null&&(et&&At.alternate!==null&&wt.delete(At.key===null?Ct:At.key),vt=it(At,vt,Ct),_t===null?xt=At:_t.sibling=At,_t=At);return et&&wt.forEach(function(Lt){return _e(gt,Lt)}),I$1&&tg(gt,Ct),xt}function ht(gt,vt,yt,bt){if(typeof yt=="object"&&yt!==null&&yt.type===ya&&yt.key===null&&(yt=yt.props.children),typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case va:e:{for(var xt=yt.key,_t=vt;_t!==null;){if(_t.key===xt){if(xt=yt.type,xt===ya){if(_t.tag===7){tt(gt,_t.sibling),vt=nt(_t,yt.props.children),vt.return=gt,gt=vt;break e}}else if(_t.elementType===xt||typeof xt=="object"&&xt!==null&&xt.$$typeof===Ha&&uh(xt)===_t.type){tt(gt,_t.sibling),vt=nt(_t,yt.props),vt.ref=sh(gt,_t,yt),vt.return=gt,gt=vt;break e}tt(gt,_t);break}else _e(gt,_t);_t=_t.sibling}yt.type===ya?(vt=Ah(yt.props.children,gt.mode,bt,yt.key),vt.return=gt,gt=vt):(bt=yh(yt.type,yt.key,yt.props,null,gt.mode,bt),bt.ref=sh(gt,vt,yt),bt.return=gt,gt=bt)}return st(gt);case wa:e:{for(_t=yt.key;vt!==null;){if(vt.key===_t)if(vt.tag===4&&vt.stateNode.containerInfo===yt.containerInfo&&vt.stateNode.implementation===yt.implementation){tt(gt,vt.sibling),vt=nt(vt,yt.children||[]),vt.return=gt,gt=vt;break e}else{tt(gt,vt);break}else _e(gt,vt);vt=vt.sibling}vt=zh(yt,gt.mode,bt),vt.return=gt,gt=vt}return st(gt);case Ha:return _t=yt._init,ht(gt,vt,_t(yt._payload),bt)}if(eb(yt))return pt(gt,vt,yt,bt);if(Ka(yt))return mt(gt,vt,yt,bt);th(gt,yt)}return typeof yt=="string"&&yt!==""||typeof yt=="number"?(yt=""+yt,vt!==null&&vt.tag===6?(tt(gt,vt.sibling),vt=nt(vt,yt),vt.return=gt,gt=vt):(tt(gt,vt),vt=xh(yt,gt.mode,bt),vt.return=gt,gt=vt),st(gt)):tt(gt,vt)}return ht}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(et){if(et===Dh)throw Error(p$1(174));return et}function Ih(et,_e){switch(G$1(Gh,_e),G$1(Fh,et),G$1(Eh,Dh),et=_e.nodeType,et){case 9:case 11:_e=(_e=_e.documentElement)?_e.namespaceURI:lb(null,"");break;default:et=et===8?_e.parentNode:_e,_e=et.namespaceURI||null,et=et.tagName,_e=lb(_e,et)}E$1(Eh),G$1(Eh,_e)}function Jh(){E$1(Eh),E$1(Fh),E$1(Gh)}function Kh(et){Hh(Gh.current);var _e=Hh(Eh.current),tt=lb(_e,et.type);_e!==tt&&(G$1(Fh,et),G$1(Eh,tt))}function Lh(et){Fh.current===et&&(E$1(Eh),E$1(Fh))}var M$1=Uf(0);function Mh(et){for(var _e=et;_e!==null;){if(_e.tag===13){var tt=_e.memoizedState;if(tt!==null&&(tt=tt.dehydrated,tt===null||tt.data==="$?"||tt.data==="$!"))return _e}else if(_e.tag===19&&_e.memoizedProps.revealOrder!==void 0){if(_e.flags&128)return _e}else if(_e.child!==null){_e.child.return=_e,_e=_e.child;continue}if(_e===et)break;for(;_e.sibling===null;){if(_e.return===null||_e.return===et)return null;_e=_e.return}_e.sibling.return=_e.return,_e=_e.sibling}return null}var Nh=[];function Oh(){for(var et=0;et<Nh.length;et++)Nh[et]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N$1=null,O$1=null,P$1=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q$1(){throw Error(p$1(321))}function Wh(et,_e){if(_e===null)return!1;for(var tt=0;tt<_e.length&&tt<et.length;tt++)if(!He(et[tt],_e[tt]))return!1;return!0}function Xh(et,_e,tt,rt,nt,it){if(Rh=it,N$1=_e,_e.memoizedState=null,_e.updateQueue=null,_e.lanes=0,Ph.current=et===null||et.memoizedState===null?Yh:Zh,et=tt(rt,nt),Th){it=0;do{if(Th=!1,Uh=0,25<=it)throw Error(p$1(301));it+=1,P$1=O$1=null,_e.updateQueue=null,Ph.current=$h,et=tt(rt,nt)}while(Th)}if(Ph.current=ai,_e=O$1!==null&&O$1.next!==null,Rh=0,P$1=O$1=N$1=null,Sh=!1,_e)throw Error(p$1(300));return et}function bi(){var et=Uh!==0;return Uh=0,et}function ci(){var et={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P$1===null?N$1.memoizedState=P$1=et:P$1=P$1.next=et,P$1}function di(){if(O$1===null){var et=N$1.alternate;et=et!==null?et.memoizedState:null}else et=O$1.next;var _e=P$1===null?N$1.memoizedState:P$1.next;if(_e!==null)P$1=_e,O$1=et;else{if(et===null)throw Error(p$1(310));O$1=et,et={memoizedState:O$1.memoizedState,baseState:O$1.baseState,baseQueue:O$1.baseQueue,queue:O$1.queue,next:null},P$1===null?N$1.memoizedState=P$1=et:P$1=P$1.next=et}return P$1}function ei(et,_e){return typeof _e=="function"?_e(et):_e}function fi(et){var _e=di(),tt=_e.queue;if(tt===null)throw Error(p$1(311));tt.lastRenderedReducer=et;var rt=O$1,nt=rt.baseQueue,it=tt.pending;if(it!==null){if(nt!==null){var st=nt.next;nt.next=it.next,it.next=st}rt.baseQueue=nt=it,tt.pending=null}if(nt!==null){it=nt.next,rt=rt.baseState;var ot=st=null,at=null,lt=it;do{var ut=lt.lane;if((Rh&ut)===ut)at!==null&&(at=at.next={lane:0,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null}),rt=lt.hasEagerState?lt.eagerState:et(rt,lt.action);else{var ct={lane:ut,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null};at===null?(ot=at=ct,st=rt):at=at.next=ct,N$1.lanes|=ut,hh|=ut}lt=lt.next}while(lt!==null&&lt!==it);at===null?st=rt:at.next=ot,He(rt,_e.memoizedState)||(Ug=!0),_e.memoizedState=rt,_e.baseState=st,_e.baseQueue=at,tt.lastRenderedState=rt}if(et=tt.interleaved,et!==null){nt=et;do it=nt.lane,N$1.lanes|=it,hh|=it,nt=nt.next;while(nt!==et)}else nt===null&&(tt.lanes=0);return[_e.memoizedState,tt.dispatch]}function gi(et){var _e=di(),tt=_e.queue;if(tt===null)throw Error(p$1(311));tt.lastRenderedReducer=et;var rt=tt.dispatch,nt=tt.pending,it=_e.memoizedState;if(nt!==null){tt.pending=null;var st=nt=nt.next;do it=et(it,st.action),st=st.next;while(st!==nt);He(it,_e.memoizedState)||(Ug=!0),_e.memoizedState=it,_e.baseQueue===null&&(_e.baseState=it),tt.lastRenderedState=it}return[it,rt]}function hi(){}function ii(et,_e){var tt=N$1,rt=di(),nt=_e(),it=!He(rt.memoizedState,nt);if(it&&(rt.memoizedState=nt,Ug=!0),rt=rt.queue,ji(ki.bind(null,tt,rt,et),[et]),rt.getSnapshot!==_e||it||P$1!==null&&P$1.memoizedState.tag&1){if(tt.flags|=2048,li(9,mi.bind(null,tt,rt,nt,_e),void 0,null),R$1===null)throw Error(p$1(349));Rh&30||ni(tt,_e,nt)}return nt}function ni(et,_e,tt){et.flags|=16384,et={getSnapshot:_e,value:tt},_e=N$1.updateQueue,_e===null?(_e={lastEffect:null,stores:null},N$1.updateQueue=_e,_e.stores=[et]):(tt=_e.stores,tt===null?_e.stores=[et]:tt.push(et))}function mi(et,_e,tt,rt){_e.value=tt,_e.getSnapshot=rt,oi(_e)&&pi(et)}function ki(et,_e,tt){return tt(function(){oi(_e)&&pi(et)})}function oi(et){var _e=et.getSnapshot;et=et.value;try{var tt=_e();return!He(et,tt)}catch{return!0}}function pi(et){var _e=Zg(et,1);_e!==null&&mh(_e,et,1,-1)}function qi(et){var _e=ci();return typeof et=="function"&&(et=et()),_e.memoizedState=_e.baseState=et,et={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:et},_e.queue=et,et=et.dispatch=ri.bind(null,N$1,et),[_e.memoizedState,et]}function li(et,_e,tt,rt){return et={tag:et,create:_e,destroy:tt,deps:rt,next:null},_e=N$1.updateQueue,_e===null?(_e={lastEffect:null,stores:null},N$1.updateQueue=_e,_e.lastEffect=et.next=et):(tt=_e.lastEffect,tt===null?_e.lastEffect=et.next=et:(rt=tt.next,tt.next=et,et.next=rt,_e.lastEffect=et)),et}function si(){return di().memoizedState}function ti(et,_e,tt,rt){var nt=ci();N$1.flags|=et,nt.memoizedState=li(1|_e,tt,void 0,rt===void 0?null:rt)}function ui(et,_e,tt,rt){var nt=di();rt=rt===void 0?null:rt;var it=void 0;if(O$1!==null){var st=O$1.memoizedState;if(it=st.destroy,rt!==null&&Wh(rt,st.deps)){nt.memoizedState=li(_e,tt,it,rt);return}}N$1.flags|=et,nt.memoizedState=li(1|_e,tt,it,rt)}function vi(et,_e){return ti(8390656,8,et,_e)}function ji(et,_e){return ui(2048,8,et,_e)}function wi(et,_e){return ui(4,2,et,_e)}function xi(et,_e){return ui(4,4,et,_e)}function yi(et,_e){if(typeof _e=="function")return et=et(),_e(et),function(){_e(null)};if(_e!=null)return et=et(),_e.current=et,function(){_e.current=null}}function zi(et,_e,tt){return tt=tt!=null?tt.concat([et]):null,ui(4,4,yi.bind(null,_e,et),tt)}function Ai(){}function Bi(et,_e){var tt=di();_e=_e===void 0?null:_e;var rt=tt.memoizedState;return rt!==null&&_e!==null&&Wh(_e,rt[1])?rt[0]:(tt.memoizedState=[et,_e],et)}function Ci(et,_e){var tt=di();_e=_e===void 0?null:_e;var rt=tt.memoizedState;return rt!==null&&_e!==null&&Wh(_e,rt[1])?rt[0]:(et=et(),tt.memoizedState=[et,_e],et)}function Di(et,_e,tt){return Rh&21?(He(tt,_e)||(tt=yc(),N$1.lanes|=tt,hh|=tt,et.baseState=!0),_e):(et.baseState&&(et.baseState=!1,Ug=!0),et.memoizedState=tt)}function Ei(et,_e){var tt=C$1;C$1=tt!==0&&4>tt?tt:4,et(!0);var rt=Qh.transition;Qh.transition={};try{et(!1),_e()}finally{C$1=tt,Qh.transition=rt}}function Fi(){return di().memoizedState}function Gi(et,_e,tt){var rt=lh(et);if(tt={lane:rt,action:tt,hasEagerState:!1,eagerState:null,next:null},Hi(et))Ii(_e,tt);else if(tt=Yg(et,_e,tt,rt),tt!==null){var nt=L$1();mh(tt,et,rt,nt),Ji(tt,_e,rt)}}function ri(et,_e,tt){var rt=lh(et),nt={lane:rt,action:tt,hasEagerState:!1,eagerState:null,next:null};if(Hi(et))Ii(_e,nt);else{var it=et.alternate;if(et.lanes===0&&(it===null||it.lanes===0)&&(it=_e.lastRenderedReducer,it!==null))try{var st=_e.lastRenderedState,ot=it(st,tt);if(nt.hasEagerState=!0,nt.eagerState=ot,He(ot,st)){var at=_e.interleaved;at===null?(nt.next=nt,Xg(_e)):(nt.next=at.next,at.next=nt),_e.interleaved=nt;return}}catch{}finally{}tt=Yg(et,_e,nt,rt),tt!==null&&(nt=L$1(),mh(tt,et,rt,nt),Ji(tt,_e,rt))}}function Hi(et){var _e=et.alternate;return et===N$1||_e!==null&&_e===N$1}function Ii(et,_e){Th=Sh=!0;var tt=et.pending;tt===null?_e.next=_e:(_e.next=tt.next,tt.next=_e),et.pending=_e}function Ji(et,_e,tt){if(tt&4194240){var rt=_e.lanes;rt&=et.pendingLanes,tt|=rt,_e.lanes=tt,Cc(et,tt)}}var ai={readContext:Vg,useCallback:Q$1,useContext:Q$1,useEffect:Q$1,useImperativeHandle:Q$1,useInsertionEffect:Q$1,useLayoutEffect:Q$1,useMemo:Q$1,useReducer:Q$1,useRef:Q$1,useState:Q$1,useDebugValue:Q$1,useDeferredValue:Q$1,useTransition:Q$1,useMutableSource:Q$1,useSyncExternalStore:Q$1,useId:Q$1,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(et,_e){return ci().memoizedState=[et,_e===void 0?null:_e],et},useContext:Vg,useEffect:vi,useImperativeHandle:function(et,_e,tt){return tt=tt!=null?tt.concat([et]):null,ti(4194308,4,yi.bind(null,_e,et),tt)},useLayoutEffect:function(et,_e){return ti(4194308,4,et,_e)},useInsertionEffect:function(et,_e){return ti(4,2,et,_e)},useMemo:function(et,_e){var tt=ci();return _e=_e===void 0?null:_e,et=et(),tt.memoizedState=[et,_e],et},useReducer:function(et,_e,tt){var rt=ci();return _e=tt!==void 0?tt(_e):_e,rt.memoizedState=rt.baseState=_e,et={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:et,lastRenderedState:_e},rt.queue=et,et=et.dispatch=Gi.bind(null,N$1,et),[rt.memoizedState,et]},useRef:function(et){var _e=ci();return et={current:et},_e.memoizedState=et},useState:qi,useDebugValue:Ai,useDeferredValue:function(et){return ci().memoizedState=et},useTransition:function(){var et=qi(!1),_e=et[0];return et=Ei.bind(null,et[1]),ci().memoizedState=et,[_e,et]},useMutableSource:function(){},useSyncExternalStore:function(et,_e,tt){var rt=N$1,nt=ci();if(I$1){if(tt===void 0)throw Error(p$1(407));tt=tt()}else{if(tt=_e(),R$1===null)throw Error(p$1(349));Rh&30||ni(rt,_e,tt)}nt.memoizedState=tt;var it={value:tt,getSnapshot:_e};return nt.queue=it,vi(ki.bind(null,rt,it,et),[et]),rt.flags|=2048,li(9,mi.bind(null,rt,it,tt,_e),void 0,null),tt},useId:function(){var et=ci(),_e=R$1.identifierPrefix;if(I$1){var tt=sg,rt=rg;tt=(rt&~(1<<32-oc(rt)-1)).toString(32)+tt,_e=":"+_e+"R"+tt,tt=Uh++,0<tt&&(_e+="H"+tt.toString(32)),_e+=":"}else tt=Vh++,_e=":"+_e+"r"+tt.toString(32)+":";return et.memoizedState=_e},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(et){var _e=di();return Di(_e,O$1.memoizedState,et)},useTransition:function(){var et=fi(ei)[0],_e=di().memoizedState;return[et,_e]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(et){var _e=di();return O$1===null?_e.memoizedState=et:Di(_e,O$1.memoizedState,et)},useTransition:function(){var et=gi(ei)[0],_e=di().memoizedState;return[et,_e]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(et,_e){try{var tt="",rt=_e;do tt+=Pa(rt),rt=rt.return;while(rt);var nt=tt}catch(it){nt=`
Error generating stack: `+it.message+`
`+it.stack}return{value:et,source:_e,stack:nt,digest:null}}function Li(et,_e,tt){return{value:et,source:null,stack:tt??null,digest:_e??null}}function Mi(et,_e){try{console.error(_e.value)}catch(tt){setTimeout(function(){throw tt})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(et,_e,tt){tt=ch(-1,tt),tt.tag=3,tt.payload={element:null};var rt=_e.value;return tt.callback=function(){Pi||(Pi=!0,Qi=rt),Mi(et,_e)},tt}function Ri(et,_e,tt){tt=ch(-1,tt),tt.tag=3;var rt=et.type.getDerivedStateFromError;if(typeof rt=="function"){var nt=_e.value;tt.payload=function(){return rt(nt)},tt.callback=function(){Mi(et,_e)}}var it=et.stateNode;return it!==null&&typeof it.componentDidCatch=="function"&&(tt.callback=function(){Mi(et,_e),typeof rt!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var st=_e.stack;this.componentDidCatch(_e.value,{componentStack:st!==null?st:""})}),tt}function Ti(et,_e,tt){var rt=et.pingCache;if(rt===null){rt=et.pingCache=new Ni;var nt=new Set;rt.set(_e,nt)}else nt=rt.get(_e),nt===void 0&&(nt=new Set,rt.set(_e,nt));nt.has(tt)||(nt.add(tt),et=Ui.bind(null,et,_e,tt),_e.then(et,et))}function Vi(et){do{var _e;if((_e=et.tag===13)&&(_e=et.memoizedState,_e=_e!==null?_e.dehydrated!==null:!0),_e)return et;et=et.return}while(et!==null);return null}function Wi(et,_e,tt,rt,nt){return et.mode&1?(et.flags|=65536,et.lanes=nt,et):(et===_e?et.flags|=65536:(et.flags|=128,tt.flags|=131072,tt.flags&=-52805,tt.tag===1&&(tt.alternate===null?tt.tag=17:(_e=ch(-1,1),_e.tag=2,dh(tt,_e,1))),tt.lanes|=1),et)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(et,_e,tt,rt){_e.child=et===null?Ch(_e,null,tt,rt):Bh(_e,et.child,tt,rt)}function Zi(et,_e,tt,rt,nt){tt=tt.render;var it=_e.ref;return Tg(_e,nt),rt=Xh(et,_e,tt,rt,it,nt),tt=bi(),et!==null&&!Ug?(_e.updateQueue=et.updateQueue,_e.flags&=-2053,et.lanes&=~nt,$i(et,_e,nt)):(I$1&&tt&&vg(_e),_e.flags|=1,Yi(et,_e,rt,nt),_e.child)}function aj(et,_e,tt,rt,nt){if(et===null){var it=tt.type;return typeof it=="function"&&!bj(it)&&it.defaultProps===void 0&&tt.compare===null&&tt.defaultProps===void 0?(_e.tag=15,_e.type=it,cj(et,_e,it,rt,nt)):(et=yh(tt.type,null,rt,_e,_e.mode,nt),et.ref=_e.ref,et.return=_e,_e.child=et)}if(it=et.child,!(et.lanes&nt)){var st=it.memoizedProps;if(tt=tt.compare,tt=tt!==null?tt:Ie,tt(st,rt)&&et.ref===_e.ref)return $i(et,_e,nt)}return _e.flags|=1,et=wh(it,rt),et.ref=_e.ref,et.return=_e,_e.child=et}function cj(et,_e,tt,rt,nt){if(et!==null){var it=et.memoizedProps;if(Ie(it,rt)&&et.ref===_e.ref)if(Ug=!1,_e.pendingProps=rt=it,(et.lanes&nt)!==0)et.flags&131072&&(Ug=!0);else return _e.lanes=et.lanes,$i(et,_e,nt)}return dj(et,_e,tt,rt,nt)}function ej(et,_e,tt){var rt=_e.pendingProps,nt=rt.children,it=et!==null?et.memoizedState:null;if(rt.mode==="hidden")if(!(_e.mode&1))_e.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(fj,gj),gj|=tt;else{if(!(tt&1073741824))return et=it!==null?it.baseLanes|tt:tt,_e.lanes=_e.childLanes=1073741824,_e.memoizedState={baseLanes:et,cachePool:null,transitions:null},_e.updateQueue=null,G$1(fj,gj),gj|=et,null;_e.memoizedState={baseLanes:0,cachePool:null,transitions:null},rt=it!==null?it.baseLanes:tt,G$1(fj,gj),gj|=rt}else it!==null?(rt=it.baseLanes|tt,_e.memoizedState=null):rt=tt,G$1(fj,gj),gj|=rt;return Yi(et,_e,nt,tt),_e.child}function hj(et,_e){var tt=_e.ref;(et===null&&tt!==null||et!==null&&et.ref!==tt)&&(_e.flags|=512,_e.flags|=2097152)}function dj(et,_e,tt,rt,nt){var it=Zf(tt)?Xf:H$1.current;return it=Yf(_e,it),Tg(_e,nt),tt=Xh(et,_e,tt,rt,it,nt),rt=bi(),et!==null&&!Ug?(_e.updateQueue=et.updateQueue,_e.flags&=-2053,et.lanes&=~nt,$i(et,_e,nt)):(I$1&&rt&&vg(_e),_e.flags|=1,Yi(et,_e,tt,nt),_e.child)}function ij(et,_e,tt,rt,nt){if(Zf(tt)){var it=!0;cg(_e)}else it=!1;if(Tg(_e,nt),_e.stateNode===null)jj(et,_e),ph(_e,tt,rt),rh(_e,tt,rt,nt),rt=!0;else if(et===null){var st=_e.stateNode,ot=_e.memoizedProps;st.props=ot;var at=st.context,lt=tt.contextType;typeof lt=="object"&&lt!==null?lt=Vg(lt):(lt=Zf(tt)?Xf:H$1.current,lt=Yf(_e,lt));var ut=tt.getDerivedStateFromProps,ct=typeof ut=="function"||typeof st.getSnapshotBeforeUpdate=="function";ct||typeof st.UNSAFE_componentWillReceiveProps!="function"&&typeof st.componentWillReceiveProps!="function"||(ot!==rt||at!==lt)&&qh(_e,st,rt,lt),$g=!1;var dt=_e.memoizedState;st.state=dt,gh(_e,rt,st,nt),at=_e.memoizedState,ot!==rt||dt!==at||Wf.current||$g?(typeof ut=="function"&&(kh(_e,tt,ut,rt),at=_e.memoizedState),(ot=$g||oh(_e,tt,ot,rt,dt,at,lt))?(ct||typeof st.UNSAFE_componentWillMount!="function"&&typeof st.componentWillMount!="function"||(typeof st.componentWillMount=="function"&&st.componentWillMount(),typeof st.UNSAFE_componentWillMount=="function"&&st.UNSAFE_componentWillMount()),typeof st.componentDidMount=="function"&&(_e.flags|=4194308)):(typeof st.componentDidMount=="function"&&(_e.flags|=4194308),_e.memoizedProps=rt,_e.memoizedState=at),st.props=rt,st.state=at,st.context=lt,rt=ot):(typeof st.componentDidMount=="function"&&(_e.flags|=4194308),rt=!1)}else{st=_e.stateNode,bh(et,_e),ot=_e.memoizedProps,lt=_e.type===_e.elementType?ot:Lg(_e.type,ot),st.props=lt,ct=_e.pendingProps,dt=st.context,at=tt.contextType,typeof at=="object"&&at!==null?at=Vg(at):(at=Zf(tt)?Xf:H$1.current,at=Yf(_e,at));var ft=tt.getDerivedStateFromProps;(ut=typeof ft=="function"||typeof st.getSnapshotBeforeUpdate=="function")||typeof st.UNSAFE_componentWillReceiveProps!="function"&&typeof st.componentWillReceiveProps!="function"||(ot!==ct||dt!==at)&&qh(_e,st,rt,at),$g=!1,dt=_e.memoizedState,st.state=dt,gh(_e,rt,st,nt);var pt=_e.memoizedState;ot!==ct||dt!==pt||Wf.current||$g?(typeof ft=="function"&&(kh(_e,tt,ft,rt),pt=_e.memoizedState),(lt=$g||oh(_e,tt,lt,rt,dt,pt,at)||!1)?(ut||typeof st.UNSAFE_componentWillUpdate!="function"&&typeof st.componentWillUpdate!="function"||(typeof st.componentWillUpdate=="function"&&st.componentWillUpdate(rt,pt,at),typeof st.UNSAFE_componentWillUpdate=="function"&&st.UNSAFE_componentWillUpdate(rt,pt,at)),typeof st.componentDidUpdate=="function"&&(_e.flags|=4),typeof st.getSnapshotBeforeUpdate=="function"&&(_e.flags|=1024)):(typeof st.componentDidUpdate!="function"||ot===et.memoizedProps&&dt===et.memoizedState||(_e.flags|=4),typeof st.getSnapshotBeforeUpdate!="function"||ot===et.memoizedProps&&dt===et.memoizedState||(_e.flags|=1024),_e.memoizedProps=rt,_e.memoizedState=pt),st.props=rt,st.state=pt,st.context=at,rt=lt):(typeof st.componentDidUpdate!="function"||ot===et.memoizedProps&&dt===et.memoizedState||(_e.flags|=4),typeof st.getSnapshotBeforeUpdate!="function"||ot===et.memoizedProps&&dt===et.memoizedState||(_e.flags|=1024),rt=!1)}return kj(et,_e,tt,rt,it,nt)}function kj(et,_e,tt,rt,nt,it){hj(et,_e);var st=(_e.flags&128)!==0;if(!rt&&!st)return nt&&dg(_e,tt,!1),$i(et,_e,it);rt=_e.stateNode,Xi.current=_e;var ot=st&&typeof tt.getDerivedStateFromError!="function"?null:rt.render();return _e.flags|=1,et!==null&&st?(_e.child=Bh(_e,et.child,null,it),_e.child=Bh(_e,null,ot,it)):Yi(et,_e,ot,it),_e.memoizedState=rt.state,nt&&dg(_e,tt,!0),_e.child}function lj(et){var _e=et.stateNode;_e.pendingContext?ag(et,_e.pendingContext,_e.pendingContext!==_e.context):_e.context&&ag(et,_e.context,!1),Ih(et,_e.containerInfo)}function mj(et,_e,tt,rt,nt){return Ig(),Jg(nt),_e.flags|=256,Yi(et,_e,tt,rt),_e.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(et){return{baseLanes:et,cachePool:null,transitions:null}}function pj(et,_e,tt){var rt=_e.pendingProps,nt=M$1.current,it=!1,st=(_e.flags&128)!==0,ot;if((ot=st)||(ot=et!==null&&et.memoizedState===null?!1:(nt&2)!==0),ot?(it=!0,_e.flags&=-129):(et===null||et.memoizedState!==null)&&(nt|=1),G$1(M$1,nt&1),et===null)return Eg(_e),et=_e.memoizedState,et!==null&&(et=et.dehydrated,et!==null)?(_e.mode&1?et.data==="$!"?_e.lanes=8:_e.lanes=1073741824:_e.lanes=1,null):(st=rt.children,et=rt.fallback,it?(rt=_e.mode,it=_e.child,st={mode:"hidden",children:st},!(rt&1)&&it!==null?(it.childLanes=0,it.pendingProps=st):it=qj(st,rt,0,null),et=Ah(et,rt,tt,null),it.return=_e,et.return=_e,it.sibling=et,_e.child=it,_e.child.memoizedState=oj(tt),_e.memoizedState=nj,et):rj(_e,st));if(nt=et.memoizedState,nt!==null&&(ot=nt.dehydrated,ot!==null))return sj(et,_e,st,rt,ot,nt,tt);if(it){it=rt.fallback,st=_e.mode,nt=et.child,ot=nt.sibling;var at={mode:"hidden",children:rt.children};return!(st&1)&&_e.child!==nt?(rt=_e.child,rt.childLanes=0,rt.pendingProps=at,_e.deletions=null):(rt=wh(nt,at),rt.subtreeFlags=nt.subtreeFlags&14680064),ot!==null?it=wh(ot,it):(it=Ah(it,st,tt,null),it.flags|=2),it.return=_e,rt.return=_e,rt.sibling=it,_e.child=rt,rt=it,it=_e.child,st=et.child.memoizedState,st=st===null?oj(tt):{baseLanes:st.baseLanes|tt,cachePool:null,transitions:st.transitions},it.memoizedState=st,it.childLanes=et.childLanes&~tt,_e.memoizedState=nj,rt}return it=et.child,et=it.sibling,rt=wh(it,{mode:"visible",children:rt.children}),!(_e.mode&1)&&(rt.lanes=tt),rt.return=_e,rt.sibling=null,et!==null&&(tt=_e.deletions,tt===null?(_e.deletions=[et],_e.flags|=16):tt.push(et)),_e.child=rt,_e.memoizedState=null,rt}function rj(et,_e){return _e=qj({mode:"visible",children:_e},et.mode,0,null),_e.return=et,et.child=_e}function tj(et,_e,tt,rt){return rt!==null&&Jg(rt),Bh(_e,et.child,null,tt),et=rj(_e,_e.pendingProps.children),et.flags|=2,_e.memoizedState=null,et}function sj(et,_e,tt,rt,nt,it,st){if(tt)return _e.flags&256?(_e.flags&=-257,rt=Li(Error(p$1(422))),tj(et,_e,st,rt)):_e.memoizedState!==null?(_e.child=et.child,_e.flags|=128,null):(it=rt.fallback,nt=_e.mode,rt=qj({mode:"visible",children:rt.children},nt,0,null),it=Ah(it,nt,st,null),it.flags|=2,rt.return=_e,it.return=_e,rt.sibling=it,_e.child=rt,_e.mode&1&&Bh(_e,et.child,null,st),_e.child.memoizedState=oj(st),_e.memoizedState=nj,it);if(!(_e.mode&1))return tj(et,_e,st,null);if(nt.data==="$!"){if(rt=nt.nextSibling&&nt.nextSibling.dataset,rt)var ot=rt.dgst;return rt=ot,it=Error(p$1(419)),rt=Li(it,rt,void 0),tj(et,_e,st,rt)}if(ot=(st&et.childLanes)!==0,Ug||ot){if(rt=R$1,rt!==null){switch(st&-st){case 4:nt=2;break;case 16:nt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:nt=32;break;case 536870912:nt=268435456;break;default:nt=0}nt=nt&(rt.suspendedLanes|st)?0:nt,nt!==0&&nt!==it.retryLane&&(it.retryLane=nt,Zg(et,nt),mh(rt,et,nt,-1))}return uj(),rt=Li(Error(p$1(421))),tj(et,_e,st,rt)}return nt.data==="$?"?(_e.flags|=128,_e.child=et.child,_e=vj.bind(null,et),nt._reactRetry=_e,null):(et=it.treeContext,yg=Lf(nt.nextSibling),xg=_e,I$1=!0,zg=null,et!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=et.id,sg=et.overflow,qg=_e),_e=rj(_e,rt.children),_e.flags|=4096,_e)}function wj(et,_e,tt){et.lanes|=_e;var rt=et.alternate;rt!==null&&(rt.lanes|=_e),Sg(et.return,_e,tt)}function xj(et,_e,tt,rt,nt){var it=et.memoizedState;it===null?et.memoizedState={isBackwards:_e,rendering:null,renderingStartTime:0,last:rt,tail:tt,tailMode:nt}:(it.isBackwards=_e,it.rendering=null,it.renderingStartTime=0,it.last=rt,it.tail=tt,it.tailMode=nt)}function yj(et,_e,tt){var rt=_e.pendingProps,nt=rt.revealOrder,it=rt.tail;if(Yi(et,_e,rt.children,tt),rt=M$1.current,rt&2)rt=rt&1|2,_e.flags|=128;else{if(et!==null&&et.flags&128)e:for(et=_e.child;et!==null;){if(et.tag===13)et.memoizedState!==null&&wj(et,tt,_e);else if(et.tag===19)wj(et,tt,_e);else if(et.child!==null){et.child.return=et,et=et.child;continue}if(et===_e)break e;for(;et.sibling===null;){if(et.return===null||et.return===_e)break e;et=et.return}et.sibling.return=et.return,et=et.sibling}rt&=1}if(G$1(M$1,rt),!(_e.mode&1))_e.memoizedState=null;else switch(nt){case"forwards":for(tt=_e.child,nt=null;tt!==null;)et=tt.alternate,et!==null&&Mh(et)===null&&(nt=tt),tt=tt.sibling;tt=nt,tt===null?(nt=_e.child,_e.child=null):(nt=tt.sibling,tt.sibling=null),xj(_e,!1,nt,tt,it);break;case"backwards":for(tt=null,nt=_e.child,_e.child=null;nt!==null;){if(et=nt.alternate,et!==null&&Mh(et)===null){_e.child=nt;break}et=nt.sibling,nt.sibling=tt,tt=nt,nt=et}xj(_e,!0,tt,null,it);break;case"together":xj(_e,!1,null,null,void 0);break;default:_e.memoizedState=null}return _e.child}function jj(et,_e){!(_e.mode&1)&&et!==null&&(et.alternate=null,_e.alternate=null,_e.flags|=2)}function $i(et,_e,tt){if(et!==null&&(_e.dependencies=et.dependencies),hh|=_e.lanes,!(tt&_e.childLanes))return null;if(et!==null&&_e.child!==et.child)throw Error(p$1(153));if(_e.child!==null){for(et=_e.child,tt=wh(et,et.pendingProps),_e.child=tt,tt.return=_e;et.sibling!==null;)et=et.sibling,tt=tt.sibling=wh(et,et.pendingProps),tt.return=_e;tt.sibling=null}return _e.child}function zj(et,_e,tt){switch(_e.tag){case 3:lj(_e),Ig();break;case 5:Kh(_e);break;case 1:Zf(_e.type)&&cg(_e);break;case 4:Ih(_e,_e.stateNode.containerInfo);break;case 10:var rt=_e.type._context,nt=_e.memoizedProps.value;G$1(Mg,rt._currentValue),rt._currentValue=nt;break;case 13:if(rt=_e.memoizedState,rt!==null)return rt.dehydrated!==null?(G$1(M$1,M$1.current&1),_e.flags|=128,null):tt&_e.child.childLanes?pj(et,_e,tt):(G$1(M$1,M$1.current&1),et=$i(et,_e,tt),et!==null?et.sibling:null);G$1(M$1,M$1.current&1);break;case 19:if(rt=(tt&_e.childLanes)!==0,et.flags&128){if(rt)return yj(et,_e,tt);_e.flags|=128}if(nt=_e.memoizedState,nt!==null&&(nt.rendering=null,nt.tail=null,nt.lastEffect=null),G$1(M$1,M$1.current),rt)break;return null;case 22:case 23:return _e.lanes=0,ej(et,_e,tt)}return $i(et,_e,tt)}var Aj,Bj,Cj,Dj;Aj=function(et,_e){for(var tt=_e.child;tt!==null;){if(tt.tag===5||tt.tag===6)et.appendChild(tt.stateNode);else if(tt.tag!==4&&tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===_e)break;for(;tt.sibling===null;){if(tt.return===null||tt.return===_e)return;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}},Bj=function(){},Cj=function(et,_e,tt,rt){var nt=et.memoizedProps;if(nt!==rt){et=_e.stateNode,Hh(Eh.current);var it=null;switch(tt){case"input":nt=Ya(et,nt),rt=Ya(et,rt),it=[];break;case"select":nt=A$1({},nt,{value:void 0}),rt=A$1({},rt,{value:void 0}),it=[];break;case"textarea":nt=gb(et,nt),rt=gb(et,rt),it=[];break;default:typeof nt.onClick!="function"&&typeof rt.onClick=="function"&&(et.onclick=Bf)}ub(tt,rt);var st;tt=null;for(lt in nt)if(!rt.hasOwnProperty(lt)&&nt.hasOwnProperty(lt)&&nt[lt]!=null)if(lt==="style"){var ot=nt[lt];for(st in ot)ot.hasOwnProperty(st)&&(tt||(tt={}),tt[st]="")}else lt!=="dangerouslySetInnerHTML"&&lt!=="children"&&lt!=="suppressContentEditableWarning"&&lt!=="suppressHydrationWarning"&&lt!=="autoFocus"&&(ea.hasOwnProperty(lt)?it||(it=[]):(it=it||[]).push(lt,null));for(lt in rt){var at=rt[lt];if(ot=nt!=null?nt[lt]:void 0,rt.hasOwnProperty(lt)&&at!==ot&&(at!=null||ot!=null))if(lt==="style")if(ot){for(st in ot)!ot.hasOwnProperty(st)||at&&at.hasOwnProperty(st)||(tt||(tt={}),tt[st]="");for(st in at)at.hasOwnProperty(st)&&ot[st]!==at[st]&&(tt||(tt={}),tt[st]=at[st])}else tt||(it||(it=[]),it.push(lt,tt)),tt=at;else lt==="dangerouslySetInnerHTML"?(at=at?at.__html:void 0,ot=ot?ot.__html:void 0,at!=null&&ot!==at&&(it=it||[]).push(lt,at)):lt==="children"?typeof at!="string"&&typeof at!="number"||(it=it||[]).push(lt,""+at):lt!=="suppressContentEditableWarning"&&lt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(lt)?(at!=null&&lt==="onScroll"&&D$1("scroll",et),it||ot===at||(it=[])):(it=it||[]).push(lt,at))}tt&&(it=it||[]).push("style",tt);var lt=it;(_e.updateQueue=lt)&&(_e.flags|=4)}},Dj=function(et,_e,tt,rt){tt!==rt&&(_e.flags|=4)};function Ej(et,_e){if(!I$1)switch(et.tailMode){case"hidden":_e=et.tail;for(var tt=null;_e!==null;)_e.alternate!==null&&(tt=_e),_e=_e.sibling;tt===null?et.tail=null:tt.sibling=null;break;case"collapsed":tt=et.tail;for(var rt=null;tt!==null;)tt.alternate!==null&&(rt=tt),tt=tt.sibling;rt===null?_e||et.tail===null?et.tail=null:et.tail.sibling=null:rt.sibling=null}}function S$1(et){var _e=et.alternate!==null&&et.alternate.child===et.child,tt=0,rt=0;if(_e)for(var nt=et.child;nt!==null;)tt|=nt.lanes|nt.childLanes,rt|=nt.subtreeFlags&14680064,rt|=nt.flags&14680064,nt.return=et,nt=nt.sibling;else for(nt=et.child;nt!==null;)tt|=nt.lanes|nt.childLanes,rt|=nt.subtreeFlags,rt|=nt.flags,nt.return=et,nt=nt.sibling;return et.subtreeFlags|=rt,et.childLanes=tt,_e}function Fj(et,_e,tt){var rt=_e.pendingProps;switch(wg(_e),_e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(_e),null;case 1:return Zf(_e.type)&&$f(),S$1(_e),null;case 3:return rt=_e.stateNode,Jh(),E$1(Wf),E$1(H$1),Oh(),rt.pendingContext&&(rt.context=rt.pendingContext,rt.pendingContext=null),(et===null||et.child===null)&&(Gg(_e)?_e.flags|=4:et===null||et.memoizedState.isDehydrated&&!(_e.flags&256)||(_e.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(et,_e),S$1(_e),null;case 5:Lh(_e);var nt=Hh(Gh.current);if(tt=_e.type,et!==null&&_e.stateNode!=null)Cj(et,_e,tt,rt,nt),et.ref!==_e.ref&&(_e.flags|=512,_e.flags|=2097152);else{if(!rt){if(_e.stateNode===null)throw Error(p$1(166));return S$1(_e),null}if(et=Hh(Eh.current),Gg(_e)){rt=_e.stateNode,tt=_e.type;var it=_e.memoizedProps;switch(rt[Of]=_e,rt[Pf]=it,et=(_e.mode&1)!==0,tt){case"dialog":D$1("cancel",rt),D$1("close",rt);break;case"iframe":case"object":case"embed":D$1("load",rt);break;case"video":case"audio":for(nt=0;nt<lf.length;nt++)D$1(lf[nt],rt);break;case"source":D$1("error",rt);break;case"img":case"image":case"link":D$1("error",rt),D$1("load",rt);break;case"details":D$1("toggle",rt);break;case"input":Za(rt,it),D$1("invalid",rt);break;case"select":rt._wrapperState={wasMultiple:!!it.multiple},D$1("invalid",rt);break;case"textarea":hb(rt,it),D$1("invalid",rt)}ub(tt,it),nt=null;for(var st in it)if(it.hasOwnProperty(st)){var ot=it[st];st==="children"?typeof ot=="string"?rt.textContent!==ot&&(it.suppressHydrationWarning!==!0&&Af(rt.textContent,ot,et),nt=["children",ot]):typeof ot=="number"&&rt.textContent!==""+ot&&(it.suppressHydrationWarning!==!0&&Af(rt.textContent,ot,et),nt=["children",""+ot]):ea.hasOwnProperty(st)&&ot!=null&&st==="onScroll"&&D$1("scroll",rt)}switch(tt){case"input":Va(rt),db(rt,it,!0);break;case"textarea":Va(rt),jb(rt);break;case"select":case"option":break;default:typeof it.onClick=="function"&&(rt.onclick=Bf)}rt=nt,_e.updateQueue=rt,rt!==null&&(_e.flags|=4)}else{st=nt.nodeType===9?nt:nt.ownerDocument,et==="http://www.w3.org/1999/xhtml"&&(et=kb(tt)),et==="http://www.w3.org/1999/xhtml"?tt==="script"?(et=st.createElement("div"),et.innerHTML="<script><\/script>",et=et.removeChild(et.firstChild)):typeof rt.is=="string"?et=st.createElement(tt,{is:rt.is}):(et=st.createElement(tt),tt==="select"&&(st=et,rt.multiple?st.multiple=!0:rt.size&&(st.size=rt.size))):et=st.createElementNS(et,tt),et[Of]=_e,et[Pf]=rt,Aj(et,_e,!1,!1),_e.stateNode=et;e:{switch(st=vb(tt,rt),tt){case"dialog":D$1("cancel",et),D$1("close",et),nt=rt;break;case"iframe":case"object":case"embed":D$1("load",et),nt=rt;break;case"video":case"audio":for(nt=0;nt<lf.length;nt++)D$1(lf[nt],et);nt=rt;break;case"source":D$1("error",et),nt=rt;break;case"img":case"image":case"link":D$1("error",et),D$1("load",et),nt=rt;break;case"details":D$1("toggle",et),nt=rt;break;case"input":Za(et,rt),nt=Ya(et,rt),D$1("invalid",et);break;case"option":nt=rt;break;case"select":et._wrapperState={wasMultiple:!!rt.multiple},nt=A$1({},rt,{value:void 0}),D$1("invalid",et);break;case"textarea":hb(et,rt),nt=gb(et,rt),D$1("invalid",et);break;default:nt=rt}ub(tt,nt),ot=nt;for(it in ot)if(ot.hasOwnProperty(it)){var at=ot[it];it==="style"?sb(et,at):it==="dangerouslySetInnerHTML"?(at=at?at.__html:void 0,at!=null&&nb(et,at)):it==="children"?typeof at=="string"?(tt!=="textarea"||at!=="")&&ob(et,at):typeof at=="number"&&ob(et,""+at):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(ea.hasOwnProperty(it)?at!=null&&it==="onScroll"&&D$1("scroll",et):at!=null&&ta(et,it,at,st))}switch(tt){case"input":Va(et),db(et,rt,!1);break;case"textarea":Va(et),jb(et);break;case"option":rt.value!=null&&et.setAttribute("value",""+Sa(rt.value));break;case"select":et.multiple=!!rt.multiple,it=rt.value,it!=null?fb(et,!!rt.multiple,it,!1):rt.defaultValue!=null&&fb(et,!!rt.multiple,rt.defaultValue,!0);break;default:typeof nt.onClick=="function"&&(et.onclick=Bf)}switch(tt){case"button":case"input":case"select":case"textarea":rt=!!rt.autoFocus;break e;case"img":rt=!0;break e;default:rt=!1}}rt&&(_e.flags|=4)}_e.ref!==null&&(_e.flags|=512,_e.flags|=2097152)}return S$1(_e),null;case 6:if(et&&_e.stateNode!=null)Dj(et,_e,et.memoizedProps,rt);else{if(typeof rt!="string"&&_e.stateNode===null)throw Error(p$1(166));if(tt=Hh(Gh.current),Hh(Eh.current),Gg(_e)){if(rt=_e.stateNode,tt=_e.memoizedProps,rt[Of]=_e,(it=rt.nodeValue!==tt)&&(et=xg,et!==null))switch(et.tag){case 3:Af(rt.nodeValue,tt,(et.mode&1)!==0);break;case 5:et.memoizedProps.suppressHydrationWarning!==!0&&Af(rt.nodeValue,tt,(et.mode&1)!==0)}it&&(_e.flags|=4)}else rt=(tt.nodeType===9?tt:tt.ownerDocument).createTextNode(rt),rt[Of]=_e,_e.stateNode=rt}return S$1(_e),null;case 13:if(E$1(M$1),rt=_e.memoizedState,et===null||et.memoizedState!==null&&et.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&_e.mode&1&&!(_e.flags&128))Hg(),Ig(),_e.flags|=98560,it=!1;else if(it=Gg(_e),rt!==null&&rt.dehydrated!==null){if(et===null){if(!it)throw Error(p$1(318));if(it=_e.memoizedState,it=it!==null?it.dehydrated:null,!it)throw Error(p$1(317));it[Of]=_e}else Ig(),!(_e.flags&128)&&(_e.memoizedState=null),_e.flags|=4;S$1(_e),it=!1}else zg!==null&&(Gj(zg),zg=null),it=!0;if(!it)return _e.flags&65536?_e:null}return _e.flags&128?(_e.lanes=tt,_e):(rt=rt!==null,rt!==(et!==null&&et.memoizedState!==null)&&rt&&(_e.child.flags|=8192,_e.mode&1&&(et===null||M$1.current&1?T$1===0&&(T$1=3):uj())),_e.updateQueue!==null&&(_e.flags|=4),S$1(_e),null);case 4:return Jh(),Bj(et,_e),et===null&&sf(_e.stateNode.containerInfo),S$1(_e),null;case 10:return Rg(_e.type._context),S$1(_e),null;case 17:return Zf(_e.type)&&$f(),S$1(_e),null;case 19:if(E$1(M$1),it=_e.memoizedState,it===null)return S$1(_e),null;if(rt=(_e.flags&128)!==0,st=it.rendering,st===null)if(rt)Ej(it,!1);else{if(T$1!==0||et!==null&&et.flags&128)for(et=_e.child;et!==null;){if(st=Mh(et),st!==null){for(_e.flags|=128,Ej(it,!1),rt=st.updateQueue,rt!==null&&(_e.updateQueue=rt,_e.flags|=4),_e.subtreeFlags=0,rt=tt,tt=_e.child;tt!==null;)it=tt,et=rt,it.flags&=14680066,st=it.alternate,st===null?(it.childLanes=0,it.lanes=et,it.child=null,it.subtreeFlags=0,it.memoizedProps=null,it.memoizedState=null,it.updateQueue=null,it.dependencies=null,it.stateNode=null):(it.childLanes=st.childLanes,it.lanes=st.lanes,it.child=st.child,it.subtreeFlags=0,it.deletions=null,it.memoizedProps=st.memoizedProps,it.memoizedState=st.memoizedState,it.updateQueue=st.updateQueue,it.type=st.type,et=st.dependencies,it.dependencies=et===null?null:{lanes:et.lanes,firstContext:et.firstContext}),tt=tt.sibling;return G$1(M$1,M$1.current&1|2),_e.child}et=et.sibling}it.tail!==null&&B$1()>Hj&&(_e.flags|=128,rt=!0,Ej(it,!1),_e.lanes=4194304)}else{if(!rt)if(et=Mh(st),et!==null){if(_e.flags|=128,rt=!0,tt=et.updateQueue,tt!==null&&(_e.updateQueue=tt,_e.flags|=4),Ej(it,!0),it.tail===null&&it.tailMode==="hidden"&&!st.alternate&&!I$1)return S$1(_e),null}else 2*B$1()-it.renderingStartTime>Hj&&tt!==1073741824&&(_e.flags|=128,rt=!0,Ej(it,!1),_e.lanes=4194304);it.isBackwards?(st.sibling=_e.child,_e.child=st):(tt=it.last,tt!==null?tt.sibling=st:_e.child=st,it.last=st)}return it.tail!==null?(_e=it.tail,it.rendering=_e,it.tail=_e.sibling,it.renderingStartTime=B$1(),_e.sibling=null,tt=M$1.current,G$1(M$1,rt?tt&1|2:tt&1),_e):(S$1(_e),null);case 22:case 23:return Ij(),rt=_e.memoizedState!==null,et!==null&&et.memoizedState!==null!==rt&&(_e.flags|=8192),rt&&_e.mode&1?gj&1073741824&&(S$1(_e),_e.subtreeFlags&6&&(_e.flags|=8192)):S$1(_e),null;case 24:return null;case 25:return null}throw Error(p$1(156,_e.tag))}function Jj(et,_e){switch(wg(_e),_e.tag){case 1:return Zf(_e.type)&&$f(),et=_e.flags,et&65536?(_e.flags=et&-65537|128,_e):null;case 3:return Jh(),E$1(Wf),E$1(H$1),Oh(),et=_e.flags,et&65536&&!(et&128)?(_e.flags=et&-65537|128,_e):null;case 5:return Lh(_e),null;case 13:if(E$1(M$1),et=_e.memoizedState,et!==null&&et.dehydrated!==null){if(_e.alternate===null)throw Error(p$1(340));Ig()}return et=_e.flags,et&65536?(_e.flags=et&-65537|128,_e):null;case 19:return E$1(M$1),null;case 4:return Jh(),null;case 10:return Rg(_e.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U$1=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Mj(et,_e){var tt=et.ref;if(tt!==null)if(typeof tt=="function")try{tt(null)}catch(rt){W$1(et,_e,rt)}else tt.current=null}function Nj(et,_e,tt){try{tt()}catch(rt){W$1(et,_e,rt)}}var Oj=!1;function Pj(et,_e){if(Cf=dd,et=Me(),Ne(et)){if("selectionStart"in et)var tt={start:et.selectionStart,end:et.selectionEnd};else e:{tt=(tt=et.ownerDocument)&&tt.defaultView||window;var rt=tt.getSelection&&tt.getSelection();if(rt&&rt.rangeCount!==0){tt=rt.anchorNode;var nt=rt.anchorOffset,it=rt.focusNode;rt=rt.focusOffset;try{tt.nodeType,it.nodeType}catch{tt=null;break e}var st=0,ot=-1,at=-1,lt=0,ut=0,ct=et,dt=null;t:for(;;){for(var ft;ct!==tt||nt!==0&&ct.nodeType!==3||(ot=st+nt),ct!==it||rt!==0&&ct.nodeType!==3||(at=st+rt),ct.nodeType===3&&(st+=ct.nodeValue.length),(ft=ct.firstChild)!==null;)dt=ct,ct=ft;for(;;){if(ct===et)break t;if(dt===tt&&++lt===nt&&(ot=st),dt===it&&++ut===rt&&(at=st),(ft=ct.nextSibling)!==null)break;ct=dt,dt=ct.parentNode}ct=ft}tt=ot===-1||at===-1?null:{start:ot,end:at}}else tt=null}tt=tt||{start:0,end:0}}else tt=null;for(Df={focusedElem:et,selectionRange:tt},dd=!1,V$1=_e;V$1!==null;)if(_e=V$1,et=_e.child,(_e.subtreeFlags&1028)!==0&&et!==null)et.return=_e,V$1=et;else for(;V$1!==null;){_e=V$1;try{var pt=_e.alternate;if(_e.flags&1024)switch(_e.tag){case 0:case 11:case 15:break;case 1:if(pt!==null){var mt=pt.memoizedProps,ht=pt.memoizedState,gt=_e.stateNode,vt=gt.getSnapshotBeforeUpdate(_e.elementType===_e.type?mt:Lg(_e.type,mt),ht);gt.__reactInternalSnapshotBeforeUpdate=vt}break;case 3:var yt=_e.stateNode.containerInfo;yt.nodeType===1?yt.textContent="":yt.nodeType===9&&yt.documentElement&&yt.removeChild(yt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(bt){W$1(_e,_e.return,bt)}if(et=_e.sibling,et!==null){et.return=_e.return,V$1=et;break}V$1=_e.return}return pt=Oj,Oj=!1,pt}function Qj(et,_e,tt){var rt=_e.updateQueue;if(rt=rt!==null?rt.lastEffect:null,rt!==null){var nt=rt=rt.next;do{if((nt.tag&et)===et){var it=nt.destroy;nt.destroy=void 0,it!==void 0&&Nj(_e,tt,it)}nt=nt.next}while(nt!==rt)}}function Rj(et,_e){if(_e=_e.updateQueue,_e=_e!==null?_e.lastEffect:null,_e!==null){var tt=_e=_e.next;do{if((tt.tag&et)===et){var rt=tt.create;tt.destroy=rt()}tt=tt.next}while(tt!==_e)}}function Sj(et){var _e=et.ref;if(_e!==null){var tt=et.stateNode;switch(et.tag){case 5:et=tt;break;default:et=tt}typeof _e=="function"?_e(et):_e.current=et}}function Tj(et){var _e=et.alternate;_e!==null&&(et.alternate=null,Tj(_e)),et.child=null,et.deletions=null,et.sibling=null,et.tag===5&&(_e=et.stateNode,_e!==null&&(delete _e[Of],delete _e[Pf],delete _e[of],delete _e[Qf],delete _e[Rf])),et.stateNode=null,et.return=null,et.dependencies=null,et.memoizedProps=null,et.memoizedState=null,et.pendingProps=null,et.stateNode=null,et.updateQueue=null}function Uj(et){return et.tag===5||et.tag===3||et.tag===4}function Vj(et){e:for(;;){for(;et.sibling===null;){if(et.return===null||Uj(et.return))return null;et=et.return}for(et.sibling.return=et.return,et=et.sibling;et.tag!==5&&et.tag!==6&&et.tag!==18;){if(et.flags&2||et.child===null||et.tag===4)continue e;et.child.return=et,et=et.child}if(!(et.flags&2))return et.stateNode}}function Wj(et,_e,tt){var rt=et.tag;if(rt===5||rt===6)et=et.stateNode,_e?tt.nodeType===8?tt.parentNode.insertBefore(et,_e):tt.insertBefore(et,_e):(tt.nodeType===8?(_e=tt.parentNode,_e.insertBefore(et,tt)):(_e=tt,_e.appendChild(et)),tt=tt._reactRootContainer,tt!=null||_e.onclick!==null||(_e.onclick=Bf));else if(rt!==4&&(et=et.child,et!==null))for(Wj(et,_e,tt),et=et.sibling;et!==null;)Wj(et,_e,tt),et=et.sibling}function Xj(et,_e,tt){var rt=et.tag;if(rt===5||rt===6)et=et.stateNode,_e?tt.insertBefore(et,_e):tt.appendChild(et);else if(rt!==4&&(et=et.child,et!==null))for(Xj(et,_e,tt),et=et.sibling;et!==null;)Xj(et,_e,tt),et=et.sibling}var X$1=null,Yj=!1;function Zj(et,_e,tt){for(tt=tt.child;tt!==null;)ak(et,_e,tt),tt=tt.sibling}function ak(et,_e,tt){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,tt)}catch{}switch(tt.tag){case 5:U$1||Mj(tt,_e);case 6:var rt=X$1,nt=Yj;X$1=null,Zj(et,_e,tt),X$1=rt,Yj=nt,X$1!==null&&(Yj?(et=X$1,tt=tt.stateNode,et.nodeType===8?et.parentNode.removeChild(tt):et.removeChild(tt)):X$1.removeChild(tt.stateNode));break;case 18:X$1!==null&&(Yj?(et=X$1,tt=tt.stateNode,et.nodeType===8?Kf(et.parentNode,tt):et.nodeType===1&&Kf(et,tt),bd(et)):Kf(X$1,tt.stateNode));break;case 4:rt=X$1,nt=Yj,X$1=tt.stateNode.containerInfo,Yj=!0,Zj(et,_e,tt),X$1=rt,Yj=nt;break;case 0:case 11:case 14:case 15:if(!U$1&&(rt=tt.updateQueue,rt!==null&&(rt=rt.lastEffect,rt!==null))){nt=rt=rt.next;do{var it=nt,st=it.destroy;it=it.tag,st!==void 0&&(it&2||it&4)&&Nj(tt,_e,st),nt=nt.next}while(nt!==rt)}Zj(et,_e,tt);break;case 1:if(!U$1&&(Mj(tt,_e),rt=tt.stateNode,typeof rt.componentWillUnmount=="function"))try{rt.props=tt.memoizedProps,rt.state=tt.memoizedState,rt.componentWillUnmount()}catch(ot){W$1(tt,_e,ot)}Zj(et,_e,tt);break;case 21:Zj(et,_e,tt);break;case 22:tt.mode&1?(U$1=(rt=U$1)||tt.memoizedState!==null,Zj(et,_e,tt),U$1=rt):Zj(et,_e,tt);break;default:Zj(et,_e,tt)}}function bk(et){var _e=et.updateQueue;if(_e!==null){et.updateQueue=null;var tt=et.stateNode;tt===null&&(tt=et.stateNode=new Lj),_e.forEach(function(rt){var nt=ck.bind(null,et,rt);tt.has(rt)||(tt.add(rt),rt.then(nt,nt))})}}function dk(et,_e){var tt=_e.deletions;if(tt!==null)for(var rt=0;rt<tt.length;rt++){var nt=tt[rt];try{var it=et,st=_e,ot=st;e:for(;ot!==null;){switch(ot.tag){case 5:X$1=ot.stateNode,Yj=!1;break e;case 3:X$1=ot.stateNode.containerInfo,Yj=!0;break e;case 4:X$1=ot.stateNode.containerInfo,Yj=!0;break e}ot=ot.return}if(X$1===null)throw Error(p$1(160));ak(it,st,nt),X$1=null,Yj=!1;var at=nt.alternate;at!==null&&(at.return=null),nt.return=null}catch(lt){W$1(nt,_e,lt)}}if(_e.subtreeFlags&12854)for(_e=_e.child;_e!==null;)ek(_e,et),_e=_e.sibling}function ek(et,_e){var tt=et.alternate,rt=et.flags;switch(et.tag){case 0:case 11:case 14:case 15:if(dk(_e,et),fk(et),rt&4){try{Qj(3,et,et.return),Rj(3,et)}catch(mt){W$1(et,et.return,mt)}try{Qj(5,et,et.return)}catch(mt){W$1(et,et.return,mt)}}break;case 1:dk(_e,et),fk(et),rt&512&&tt!==null&&Mj(tt,tt.return);break;case 5:if(dk(_e,et),fk(et),rt&512&&tt!==null&&Mj(tt,tt.return),et.flags&32){var nt=et.stateNode;try{ob(nt,"")}catch(mt){W$1(et,et.return,mt)}}if(rt&4&&(nt=et.stateNode,nt!=null)){var it=et.memoizedProps,st=tt!==null?tt.memoizedProps:it,ot=et.type,at=et.updateQueue;if(et.updateQueue=null,at!==null)try{ot==="input"&&it.type==="radio"&&it.name!=null&&ab(nt,it),vb(ot,st);var lt=vb(ot,it);for(st=0;st<at.length;st+=2){var ut=at[st],ct=at[st+1];ut==="style"?sb(nt,ct):ut==="dangerouslySetInnerHTML"?nb(nt,ct):ut==="children"?ob(nt,ct):ta(nt,ut,ct,lt)}switch(ot){case"input":bb(nt,it);break;case"textarea":ib(nt,it);break;case"select":var dt=nt._wrapperState.wasMultiple;nt._wrapperState.wasMultiple=!!it.multiple;var ft=it.value;ft!=null?fb(nt,!!it.multiple,ft,!1):dt!==!!it.multiple&&(it.defaultValue!=null?fb(nt,!!it.multiple,it.defaultValue,!0):fb(nt,!!it.multiple,it.multiple?[]:"",!1))}nt[Pf]=it}catch(mt){W$1(et,et.return,mt)}}break;case 6:if(dk(_e,et),fk(et),rt&4){if(et.stateNode===null)throw Error(p$1(162));nt=et.stateNode,it=et.memoizedProps;try{nt.nodeValue=it}catch(mt){W$1(et,et.return,mt)}}break;case 3:if(dk(_e,et),fk(et),rt&4&&tt!==null&&tt.memoizedState.isDehydrated)try{bd(_e.containerInfo)}catch(mt){W$1(et,et.return,mt)}break;case 4:dk(_e,et),fk(et);break;case 13:dk(_e,et),fk(et),nt=et.child,nt.flags&8192&&(it=nt.memoizedState!==null,nt.stateNode.isHidden=it,!it||nt.alternate!==null&&nt.alternate.memoizedState!==null||(gk=B$1())),rt&4&&bk(et);break;case 22:if(ut=tt!==null&&tt.memoizedState!==null,et.mode&1?(U$1=(lt=U$1)||ut,dk(_e,et),U$1=lt):dk(_e,et),fk(et),rt&8192){if(lt=et.memoizedState!==null,(et.stateNode.isHidden=lt)&&!ut&&et.mode&1)for(V$1=et,ut=et.child;ut!==null;){for(ct=V$1=ut;V$1!==null;){switch(dt=V$1,ft=dt.child,dt.tag){case 0:case 11:case 14:case 15:Qj(4,dt,dt.return);break;case 1:Mj(dt,dt.return);var pt=dt.stateNode;if(typeof pt.componentWillUnmount=="function"){rt=dt,tt=dt.return;try{_e=rt,pt.props=_e.memoizedProps,pt.state=_e.memoizedState,pt.componentWillUnmount()}catch(mt){W$1(rt,tt,mt)}}break;case 5:Mj(dt,dt.return);break;case 22:if(dt.memoizedState!==null){hk(ct);continue}}ft!==null?(ft.return=dt,V$1=ft):hk(ct)}ut=ut.sibling}e:for(ut=null,ct=et;;){if(ct.tag===5){if(ut===null){ut=ct;try{nt=ct.stateNode,lt?(it=nt.style,typeof it.setProperty=="function"?it.setProperty("display","none","important"):it.display="none"):(ot=ct.stateNode,at=ct.memoizedProps.style,st=at!=null&&at.hasOwnProperty("display")?at.display:null,ot.style.display=rb("display",st))}catch(mt){W$1(et,et.return,mt)}}}else if(ct.tag===6){if(ut===null)try{ct.stateNode.nodeValue=lt?"":ct.memoizedProps}catch(mt){W$1(et,et.return,mt)}}else if((ct.tag!==22&&ct.tag!==23||ct.memoizedState===null||ct===et)&&ct.child!==null){ct.child.return=ct,ct=ct.child;continue}if(ct===et)break e;for(;ct.sibling===null;){if(ct.return===null||ct.return===et)break e;ut===ct&&(ut=null),ct=ct.return}ut===ct&&(ut=null),ct.sibling.return=ct.return,ct=ct.sibling}}break;case 19:dk(_e,et),fk(et),rt&4&&bk(et);break;case 21:break;default:dk(_e,et),fk(et)}}function fk(et){var _e=et.flags;if(_e&2){try{e:{for(var tt=et.return;tt!==null;){if(Uj(tt)){var rt=tt;break e}tt=tt.return}throw Error(p$1(160))}switch(rt.tag){case 5:var nt=rt.stateNode;rt.flags&32&&(ob(nt,""),rt.flags&=-33);var it=Vj(et);Xj(et,it,nt);break;case 3:case 4:var st=rt.stateNode.containerInfo,ot=Vj(et);Wj(et,ot,st);break;default:throw Error(p$1(161))}}catch(at){W$1(et,et.return,at)}et.flags&=-3}_e&4096&&(et.flags&=-4097)}function ik(et,_e,tt){V$1=et,jk(et)}function jk(et,_e,tt){for(var rt=(et.mode&1)!==0;V$1!==null;){var nt=V$1,it=nt.child;if(nt.tag===22&&rt){var st=nt.memoizedState!==null||Kj;if(!st){var ot=nt.alternate,at=ot!==null&&ot.memoizedState!==null||U$1;ot=Kj;var lt=U$1;if(Kj=st,(U$1=at)&&!lt)for(V$1=nt;V$1!==null;)st=V$1,at=st.child,st.tag===22&&st.memoizedState!==null?kk(nt):at!==null?(at.return=st,V$1=at):kk(nt);for(;it!==null;)V$1=it,jk(it),it=it.sibling;V$1=nt,Kj=ot,U$1=lt}lk(et)}else nt.subtreeFlags&8772&&it!==null?(it.return=nt,V$1=it):lk(et)}}function lk(et){for(;V$1!==null;){var _e=V$1;if(_e.flags&8772){var tt=_e.alternate;try{if(_e.flags&8772)switch(_e.tag){case 0:case 11:case 15:U$1||Rj(5,_e);break;case 1:var rt=_e.stateNode;if(_e.flags&4&&!U$1)if(tt===null)rt.componentDidMount();else{var nt=_e.elementType===_e.type?tt.memoizedProps:Lg(_e.type,tt.memoizedProps);rt.componentDidUpdate(nt,tt.memoizedState,rt.__reactInternalSnapshotBeforeUpdate)}var it=_e.updateQueue;it!==null&&ih(_e,it,rt);break;case 3:var st=_e.updateQueue;if(st!==null){if(tt=null,_e.child!==null)switch(_e.child.tag){case 5:tt=_e.child.stateNode;break;case 1:tt=_e.child.stateNode}ih(_e,st,tt)}break;case 5:var ot=_e.stateNode;if(tt===null&&_e.flags&4){tt=ot;var at=_e.memoizedProps;switch(_e.type){case"button":case"input":case"select":case"textarea":at.autoFocus&&tt.focus();break;case"img":at.src&&(tt.src=at.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_e.memoizedState===null){var lt=_e.alternate;if(lt!==null){var ut=lt.memoizedState;if(ut!==null){var ct=ut.dehydrated;ct!==null&&bd(ct)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$1||_e.flags&512&&Sj(_e)}catch(dt){W$1(_e,_e.return,dt)}}if(_e===et){V$1=null;break}if(tt=_e.sibling,tt!==null){tt.return=_e.return,V$1=tt;break}V$1=_e.return}}function hk(et){for(;V$1!==null;){var _e=V$1;if(_e===et){V$1=null;break}var tt=_e.sibling;if(tt!==null){tt.return=_e.return,V$1=tt;break}V$1=_e.return}}function kk(et){for(;V$1!==null;){var _e=V$1;try{switch(_e.tag){case 0:case 11:case 15:var tt=_e.return;try{Rj(4,_e)}catch(at){W$1(_e,tt,at)}break;case 1:var rt=_e.stateNode;if(typeof rt.componentDidMount=="function"){var nt=_e.return;try{rt.componentDidMount()}catch(at){W$1(_e,nt,at)}}var it=_e.return;try{Sj(_e)}catch(at){W$1(_e,it,at)}break;case 5:var st=_e.return;try{Sj(_e)}catch(at){W$1(_e,st,at)}}}catch(at){W$1(_e,_e.return,at)}if(_e===et){V$1=null;break}var ot=_e.sibling;if(ot!==null){ot.return=_e.return,V$1=ot;break}V$1=_e.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K$1=0,R$1=null,Y$1=null,Z=0,gj=0,fj=Uf(0),T$1=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L$1(){return K$1&6?B$1():Bk!==-1?Bk:Bk=B$1()}function lh(et){return et.mode&1?K$1&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(et=C$1,et!==0||(et=window.event,et=et===void 0?16:jd(et.type)),et):1}function mh(et,_e,tt,rt){if(50<zk)throw zk=0,Ak=null,Error(p$1(185));Ac(et,tt,rt),(!(K$1&2)||et!==R$1)&&(et===R$1&&(!(K$1&2)&&(rk|=tt),T$1===4&&Dk(et,Z)),Ek(et,rt),tt===1&&K$1===0&&!(_e.mode&1)&&(Hj=B$1()+500,fg&&jg()))}function Ek(et,_e){var tt=et.callbackNode;wc(et,_e);var rt=uc(et,et===R$1?Z:0);if(rt===0)tt!==null&&bc(tt),et.callbackNode=null,et.callbackPriority=0;else if(_e=rt&-rt,et.callbackPriority!==_e){if(tt!=null&&bc(tt),_e===1)et.tag===0?ig(Fk.bind(null,et)):hg(Fk.bind(null,et)),Jf(function(){!(K$1&6)&&jg()}),tt=null;else{switch(Dc(rt)){case 1:tt=fc;break;case 4:tt=gc;break;case 16:tt=hc;break;case 536870912:tt=jc;break;default:tt=hc}tt=Gk(tt,Hk.bind(null,et))}et.callbackPriority=_e,et.callbackNode=tt}}function Hk(et,_e){if(Bk=-1,Ck=0,K$1&6)throw Error(p$1(327));var tt=et.callbackNode;if(Ik()&&et.callbackNode!==tt)return null;var rt=uc(et,et===R$1?Z:0);if(rt===0)return null;if(rt&30||rt&et.expiredLanes||_e)_e=Jk(et,rt);else{_e=rt;var nt=K$1;K$1|=2;var it=Kk();(R$1!==et||Z!==_e)&&(vk=null,Hj=B$1()+500,Lk(et,_e));do try{Mk();break}catch(ot){Nk(et,ot)}while(!0);Qg(),nk.current=it,K$1=nt,Y$1!==null?_e=0:(R$1=null,Z=0,_e=T$1)}if(_e!==0){if(_e===2&&(nt=xc(et),nt!==0&&(rt=nt,_e=Ok(et,nt))),_e===1)throw tt=qk,Lk(et,0),Dk(et,rt),Ek(et,B$1()),tt;if(_e===6)Dk(et,rt);else{if(nt=et.current.alternate,!(rt&30)&&!Pk(nt)&&(_e=Jk(et,rt),_e===2&&(it=xc(et),it!==0&&(rt=it,_e=Ok(et,it))),_e===1))throw tt=qk,Lk(et,0),Dk(et,rt),Ek(et,B$1()),tt;switch(et.finishedWork=nt,et.finishedLanes=rt,_e){case 0:case 1:throw Error(p$1(345));case 2:Qk(et,uk,vk);break;case 3:if(Dk(et,rt),(rt&130023424)===rt&&(_e=gk+500-B$1(),10<_e)){if(uc(et,0)!==0)break;if(nt=et.suspendedLanes,(nt&rt)!==rt){L$1(),et.pingedLanes|=et.suspendedLanes&nt;break}et.timeoutHandle=Ff(Qk.bind(null,et,uk,vk),_e);break}Qk(et,uk,vk);break;case 4:if(Dk(et,rt),(rt&4194240)===rt)break;for(_e=et.eventTimes,nt=-1;0<rt;){var st=31-oc(rt);it=1<<st,st=_e[st],st>nt&&(nt=st),rt&=~it}if(rt=nt,rt=B$1()-rt,rt=(120>rt?120:480>rt?480:1080>rt?1080:1920>rt?1920:3e3>rt?3e3:4320>rt?4320:1960*mk(rt/1960))-rt,10<rt){et.timeoutHandle=Ff(Qk.bind(null,et,uk,vk),rt);break}Qk(et,uk,vk);break;case 5:Qk(et,uk,vk);break;default:throw Error(p$1(329))}}}return Ek(et,B$1()),et.callbackNode===tt?Hk.bind(null,et):null}function Ok(et,_e){var tt=tk;return et.current.memoizedState.isDehydrated&&(Lk(et,_e).flags|=256),et=Jk(et,_e),et!==2&&(_e=uk,uk=tt,_e!==null&&Gj(_e)),et}function Gj(et){uk===null?uk=et:uk.push.apply(uk,et)}function Pk(et){for(var _e=et;;){if(_e.flags&16384){var tt=_e.updateQueue;if(tt!==null&&(tt=tt.stores,tt!==null))for(var rt=0;rt<tt.length;rt++){var nt=tt[rt],it=nt.getSnapshot;nt=nt.value;try{if(!He(it(),nt))return!1}catch{return!1}}}if(tt=_e.child,_e.subtreeFlags&16384&&tt!==null)tt.return=_e,_e=tt;else{if(_e===et)break;for(;_e.sibling===null;){if(_e.return===null||_e.return===et)return!0;_e=_e.return}_e.sibling.return=_e.return,_e=_e.sibling}}return!0}function Dk(et,_e){for(_e&=~sk,_e&=~rk,et.suspendedLanes|=_e,et.pingedLanes&=~_e,et=et.expirationTimes;0<_e;){var tt=31-oc(_e),rt=1<<tt;et[tt]=-1,_e&=~rt}}function Fk(et){if(K$1&6)throw Error(p$1(327));Ik();var _e=uc(et,0);if(!(_e&1))return Ek(et,B$1()),null;var tt=Jk(et,_e);if(et.tag!==0&&tt===2){var rt=xc(et);rt!==0&&(_e=rt,tt=Ok(et,rt))}if(tt===1)throw tt=qk,Lk(et,0),Dk(et,_e),Ek(et,B$1()),tt;if(tt===6)throw Error(p$1(345));return et.finishedWork=et.current.alternate,et.finishedLanes=_e,Qk(et,uk,vk),Ek(et,B$1()),null}function Rk(et,_e){var tt=K$1;K$1|=1;try{return et(_e)}finally{K$1=tt,K$1===0&&(Hj=B$1()+500,fg&&jg())}}function Sk(et){xk!==null&&xk.tag===0&&!(K$1&6)&&Ik();var _e=K$1;K$1|=1;var tt=pk.transition,rt=C$1;try{if(pk.transition=null,C$1=1,et)return et()}finally{C$1=rt,pk.transition=tt,K$1=_e,!(K$1&6)&&jg()}}function Ij(){gj=fj.current,E$1(fj)}function Lk(et,_e){et.finishedWork=null,et.finishedLanes=0;var tt=et.timeoutHandle;if(tt!==-1&&(et.timeoutHandle=-1,Gf(tt)),Y$1!==null)for(tt=Y$1.return;tt!==null;){var rt=tt;switch(wg(rt),rt.tag){case 1:rt=rt.type.childContextTypes,rt!=null&&$f();break;case 3:Jh(),E$1(Wf),E$1(H$1),Oh();break;case 5:Lh(rt);break;case 4:Jh();break;case 13:E$1(M$1);break;case 19:E$1(M$1);break;case 10:Rg(rt.type._context);break;case 22:case 23:Ij()}tt=tt.return}if(R$1=et,Y$1=et=wh(et.current,null),Z=gj=_e,T$1=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(_e=0;_e<Wg.length;_e++)if(tt=Wg[_e],rt=tt.interleaved,rt!==null){tt.interleaved=null;var nt=rt.next,it=tt.pending;if(it!==null){var st=it.next;it.next=nt,rt.next=st}tt.pending=rt}Wg=null}return et}function Nk(et,_e){do{var tt=Y$1;try{if(Qg(),Ph.current=ai,Sh){for(var rt=N$1.memoizedState;rt!==null;){var nt=rt.queue;nt!==null&&(nt.pending=null),rt=rt.next}Sh=!1}if(Rh=0,P$1=O$1=N$1=null,Th=!1,Uh=0,ok.current=null,tt===null||tt.return===null){T$1=1,qk=_e,Y$1=null;break}e:{var it=et,st=tt.return,ot=tt,at=_e;if(_e=Z,ot.flags|=32768,at!==null&&typeof at=="object"&&typeof at.then=="function"){var lt=at,ut=ot,ct=ut.tag;if(!(ut.mode&1)&&(ct===0||ct===11||ct===15)){var dt=ut.alternate;dt?(ut.updateQueue=dt.updateQueue,ut.memoizedState=dt.memoizedState,ut.lanes=dt.lanes):(ut.updateQueue=null,ut.memoizedState=null)}var ft=Vi(st);if(ft!==null){ft.flags&=-257,Wi(ft,st,ot,it,_e),ft.mode&1&&Ti(it,lt,_e),_e=ft,at=lt;var pt=_e.updateQueue;if(pt===null){var mt=new Set;mt.add(at),_e.updateQueue=mt}else pt.add(at);break e}else{if(!(_e&1)){Ti(it,lt,_e),uj();break e}at=Error(p$1(426))}}else if(I$1&&ot.mode&1){var ht=Vi(st);if(ht!==null){!(ht.flags&65536)&&(ht.flags|=256),Wi(ht,st,ot,it,_e),Jg(Ki(at,ot));break e}}it=at=Ki(at,ot),T$1!==4&&(T$1=2),tk===null?tk=[it]:tk.push(it),it=st;do{switch(it.tag){case 3:it.flags|=65536,_e&=-_e,it.lanes|=_e;var gt=Oi(it,at,_e);fh(it,gt);break e;case 1:ot=at;var vt=it.type,yt=it.stateNode;if(!(it.flags&128)&&(typeof vt.getDerivedStateFromError=="function"||yt!==null&&typeof yt.componentDidCatch=="function"&&(Si===null||!Si.has(yt)))){it.flags|=65536,_e&=-_e,it.lanes|=_e;var bt=Ri(it,ot,_e);fh(it,bt);break e}}it=it.return}while(it!==null)}Tk(tt)}catch(xt){_e=xt,Y$1===tt&&tt!==null&&(Y$1=tt=tt.return);continue}break}while(!0)}function Kk(){var et=nk.current;return nk.current=ai,et===null?ai:et}function uj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),R$1===null||!(hh&268435455)&&!(rk&268435455)||Dk(R$1,Z)}function Jk(et,_e){var tt=K$1;K$1|=2;var rt=Kk();(R$1!==et||Z!==_e)&&(vk=null,Lk(et,_e));do try{Uk();break}catch(nt){Nk(et,nt)}while(!0);if(Qg(),K$1=tt,nk.current=rt,Y$1!==null)throw Error(p$1(261));return R$1=null,Z=0,T$1}function Uk(){for(;Y$1!==null;)Vk(Y$1)}function Mk(){for(;Y$1!==null&&!cc();)Vk(Y$1)}function Vk(et){var _e=Wk(et.alternate,et,gj);et.memoizedProps=et.pendingProps,_e===null?Tk(et):Y$1=_e,ok.current=null}function Tk(et){var _e=et;do{var tt=_e.alternate;if(et=_e.return,_e.flags&32768){if(tt=Jj(tt,_e),tt!==null){tt.flags&=32767,Y$1=tt;return}if(et!==null)et.flags|=32768,et.subtreeFlags=0,et.deletions=null;else{T$1=6,Y$1=null;return}}else if(tt=Fj(tt,_e,gj),tt!==null){Y$1=tt;return}if(_e=_e.sibling,_e!==null){Y$1=_e;return}Y$1=_e=et}while(_e!==null);T$1===0&&(T$1=5)}function Qk(et,_e,tt){var rt=C$1,nt=pk.transition;try{pk.transition=null,C$1=1,Xk(et,_e,tt,rt)}finally{pk.transition=nt,C$1=rt}return null}function Xk(et,_e,tt,rt){do Ik();while(xk!==null);if(K$1&6)throw Error(p$1(327));tt=et.finishedWork;var nt=et.finishedLanes;if(tt===null)return null;if(et.finishedWork=null,et.finishedLanes=0,tt===et.current)throw Error(p$1(177));et.callbackNode=null,et.callbackPriority=0;var it=tt.lanes|tt.childLanes;if(Bc(et,it),et===R$1&&(Y$1=R$1=null,Z=0),!(tt.subtreeFlags&2064)&&!(tt.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),it=(tt.flags&15990)!==0,tt.subtreeFlags&15990||it){it=pk.transition,pk.transition=null;var st=C$1;C$1=1;var ot=K$1;K$1|=4,ok.current=null,Pj(et,tt),ek(tt,et),Oe(Df),dd=!!Cf,Df=Cf=null,et.current=tt,ik(tt),dc(),K$1=ot,C$1=st,pk.transition=it}else et.current=tt;if(wk&&(wk=!1,xk=et,yk=nt),it=et.pendingLanes,it===0&&(Si=null),mc(tt.stateNode),Ek(et,B$1()),_e!==null)for(rt=et.onRecoverableError,tt=0;tt<_e.length;tt++)nt=_e[tt],rt(nt.value,{componentStack:nt.stack,digest:nt.digest});if(Pi)throw Pi=!1,et=Qi,Qi=null,et;return yk&1&&et.tag!==0&&Ik(),it=et.pendingLanes,it&1?et===Ak?zk++:(zk=0,Ak=et):zk=0,jg(),null}function Ik(){if(xk!==null){var et=Dc(yk),_e=pk.transition,tt=C$1;try{if(pk.transition=null,C$1=16>et?16:et,xk===null)var rt=!1;else{if(et=xk,xk=null,yk=0,K$1&6)throw Error(p$1(331));var nt=K$1;for(K$1|=4,V$1=et.current;V$1!==null;){var it=V$1,st=it.child;if(V$1.flags&16){var ot=it.deletions;if(ot!==null){for(var at=0;at<ot.length;at++){var lt=ot[at];for(V$1=lt;V$1!==null;){var ut=V$1;switch(ut.tag){case 0:case 11:case 15:Qj(8,ut,it)}var ct=ut.child;if(ct!==null)ct.return=ut,V$1=ct;else for(;V$1!==null;){ut=V$1;var dt=ut.sibling,ft=ut.return;if(Tj(ut),ut===lt){V$1=null;break}if(dt!==null){dt.return=ft,V$1=dt;break}V$1=ft}}}var pt=it.alternate;if(pt!==null){var mt=pt.child;if(mt!==null){pt.child=null;do{var ht=mt.sibling;mt.sibling=null,mt=ht}while(mt!==null)}}V$1=it}}if(it.subtreeFlags&2064&&st!==null)st.return=it,V$1=st;else e:for(;V$1!==null;){if(it=V$1,it.flags&2048)switch(it.tag){case 0:case 11:case 15:Qj(9,it,it.return)}var gt=it.sibling;if(gt!==null){gt.return=it.return,V$1=gt;break e}V$1=it.return}}var vt=et.current;for(V$1=vt;V$1!==null;){st=V$1;var yt=st.child;if(st.subtreeFlags&2064&&yt!==null)yt.return=st,V$1=yt;else e:for(st=vt;V$1!==null;){if(ot=V$1,ot.flags&2048)try{switch(ot.tag){case 0:case 11:case 15:Rj(9,ot)}}catch(xt){W$1(ot,ot.return,xt)}if(ot===st){V$1=null;break e}var bt=ot.sibling;if(bt!==null){bt.return=ot.return,V$1=bt;break e}V$1=ot.return}}if(K$1=nt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,et)}catch{}rt=!0}return rt}finally{C$1=tt,pk.transition=_e}}return!1}function Yk(et,_e,tt){_e=Ki(tt,_e),_e=Oi(et,_e,1),et=dh(et,_e,1),_e=L$1(),et!==null&&(Ac(et,1,_e),Ek(et,_e))}function W$1(et,_e,tt){if(et.tag===3)Yk(et,et,tt);else for(;_e!==null;){if(_e.tag===3){Yk(_e,et,tt);break}else if(_e.tag===1){var rt=_e.stateNode;if(typeof _e.type.getDerivedStateFromError=="function"||typeof rt.componentDidCatch=="function"&&(Si===null||!Si.has(rt))){et=Ki(tt,et),et=Ri(_e,et,1),_e=dh(_e,et,1),et=L$1(),_e!==null&&(Ac(_e,1,et),Ek(_e,et));break}}_e=_e.return}}function Ui(et,_e,tt){var rt=et.pingCache;rt!==null&&rt.delete(_e),_e=L$1(),et.pingedLanes|=et.suspendedLanes&tt,R$1===et&&(Z&tt)===tt&&(T$1===4||T$1===3&&(Z&130023424)===Z&&500>B$1()-gk?Lk(et,0):sk|=tt),Ek(et,_e)}function Zk(et,_e){_e===0&&(et.mode&1?(_e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):_e=1);var tt=L$1();et=Zg(et,_e),et!==null&&(Ac(et,_e,tt),Ek(et,tt))}function vj(et){var _e=et.memoizedState,tt=0;_e!==null&&(tt=_e.retryLane),Zk(et,tt)}function ck(et,_e){var tt=0;switch(et.tag){case 13:var rt=et.stateNode,nt=et.memoizedState;nt!==null&&(tt=nt.retryLane);break;case 19:rt=et.stateNode;break;default:throw Error(p$1(314))}rt!==null&&rt.delete(_e),Zk(et,tt)}var Wk;Wk=function(et,_e,tt){if(et!==null)if(et.memoizedProps!==_e.pendingProps||Wf.current)Ug=!0;else{if(!(et.lanes&tt)&&!(_e.flags&128))return Ug=!1,zj(et,_e,tt);Ug=!!(et.flags&131072)}else Ug=!1,I$1&&_e.flags&1048576&&ug(_e,ng,_e.index);switch(_e.lanes=0,_e.tag){case 2:var rt=_e.type;jj(et,_e),et=_e.pendingProps;var nt=Yf(_e,H$1.current);Tg(_e,tt),nt=Xh(null,_e,rt,et,nt,tt);var it=bi();return _e.flags|=1,typeof nt=="object"&&nt!==null&&typeof nt.render=="function"&&nt.$$typeof===void 0?(_e.tag=1,_e.memoizedState=null,_e.updateQueue=null,Zf(rt)?(it=!0,cg(_e)):it=!1,_e.memoizedState=nt.state!==null&&nt.state!==void 0?nt.state:null,ah(_e),nt.updater=nh,_e.stateNode=nt,nt._reactInternals=_e,rh(_e,rt,et,tt),_e=kj(null,_e,rt,!0,it,tt)):(_e.tag=0,I$1&&it&&vg(_e),Yi(null,_e,nt,tt),_e=_e.child),_e;case 16:rt=_e.elementType;e:{switch(jj(et,_e),et=_e.pendingProps,nt=rt._init,rt=nt(rt._payload),_e.type=rt,nt=_e.tag=$k(rt),et=Lg(rt,et),nt){case 0:_e=dj(null,_e,rt,et,tt);break e;case 1:_e=ij(null,_e,rt,et,tt);break e;case 11:_e=Zi(null,_e,rt,et,tt);break e;case 14:_e=aj(null,_e,rt,Lg(rt.type,et),tt);break e}throw Error(p$1(306,rt,""))}return _e;case 0:return rt=_e.type,nt=_e.pendingProps,nt=_e.elementType===rt?nt:Lg(rt,nt),dj(et,_e,rt,nt,tt);case 1:return rt=_e.type,nt=_e.pendingProps,nt=_e.elementType===rt?nt:Lg(rt,nt),ij(et,_e,rt,nt,tt);case 3:e:{if(lj(_e),et===null)throw Error(p$1(387));rt=_e.pendingProps,it=_e.memoizedState,nt=it.element,bh(et,_e),gh(_e,rt,null,tt);var st=_e.memoizedState;if(rt=st.element,it.isDehydrated)if(it={element:rt,isDehydrated:!1,cache:st.cache,pendingSuspenseBoundaries:st.pendingSuspenseBoundaries,transitions:st.transitions},_e.updateQueue.baseState=it,_e.memoizedState=it,_e.flags&256){nt=Ki(Error(p$1(423)),_e),_e=mj(et,_e,rt,tt,nt);break e}else if(rt!==nt){nt=Ki(Error(p$1(424)),_e),_e=mj(et,_e,rt,tt,nt);break e}else for(yg=Lf(_e.stateNode.containerInfo.firstChild),xg=_e,I$1=!0,zg=null,tt=Ch(_e,null,rt,tt),_e.child=tt;tt;)tt.flags=tt.flags&-3|4096,tt=tt.sibling;else{if(Ig(),rt===nt){_e=$i(et,_e,tt);break e}Yi(et,_e,rt,tt)}_e=_e.child}return _e;case 5:return Kh(_e),et===null&&Eg(_e),rt=_e.type,nt=_e.pendingProps,it=et!==null?et.memoizedProps:null,st=nt.children,Ef(rt,nt)?st=null:it!==null&&Ef(rt,it)&&(_e.flags|=32),hj(et,_e),Yi(et,_e,st,tt),_e.child;case 6:return et===null&&Eg(_e),null;case 13:return pj(et,_e,tt);case 4:return Ih(_e,_e.stateNode.containerInfo),rt=_e.pendingProps,et===null?_e.child=Bh(_e,null,rt,tt):Yi(et,_e,rt,tt),_e.child;case 11:return rt=_e.type,nt=_e.pendingProps,nt=_e.elementType===rt?nt:Lg(rt,nt),Zi(et,_e,rt,nt,tt);case 7:return Yi(et,_e,_e.pendingProps,tt),_e.child;case 8:return Yi(et,_e,_e.pendingProps.children,tt),_e.child;case 12:return Yi(et,_e,_e.pendingProps.children,tt),_e.child;case 10:e:{if(rt=_e.type._context,nt=_e.pendingProps,it=_e.memoizedProps,st=nt.value,G$1(Mg,rt._currentValue),rt._currentValue=st,it!==null)if(He(it.value,st)){if(it.children===nt.children&&!Wf.current){_e=$i(et,_e,tt);break e}}else for(it=_e.child,it!==null&&(it.return=_e);it!==null;){var ot=it.dependencies;if(ot!==null){st=it.child;for(var at=ot.firstContext;at!==null;){if(at.context===rt){if(it.tag===1){at=ch(-1,tt&-tt),at.tag=2;var lt=it.updateQueue;if(lt!==null){lt=lt.shared;var ut=lt.pending;ut===null?at.next=at:(at.next=ut.next,ut.next=at),lt.pending=at}}it.lanes|=tt,at=it.alternate,at!==null&&(at.lanes|=tt),Sg(it.return,tt,_e),ot.lanes|=tt;break}at=at.next}}else if(it.tag===10)st=it.type===_e.type?null:it.child;else if(it.tag===18){if(st=it.return,st===null)throw Error(p$1(341));st.lanes|=tt,ot=st.alternate,ot!==null&&(ot.lanes|=tt),Sg(st,tt,_e),st=it.sibling}else st=it.child;if(st!==null)st.return=it;else for(st=it;st!==null;){if(st===_e){st=null;break}if(it=st.sibling,it!==null){it.return=st.return,st=it;break}st=st.return}it=st}Yi(et,_e,nt.children,tt),_e=_e.child}return _e;case 9:return nt=_e.type,rt=_e.pendingProps.children,Tg(_e,tt),nt=Vg(nt),rt=rt(nt),_e.flags|=1,Yi(et,_e,rt,tt),_e.child;case 14:return rt=_e.type,nt=Lg(rt,_e.pendingProps),nt=Lg(rt.type,nt),aj(et,_e,rt,nt,tt);case 15:return cj(et,_e,_e.type,_e.pendingProps,tt);case 17:return rt=_e.type,nt=_e.pendingProps,nt=_e.elementType===rt?nt:Lg(rt,nt),jj(et,_e),_e.tag=1,Zf(rt)?(et=!0,cg(_e)):et=!1,Tg(_e,tt),ph(_e,rt,nt),rh(_e,rt,nt,tt),kj(null,_e,rt,!0,et,tt);case 19:return yj(et,_e,tt);case 22:return ej(et,_e,tt)}throw Error(p$1(156,_e.tag))};function Gk(et,_e){return ac(et,_e)}function al(et,_e,tt,rt){this.tag=et,this.key=tt,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=rt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(et,_e,tt,rt){return new al(et,_e,tt,rt)}function bj(et){return et=et.prototype,!(!et||!et.isReactComponent)}function $k(et){if(typeof et=="function")return bj(et)?1:0;if(et!=null){if(et=et.$$typeof,et===Da)return 11;if(et===Ga)return 14}return 2}function wh(et,_e){var tt=et.alternate;return tt===null?(tt=Bg(et.tag,_e,et.key,et.mode),tt.elementType=et.elementType,tt.type=et.type,tt.stateNode=et.stateNode,tt.alternate=et,et.alternate=tt):(tt.pendingProps=_e,tt.type=et.type,tt.flags=0,tt.subtreeFlags=0,tt.deletions=null),tt.flags=et.flags&14680064,tt.childLanes=et.childLanes,tt.lanes=et.lanes,tt.child=et.child,tt.memoizedProps=et.memoizedProps,tt.memoizedState=et.memoizedState,tt.updateQueue=et.updateQueue,_e=et.dependencies,tt.dependencies=_e===null?null:{lanes:_e.lanes,firstContext:_e.firstContext},tt.sibling=et.sibling,tt.index=et.index,tt.ref=et.ref,tt}function yh(et,_e,tt,rt,nt,it){var st=2;if(rt=et,typeof et=="function")bj(et)&&(st=1);else if(typeof et=="string")st=5;else e:switch(et){case ya:return Ah(tt.children,nt,it,_e);case za:st=8,nt|=8;break;case Aa:return et=Bg(12,tt,_e,nt|2),et.elementType=Aa,et.lanes=it,et;case Ea:return et=Bg(13,tt,_e,nt),et.elementType=Ea,et.lanes=it,et;case Fa:return et=Bg(19,tt,_e,nt),et.elementType=Fa,et.lanes=it,et;case Ia:return qj(tt,nt,it,_e);default:if(typeof et=="object"&&et!==null)switch(et.$$typeof){case Ba:st=10;break e;case Ca:st=9;break e;case Da:st=11;break e;case Ga:st=14;break e;case Ha:st=16,rt=null;break e}throw Error(p$1(130,et==null?et:typeof et,""))}return _e=Bg(st,tt,_e,nt),_e.elementType=et,_e.type=rt,_e.lanes=it,_e}function Ah(et,_e,tt,rt){return et=Bg(7,et,rt,_e),et.lanes=tt,et}function qj(et,_e,tt,rt){return et=Bg(22,et,rt,_e),et.elementType=Ia,et.lanes=tt,et.stateNode={isHidden:!1},et}function xh(et,_e,tt){return et=Bg(6,et,null,_e),et.lanes=tt,et}function zh(et,_e,tt){return _e=Bg(4,et.children!==null?et.children:[],et.key,_e),_e.lanes=tt,_e.stateNode={containerInfo:et.containerInfo,pendingChildren:null,implementation:et.implementation},_e}function bl(et,_e,tt,rt,nt){this.tag=_e,this.containerInfo=et,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=rt,this.onRecoverableError=nt,this.mutableSourceEagerHydrationData=null}function cl(et,_e,tt,rt,nt,it,st,ot,at){return et=new bl(et,_e,tt,ot,at),_e===1?(_e=1,it===!0&&(_e|=8)):_e=0,it=Bg(3,null,null,_e),et.current=it,it.stateNode=et,it.memoizedState={element:rt,isDehydrated:tt,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(it),et}function dl(et,_e,tt){var rt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:rt==null?null:""+rt,children:et,containerInfo:_e,implementation:tt}}function el(et){if(!et)return Vf;et=et._reactInternals;e:{if(Vb(et)!==et||et.tag!==1)throw Error(p$1(170));var _e=et;do{switch(_e.tag){case 3:_e=_e.stateNode.context;break e;case 1:if(Zf(_e.type)){_e=_e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_e=_e.return}while(_e!==null);throw Error(p$1(171))}if(et.tag===1){var tt=et.type;if(Zf(tt))return bg(et,tt,_e)}return _e}function fl(et,_e,tt,rt,nt,it,st,ot,at){return et=cl(tt,rt,!0,et,nt,it,st,ot,at),et.context=el(null),tt=et.current,rt=L$1(),nt=lh(tt),it=ch(rt,nt),it.callback=_e??null,dh(tt,it,nt),et.current.lanes=nt,Ac(et,nt,rt),Ek(et,rt),et}function gl(et,_e,tt,rt){var nt=_e.current,it=L$1(),st=lh(nt);return tt=el(tt),_e.context===null?_e.context=tt:_e.pendingContext=tt,_e=ch(it,st),_e.payload={element:et},rt=rt===void 0?null:rt,rt!==null&&(_e.callback=rt),et=dh(nt,_e,st),et!==null&&(mh(et,nt,st,it),eh(et,nt,st)),st}function hl(et){if(et=et.current,!et.child)return null;switch(et.child.tag){case 5:return et.child.stateNode;default:return et.child.stateNode}}function il(et,_e){if(et=et.memoizedState,et!==null&&et.dehydrated!==null){var tt=et.retryLane;et.retryLane=tt!==0&&tt<_e?tt:_e}}function jl(et,_e){il(et,_e),(et=et.alternate)&&il(et,_e)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(et){console.error(et)};function ml(et){this._internalRoot=et}nl.prototype.render=ml.prototype.render=function(et){var _e=this._internalRoot;if(_e===null)throw Error(p$1(409));gl(et,_e,null,null)},nl.prototype.unmount=ml.prototype.unmount=function(){var et=this._internalRoot;if(et!==null){this._internalRoot=null;var _e=et.containerInfo;Sk(function(){gl(null,et,null,null)}),_e[uf]=null}};function nl(et){this._internalRoot=et}nl.prototype.unstable_scheduleHydration=function(et){if(et){var _e=Hc();et={blockedOn:null,target:et,priority:_e};for(var tt=0;tt<Qc.length&&_e!==0&&_e<Qc[tt].priority;tt++);Qc.splice(tt,0,et),tt===0&&Vc(et)}};function ol(et){return!(!et||et.nodeType!==1&&et.nodeType!==9&&et.nodeType!==11)}function pl(et){return!(!et||et.nodeType!==1&&et.nodeType!==9&&et.nodeType!==11&&(et.nodeType!==8||et.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(et,_e,tt,rt,nt){if(nt){if(typeof rt=="function"){var it=rt;rt=function(){var lt=hl(st);it.call(lt)}}var st=fl(_e,rt,et,0,null,!1,!1,"",ql);return et._reactRootContainer=st,et[uf]=st.current,sf(et.nodeType===8?et.parentNode:et),Sk(),st}for(;nt=et.lastChild;)et.removeChild(nt);if(typeof rt=="function"){var ot=rt;rt=function(){var lt=hl(at);ot.call(lt)}}var at=cl(et,0,!1,null,null,!1,!1,"",ql);return et._reactRootContainer=at,et[uf]=at.current,sf(et.nodeType===8?et.parentNode:et),Sk(function(){gl(_e,at,tt,rt)}),at}function sl(et,_e,tt,rt,nt){var it=tt._reactRootContainer;if(it){var st=it;if(typeof nt=="function"){var ot=nt;nt=function(){var at=hl(st);ot.call(at)}}gl(_e,st,et,nt)}else st=rl(tt,_e,et,nt,rt);return hl(st)}Ec=function(et){switch(et.tag){case 3:var _e=et.stateNode;if(_e.current.memoizedState.isDehydrated){var tt=tc(_e.pendingLanes);tt!==0&&(Cc(_e,tt|1),Ek(_e,B$1()),!(K$1&6)&&(Hj=B$1()+500,jg()))}break;case 13:Sk(function(){var rt=Zg(et,1);if(rt!==null){var nt=L$1();mh(rt,et,1,nt)}}),jl(et,1)}},Fc=function(et){if(et.tag===13){var _e=Zg(et,134217728);if(_e!==null){var tt=L$1();mh(_e,et,134217728,tt)}jl(et,134217728)}},Gc=function(et){if(et.tag===13){var _e=lh(et),tt=Zg(et,_e);if(tt!==null){var rt=L$1();mh(tt,et,_e,rt)}jl(et,_e)}},Hc=function(){return C$1},Ic=function(et,_e){var tt=C$1;try{return C$1=et,_e()}finally{C$1=tt}},yb=function(et,_e,tt){switch(_e){case"input":if(bb(et,tt),_e=tt.name,tt.type==="radio"&&_e!=null){for(tt=et;tt.parentNode;)tt=tt.parentNode;for(tt=tt.querySelectorAll("input[name="+JSON.stringify(""+_e)+'][type="radio"]'),_e=0;_e<tt.length;_e++){var rt=tt[_e];if(rt!==et&&rt.form===et.form){var nt=Db(rt);if(!nt)throw Error(p$1(90));Wa(rt),bb(rt,nt)}}}break;case"textarea":ib(et,tt);break;case"select":_e=tt.value,_e!=null&&fb(et,!!tt.multiple,_e,!1)}},Gb=Rk,Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(et){return et=Zb(et),et===null?null:et.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,reactDom_production_min.createPortal=function(et,_e){var tt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(_e))throw Error(p$1(200));return dl(et,_e,null,tt)},reactDom_production_min.createRoot=function(et,_e){if(!ol(et))throw Error(p$1(299));var tt=!1,rt="",nt=ll;return _e!=null&&(_e.unstable_strictMode===!0&&(tt=!0),_e.identifierPrefix!==void 0&&(rt=_e.identifierPrefix),_e.onRecoverableError!==void 0&&(nt=_e.onRecoverableError)),_e=cl(et,1,!1,null,null,tt,!1,rt,nt),et[uf]=_e.current,sf(et.nodeType===8?et.parentNode:et),new ml(_e)},reactDom_production_min.findDOMNode=function(et){if(et==null)return null;if(et.nodeType===1)return et;var _e=et._reactInternals;if(_e===void 0)throw typeof et.render=="function"?Error(p$1(188)):(et=Object.keys(et).join(","),Error(p$1(268,et)));return et=Zb(_e),et=et===null?null:et.stateNode,et},reactDom_production_min.flushSync=function(et){return Sk(et)},reactDom_production_min.hydrate=function(et,_e,tt){if(!pl(_e))throw Error(p$1(200));return sl(null,et,_e,!0,tt)},reactDom_production_min.hydrateRoot=function(et,_e,tt){if(!ol(et))throw Error(p$1(405));var rt=tt!=null&&tt.hydratedSources||null,nt=!1,it="",st=ll;if(tt!=null&&(tt.unstable_strictMode===!0&&(nt=!0),tt.identifierPrefix!==void 0&&(it=tt.identifierPrefix),tt.onRecoverableError!==void 0&&(st=tt.onRecoverableError)),_e=fl(_e,null,et,1,tt??null,nt,!1,it,st),et[uf]=_e.current,sf(et),rt)for(et=0;et<rt.length;et++)tt=rt[et],nt=tt._getVersion,nt=nt(tt._source),_e.mutableSourceEagerHydrationData==null?_e.mutableSourceEagerHydrationData=[tt,nt]:_e.mutableSourceEagerHydrationData.push(tt,nt);return new nl(_e)},reactDom_production_min.render=function(et,_e,tt){if(!pl(_e))throw Error(p$1(200));return sl(null,et,_e,!1,tt)},reactDom_production_min.unmountComponentAtNode=function(et){if(!pl(et))throw Error(p$1(40));return et._reactRootContainer?(Sk(function(){sl(null,null,et,!1,function(){et._reactRootContainer=null,et[uf]=null})}),!0):!1},reactDom_production_min.unstable_batchedUpdates=Rk,reactDom_production_min.unstable_renderSubtreeIntoContainer=function(et,_e,tt,rt){if(!pl(tt))throw Error(p$1(200));if(et==null||et._reactInternals===void 0)throw Error(p$1(38));return sl(et,_e,tt,!1,rt)},reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(et){console.error(et)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const $7SXl2$reactdom=getDefaultExportFromCjs$1(reactDomExports),$5e63c961fc1ce211$export$8c6ed5c666ac1360=N$2((et,_e)=>{const{children:tt,...rt}=et,nt=A$2.toArray(tt),it=nt.find($5e63c961fc1ce211$var$isSlottable);if(it){const st=it.props.children,ot=nt.map(at=>at===it?A$2.count(st)>1?A$2.only(null):fn(st)?st.props.children:null:at);return y$3($5e63c961fc1ce211$var$SlotClone,_extends$1({},rt,{ref:_e}),fn(st)?sn(st,void 0,ot):null)}return y$3($5e63c961fc1ce211$var$SlotClone,_extends$1({},rt,{ref:_e}),tt)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=N$2((et,_e)=>{const{children:tt,...rt}=et;return fn(tt)?sn(tt,{...$5e63c961fc1ce211$var$mergeProps(rt,tt.props),ref:_e?$6ed0406888f73fc4$export$43e446d32b3d21af(_e,tt.ref):tt.ref}):A$2.count(tt)>1?A$2.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:et})=>y$3(g$3,null,et);function $5e63c961fc1ce211$var$isSlottable(et){return fn(et)&&et.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(et,_e){const tt={..._e};for(const rt in _e){const nt=et[rt],it=_e[rt];/^on[A-Z]/.test(rt)?nt&&it?tt[rt]=(...ot)=>{it(...ot),nt(...ot)}:nt&&(tt[rt]=nt):rt==="style"?tt[rt]={...nt,...it}:rt==="className"&&(tt[rt]=[nt,it].filter(Boolean).join(" "))}return{...et,...tt}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((et,_e)=>{const tt=N$2((rt,nt)=>{const{asChild:it,...st}=rt,ot=it?$5e63c961fc1ce211$export$8c6ed5c666ac1360:_e;return _(()=>{window[Symbol.for("radix-ui")]=!0},[]),y$3(ot,_extends$1({},st,{ref:nt}))});return tt.displayName=`Primitive.${_e}`,{...et,[_e]:tt}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(et,_e){et&&reactDomExports.flushSync(()=>et.dispatchEvent(_e))}function $fe963b355347cc68$export$3e6543de14f8614f(et,_e){return y$2((tt,rt)=>{const nt=_e[tt][rt];return nt??tt},et)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=et=>{const{present:_e,children:tt}=et,rt=$921a889cee6df7e8$var$usePresence(_e),nt=typeof tt=="function"?tt({present:rt.isPresent}):A$2.only(tt),it=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(rt.ref,nt.ref);return typeof tt=="function"||rt.isPresent?sn(nt,{ref:it}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(et){const[_e,tt]=p$2(),rt=F$2({}),nt=F$2(et),it=F$2("none"),st=et?"mounted":"unmounted",[ot,at]=$fe963b355347cc68$export$3e6543de14f8614f(st,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _(()=>{const lt=$921a889cee6df7e8$var$getAnimationName(rt.current);it.current=ot==="mounted"?lt:"none"},[ot]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const lt=rt.current,ut=nt.current;if(ut!==et){const dt=it.current,ft=$921a889cee6df7e8$var$getAnimationName(lt);et?at("MOUNT"):ft==="none"||(lt==null?void 0:lt.display)==="none"?at("UNMOUNT"):at(ut&&dt!==ft?"ANIMATION_OUT":"UNMOUNT"),nt.current=et}},[et,at]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(_e){const lt=ct=>{const ft=$921a889cee6df7e8$var$getAnimationName(rt.current).includes(ct.animationName);ct.target===_e&&ft&&reactDomExports.flushSync(()=>at("ANIMATION_END"))},ut=ct=>{ct.target===_e&&(it.current=$921a889cee6df7e8$var$getAnimationName(rt.current))};return _e.addEventListener("animationstart",ut),_e.addEventListener("animationcancel",lt),_e.addEventListener("animationend",lt),()=>{_e.removeEventListener("animationstart",ut),_e.removeEventListener("animationcancel",lt),_e.removeEventListener("animationend",lt)}}else at("ANIMATION_END")},[_e,at]),{isPresent:["mounted","unmountSuspended"].includes(ot),ref:x$3(lt=>{lt&&(rt.current=getComputedStyle(lt)),tt(lt)},[])}}function $921a889cee6df7e8$var$getAnimationName(et){return(et==null?void 0:et.animationName)||"none"}const $1746a345f3d73bb7$var$useReactId=$2AODx$react.useId||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(et){const[_e,tt]=p$2($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{et||tt(rt=>rt??String($1746a345f3d73bb7$var$count++))},[et]),et||(_e?`radix-${_e}`:"")}const $409067139f391064$var$COLLAPSIBLE_NAME="Collapsible",[$409067139f391064$var$createCollapsibleContext,$409067139f391064$export$952b32dcbe73087a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($409067139f391064$var$COLLAPSIBLE_NAME),[$409067139f391064$var$CollapsibleProvider,$409067139f391064$var$useCollapsibleContext]=$409067139f391064$var$createCollapsibleContext($409067139f391064$var$COLLAPSIBLE_NAME),$409067139f391064$export$6eb0f7ddcda6131f=N$2((et,_e)=>{const{__scopeCollapsible:tt,open:rt,defaultOpen:nt,disabled:it,onOpenChange:st,...ot}=et,[at=!1,lt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:rt,defaultProp:nt,onChange:st});return y$3($409067139f391064$var$CollapsibleProvider,{scope:tt,disabled:it,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),open:at,onOpenToggle:x$3(()=>lt(ut=>!ut),[lt])},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(at),"data-disabled":it?"":void 0},ot,{ref:_e})))}),$409067139f391064$var$TRIGGER_NAME="CollapsibleTrigger",$409067139f391064$export$c135dce7b15bbbdc=N$2((et,_e)=>{const{__scopeCollapsible:tt,...rt}=et,nt=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$TRIGGER_NAME,tt);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-controls":nt.contentId,"aria-expanded":nt.open||!1,"data-state":$409067139f391064$var$getState(nt.open),"data-disabled":nt.disabled?"":void 0,disabled:nt.disabled},rt,{ref:_e,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onClick,nt.onOpenToggle)}))}),$409067139f391064$var$CONTENT_NAME="CollapsibleContent",$409067139f391064$export$aadde00976f34151=N$2((et,_e)=>{const{forceMount:tt,...rt}=et,nt=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,et.__scopeCollapsible);return y$3($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:tt||nt.open},({present:it})=>y$3($409067139f391064$var$CollapsibleContentImpl,_extends$1({},rt,{ref:_e,present:it})))}),$409067139f391064$var$CollapsibleContentImpl=N$2((et,_e)=>{const{__scopeCollapsible:tt,present:rt,children:nt,...it}=et,st=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,tt),[ot,at]=p$2(rt),lt=F$2(null),ut=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,lt),ct=F$2(0),dt=ct.current,ft=F$2(0),pt=ft.current,mt=st.open||ot,ht=F$2(mt),gt=F$2();return _(()=>{const vt=requestAnimationFrame(()=>ht.current=!1);return()=>cancelAnimationFrame(vt)},[]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const vt=lt.current;if(vt){gt.current=gt.current||{transitionDuration:vt.style.transitionDuration,animationName:vt.style.animationName},vt.style.transitionDuration="0s",vt.style.animationName="none";const yt=vt.getBoundingClientRect();ct.current=yt.height,ft.current=yt.width,ht.current||(vt.style.transitionDuration=gt.current.transitionDuration,vt.style.animationName=gt.current.animationName),at(rt)}},[st.open,rt]),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(st.open),"data-disabled":st.disabled?"":void 0,id:st.contentId,hidden:!mt},it,{ref:ut,style:{"--radix-collapsible-content-height":dt?`${dt}px`:void 0,"--radix-collapsible-content-width":pt?`${pt}px`:void 0,...et.style}}),mt&&nt)});function $409067139f391064$var$getState(et){return et?"open":"closed"}const $409067139f391064$export$be92b6f5f03c0fe9=$409067139f391064$export$6eb0f7ddcda6131f,$409067139f391064$export$41fb9f06171c75f4=$409067139f391064$export$c135dce7b15bbbdc,$409067139f391064$export$7c6e2c02157bb7d2=$409067139f391064$export$aadde00976f34151,getAnnotationResources=(et,_e)=>{const tt=et.get({id:_e,type:"Canvas"});return!(tt!=null&&tt.annotations)||!tt.annotations[0]?[]:et.get(tt.annotations).filter(nt=>!nt.items||!nt.items.length?!1:nt).map(nt=>{const it=nt.label||{none:["Annotations"]};return{...nt,label:it}})},getCanvasByCriteria=(et,_e,tt,rt)=>{var st,ot;const nt={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},it=at=>{if(at){if(!at.body||!at.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",at);return}let lt=at.body;Array.isArray(lt)&&(lt=lt[0]);const ut=et.get(lt.id);if(!ut)return;switch(tt){case"painting":return at.target===_e.id&&at.motivation&&at.motivation[0]==="painting"&&rt.includes(ut.type)&&(at.body=ut),!!at;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(nt.canvas=et.get(_e),nt.canvas&&(nt.annotationPage=et.get(nt.canvas.items[0]),nt.accompanyingCanvas=(st=nt.canvas)!=null&&st.accompanyingCanvas?et.get((ot=nt.canvas)==null?void 0:ot.accompanyingCanvas):void 0),nt.annotationPage){const at=et.get(nt.annotationPage.items).map(ut=>({body:et.get(ut.body[0].id),motivation:ut.motivation,type:"Annotation"})),lt=[];at.forEach(ut=>{ut.body.type==="Choice"?ut.body.items.forEach(ct=>lt.push({...ut,id:ct.id,body:et.get(ct.id)})):lt.push(ut)}),nt.annotations=lt.filter(it)}return nt},getLabel=(et,_e="en")=>{if(!et)return"";if(!et[_e]){const tt=Object.getOwnPropertyNames(et);if(tt.length>0)return et[tt[0]]}return et[_e]},getPaintingResource=(et,_e)=>{const tt=getCanvasByCriteria(et,{id:_e,type:"Canvas"},"painting",["Image","Sound","Video"]);if(tt.annotations.length!==0&&tt.annotations&&tt.annotations)return tt.annotations.map(rt=>rt==null?void 0:rt.body)},getThumbnail=(et,_e,tt,rt)=>{const nt=[];if(_e.canvas&&_e.canvas.thumbnail.length>0){const ot=et.get(_e.canvas.thumbnail[0]);nt.push(ot)}if(_e.annotations[0]){if(_e.annotations[0].thumbnail&&_e.annotations[0].thumbnail.length>0){const at=et.get(_e.annotations[0].thumbnail[0]);nt.push(at)}if(!_e.annotations[0].body)return;const ot=_e.annotations[0].body;ot.type==="Image"&&nt.push(ot)}return nt.length===0?void 0:{id:nt[0].id,format:nt[0].format,type:nt[0].type,width:tt,height:rt}},ErrorBoundaryContext=G$3(null),initialState={didCatch:!1,error:null};class ErrorBoundary extends b$2{constructor(_e){super(_e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=initialState}static getDerivedStateFromError(_e){return{didCatch:!0,error:_e}}resetErrorBoundary(){const{error:_e}=this.state;if(_e!==null){for(var tt,rt,nt=arguments.length,it=new Array(nt),st=0;st<nt;st++)it[st]=arguments[st];(tt=(rt=this.props).onReset)===null||tt===void 0||tt.call(rt,{args:it,reason:"imperative-api"}),this.setState(initialState)}}componentDidCatch(_e,tt){var rt,nt;(rt=(nt=this.props).onError)===null||rt===void 0||rt.call(nt,_e,tt)}componentDidUpdate(_e,tt){const{didCatch:rt}=this.state,{resetKeys:nt}=this.props;if(rt&&tt.error!==null&&hasArrayChanged(_e.resetKeys,nt)){var it,st;(it=(st=this.props).onReset)===null||it===void 0||it.call(st,{next:nt,prev:_e.resetKeys,reason:"keys"}),this.setState(initialState)}}render(){const{children:_e,fallbackRender:tt,FallbackComponent:rt,fallback:nt}=this.props,{didCatch:it,error:st}=this.state;let ot=_e;if(it){const at={error:st,resetErrorBoundary:this.resetErrorBoundary};if(typeof tt=="function")ot=tt(at);else if(rt)ot=y$3(rt,at);else if(nt===null||fn(nt))ot=nt;else throw st}return y$3(ErrorBoundaryContext.Provider,{value:{didCatch:it,error:st,resetErrorBoundary:this.resetErrorBoundary}},ot)}}function hasArrayChanged(){let et=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],_e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return et.length!==_e.length||et.some((tt,rt)=>!Object.is(tt,_e[rt]))}var e="colors",t="sizes",r="space",n={gap:r,gridGap:r,columnGap:r,gridColumnGap:r,rowGap:r,gridRowGap:r,inset:r,insetBlock:r,insetBlockEnd:r,insetBlockStart:r,insetInline:r,insetInlineEnd:r,insetInlineStart:r,margin:r,marginTop:r,marginRight:r,marginBottom:r,marginLeft:r,marginBlock:r,marginBlockEnd:r,marginBlockStart:r,marginInline:r,marginInlineEnd:r,marginInlineStart:r,padding:r,paddingTop:r,paddingRight:r,paddingBottom:r,paddingLeft:r,paddingBlock:r,paddingBlockEnd:r,paddingBlockStart:r,paddingInline:r,paddingInlineEnd:r,paddingInlineStart:r,top:r,right:r,bottom:r,left:r,scrollMargin:r,scrollMarginTop:r,scrollMarginRight:r,scrollMarginBottom:r,scrollMarginLeft:r,scrollMarginX:r,scrollMarginY:r,scrollMarginBlock:r,scrollMarginBlockEnd:r,scrollMarginBlockStart:r,scrollMarginInline:r,scrollMarginInlineEnd:r,scrollMarginInlineStart:r,scrollPadding:r,scrollPaddingTop:r,scrollPaddingRight:r,scrollPaddingBottom:r,scrollPaddingLeft:r,scrollPaddingX:r,scrollPaddingY:r,scrollPaddingBlock:r,scrollPaddingBlockEnd:r,scrollPaddingBlockStart:r,scrollPaddingInline:r,scrollPaddingInlineEnd:r,scrollPaddingInlineStart:r,fontSize:"fontSizes",background:e,backgroundColor:e,backgroundImage:e,borderImage:e,border:e,borderBlock:e,borderBlockEnd:e,borderBlockStart:e,borderBottom:e,borderBottomColor:e,borderColor:e,borderInline:e,borderInlineEnd:e,borderInlineStart:e,borderLeft:e,borderLeftColor:e,borderRight:e,borderRightColor:e,borderTop:e,borderTopColor:e,caretColor:e,color:e,columnRuleColor:e,fill:e,outline:e,outlineColor:e,stroke:e,textDecorationColor:e,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t,minBlockSize:t,maxBlockSize:t,inlineSize:t,minInlineSize:t,maxInlineSize:t,width:t,minWidth:t,maxWidth:t,height:t,minHeight:t,maxHeight:t,flexBasis:t,gridTemplateColumns:t,gridTemplateRows:t,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i=(et,_e)=>typeof _e=="function"?{"()":Function.prototype.toString.call(_e)}:_e,o=()=>{const et=Object.create(null);return(_e,tt,...rt)=>{const nt=(it=>JSON.stringify(it,i))(_e);return nt in et?et[nt]:et[nt]=tt(_e,...rt)}},l=Symbol.for("sxs.internal"),s=(et,_e)=>Object.defineProperties(et,Object.getOwnPropertyDescriptors(_e)),a=et=>{for(const _e in et)return!0;return!1},{hasOwnProperty:c}=Object.prototype,d=et=>et.includes("-")?et:et.replace(/[A-Z]/g,_e=>"-"+_e.toLowerCase()),g=/\s+(?![^()]*\))/,p=et=>_e=>et(...typeof _e=="string"?String(_e).split(g):[_e]),u={appearance:et=>({WebkitAppearance:et,appearance:et}),backfaceVisibility:et=>({WebkitBackfaceVisibility:et,backfaceVisibility:et}),backdropFilter:et=>({WebkitBackdropFilter:et,backdropFilter:et}),backgroundClip:et=>({WebkitBackgroundClip:et,backgroundClip:et}),boxDecorationBreak:et=>({WebkitBoxDecorationBreak:et,boxDecorationBreak:et}),clipPath:et=>({WebkitClipPath:et,clipPath:et}),content:et=>({content:et.includes('"')||et.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(et)?et:`"${et}"`}),hyphens:et=>({WebkitHyphens:et,hyphens:et}),maskImage:et=>({WebkitMaskImage:et,maskImage:et}),maskSize:et=>({WebkitMaskSize:et,maskSize:et}),tabSize:et=>({MozTabSize:et,tabSize:et}),textSizeAdjust:et=>({WebkitTextSizeAdjust:et,textSizeAdjust:et}),userSelect:et=>({WebkitUserSelect:et,userSelect:et}),marginBlock:p((et,_e)=>({marginBlockStart:et,marginBlockEnd:_e||et})),marginInline:p((et,_e)=>({marginInlineStart:et,marginInlineEnd:_e||et})),maxSize:p((et,_e)=>({maxBlockSize:et,maxInlineSize:_e||et})),minSize:p((et,_e)=>({minBlockSize:et,minInlineSize:_e||et})),paddingBlock:p((et,_e)=>({paddingBlockStart:et,paddingBlockEnd:_e||et})),paddingInline:p((et,_e)=>({paddingInlineStart:et,paddingInlineEnd:_e||et}))},h=/([\d.]+)([^]*)/,f=(et,_e)=>et.length?et.reduce((tt,rt)=>(tt.push(..._e.map(nt=>nt.includes("&")?nt.replace(/&/g,/[ +>|~]/.test(rt)&&/&.*&/.test(nt)?`:is(${rt})`:rt):rt+" "+nt)),tt),[]):_e,m=(et,_e)=>et in b&&typeof _e=="string"?_e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(tt,rt,nt,it)=>rt+(nt==="stretch"?`-moz-available${it};${d(et)}:${rt}-webkit-fill-available`:`-moz-fit-content${it};${d(et)}:${rt}fit-content`)+it):String(_e),b={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S=et=>et?et+"-":"",k=(et,_e,tt)=>et.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(rt,nt,it,st,ot)=>st=="$"==!!it?rt:(nt||st=="--"?"calc(":"")+"var(--"+(st==="$"?S(_e)+(ot.includes("$")?"":S(tt))+ot.replace(/\$/g,"-"):ot)+")"+(nt||st=="--"?"*"+(nt||"")+(it||"1")+")":"")),y=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$$1=(et,_e,tt,rt,nt)=>{let it,st,ot;const at=(lt,ut,ct)=>{let dt,ft;const pt=mt=>{for(dt in mt){const vt=dt.charCodeAt(0)===64,yt=vt&&Array.isArray(mt[dt])?mt[dt]:[mt[dt]];for(ft of yt){const bt=/[A-Z]/.test(gt=dt)?gt:gt.replace(/-[^]/g,_t=>_t[1].toUpperCase()),xt=typeof ft=="object"&&ft&&ft.toString===B&&(!rt.utils[bt]||!ut.length);if(bt in rt.utils&&!xt){const _t=rt.utils[bt];if(_t!==st){st=_t,pt(_t(ft)),st=null;continue}}else if(bt in u){const _t=u[bt];if(_t!==ot){ot=_t,pt(_t(ft)),ot=null;continue}}if(vt&&(ht=dt.slice(1)in rt.media?"@media "+rt.media[dt.slice(1)]:dt,dt=ht.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(_t,wt,Ct,kt,At,$t)=>{const Lt=h.test(wt),Mt=.0625*(Lt?-1:1),[Bt,Pt]=Lt?[kt,wt]:[wt,kt];return"("+(Ct[0]==="="?"":Ct[0]===">"===Lt?"max-":"min-")+Bt+":"+(Ct[0]!=="="&&Ct.length===1?Pt.replace(h,(Nt,It,Ft)=>Number(It)+Mt*(Ct===">"?1:-1)+Ft):Pt)+(At?") and ("+(At[0]===">"?"min-":"max-")+Bt+":"+(At.length===1?$t.replace(h,(Nt,It,Ft)=>Number(It)+Mt*(At===">"?-1:1)+Ft):$t):"")+")"})),xt){const _t=vt?ct.concat(dt):[...ct],wt=vt?[...ut]:f(ut,dt.split(y));it!==void 0&&nt(x$1(...it)),it=void 0,at(ft,wt,_t)}else it===void 0&&(it=[[],ut,ct]),dt=vt||dt.charCodeAt(0)!==36?dt:`--${S(rt.prefix)}${dt.slice(1).replace(/\$/g,"-")}`,ft=xt?ft:typeof ft=="number"?ft&&bt in I?String(ft)+"px":String(ft):k(m(bt,ft??""),rt.prefix,rt.themeMap[bt]),it[0].push(`${vt?`${dt} `:`${d(dt)}:`}${ft}`)}}var ht,gt};pt(lt),it!==void 0&&nt(x$1(...it)),it=void 0};at(et,_e,tt)},x$1=(et,_e,tt)=>`${tt.map(rt=>`${rt}{`).join("")}${_e.length?`${_e.join(",")}{`:""}${et.join(";")}${_e.length?"}":""}${Array(tt.length?tt.length+1:0).join("}")}`,I={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R=et=>String.fromCharCode(et+(et>25?39:97)),z=et=>(_e=>{let tt,rt="";for(tt=Math.abs(_e);tt>52;tt=tt/52|0)rt=R(tt%52)+rt;return R(tt%52)+rt})(((_e,tt)=>{let rt=tt.length;for(;rt;)_e=33*_e^tt.charCodeAt(--rt);return _e})(5381,JSON.stringify(et))>>>0),W=["themed","global","styled","onevar","resonevar","allvar","inline"],j=et=>{if(et.href&&!et.href.startsWith(location.origin))return!1;try{return!!et.cssRules}catch{return!1}},E=et=>{let _e;const tt=()=>{const{cssRules:nt}=_e.sheet;return[].map.call(nt,(it,st)=>{const{cssText:ot}=it;let at="";if(ot.startsWith("--sxs"))return"";if(nt[st-1]&&(at=nt[st-1].cssText).startsWith("--sxs")){if(!it.cssRules.length)return"";for(const lt in _e.rules)if(_e.rules[lt].group===it)return`--sxs{--sxs:${[..._e.rules[lt].cache].join(" ")}}${ot}`;return it.cssRules.length?`${at}${ot}`:""}return ot}).join("")},rt=()=>{if(_e){const{rules:ot,sheet:at}=_e;if(!at.deleteRule){for(;Object(Object(at.cssRules)[0]).type===3;)at.cssRules.splice(0,1);at.cssRules=[]}for(const lt in ot)delete ot[lt]}const nt=Object(et).styleSheets||[];for(const ot of nt)if(j(ot)){for(let at=0,lt=ot.cssRules;lt[at];++at){const ut=Object(lt[at]);if(ut.type!==1)continue;const ct=Object(lt[at+1]);if(ct.type!==4)continue;++at;const{cssText:dt}=ut;if(!dt.startsWith("--sxs"))continue;const ft=dt.slice(14,-3).trim().split(/\s+/),pt=W[ft[0]];pt&&(_e||(_e={sheet:ot,reset:rt,rules:{},toString:tt}),_e.rules[pt]={group:ct,index:at,cache:new Set(ft)})}if(_e)break}if(!_e){const ot=(at,lt)=>({type:lt,cssRules:[],insertRule(ut,ct){this.cssRules.splice(ct,0,ot(ut,{import:3,undefined:1}[(ut.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return at==="@media{}"?`@media{${[].map.call(this.cssRules,ut=>ut.cssText).join("")}}`:at}});_e={sheet:et?(et.head||et).appendChild(document.createElement("style")).sheet:ot("","text/css"),rules:{},reset:rt,toString:tt}}const{sheet:it,rules:st}=_e;for(let ot=W.length-1;ot>=0;--ot){const at=W[ot];if(!st[at]){const lt=W[ot+1],ut=st[lt]?st[lt].index:it.cssRules.length;it.insertRule("@media{}",ut),it.insertRule(`--sxs{--sxs:${ot}}`,ut),st[at]={group:it.cssRules[ut+1],index:ut,cache:new Set([ot])}}v(st[at])}};return rt(),_e},v=et=>{const _e=et.group;let tt=_e.cssRules.length;et.apply=rt=>{try{_e.insertRule(rt,tt),++tt}catch{}}},T=Symbol(),w=o(),M=(et,_e)=>w(et,()=>(...tt)=>{let rt={type:null,composers:new Set};for(const nt of tt)if(nt!=null)if(nt[l]){rt.type==null&&(rt.type=nt[l].type);for(const it of nt[l].composers)rt.composers.add(it)}else nt.constructor!==Object||nt.$$typeof?rt.type==null&&(rt.type=nt):rt.composers.add(C(nt,et));return rt.type==null&&(rt.type="span"),rt.composers.size||rt.composers.add(["PJLV",{},[],[],{},[]]),P(et,rt,_e)}),C=({variants:et,compoundVariants:_e,defaultVariants:tt,...rt},nt)=>{const it=`${S(nt.prefix)}c-${z(rt)}`,st=[],ot=[],at=Object.create(null),lt=[];for(const dt in tt)at[dt]=String(tt[dt]);if(typeof et=="object"&&et)for(const dt in et){ut=at,ct=dt,c.call(ut,ct)||(at[dt]="undefined");const ft=et[dt];for(const pt in ft){const mt={[dt]:String(pt)};String(pt)==="undefined"&&lt.push(dt);const ht=ft[pt],gt=[mt,ht,!a(ht)];st.push(gt)}}var ut,ct;if(typeof _e=="object"&&_e)for(const dt of _e){let{css:ft,...pt}=dt;ft=typeof ft=="object"&&ft||{};for(const ht in pt)pt[ht]=String(pt[ht]);const mt=[pt,ft,!a(ft)];ot.push(mt)}return[it,rt,st,ot,at,lt]},P=(et,_e,tt)=>{const[rt,nt,it,st]=L(_e.composers),ot=typeof _e.type=="function"||_e.type.$$typeof?(ct=>{function dt(){for(let ft=0;ft<dt[T].length;ft++){const[pt,mt]=dt[T][ft];ct.rules[pt].apply(mt)}return dt[T]=[],null}return dt[T]=[],dt.rules={},W.forEach(ft=>dt.rules[ft]={apply:pt=>dt[T].push([ft,pt])}),dt})(tt):null,at=(ot||tt).rules,lt=`.${rt}${nt.length>1?`:where(.${nt.slice(1).join(".")})`:""}`,ut=ct=>{ct=typeof ct=="object"&&ct||A;const{css:dt,...ft}=ct,pt={};for(const gt in it)if(delete ft[gt],gt in ct){let vt=ct[gt];typeof vt=="object"&&vt?pt[gt]={"@initial":it[gt],...vt}:(vt=String(vt),pt[gt]=vt!=="undefined"||st.has(gt)?vt:it[gt])}else pt[gt]=it[gt];const mt=new Set([...nt]);for(const[gt,vt,yt,bt]of _e.composers){tt.rules.styled.cache.has(gt)||(tt.rules.styled.cache.add(gt),$$1(vt,[`.${gt}`],[],et,wt=>{at.styled.apply(wt)}));const xt=O(yt,pt,et.media),_t=O(bt,pt,et.media,!0);for(const wt of xt)if(wt!==void 0)for(const[Ct,kt,At]of wt){const $t=`${gt}-${z(kt)}-${Ct}`;mt.add($t);const Lt=(At?tt.rules.resonevar:tt.rules.onevar).cache,Mt=At?at.resonevar:at.onevar;Lt.has($t)||(Lt.add($t),$$1(kt,[`.${$t}`],[],et,Bt=>{Mt.apply(Bt)}))}for(const wt of _t)if(wt!==void 0)for(const[Ct,kt]of wt){const At=`${gt}-${z(kt)}-${Ct}`;mt.add(At),tt.rules.allvar.cache.has(At)||(tt.rules.allvar.cache.add(At),$$1(kt,[`.${At}`],[],et,$t=>{at.allvar.apply($t)}))}}if(typeof dt=="object"&&dt){const gt=`${rt}-i${z(dt)}-css`;mt.add(gt),tt.rules.inline.cache.has(gt)||(tt.rules.inline.cache.add(gt),$$1(dt,[`.${gt}`],[],et,vt=>{at.inline.apply(vt)}))}for(const gt of String(ct.className||"").trim().split(/\s+/))gt&&mt.add(gt);const ht=ft.className=[...mt].join(" ");return{type:_e.type,className:ht,selector:lt,props:ft,toString:()=>ht,deferredInjector:ot}};return s(ut,{className:rt,selector:lt,[l]:_e,toString:()=>(tt.rules.styled.cache.has(rt)||ut(),rt)})},L=et=>{let _e="";const tt=[],rt={},nt=[];for(const[it,,,,st,ot]of et){_e===""&&(_e=it),tt.push(it),nt.push(...ot);for(const at in st){const lt=st[at];(rt[at]===void 0||lt!=="undefined"||ot.includes(lt))&&(rt[at]=lt)}}return[_e,tt,rt,new Set(nt)]},O=(et,_e,tt,rt)=>{const nt=[];e:for(let[it,st,ot]of et){if(ot)continue;let at,lt=0,ut=!1;for(at in it){const ct=it[at];let dt=_e[at];if(dt!==ct){if(typeof dt!="object"||!dt)continue e;{let ft,pt,mt=0;for(const ht in dt){if(ct===String(dt[ht])){if(ht!=="@initial"){const gt=ht.slice(1);(pt=pt||[]).push(gt in tt?tt[gt]:ht.replace(/^@media ?/,"")),ut=!0}lt+=mt,ft=!0}++mt}if(pt&&pt.length&&(st={["@media "+pt.join(", ")]:st}),!ft)continue e}}}(nt[lt]=nt[lt]||[]).push([rt?"cv":`${at}-${it[at]}`,st,ut])}return nt},A={},N=o(),D=(et,_e)=>N(et,()=>(...tt)=>{const rt=()=>{for(let nt of tt){nt=typeof nt=="object"&&nt||{};let it=z(nt);if(!_e.rules.global.cache.has(it)){if(_e.rules.global.cache.add(it),"@import"in nt){let st=[].indexOf.call(_e.sheet.cssRules,_e.rules.themed.group)-1;for(let ot of[].concat(nt["@import"]))ot=ot.includes('"')||ot.includes("'")?ot:`"${ot}"`,_e.sheet.insertRule(`@import ${ot};`,st++);delete nt["@import"]}$$1(nt,[],[],et,st=>{_e.rules.global.apply(st)})}}return""};return s(rt,{toString:rt})}),H=o(),V=(et,_e)=>H(et,()=>tt=>{const rt=`${S(et.prefix)}k-${z(tt)}`,nt=()=>{if(!_e.rules.global.cache.has(rt)){_e.rules.global.cache.add(rt);const it=[];$$1(tt,[],[],et,ot=>it.push(ot));const st=`@keyframes ${rt}{${it.join("")}}`;_e.rules.global.apply(st)}return rt};return s(nt,{get name(){return nt()},toString:nt})}),G=class{constructor(et,_e,tt,rt){this.token=et==null?"":String(et),this.value=_e==null?"":String(_e),this.scale=tt==null?"":String(tt),this.prefix=rt==null?"":String(rt)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S(this.prefix)+S(this.scale)+this.token}toString(){return this.computedValue}},F=o(),J=(et,_e)=>F(et,()=>(tt,rt)=>{rt=typeof tt=="object"&&tt||Object(rt);const nt=`.${tt=(tt=typeof tt=="string"?tt:"")||`${S(et.prefix)}t-${z(rt)}`}`,it={},st=[];for(const at in rt){it[at]={};for(const lt in rt[at]){const ut=`--${S(et.prefix)}${at}-${lt}`,ct=k(String(rt[at][lt]),et.prefix,at);it[at][lt]=new G(lt,ct,at,et.prefix),st.push(`${ut}:${ct}`)}}const ot=()=>{if(st.length&&!_e.rules.themed.cache.has(tt)){_e.rules.themed.cache.add(tt);const at=`${rt===et.theme?":root,":""}.${tt}{${st.join(";")}}`;_e.rules.themed.apply(at)}return tt};return{...it,get className(){return ot()},selector:nt,toString:ot}}),U=o(),X,Y=o(),q=et=>{const _e=(tt=>{let rt=!1;const nt=U(tt,it=>{rt=!0;const st="prefix"in(it=typeof it=="object"&&it||{})?String(it.prefix):"",ot=typeof it.media=="object"&&it.media||{},at=typeof it.root=="object"?it.root||null:globalThis.document||null,lt=typeof it.theme=="object"&&it.theme||{},ut={prefix:st,media:ot,theme:lt,themeMap:typeof it.themeMap=="object"&&it.themeMap||{...n},utils:typeof it.utils=="object"&&it.utils||{}},ct=E(at),dt={css:M(ut,ct),globalCss:D(ut,ct),keyframes:V(ut,ct),createTheme:J(ut,ct),reset(){ct.reset(),dt.theme.toString()},theme:{},sheet:ct,config:ut,prefix:st,getCssText:ct.toString,toString:ct.toString};return String(dt.theme=dt.createTheme(lt)),dt});return rt||nt.reset(),nt})(et);return _e.styled=(({config:tt,sheet:rt})=>Y(tt,()=>{const nt=M(tt,rt);return(...it)=>{const st=nt(...it),ot=st[l].type,at=wn.forwardRef((lt,ut)=>{const ct=lt&&lt.as||ot,{props:dt,deferredInjector:ft}=st(lt);return delete dt.as,dt.ref=ut,ft?wn.createElement(wn.Fragment,null,wn.createElement(ct,dt),wn.createElement(ft,null)):wn.createElement(ct,dt)});return at.className=st.className,at.displayName=`Styled.${ot.displayName||ot.name||ot}`,at.selector=st.selector,at.toString=()=>st.selector,at[l]=st[l],at}}))(_e),_e},K=()=>X||(X=q()),Q=(...et)=>K().createTheme(...et);const hue=209,theme={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${hue} 100% 38.2%)`,accentMuted:`hsl(${hue} 80% 61.8%)`,accentAlt:`hsl(${hue} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},media={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled,css,keyframes,createTheme}=q({theme,media}),ErrorFallbackStyled=styled("div",{display:"flex",flexDirection:"column",alignItems:"center"}),Headline=styled("p",{fontWeight:"bold",fontSize:"x-large"}),ErrorBody=styled("span",{fontSize:"medium"}),ErrorFallback=({error:et})=>{const{message:_e}=et;return y$3(ErrorFallbackStyled,{role:"alert"},y$3(Headline,{"data-testid":"headline"},"Something went wrong"),_e&&y$3(ErrorBody,null,`Error message: ${_e}`," "))},MediaWrapper=styled("div",{position:"relative",zIndex:"0"}),Content$2=styled("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),Main=styled("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),CollapsibleTrigger=styled($409067139f391064$export$41fb9f06171c75f4,{display:"none",border:"none",padding:"0",transition:"$all",opacity:"1",background:"#6663",margin:"1rem 0",borderRadius:"6px","&[data-information-panel='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",fontSize:"0.8333em",justifyContent:"center",padding:"0.5rem",fontFamily:"inherit"}}}),CollapsibleContent=styled($409067139f391064$export$7c6e2c02157bb7d2,{width:"100%",display:"flex"}),Aside=styled("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),Wrapper$4=styled("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${Content$2}`]:{flexGrow:"1"},[`& ${Main}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${MediaWrapper}`]:{display:"none"},[`& ${CollapsibleTrigger}`]:{margin:"1rem"},[`& ${CollapsibleContent}`]:{height:"100%"}}}});function $e02a7d9cb1dc128c$export$c74125a8e3af6bb2(et){const _e=et+"CollectionProvider",[tt,rt]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(_e),[nt,it]=tt(_e,{collectionRef:{current:null},itemMap:new Map}),st=ft=>{const{scope:pt,children:mt}=ft,ht=wn.useRef(null),gt=wn.useRef(new Map).current;return wn.createElement(nt,{scope:pt,itemMap:gt,collectionRef:ht},mt)},ot=et+"CollectionSlot",at=wn.forwardRef((ft,pt)=>{const{scope:mt,children:ht}=ft,gt=it(ot,mt),vt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(pt,gt.collectionRef);return wn.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{ref:vt},ht)}),lt=et+"CollectionItemSlot",ut="data-radix-collection-item",ct=wn.forwardRef((ft,pt)=>{const{scope:mt,children:ht,...gt}=ft,vt=wn.useRef(null),yt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(pt,vt),bt=it(lt,mt);return wn.useEffect(()=>(bt.itemMap.set(vt,{ref:vt,...gt}),()=>void bt.itemMap.delete(vt))),wn.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{[ut]:"",ref:yt},ht)});function dt(ft){const pt=it(et+"CollectionConsumer",ft);return wn.useCallback(()=>{const ht=pt.collectionRef.current;if(!ht)return[];const gt=Array.from(ht.querySelectorAll(`[${ut}]`));return Array.from(pt.itemMap.values()).sort((bt,xt)=>gt.indexOf(bt.ref.current)-gt.indexOf(xt.ref.current))},[pt.collectionRef,pt.itemMap])}return[{Provider:st,Slot:at,ItemSlot:ct},dt,rt]}const $f631663db3294ace$var$DirectionContext=G$3(void 0);function $f631663db3294ace$export$b39126d51d94e6f3(et){const _e=P$3($f631663db3294ace$var$DirectionContext);return et||_e||"ltr"}const $d7bdfb9eb0fdf311$var$ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",$d7bdfb9eb0fdf311$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d7bdfb9eb0fdf311$var$GROUP_NAME="RovingFocusGroup",[$d7bdfb9eb0fdf311$var$Collection,$d7bdfb9eb0fdf311$var$useCollection,$d7bdfb9eb0fdf311$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($d7bdfb9eb0fdf311$var$GROUP_NAME),[$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext,$d7bdfb9eb0fdf311$export$c7109489551a4f4]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($d7bdfb9eb0fdf311$var$GROUP_NAME,[$d7bdfb9eb0fdf311$var$createCollectionScope]),[$d7bdfb9eb0fdf311$var$RovingFocusProvider,$d7bdfb9eb0fdf311$var$useRovingFocusContext]=$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext($d7bdfb9eb0fdf311$var$GROUP_NAME),$d7bdfb9eb0fdf311$export$8699f7c8af148338=N$2((et,_e)=>y$3($d7bdfb9eb0fdf311$var$Collection.Provider,{scope:et.__scopeRovingFocusGroup},y$3($d7bdfb9eb0fdf311$var$Collection.Slot,{scope:et.__scopeRovingFocusGroup},y$3($d7bdfb9eb0fdf311$var$RovingFocusGroupImpl,_extends$1({},et,{ref:_e}))))),$d7bdfb9eb0fdf311$var$RovingFocusGroupImpl=N$2((et,_e)=>{const{__scopeRovingFocusGroup:tt,orientation:rt,loop:nt=!1,dir:it,currentTabStopId:st,defaultCurrentTabStopId:ot,onCurrentTabStopIdChange:at,onEntryFocus:lt,...ut}=et,ct=F$2(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,ct),ft=$f631663db3294ace$export$b39126d51d94e6f3(it),[pt=null,mt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:st,defaultProp:ot,onChange:at}),[ht,gt]=p$2(!1),vt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(lt),yt=$d7bdfb9eb0fdf311$var$useCollection(tt),bt=F$2(!1),[xt,_t]=p$2(0);return _(()=>{const wt=ct.current;if(wt)return wt.addEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,vt),()=>wt.removeEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,vt)},[vt]),y$3($d7bdfb9eb0fdf311$var$RovingFocusProvider,{scope:tt,orientation:rt,dir:ft,loop:nt,currentTabStopId:pt,onItemFocus:x$3(wt=>mt(wt),[mt]),onItemShiftTab:x$3(()=>gt(!0),[]),onFocusableItemAdd:x$3(()=>_t(wt=>wt+1),[]),onFocusableItemRemove:x$3(()=>_t(wt=>wt-1),[])},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:ht||xt===0?-1:0,"data-orientation":rt},ut,{ref:dt,style:{outline:"none",...et.style},onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onMouseDown,()=>{bt.current=!0}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onFocus,wt=>{const Ct=!bt.current;if(wt.target===wt.currentTarget&&Ct&&!ht){const kt=new CustomEvent($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,$d7bdfb9eb0fdf311$var$EVENT_OPTIONS);if(wt.currentTarget.dispatchEvent(kt),!kt.defaultPrevented){const At=yt().filter(Pt=>Pt.focusable),$t=At.find(Pt=>Pt.active),Lt=At.find(Pt=>Pt.id===pt),Bt=[$t,Lt,...At].filter(Boolean).map(Pt=>Pt.ref.current);$d7bdfb9eb0fdf311$var$focusFirst(Bt)}}bt.current=!1}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onBlur,()=>gt(!1))})))}),$d7bdfb9eb0fdf311$var$ITEM_NAME="RovingFocusGroupItem",$d7bdfb9eb0fdf311$export$ab9df7c53fe8454=N$2((et,_e)=>{const{__scopeRovingFocusGroup:tt,focusable:rt=!0,active:nt=!1,tabStopId:it,...st}=et,ot=$1746a345f3d73bb7$export$f680877a34711e37(),at=it||ot,lt=$d7bdfb9eb0fdf311$var$useRovingFocusContext($d7bdfb9eb0fdf311$var$ITEM_NAME,tt),ut=lt.currentTabStopId===at,ct=$d7bdfb9eb0fdf311$var$useCollection(tt),{onFocusableItemAdd:dt,onFocusableItemRemove:ft}=lt;return _(()=>{if(rt)return dt(),()=>ft()},[rt,dt,ft]),y$3($d7bdfb9eb0fdf311$var$Collection.ItemSlot,{scope:tt,id:at,focusable:rt,active:nt},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({tabIndex:ut?0:-1,"data-orientation":lt.orientation},st,{ref:_e,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onMouseDown,pt=>{rt?lt.onItemFocus(at):pt.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onFocus,()=>lt.onItemFocus(at)),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onKeyDown,pt=>{if(pt.key==="Tab"&&pt.shiftKey){lt.onItemShiftTab();return}if(pt.target!==pt.currentTarget)return;const mt=$d7bdfb9eb0fdf311$var$getFocusIntent(pt,lt.orientation,lt.dir);if(mt!==void 0){pt.preventDefault();let gt=ct().filter(vt=>vt.focusable).map(vt=>vt.ref.current);if(mt==="last")gt.reverse();else if(mt==="prev"||mt==="next"){mt==="prev"&&gt.reverse();const vt=gt.indexOf(pt.currentTarget);gt=lt.loop?$d7bdfb9eb0fdf311$var$wrapArray(gt,vt+1):gt.slice(vt+1)}setTimeout(()=>$d7bdfb9eb0fdf311$var$focusFirst(gt))}})})))}),$d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $d7bdfb9eb0fdf311$var$getDirectionAwareKey(et,_e){return _e!=="rtl"?et:et==="ArrowLeft"?"ArrowRight":et==="ArrowRight"?"ArrowLeft":et}function $d7bdfb9eb0fdf311$var$getFocusIntent(et,_e,tt){const rt=$d7bdfb9eb0fdf311$var$getDirectionAwareKey(et.key,tt);if(!(_e==="vertical"&&["ArrowLeft","ArrowRight"].includes(rt))&&!(_e==="horizontal"&&["ArrowUp","ArrowDown"].includes(rt)))return $d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT[rt]}function $d7bdfb9eb0fdf311$var$focusFirst(et){const _e=document.activeElement;for(const tt of et)if(tt===_e||(tt.focus(),document.activeElement!==_e))return}function $d7bdfb9eb0fdf311$var$wrapArray(et,_e){return et.map((tt,rt)=>et[(_e+rt)%et.length])}const $d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9=$d7bdfb9eb0fdf311$export$8699f7c8af148338,$d7bdfb9eb0fdf311$export$6d08773d2e66f8f2=$d7bdfb9eb0fdf311$export$ab9df7c53fe8454,$69cb30bb0017df05$var$TABS_NAME="Tabs",[$69cb30bb0017df05$var$createTabsContext,$69cb30bb0017df05$export$355f5bd209d7b13a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($69cb30bb0017df05$var$TABS_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4]),$69cb30bb0017df05$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),[$69cb30bb0017df05$var$TabsProvider,$69cb30bb0017df05$var$useTabsContext]=$69cb30bb0017df05$var$createTabsContext($69cb30bb0017df05$var$TABS_NAME),$69cb30bb0017df05$export$b2539bed5023c21c=N$2((et,_e)=>{const{__scopeTabs:tt,value:rt,onValueChange:nt,defaultValue:it,orientation:st="horizontal",dir:ot,activationMode:at="automatic",...lt}=et,ut=$f631663db3294ace$export$b39126d51d94e6f3(ot),[ct,dt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:rt,onChange:nt,defaultProp:it});return y$3($69cb30bb0017df05$var$TabsProvider,{scope:tt,baseId:$1746a345f3d73bb7$export$f680877a34711e37(),value:ct,onValueChange:dt,orientation:st,dir:ut,activationMode:at},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({dir:ut,"data-orientation":st},lt,{ref:_e})))}),$69cb30bb0017df05$var$TAB_LIST_NAME="TabsList",$69cb30bb0017df05$export$9712d22edc0d78c1=N$2((et,_e)=>{const{__scopeTabs:tt,loop:rt=!0,...nt}=et,it=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TAB_LIST_NAME,tt),st=$69cb30bb0017df05$var$useRovingFocusGroupScope(tt);return y$3($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},st,{orientation:it.orientation,dir:it.dir,loop:rt}),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"tablist","aria-orientation":it.orientation},nt,{ref:_e})))}),$69cb30bb0017df05$var$TRIGGER_NAME="TabsTrigger",$69cb30bb0017df05$export$8114b9fdfdf9f3ba=N$2((et,_e)=>{const{__scopeTabs:tt,value:rt,disabled:nt=!1,...it}=et,st=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TRIGGER_NAME,tt),ot=$69cb30bb0017df05$var$useRovingFocusGroupScope(tt),at=$69cb30bb0017df05$var$makeTriggerId(st.baseId,rt),lt=$69cb30bb0017df05$var$makeContentId(st.baseId,rt),ut=rt===st.value;return y$3($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},ot,{focusable:!nt,active:ut}),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"tab","aria-selected":ut,"aria-controls":lt,"data-state":ut?"active":"inactive","data-disabled":nt?"":void 0,disabled:nt,id:at},it,{ref:_e,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onMouseDown,ct=>{!nt&&ct.button===0&&ct.ctrlKey===!1?st.onValueChange(rt):ct.preventDefault()}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onKeyDown,ct=>{[" ","Enter"].includes(ct.key)&&st.onValueChange(rt)}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onFocus,()=>{const ct=st.activationMode!=="manual";!ut&&!nt&&ct&&st.onValueChange(rt)})})))}),$69cb30bb0017df05$var$CONTENT_NAME="TabsContent",$69cb30bb0017df05$export$bd905d70e8fd2ebb=N$2((et,_e)=>{const{__scopeTabs:tt,value:rt,forceMount:nt,children:it,...st}=et,ot=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$CONTENT_NAME,tt),at=$69cb30bb0017df05$var$makeTriggerId(ot.baseId,rt),lt=$69cb30bb0017df05$var$makeContentId(ot.baseId,rt),ut=rt===ot.value,ct=F$2(ut);return _(()=>{const dt=requestAnimationFrame(()=>ct.current=!1);return()=>cancelAnimationFrame(dt)},[]),y$3($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:nt||ut},({present:dt})=>y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":ut?"active":"inactive","data-orientation":ot.orientation,role:"tabpanel","aria-labelledby":at,hidden:!dt,id:lt,tabIndex:0},st,{ref:_e,style:{...et.style,animationDuration:ct.current?"0s":void 0}}),dt&&it))});function $69cb30bb0017df05$var$makeTriggerId(et,_e){return`${et}-trigger-${_e}`}function $69cb30bb0017df05$var$makeContentId(et,_e){return`${et}-content-${_e}`}const $69cb30bb0017df05$export$be92b6f5f03c0fe9=$69cb30bb0017df05$export$b2539bed5023c21c,$69cb30bb0017df05$export$54c2e3dc7acea9f5=$69cb30bb0017df05$export$9712d22edc0d78c1,$69cb30bb0017df05$export$41fb9f06171c75f4=$69cb30bb0017df05$export$8114b9fdfdf9f3ba,$69cb30bb0017df05$export$7c6e2c02157bb7d2=$69cb30bb0017df05$export$bd905d70e8fd2ebb,Wrapper$3=styled($69cb30bb0017df05$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% - 2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),List=styled($69cb30bb0017df05$export$54c2e3dc7acea9f5,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid #6663","@sm":{margin:"0 1rem"}}),Trigger$1=styled($69cb30bb0017df05$export$41fb9f06171c75f4,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),Content$1=styled($69cb30bb0017df05$export$7c6e2c02157bb7d2,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),Scroll=styled("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),annotationItemRow={position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"inherit",border:"none",background:"none"},ButtonStyled=styled("button",{textAlign:"left","&:hover":{color:"$accent"}}),Group$2=styled("div",{display:"flex",flexDirection:"column",width:"100%"}),Item$3=styled("div",{...annotationItemRow}),ItemHTMLWrapper=styled("div",{"&:hover":{color:"$accent"}}),AnnotationItemPlainText=({value:et,handleClick:_e})=>y$3(ButtonStyled,{onClick:_e},et),AnnotationItemHTML=({value:et,handleClick:_e})=>y$3(ItemHTMLWrapper,{dangerouslySetInnerHTML:{__html:et},onClick:_e});let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let et=0;et<256;++et)byteToHex.push((et+256).toString(16).slice(1));function unsafeStringify(et,_e=0){return byteToHex[et[_e+0]]+byteToHex[et[_e+1]]+byteToHex[et[_e+2]]+byteToHex[et[_e+3]]+"-"+byteToHex[et[_e+4]]+byteToHex[et[_e+5]]+"-"+byteToHex[et[_e+6]]+byteToHex[et[_e+7]]+"-"+byteToHex[et[_e+8]]+byteToHex[et[_e+9]]+"-"+byteToHex[et[_e+10]]+byteToHex[et[_e+11]]+byteToHex[et[_e+12]]+byteToHex[et[_e+13]]+byteToHex[et[_e+14]]+byteToHex[et[_e+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(et,_e,tt){if(native.randomUUID&&!_e&&!et)return native.randomUUID();et=et||{};const rt=et.random||(et.rng||rng)();if(rt[6]=rt[6]&15|64,rt[8]=rt[8]&63|128,_e){tt=tt||0;for(let nt=0;nt<16;++nt)_e[tt+nt]=rt[nt];return _e}return unsafeStringify(rt)}const useWebVtt=()=>{function et(nt){return nt.map(it=>{const st=it.identifier||v4();return{...it,identifier:st}})}function _e(nt){var at;const it=[],st=[],ot=et(nt);for(const lt of ot){for(;st.length>0&&st[st.length-1].end<=lt.start;)st.pop();st.length>0?(st[st.length-1].children||(st[st.length-1].children=[]),(at=st[st.length-1].children)==null||at.push(lt),st.push(lt)):(it.push(lt),st.push(lt))}return it}function tt(nt,it=[]){return it.some(st=>nt.start>=st.start&&nt.end<=st.end)}function rt(nt=[]){return nt.sort((it,st)=>it.start-st.start)}return{addIdentifiersToParsedCues:et,createNestedCues:_e,isChild:tt,orderCuesByTime:rt}};function $db6c3485150b8e66$export$1ab7ae714698c4b8(et){const[_e,tt]=p$2(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(et){tt({width:et.offsetWidth,height:et.offsetHeight});const rt=new ResizeObserver(nt=>{if(!Array.isArray(nt)||!nt.length)return;const it=nt[0];let st,ot;if("borderBoxSize"in it){const at=it.borderBoxSize,lt=Array.isArray(at)?at[0]:at;st=lt.inlineSize,ot=lt.blockSize}else st=et.offsetWidth,ot=et.offsetHeight;tt({width:st,height:ot})});return rt.observe(et,{box:"border-box"}),()=>rt.unobserve(et)}else tt(void 0)},[et]),_e}function $010c2913dbd2fe3d$export$5cae361ad82dce8b(et){const _e=F$2({value:et,previous:et});return q$2(()=>(_e.current.value!==et&&(_e.current.previous=_e.current.value,_e.current.value=et),_e.current.previous),[et])}const $ce77a8961b41be9e$var$RADIO_NAME="Radio",[$ce77a8961b41be9e$var$createRadioContext,$ce77a8961b41be9e$export$67d2296460f1b002]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($ce77a8961b41be9e$var$RADIO_NAME),[$ce77a8961b41be9e$var$RadioProvider,$ce77a8961b41be9e$var$useRadioContext]=$ce77a8961b41be9e$var$createRadioContext($ce77a8961b41be9e$var$RADIO_NAME),$ce77a8961b41be9e$export$d7b12c4107be0d61=N$2((et,_e)=>{const{__scopeRadio:tt,name:rt,checked:nt=!1,required:it,disabled:st,value:ot="on",onCheck:at,...lt}=et,[ut,ct]=p$2(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,mt=>ct(mt)),ft=F$2(!1),pt=ut?!!ut.closest("form"):!0;return y$3($ce77a8961b41be9e$var$RadioProvider,{scope:tt,checked:nt,disabled:st},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"radio","aria-checked":nt,"data-state":$ce77a8961b41be9e$var$getState(nt),"data-disabled":st?"":void 0,disabled:st,value:ot},lt,{ref:dt,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onClick,mt=>{nt||at==null||at(),pt&&(ft.current=mt.isPropagationStopped(),ft.current||mt.stopPropagation())})})),pt&&y$3($ce77a8961b41be9e$var$BubbleInput,{control:ut,bubbles:!ft.current,name:rt,value:ot,checked:nt,required:it,disabled:st,style:{transform:"translateX(-100%)"}}))}),$ce77a8961b41be9e$var$BubbleInput=et=>{const{control:_e,checked:tt,bubbles:rt=!0,...nt}=et,it=F$2(null),st=$010c2913dbd2fe3d$export$5cae361ad82dce8b(tt),ot=$db6c3485150b8e66$export$1ab7ae714698c4b8(_e);return _(()=>{const at=it.current,lt=window.HTMLInputElement.prototype,ct=Object.getOwnPropertyDescriptor(lt,"checked").set;if(st!==tt&&ct){const dt=new Event("click",{bubbles:rt});ct.call(at,tt),at.dispatchEvent(dt)}},[st,tt,rt]),y$3("input",_extends$1({type:"radio","aria-hidden":!0,defaultChecked:tt},nt,{tabIndex:-1,ref:it,style:{...et.style,...ot,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $ce77a8961b41be9e$var$getState(et){return et?"checked":"unchecked"}const $f99a8c78507165f7$var$ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$f99a8c78507165f7$var$RADIO_GROUP_NAME="RadioGroup",[$f99a8c78507165f7$var$createRadioGroupContext,$f99a8c78507165f7$export$c547093f11b76da2]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($f99a8c78507165f7$var$RADIO_GROUP_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4,$ce77a8961b41be9e$export$67d2296460f1b002]),$f99a8c78507165f7$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),$f99a8c78507165f7$var$useRadioScope=$ce77a8961b41be9e$export$67d2296460f1b002(),[$f99a8c78507165f7$var$RadioGroupProvider,$f99a8c78507165f7$var$useRadioGroupContext]=$f99a8c78507165f7$var$createRadioGroupContext($f99a8c78507165f7$var$RADIO_GROUP_NAME),$f99a8c78507165f7$export$a98f0dcb43a68a25=N$2((et,_e)=>{const{__scopeRadioGroup:tt,name:rt,defaultValue:nt,value:it,required:st=!1,disabled:ot=!1,orientation:at,dir:lt,loop:ut=!0,onValueChange:ct,...dt}=et,ft=$f99a8c78507165f7$var$useRovingFocusGroupScope(tt),pt=$f631663db3294ace$export$b39126d51d94e6f3(lt),[mt,ht]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:it,defaultProp:nt,onChange:ct});return y$3($f99a8c78507165f7$var$RadioGroupProvider,{scope:tt,name:rt,required:st,disabled:ot,value:mt,onValueChange:ht},y$3($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},ft,{orientation:at,dir:pt,loop:ut}),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"radiogroup","aria-required":st,"aria-orientation":at,"data-disabled":ot?"":void 0,dir:pt},dt,{ref:_e}))))}),$f99a8c78507165f7$var$ITEM_NAME="RadioGroupItem",$f99a8c78507165f7$export$9f866c100ef519e4=N$2((et,_e)=>{const{__scopeRadioGroup:tt,disabled:rt,...nt}=et,it=$f99a8c78507165f7$var$useRadioGroupContext($f99a8c78507165f7$var$ITEM_NAME,tt),st=it.disabled||rt,ot=$f99a8c78507165f7$var$useRovingFocusGroupScope(tt),at=$f99a8c78507165f7$var$useRadioScope(tt),lt=F$2(null),ut=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,lt),ct=it.value===nt.value,dt=F$2(!1);return _(()=>{const ft=mt=>{$f99a8c78507165f7$var$ARROW_KEYS.includes(mt.key)&&(dt.current=!0)},pt=()=>dt.current=!1;return document.addEventListener("keydown",ft),document.addEventListener("keyup",pt),()=>{document.removeEventListener("keydown",ft),document.removeEventListener("keyup",pt)}},[]),y$3($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},ot,{focusable:!st,active:ct}),y$3($ce77a8961b41be9e$export$d7b12c4107be0d61,_extends$1({disabled:st,required:it.required,checked:ct},at,nt,{name:it.name,ref:ut,onCheck:()=>it.onValueChange(nt.value),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ft=>{ft.key==="Enter"&&ft.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onFocus,()=>{var ft;dt.current&&((ft=lt.current)===null||ft===void 0||ft.click())})})))}),$f99a8c78507165f7$export$be92b6f5f03c0fe9=$f99a8c78507165f7$export$a98f0dcb43a68a25,$f99a8c78507165f7$export$6d08773d2e66f8f2=$f99a8c78507165f7$export$9f866c100ef519e4,spin=keyframes({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),Group$1=styled($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%"}),Item$2=styled($f99a8c78507165f7$export$6d08773d2e66f8f2,{...annotationItemRow,"@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{backgroundColor:"#6663","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:spin,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:spin,boxSizing:"content-box","@sm":{content:"unset"}}}}),Cue=({label:et,start:_e,end:tt})=>{const[rt,nt]=p$2(!1),it=document.getElementById("clover-iiif-video");return _(()=>(it==null||it.addEventListener("timeupdate",()=>{const{currentTime:ot}=it;nt(_e<=ot&&ot<tt)}),()=>document.removeEventListener("timeupdate",()=>{})),[tt,_e,it]),y$3(Item$2,{"aria-checked":rt,"data-testid":"information-panel-cue",onClick:()=>{it&&(it.pause(),it.currentTime=_e,it.play())},value:et},et,y$3("strong",null,convertTime(_e)))},MenuStyled=styled("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${Item$2}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),Menu=({items:et})=>y$3(MenuStyled,null,et.map(_e=>{const{text:tt,start:rt,end:nt,children:it,identifier:st}=_e;return y$3("li",{key:st},y$3(Cue,{label:tt,start:rt,end:nt}),it&&y$3(Menu,{items:it}))}));function ParserError(et,_e){this.message=et,this.error=_e}ParserError.prototype=Object.create(Error.prototype);const TIMESTAMP_REGEXP=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function parse$8(et,_e){_e||(_e={});const{meta:tt=!1,strict:rt=!0}=_e;if(typeof et!="string")throw new ParserError("Input must be a string");et=et.trim(),et=et.replace(/\r\n/g,`
`),et=et.replace(/\r/g,`
`);const nt=et.split(`

`),it=nt.shift();if(!it.startsWith("WEBVTT"))throw new ParserError('Must start with "WEBVTT"');const st=it.split(`
`),ot=st[0].replace("WEBVTT","");if(ot.length>0&&ot[0]!==" "&&ot[0]!=="	")throw new ParserError("Header comment must start with space or tab");if(nt.length===0&&st.length===1)return{valid:!0,strict:rt,cues:[],errors:[]};if(!tt&&st.length>1&&st[1]!=="")throw new ParserError("Missing blank line after signature");const{cues:at,errors:lt}=parseCues(nt,rt);if(rt&&lt.length>0)throw lt[0];const ut=tt?parseMeta(st):null,ct={valid:lt.length===0,strict:rt,cues:at,errors:lt};return tt&&(ct.meta=ut),ct}function parseMeta(et){const _e={};return et.slice(1).forEach(tt=>{const rt=tt.indexOf(":"),nt=tt.slice(0,rt).trim(),it=tt.slice(rt+1).trim();_e[nt]=it}),Object.keys(_e).length>0?_e:null}function parseCues(et,_e){const tt=[];return{cues:et.map((nt,it)=>{try{return parseCue$1(nt,it,_e)}catch(st){return tt.push(st),null}}).filter(Boolean),errors:tt}}function parseCue$1(et,_e,tt){let rt="",nt=0,it=.01,st="",ot="";const at=et.split(`
`).filter(Boolean);if(at.length>0&&at[0].trim().startsWith("NOTE"))return null;if(at.length===1&&!at[0].includes("-->"))throw new ParserError(`Cue identifier cannot be standalone (cue #${_e})`);if(at.length>1&&!(at[0].includes("-->")||at[1].includes("-->"))){const ut=`Cue identifier needs to be followed by timestamp (cue #${_e})`;throw new ParserError(ut)}at.length>1&&at[1].includes("-->")&&(rt=at.shift());const lt=typeof at[0]=="string"&&at[0].split(" --> ");if(lt.length!==2||!validTimestamp(lt[0])||!validTimestamp(lt[1]))throw new ParserError(`Invalid cue timestamp (cue #${_e})`);if(nt=parseTimestamp(lt[0]),it=parseTimestamp(lt[1]),tt){if(nt>it)throw new ParserError(`Start timestamp greater than end (cue #${_e})`);if(it<=nt)throw new ParserError(`End must be greater than start (cue #${_e})`)}if(!tt&&it<nt)throw new ParserError(`End must be greater or equal to start when not strict (cue #${_e})`);return ot=lt[1].replace(TIMESTAMP_REGEXP,"").trim(),at.shift(),st=at.join(`
`),st?{identifier:rt,start:nt,end:it,text:st,styles:ot}:!1}function validTimestamp(et){return TIMESTAMP_REGEXP.test(et)}function parseTimestamp(et){const _e=et.match(TIMESTAMP_REGEXP);let tt=parseFloat(_e[1]||0)*60*60;return tt+=parseFloat(_e[2])*60,tt+=parseFloat(_e[3]),tt}var parser$1={ParserError,parse:parse$8};function CompilerError(et,_e){this.message=et,this.error=_e}CompilerError.prototype=Object.create(Error.prototype);function compile$1(et){if(!et)throw new CompilerError("Input must be non-null");if(typeof et!="object")throw new CompilerError("Input must be an object");if(Array.isArray(et))throw new CompilerError("Input cannot be array");if(!et.valid)throw new CompilerError("Input must be valid");let _e=`WEBVTT
`;if(et.meta){if(typeof et.meta!="object"||Array.isArray(et.meta))throw new CompilerError("Metadata must be an object");Object.entries(et.meta).forEach(rt=>{if(typeof rt[1]!="string")throw new CompilerError(`Metadata value for "${rt[0]}" must be string`);_e+=`${rt[0]}: ${rt[1]}
`})}let tt=null;return et.cues.forEach((rt,nt)=>{if(tt&&tt>rt.start)throw new CompilerError(`Cue number ${nt} is not in chronological order`);tt=rt.start,_e+=`
`,_e+=compileCue(rt),_e+=`
`}),_e}function compileCue(et){if(typeof et!="object")throw new CompilerError("Cue malformed: not of type object");if(typeof et.identifier!="string"&&typeof et.identifier!="number"&&et.identifier!==null)throw new CompilerError(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(et)}`);if(isNaN(et.start))throw new CompilerError(`Cue malformed: null start value.
    ${JSON.stringify(et)}`);if(isNaN(et.end))throw new CompilerError(`Cue malformed: null end value.
    ${JSON.stringify(et)}`);if(et.start>=et.end)throw new CompilerError(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(et)}`);if(typeof et.text!="string")throw new CompilerError(`Cue malformed: null text value.
    ${JSON.stringify(et)}`);if(typeof et.styles!="string")throw new CompilerError(`Cue malformed: null styles value.
    ${JSON.stringify(et)}`);let _e="";et.identifier.length>0&&(_e+=`${et.identifier}
`);const tt=convertTimestamp(et.start),rt=convertTimestamp(et.end);return _e+=`${tt} --> ${rt}`,_e+=et.styles?` ${et.styles}`:"",_e+=`
${et.text}`,_e}function convertTimestamp(et){const _e=pad$1(calculateHours(et),2),tt=pad$1(calculateMinutes(et),2),rt=pad$1(calculateSeconds(et),2),nt=pad$1(calculateMs(et),3);return`${_e}:${tt}:${rt}.${nt}`}function pad$1(et,_e){let tt=`${et}`;for(;tt.length<_e;)tt=`0${tt}`;return tt}function calculateHours(et){return Math.floor(et/60/60)}function calculateMinutes(et){return Math.floor(et/60)%60}function calculateSeconds(et){return Math.floor(et%60)}function calculateMs(et){return Math.floor((et%1).toFixed(4)*1e3)}var compiler={CompilerError,compile:compile$1};const parse$7=parser$1.parse;function segment$2(et,_e){_e=_e||10;const tt=parse$7(et),rt=[];let nt=[],it=null,st=0,ot=0;return tt.cues.forEach((at,lt)=>{const ut=lt===0,ct=lt===tt.cues.length-1,dt=at.start,ft=at.end,pt=ct?1/0:tt.cues[lt+1].start,mt=ut?ft:ft-dt,ht=ut?0:dt-tt.cues[lt-1].end;st=st+mt+ht,`${lt}`,rt.length+1,it&&(nt.push(it),st+=it.end-ot,it=null),nt.push(at);let gt=pt-ft<_e&&ht<_e&&st>_e;if(shouldSegment(ot,_e,pt,ht)){const vt=segmentDuration(ct,ft,_e,st,ot);rt.push({duration:vt,cues:nt}),ot+=vt,st=0,nt=[]}else gt=!1;gt&&(it=at)}),rt}function shouldSegment(et,_e,tt,rt){const nt=alignToSegmentLength(rt,_e);return(rt<=_e||nt+et<tt)&&tt-et>=_e}function segmentDuration(et,_e,tt,rt,nt){let it=tt;return rt>tt&&(it=alignToSegmentLength(rt-tt,tt)),et?it=parseFloat((_e-nt).toFixed(2)):it=Math.round(it),it}function alignToSegmentLength(et,_e){return et+=_e-et%_e,et}function debug(et){}var segmenter={segment:segment$2};const segment$1=segmenter.segment;function hlsSegment(et,_e,tt){typeof tt>"u"&&(tt="900000");const rt=segment$1(et,_e),nt=[];return rt.forEach((it,st)=>{const ot=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${tt},LOCAL:00:00:00.000

${printableCues(it.cues)}
`,at=generateSegmentFilename(st);nt.push({filename:at,content:ot})}),nt}function hlsSegmentPlaylist(et,_e){const tt=segment$1(et,_e),rt=printableSegments(tt);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(findLongestSegment(tt))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${rt}
#EXT-X-ENDLIST
`}function pad(et,_e){return`${"0".repeat(Math.max(0,_e-et.toString().length))}${et}`}function generateSegmentFilename(et){return`${et}.vtt`}function printableSegments(et){const _e=[];return et.forEach((tt,rt)=>{_e.push(`#EXTINF:${tt.duration.toFixed(5)},
${generateSegmentFilename(rt)}`)}),_e.join(`
`)}function findLongestSegment(et){let _e=0;return et.forEach(tt=>{tt.duration>_e&&(_e=tt.duration)}),_e}function printableCues(et){const _e=[];return et.forEach(tt=>{_e.push(printableCue(tt))}),_e.join(`

`)}function printableCue(et){const _e=[];et.identifier&&_e.push(et.identifier);const tt=printableTimestamp(et.start),rt=printableTimestamp(et.end),nt=et.styles?`${et.styles}`:"";return _e.push(`${tt} --> ${rt} ${nt}`),_e.push(et.text),_e.join(`
`)}function printableTimestamp(et){const _e=(et%1).toFixed(3);et=Math.round(et-_e);const tt=Math.floor(et/3600),rt=Math.floor((et-tt*3600)/60),nt=et-tt*3600-rt*60;return`${`${pad(tt,2)}:`}${pad(rt,2)}:${pad(nt,2)}.${pad(_e*1e3,3)}`}var hls$1={hlsSegment,hlsSegmentPlaylist};const parse$6=parser$1.parse,compile=compiler.compile,segment=segmenter.segment,hls=hls$1;var nodeWebvtt={parse:parse$6,compile,segment,hls};const AnnotationItemVTT=({label:et,vttUri:_e})=>{const[tt,rt]=wn.useState([]),{createNestedCues:nt,orderCuesByTime:it}=useWebVtt(),[st,ot]=wn.useState();return _(()=>{_e&&fetch(_e,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(at=>at.text()).then(at=>{const lt=nodeWebvtt.parse(at).cues,ut=it(lt),ct=nt(ut);rt(ct)}).catch(at=>{console.error(_e,at.toString()),ot(at)})},[_e]),y$3(Group$1,{"data-testid":"annotation-item-vtt","aria-label":`navigate ${getLabel(et,"en")}`},st&&y$3("div",{"data-testid":"error-message"},"Network Error: ",st.toString()),y$3(Menu,{items:tt}))},parseAnnotationTarget=et=>{var tt,rt;let _e={id:typeof et=="string"?et:et.source};if(typeof et=="string"){if(et.includes("#xywh=")){const nt=et.split("#xywh=");if(nt&&nt[1]){const[it,st,ot,at]=nt[1].split(",").map(lt=>Number(lt));_e={id:nt[0],rect:{x:it,y:st,w:ot,h:at}}}}else if(et.includes("#t=")){const nt=et.split("#t=");nt&&nt[1]&&(_e={id:nt[0],t:nt[1]})}}else typeof et=="object"&&(((tt=et.selector)==null?void 0:tt.type)==="PointSelector"?_e={id:et.source,point:{x:et.selector.x,y:et.selector.y}}:((rt=et.selector)==null?void 0:rt.type)==="SvgSelector"&&(_e={id:et.source,svg:et.selector.value}));return _e};var openseadragon={exports:{}};(function(module){//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(et){return new OpenSeadragon.Viewer(et)}(function(et){et.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var _e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},tt=Object.prototype.toString,rt=Object.prototype.hasOwnProperty;et.isFunction=function(nt){return et.type(nt)==="function"},et.isArray=Array.isArray||function(nt){return et.type(nt)==="array"},et.isWindow=function(nt){return nt&&typeof nt=="object"&&"setInterval"in nt},et.type=function(nt){return nt==null?String(nt):_e[tt.call(nt)]||"object"},et.isPlainObject=function(nt){if(!nt||OpenSeadragon.type(nt)!=="object"||nt.nodeType||et.isWindow(nt)||nt.constructor&&!rt.call(nt,"constructor")&&!rt.call(nt.constructor.prototype,"isPrototypeOf"))return!1;var it;for(var st in nt)it=st;return it===void 0||rt.call(nt,it)},et.isEmptyObject=function(nt){for(var it in nt)return!1;return!0},et.freezeObject=function(nt){return Object.freeze?et.freezeObject=Object.freeze:et.freezeObject=function(it){return it},et.freezeObject(nt)},et.supportsCanvas=function(){var nt=document.createElement("canvas");return!!(et.isFunction(nt.getContext)&&nt.getContext("2d"))}(),et.isCanvasTainted=function(nt){var it=!1;try{nt.getContext("2d").getImageData(0,0,1,1)}catch{it=!0}return it},et.pixelDensityRatio=function(){if(et.supportsCanvas){var nt=document.createElement("canvas").getContext("2d"),it=window.devicePixelRatio||1,st=nt.webkitBackingStorePixelRatio||nt.mozBackingStorePixelRatio||nt.msBackingStorePixelRatio||nt.oBackingStorePixelRatio||nt.backingStorePixelRatio||1;return Math.max(it,1)/st}else return 1}()})(OpenSeadragon),function($){$.extend=function(){var et,_e,tt,rt,nt,it,st=arguments[0]||{},ot=arguments.length,at=!1,lt=1;for(typeof st=="boolean"&&(at=st,st=arguments[1]||{},lt=2),typeof st!="object"&&!OpenSeadragon.isFunction(st)&&(st={}),ot===lt&&(st=this,--lt);lt<ot;lt++)if(et=arguments[lt],et!==null||et!==void 0)for(_e in et)tt=st[_e],rt=et[_e],st!==rt&&(at&&rt&&(OpenSeadragon.isPlainObject(rt)||(nt=OpenSeadragon.isArray(rt)))?(nt?(nt=!1,it=tt&&OpenSeadragon.isArray(tt)?tt:[]):it=tt&&OpenSeadragon.isPlainObject(tt)?tt:{},st[_e]=OpenSeadragon.extend(at,it,rt)):rt!==void 0&&(st[_e]=rt));return st};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var et=navigator.userAgent;return typeof et!="string"?!1:et.indexOf("iPhone")!==-1||et.indexOf("iPad")!==-1||et.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(et,_e){return function(){var tt=arguments;return tt===void 0&&(tt=[]),_e.apply(et,tt)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(et){return typeof et=="string"&&(et=document.getElementById(et)),et},getElementPosition:function(et){var _e=new $.Point,tt,rt;for(et=$.getElement(et),tt=$.getElementStyle(et).position=="fixed",rt=getOffsetParent(et,tt);rt;)_e.x+=et.offsetLeft,_e.y+=et.offsetTop,tt&&(_e=_e.plus($.getPageScroll())),et=rt,tt=$.getElementStyle(et).position=="fixed",rt=getOffsetParent(et,tt);return _e},getElementOffset:function(et){et=$.getElement(et);var _e=et&&et.ownerDocument,tt,rt,nt={top:0,left:0};return _e?(tt=_e.documentElement,typeof et.getBoundingClientRect<"u"&&(nt=et.getBoundingClientRect()),rt=_e==_e.window?_e:_e.nodeType===9?_e.defaultView||_e.parentWindow:!1,new $.Point(nt.left+(rt.pageXOffset||tt.scrollLeft)-(tt.clientLeft||0),nt.top+(rt.pageYOffset||tt.scrollTop)-(tt.clientTop||0))):new $.Point},getElementSize:function(et){return et=$.getElement(et),new $.Point(et.clientWidth,et.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(et){return et=$.getElement(et),et.currentStyle}:function(et){return et=$.getElement(et),window.getComputedStyle(et,"")},getCssPropertyWithVendorPrefix:function(et){var _e={};return $.getCssPropertyWithVendorPrefix=function(tt){if(_e[tt]!==void 0)return _e[tt];var rt=document.createElement("div").style,nt=null;if(rt[tt]!==void 0)nt=tt;else for(var it=["Webkit","Moz","MS","O","webkit","moz","ms","o"],st=$.capitalizeFirstLetter(tt),ot=0;ot<it.length;ot++){var at=it[ot]+st;if(rt[at]!==void 0){nt=at;break}}return _e[tt]=nt,nt},$.getCssPropertyWithVendorPrefix(et)},capitalizeFirstLetter:function(et){return et.charAt(0).toUpperCase()+et.slice(1)},positiveModulo:function(et,_e){var tt=et%_e;return tt<0&&(tt+=_e),tt},pointInElement:function(et,_e){et=$.getElement(et);var tt=$.getElementOffset(et),rt=$.getElementSize(et);return _e.x>=tt.x&&_e.x<tt.x+rt.x&&_e.y<tt.y+rt.y&&_e.y>=tt.y},getEvent:function(et){return et?$.getEvent=function(_e){return _e}:$.getEvent=function(){return window.event},$.getEvent(et)},getMousePosition:function(et){if(typeof et.pageX=="number")$.getMousePosition=function(_e){var tt=new $.Point;return _e=$.getEvent(_e),tt.x=_e.pageX,tt.y=_e.pageY,tt};else if(typeof et.clientX=="number")$.getMousePosition=function(_e){var tt=new $.Point;return _e=$.getEvent(_e),tt.x=_e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,tt.y=_e.clientY+document.body.scrollTop+document.documentElement.scrollTop,tt};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(et)},getPageScroll:function(){var et=document.documentElement||{},_e=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(_e.scrollLeft||_e.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(et.scrollLeft||et.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(et){if(typeof window.scrollTo<"u")$.setPageScroll=function(rt){window.scrollTo(rt.x,rt.y)};else{var _e=$.getPageScroll();if(_e.x===et.x&&_e.y===et.y)return;document.body.scrollLeft=et.x,document.body.scrollTop=et.y;var tt=$.getPageScroll();if(tt.x!==_e.x&&tt.y!==_e.y){$.setPageScroll=function(rt){document.body.scrollLeft=rt.x,document.body.scrollTop=rt.y};return}if(document.documentElement.scrollLeft=et.x,document.documentElement.scrollTop=et.y,tt=$.getPageScroll(),tt.x!==_e.x&&tt.y!==_e.y){$.setPageScroll=function(rt){document.documentElement.scrollLeft=rt.x,document.documentElement.scrollTop=rt.y};return}$.setPageScroll=function(rt){}}return $.setPageScroll(et)},getWindowSize:function(){var et=document.documentElement||{},_e=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(et.clientWidth||et.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(_e.clientWidth||_e.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(et){et=$.getElement(et);var _e=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(_e[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(_e[1].style,{display:"table-row"}),$.extend(_e[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),_e[0].appendChild(_e[1]),_e[1].appendChild(_e[2]),_e[2].appendChild(et),_e[0]},makeNeutralElement:function(et){var _e=document.createElement(et),tt=_e.style;return tt.background="transparent none",tt.border="none",tt.margin="0px",tt.padding="0px",tt.position="static",_e},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(et){return $.makeTransparentImage=function(_e){var tt=$.makeNeutralElement("img");return tt.src=_e,tt},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(_e){var tt=$.makeNeutralElement("img"),rt=null;return rt=$.makeNeutralElement("span"),rt.style.display="inline-block",tt.onload=function(){rt.style.width=rt.style.width||tt.width+"px",rt.style.height=rt.style.height||tt.height+"px",tt.onload=null,tt=null},tt.src=_e,rt.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+_e+"', sizingMethod='scale')",rt}),$.makeTransparentImage(et)},setElementOpacity:function(et,_e,tt){var rt,nt;et=$.getElement(et),tt&&!$.Browser.alpha&&(_e=Math.round(_e)),$.Browser.opacity?et.style.opacity=_e<1?_e:"":_e<1?(rt=Math.round(100*_e),nt="alpha(opacity="+rt+")",et.style.filter=nt):et.style.filter=""},setElementTouchActionNone:function(et){et=$.getElement(et),typeof et.style.touchAction<"u"?et.style.touchAction="none":typeof et.style.msTouchAction<"u"&&(et.style.msTouchAction="none")},addClass:function(et,_e){et=$.getElement(et),et.className?(" "+et.className+" ").indexOf(" "+_e+" ")===-1&&(et.className+=" "+_e):et.className=_e},indexOf:function(et,_e,tt){return Array.prototype.indexOf?this.indexOf=function(rt,nt,it){return rt.indexOf(nt,it)}:this.indexOf=function(rt,nt,it){var st,ot=it||0,at;if(!rt)throw new TypeError;if(at=rt.length,at===0||ot>=at)return-1;for(ot<0&&(ot=at-Math.abs(ot)),st=ot;st<at;st++)if(rt[st]===nt)return st;return-1},this.indexOf(et,_e,tt)},removeClass:function(et,_e){var tt,rt=[],nt;for(et=$.getElement(et),tt=et.className.split(/\s+/),nt=0;nt<tt.length;nt++)tt[nt]&&tt[nt]!==_e&&rt.push(tt[nt]);et.className=rt.join(" ")},addEvent:function(){if(window.addEventListener)return function(et,_e,tt,rt){et=$.getElement(et),et.addEventListener(_e,tt,rt)};if(window.attachEvent)return function(et,_e,tt,rt){et=$.getElement(et),et.attachEvent("on"+_e,tt)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(et,_e,tt,rt){et=$.getElement(et),et.removeEventListener(_e,tt,rt)};if(window.detachEvent)return function(et,_e,tt,rt){et=$.getElement(et),et.detachEvent("on"+_e,tt)};throw new Error("No known event model.")}(),cancelEvent:function(et){et=$.getEvent(et),et.preventDefault?$.cancelEvent=function(_e){_e.preventDefault()}:$.cancelEvent=function(_e){_e=$.getEvent(_e),_e.cancel=!0,_e.returnValue=!1},$.cancelEvent(et)},stopEvent:function(et){et=$.getEvent(et),et.stopPropagation?$.stopEvent=function(_e){_e.stopPropagation()}:$.stopEvent=function(_e){_e=$.getEvent(_e),_e.cancelBubble=!0},$.stopEvent(et)},createCallback:function(et,_e){var tt=[],rt;for(rt=2;rt<arguments.length;rt++)tt.push(arguments[rt]);return function(){var nt=tt.concat([]),it;for(it=0;it<arguments.length;it++)nt.push(arguments[it]);return _e.apply(et,nt)}},getUrlParameter:function(et){var _e=URLPARAMS[et];return _e||null},getUrlProtocol:function(et){var _e=et.match(/^([a-z]+:)\/\//i);return _e===null?window.location.protocol:_e[1].toLowerCase()},createAjaxRequest:function(et){var _e;try{_e=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{_e=!1}if(_e)window.XMLHttpRequest?$.createAjaxRequest=function(tt){return tt?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(et)},makeAjaxRequest:function(et,_e,tt){var rt,nt,it;$.isPlainObject(et)&&(_e=et.success,tt=et.error,rt=et.withCredentials,nt=et.headers,it=et.responseType||null,et=et.url);var st=$.getUrlProtocol(et),ot=$.createAjaxRequest(st==="file:");if(!$.isFunction(_e))throw new Error("makeAjaxRequest requires a success callback");ot.onreadystatechange=function(){ot.readyState==4&&(ot.onreadystatechange=function(){},ot.status>=200&&ot.status<300||ot.status===0&&st!=="http:"&&st!=="https:"?_e(ot):($.console.log("AJAX request returned %d: %s",ot.status,et),$.isFunction(tt)&&tt(ot)))};try{if(ot.open("GET",et,!0),it&&(ot.responseType=it),nt)for(var at in nt)Object.prototype.hasOwnProperty.call(nt,at)&&nt[at]&&ot.setRequestHeader(at,nt[at]);rt&&(ot.withCredentials=!0),ot.send(null)}catch(dt){var lt=dt.message,ut=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(ut&&typeof dt.number<"u"&&dt.number==-2147024891&&(lt+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",dt.name,lt),ot.onreadystatechange=function(){},window.XDomainRequest){var ct=new window.XDomainRequest;if(ct){ct.onload=function(ft){$.isFunction(_e)&&_e({responseText:ct.responseText,status:200,statusText:"OK"})},ct.onerror=function(ft){$.isFunction(tt)&&tt({responseText:ct.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{ct.open("GET",et),ct.send()}catch{$.isFunction(tt)&&tt(ot,dt)}}}else $.isFunction(tt)&&tt(ot,dt)}return ot},jsonp:function(et){var _e,tt=et.url,rt=document.head||document.getElementsByTagName("head")[0]||document.documentElement,nt=et.callbackName||"openseadragon"+$.now(),it=window[nt],st="$1"+nt+"$2",ot=et.param||"callback",at=et.callback;tt=tt.replace(/(\=)\?(&|$)|\?\?/i,st),tt+=(/\?/.test(tt)?"&":"?")+ot+"="+nt,window[nt]=function(lt){if(it)window[nt]=it;else try{delete window[nt]}catch{}at&&$.isFunction(at)&&at(lt)},_e=document.createElement("script"),(et.async!==void 0||et.async!==!1)&&(_e.async="async"),et.scriptCharset&&(_e.charset=et.scriptCharset),_e.src=tt,_e.onload=_e.onreadystatechange=function(lt,ut){(ut||!_e.readyState||/loaded|complete/.test(_e.readyState))&&(_e.onload=_e.onreadystatechange=null,rt&&_e.parentNode&&rt.removeChild(_e),_e=void 0)},rt.insertBefore(_e,rt.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(et){if(window.DOMParser)$.parseXml=function(_e){var tt=null,rt;return rt=new DOMParser,tt=rt.parseFromString(_e,"text/xml"),tt};else if(window.ActiveXObject)$.parseXml=function(_e){var tt=null;return tt=new ActiveXObject("Microsoft.XMLDOM"),tt.async=!1,tt.loadXML(_e),tt};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(et)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(et){return et=et||"",!!FILEFORMATS[et.toLowerCase()]}});var nullfunction=function(et){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var et=navigator.appVersion,_e=navigator.userAgent,tt;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(_e.substring(_e.indexOf("MSIE")+5,_e.indexOf(";",_e.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(_e.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(_e.substring(_e.indexOf("Firefox")+8))):_e.indexOf("Safari")>=0?($.Browser.vendor=_e.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(_e.substring(_e.substring(0,_e.indexOf("Safari")).lastIndexOf("/")+1,_e.indexOf("Safari")))):(tt=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),tt.exec(_e)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(et);break}var rt=window.location.search.substring(1),nt=rt.split("&"),it,st,ot;for(ot=0;ot<nt.length;ot++)if(it=nt[ot],st=it.indexOf("="),st>0){var at=it.substring(0,st),lt=it.substring(st+1);try{URLPARAMS[at]=decodeURIComponent(lt)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",at,lt)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(et){var _e=et.requestAnimationFrame||et.mozRequestAnimationFrame||et.webkitRequestAnimationFrame||et.msRequestAnimationFrame,tt=et.cancelAnimationFrame||et.mozCancelAnimationFrame||et.webkitCancelAnimationFrame||et.msCancelAnimationFrame;if(_e&&tt)$.requestAnimationFrame=function(){return _e.apply(et,arguments)},$.cancelAnimationFrame=function(){return tt.apply(et,arguments)};else{var rt=[],nt=[],it=0,st;$.requestAnimationFrame=function(ot){return rt.push([++it,ot]),st||(st=setInterval(function(){if(rt.length){var at=$.now(),lt=nt;for(nt=rt,rt=lt;nt.length;)nt.shift()[1](at)}else clearInterval(st),st=void 0},1e3/50)),it},$.cancelAnimationFrame=function(ot){var at,lt;for(at=0,lt=rt.length;at<lt;at+=1)if(rt[at][0]===ot){rt.splice(at,1);return}for(at=0,lt=nt.length;at<lt;at+=1)if(nt[at][0]===ot){nt.splice(at,1);return}}}}(window);function getOffsetParent(et,_e){return _e&&et!=document.body?document.body:et.offsetParent}}(OpenSeadragon),function(et,_e){module.exports?module.exports=_e():et.OpenSeadragon=_e()}(commonjsGlobal,function(){return OpenSeadragon}),function(et){var _e={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(_e.supportsFullScreen=!0,_e.getFullScreenElement=function(){return document.fullscreenElement},_e.requestFullScreen=function(tt){return tt.requestFullscreen()},_e.exitFullScreen=function(){document.exitFullscreen()},_e.fullScreenEventName="fullscreenchange",_e.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(_e.supportsFullScreen=!0,_e.getFullScreenElement=function(){return document.msFullscreenElement},_e.requestFullScreen=function(tt){return tt.msRequestFullscreen()},_e.exitFullScreen=function(){document.msExitFullscreen()},_e.fullScreenEventName="MSFullscreenChange",_e.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(_e.supportsFullScreen=!0,_e.getFullScreenElement=function(){return document.webkitFullscreenElement},_e.requestFullScreen=function(tt){return tt.webkitRequestFullscreen()},_e.exitFullScreen=function(){document.webkitExitFullscreen()},_e.fullScreenEventName="webkitfullscreenchange",_e.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(_e.supportsFullScreen=!0,_e.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},_e.requestFullScreen=function(tt){return tt.webkitRequestFullScreen()},_e.exitFullScreen=function(){document.webkitCancelFullScreen()},_e.fullScreenEventName="webkitfullscreenchange",_e.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(_e.supportsFullScreen=!0,_e.getFullScreenElement=function(){return document.mozFullScreenElement},_e.requestFullScreen=function(tt){return tt.mozRequestFullScreen()},_e.exitFullScreen=function(){document.mozCancelFullScreen()},_e.fullScreenEventName="mozfullscreenchange",_e.fullScreenErrorEventName="mozfullscreenerror"),_e.isFullScreen=function(){return _e.getFullScreenElement()!==null},_e.cancelFullScreen=function(){et.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),_e.exitFullScreen()},et.extend(et,_e)}(OpenSeadragon),function(et){et.EventSource=function(){this.events={}},et.EventSource.prototype={addOnceHandler:function(_e,tt,rt,nt){var it=this;nt=nt||1;var st=0,ot=function(at){st++,st===nt&&it.removeHandler(_e,ot),tt(at)};this.addHandler(_e,ot,rt)},addHandler:function(_e,tt,rt){var nt=this.events[_e];nt||(this.events[_e]=nt=[]),tt&&et.isFunction(tt)&&(nt[nt.length]={handler:tt,userData:rt||null})},removeHandler:function(_e,tt){var rt=this.events[_e],nt=[],it;if(rt&&et.isArray(rt)){for(it=0;it<rt.length;it++)rt[it].handler!==tt&&nt.push(rt[it]);this.events[_e]=nt}},removeAllHandlers:function(_e){if(_e)this.events[_e]=[];else for(var tt in this.events)this.events[tt]=[]},getHandler:function(_e){var tt=this.events[_e];return!tt||!tt.length?null:(tt=tt.length===1?[tt[0]]:Array.apply(null,tt),function(rt,nt){var it,st=tt.length;for(it=0;it<st;it++)tt[it]&&(nt.eventSource=rt,nt.userData=tt[it].userData,tt[it].handler(nt))})},raiseEvent:function(_e,tt){var rt=this.getHandler(_e);rt&&(tt||(tt={}),rt(this,tt))}}}(OpenSeadragon),function(et){var _e=[],tt={};et.MouseTracker=function(Tt){_e.push(this);var St=arguments;et.isPlainObject(Tt)||(Tt={element:St[0],clickTimeThreshold:St[1],clickDistThreshold:St[2]}),this.hash=Math.random(),this.element=et.getElement(Tt.element),this.clickTimeThreshold=Tt.clickTimeThreshold||et.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=Tt.clickDistThreshold||et.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=Tt.dblClickTimeThreshold||et.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=Tt.dblClickDistThreshold||et.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=Tt.userData||null,this.stopDelay=Tt.stopDelay||50,this.enterHandler=Tt.enterHandler||null,this.exitHandler=Tt.exitHandler||null,this.pressHandler=Tt.pressHandler||null,this.nonPrimaryPressHandler=Tt.nonPrimaryPressHandler||null,this.releaseHandler=Tt.releaseHandler||null,this.nonPrimaryReleaseHandler=Tt.nonPrimaryReleaseHandler||null,this.moveHandler=Tt.moveHandler||null,this.scrollHandler=Tt.scrollHandler||null,this.clickHandler=Tt.clickHandler||null,this.dblClickHandler=Tt.dblClickHandler||null,this.dragHandler=Tt.dragHandler||null,this.dragEndHandler=Tt.dragEndHandler||null,this.pinchHandler=Tt.pinchHandler||null,this.stopHandler=Tt.stopHandler||null,this.keyDownHandler=Tt.keyDownHandler||null,this.keyUpHandler=Tt.keyUpHandler||null,this.keyHandler=Tt.keyHandler||null,this.focusHandler=Tt.focusHandler||null,this.blurHandler=Tt.blurHandler||null;var Dt=this;tt[this.hash]={click:function(Ot){pt(Dt,Ot)},dblclick:function(Ot){mt(Dt,Ot)},keydown:function(Ot){ht(Dt,Ot)},keyup:function(Ot){gt(Dt,Ot)},keypress:function(Ot){vt(Dt,Ot)},focus:function(Ot){yt(Dt,Ot)},blur:function(Ot){bt(Dt,Ot)},wheel:function(Ot){xt(Dt,Ot)},mousewheel:function(Ot){_t(Dt,Ot)},DOMMouseScroll:function(Ot){_t(Dt,Ot)},MozMousePixelScroll:function(Ot){_t(Dt,Ot)},mouseenter:function(Ot){kt(Dt,Ot)},mouseleave:function(Ot){Lt(Dt,Ot)},mouseover:function(Ot){At(Dt,Ot)},mouseout:function(Ot){Mt(Dt,Ot)},mousedown:function(Ot){Nt(Dt,Ot)},mouseup:function(Ot){It(Dt,Ot)},mouseupcaptured:function(Ot){Ft(Dt,Ot)},mousemove:function(Ot){Ht(Dt,Ot)},mousemovecaptured:function(Ot){jt(Dt,Ot)},touchstart:function(Ot){Yt(Dt,Ot)},touchend:function(Ot){Jt(Dt,Ot)},touchendcaptured:function(Ot){rr(Dt,Ot)},touchmove:function(Ot){nr(Dt,Ot)},touchmovecaptured:function(Ot){vr(Dt,Ot)},touchcancel:function(Ot){hr(Dt,Ot)},gesturestart:function(Ot){pr(Dt,Ot)},gesturechange:function(Ot){Et(Dt,Ot)},pointerover:function(Ot){Rt(Dt,Ot)},MSPointerOver:function(Ot){Rt(Dt,Ot)},pointerout:function(Ot){Vt(Dt,Ot)},MSPointerOut:function(Ot){Vt(Dt,Ot)},pointerdown:function(Ot){zt(Dt,Ot)},MSPointerDown:function(Ot){zt(Dt,Ot)},pointerup:function(Ot){Wt(Dt,Ot)},MSPointerUp:function(Ot){Wt(Dt,Ot)},pointermove:function(Ot){mr(Dt,Ot)},MSPointerMove:function(Ot){mr(Dt,Ot)},pointercancel:function(Ot){sr(Dt,Ot)},MSPointerCancel:function(Ot){sr(Dt,Ot)},pointerupcaptured:function(Ot){ar(Dt,Ot)},pointermovecaptured:function(Ot){gr(Dt,Ot)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},Tt.startDisabled||this.setTracking(!0)},et.MouseTracker.prototype={destroy:function(){var Tt;for(it(this),this.element=null,Tt=0;Tt<_e.length;Tt++)if(_e[Tt]===this){_e.splice(Tt,1);break}tt[this.hash]=null,delete tt[this.hash]},isTracking:function(){return tt[this.hash].tracking},setTracking:function(Tt){return Tt?nt(this):it(this),this},getActivePointersListsExceptType:function(Tt){for(var St=tt[this.hash],Dt=[],Ot=0;Ot<St.activePointersLists.length;++Ot)St.activePointersLists[Ot].type!==Tt&&Dt.push(St.activePointersLists[Ot]);return Dt},getActivePointersListByType:function(Tt){var St=tt[this.hash],Dt,Ot=St.activePointersLists.length,Kt;for(Dt=0;Dt<Ot;Dt++)if(St.activePointersLists[Dt].type===Tt)return St.activePointersLists[Dt];return Kt=new et.MouseTracker.GesturePointList(Tt),St.activePointersLists.push(Kt),Kt},getActivePointerCount:function(){var Tt=tt[this.hash],St,Dt=Tt.activePointersLists.length,Ot=0;for(St=0;St<Dt;St++)Ot+=Tt.activePointersLists[St].getLength();return Ot},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},et.MouseTracker.resetAllMouseTrackers=function(){for(var Tt=0;Tt<_e.length;Tt++)_e[Tt].isTracking()&&(_e[Tt].setTracking(!1),_e[Tt].setTracking(!0))},et.MouseTracker.gesturePointVelocityTracker=function(){var Tt=[],St=0,Dt=0,Ot=function(Xt,ir){return Xt.hash.toString()+ir.type+ir.id.toString()},Kt=function(){var Xt,ir=Tt.length,lr,ur,yr=et.now(),or,_r,$r;for(or=yr-Dt,Dt=yr,Xt=0;Xt<ir;Xt++)lr=Tt[Xt],ur=lr.gPoint,ur.direction=Math.atan2(ur.currentPos.y-lr.lastPos.y,ur.currentPos.x-lr.lastPos.x),_r=lr.lastPos.distanceTo(ur.currentPos),lr.lastPos=ur.currentPos,$r=1e3*_r/(or+1),ur.speed=.75*$r+.25*ur.speed},er=function(Xt,ir){var lr=Ot(Xt,ir);Tt.push({guid:lr,gPoint:ir,lastPos:ir.currentPos}),Tt.length===1&&(Dt=et.now(),St=window.setInterval(Kt,50))},Zt=function(Xt,ir){var lr=Ot(Xt,ir),ur,yr=Tt.length;for(ur=0;ur<yr;ur++)if(Tt[ur].guid===lr){Tt.splice(ur,1),yr--,yr===0&&window.clearInterval(St);break}};return{addPoint:er,removePoint:Zt}}(),et.MouseTracker.captureElement=document,et.MouseTracker.wheelEventName=et.Browser.vendor==et.BROWSERS.IE&&et.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",et.MouseTracker.supportsMouseCapture=function(){var Tt=document.createElement("div");return et.isFunction(Tt.setCapture)&&et.isFunction(Tt.releaseCapture)}(),et.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",et.MouseTracker.wheelEventName],et.MouseTracker.wheelEventName=="DOMMouseScroll"&&et.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||et.Browser.vendor!==et.BROWSERS.IE)?(et.MouseTracker.havePointerEvents=!0,et.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),et.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?et.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:et.MouseTracker.maxTouchPoints=0,et.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(et.MouseTracker.havePointerEvents=!0,et.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),et.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?et.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:et.MouseTracker.maxTouchPoints=0,et.MouseTracker.haveMouseEnter=!1):(et.MouseTracker.havePointerEvents=!1,et.Browser.vendor===et.BROWSERS.IE&&et.Browser.version<9?(et.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),et.MouseTracker.haveMouseEnter=!0):(et.MouseTracker.subscribeEvents.push("mouseover","mouseout"),et.MouseTracker.haveMouseEnter=!1),et.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&et.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&et.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),et.MouseTracker.mousePointerId="legacy-mouse",et.MouseTracker.maxTouchPoints=10),et.MouseTracker.GesturePointList=function(Tt){this._gPoints=[],this.type=Tt,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},et.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(Tt){return this._gPoints.push(Tt)},removeById:function(Tt){var St,Dt=this._gPoints.length;for(St=0;St<Dt;St++)if(this._gPoints[St].id===Tt){this._gPoints.splice(St,1);break}return this._gPoints.length},getByIndex:function(Tt){return Tt<this._gPoints.length?this._gPoints[Tt]:null},getById:function(Tt){var St,Dt=this._gPoints.length;for(St=0;St<Dt;St++)if(this._gPoints[St].id===Tt)return this._gPoints[St];return null},getPrimary:function(Tt){var St,Dt=this._gPoints.length;for(St=0;St<Dt;St++)if(this._gPoints[St].isPrimary)return this._gPoints[St];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function rt(Tt){var St=tt[Tt.hash],Dt,Ot=St.activePointersLists.length;for(Dt=0;Dt<Ot;Dt++)St.activePointersLists[Dt].captureCount>0&&(et.removeEvent(et.MouseTracker.captureElement,"mousemove",St.mousemovecaptured,!0),et.removeEvent(et.MouseTracker.captureElement,"mouseup",St.mouseupcaptured,!0),et.removeEvent(et.MouseTracker.captureElement,et.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",St.pointermovecaptured,!0),et.removeEvent(et.MouseTracker.captureElement,et.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",St.pointerupcaptured,!0),et.removeEvent(et.MouseTracker.captureElement,"touchmove",St.touchmovecaptured,!0),et.removeEvent(et.MouseTracker.captureElement,"touchend",St.touchendcaptured,!0),St.activePointersLists[Dt].captureCount=0);for(Dt=0;Dt<Ot;Dt++)St.activePointersLists.pop()}function nt(Tt){var St=tt[Tt.hash],Dt,Ot;if(!St.tracking){for(Ot=0;Ot<et.MouseTracker.subscribeEvents.length;Ot++)Dt=et.MouseTracker.subscribeEvents[Ot],et.addEvent(Tt.element,Dt,St[Dt],!1);rt(Tt),St.tracking=!0}}function it(Tt){var St=tt[Tt.hash],Dt,Ot;if(St.tracking){for(Ot=0;Ot<et.MouseTracker.subscribeEvents.length;Ot++)Dt=et.MouseTracker.subscribeEvents[Ot],et.removeEvent(Tt.element,Dt,St[Dt],!1);rt(Tt),St.tracking=!1}}function st(Tt,St){var Dt=tt[Tt.hash];if(St==="pointerevent")return{upName:et.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:Dt.pointerupcaptured,moveName:et.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:Dt.pointermovecaptured};if(St==="mouse")return{upName:"mouseup",upHandler:Dt.mouseupcaptured,moveName:"mousemove",moveHandler:Dt.mousemovecaptured};if(St==="touch")return{upName:"touchend",upHandler:Dt.touchendcaptured,moveName:"touchmove",moveHandler:Dt.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function ot(Tt,St,Dt){var Ot=Tt.getActivePointersListByType(St),Kt;Ot.captureCount+=Dt||1,Ot.captureCount===1&&(et.Browser.vendor===et.BROWSERS.IE&&et.Browser.version<9?Tt.element.setCapture(!0):(Kt=st(Tt,et.MouseTracker.havePointerEvents?"pointerevent":St),Pr&&Ir(window.top)&&et.addEvent(window.top,Kt.upName,Kt.upHandler,!0),et.addEvent(et.MouseTracker.captureElement,Kt.upName,Kt.upHandler,!0),et.addEvent(et.MouseTracker.captureElement,Kt.moveName,Kt.moveHandler,!0)))}function at(Tt,St,Dt){var Ot=Tt.getActivePointersListByType(St),Kt;Ot.captureCount-=Dt||1,Ot.captureCount===0&&(et.Browser.vendor===et.BROWSERS.IE&&et.Browser.version<9?Tt.element.releaseCapture():(Kt=st(Tt,et.MouseTracker.havePointerEvents?"pointerevent":St),Pr&&Ir(window.top)&&et.removeEvent(window.top,Kt.upName,Kt.upHandler,!0),et.removeEvent(et.MouseTracker.captureElement,Kt.moveName,Kt.moveHandler,!0),et.removeEvent(et.MouseTracker.captureElement,Kt.upName,Kt.upHandler,!0)))}function lt(Tt){var St;if(et.MouseTracker.unprefixedPointerEvents)St=Tt.pointerType;else switch(Tt.pointerType){case 2:St="touch";break;case 3:St="pen";break;case 4:St="mouse";break;default:St=""}return St}function ut(Tt){return et.getMousePosition(Tt)}function ct(Tt,St){return dt(ut(Tt),St)}function dt(Tt,St){var Dt=et.getElementOffset(St);return Tt.minus(Dt)}function ft(Tt,St){return new et.Point((Tt.x+St.x)/2,(Tt.y+St.y)/2)}function pt(Tt,St){Tt.clickHandler&&et.cancelEvent(St)}function mt(Tt,St){Tt.dblClickHandler&&et.cancelEvent(St)}function ht(Tt,St){var Dt;Tt.keyDownHandler&&(St=et.getEvent(St),Dt=Tt.keyDownHandler({eventSource:Tt,keyCode:St.keyCode?St.keyCode:St.charCode,ctrl:St.ctrlKey,shift:St.shiftKey,alt:St.altKey,meta:St.metaKey,originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Dt||et.cancelEvent(St))}function gt(Tt,St){var Dt;Tt.keyUpHandler&&(St=et.getEvent(St),Dt=Tt.keyUpHandler({eventSource:Tt,keyCode:St.keyCode?St.keyCode:St.charCode,ctrl:St.ctrlKey,shift:St.shiftKey,alt:St.altKey,meta:St.metaKey,originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Dt||et.cancelEvent(St))}function vt(Tt,St){var Dt;Tt.keyHandler&&(St=et.getEvent(St),Dt=Tt.keyHandler({eventSource:Tt,keyCode:St.keyCode?St.keyCode:St.charCode,ctrl:St.ctrlKey,shift:St.shiftKey,alt:St.altKey,meta:St.metaKey,originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Dt||et.cancelEvent(St))}function yt(Tt,St){var Dt;Tt.focusHandler&&(St=et.getEvent(St),Dt=Tt.focusHandler({eventSource:Tt,originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Dt===!1&&et.cancelEvent(St))}function bt(Tt,St){var Dt;Tt.blurHandler&&(St=et.getEvent(St),Dt=Tt.blurHandler({eventSource:Tt,originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Dt===!1&&et.cancelEvent(St))}function xt(Tt,St){wt(Tt,St,St)}function _t(Tt,St){St=et.getEvent(St);var Dt={target:St.target||St.srcElement,type:"wheel",shiftKey:St.shiftKey||!1,clientX:St.clientX,clientY:St.clientY,pageX:St.pageX?St.pageX:St.clientX,pageY:St.pageY?St.pageY:St.clientY,deltaMode:St.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};et.MouseTracker.wheelEventName=="mousewheel"?Dt.deltaY=-St.wheelDelta/et.DEFAULT_SETTINGS.pixelsPerWheelLine:Dt.deltaY=St.detail,wt(Tt,Dt,St)}function wt(Tt,St,Dt){var Ot=0,Kt;Ot=St.deltaY<0?1:-1,Tt.scrollHandler&&(Kt=Tt.scrollHandler({eventSource:Tt,pointerType:"mouse",position:ct(St,Tt.element),scroll:Ot,shift:St.shiftKey,isTouchEvent:!1,originalEvent:Dt,preventDefaultAction:!1,userData:Tt.userData}),Kt===!1&&et.cancelEvent(Dt))}function Ct(Tt,St){if(Tt===St)return!1;for(;St&&St!==Tt;)St=St.parentNode;return St===Tt}function kt(Tt,St){St=et.getEvent(St),$t(Tt,St)}function At(Tt,St){St=et.getEvent(St),!(St.currentTarget===St.relatedTarget||Ct(St.currentTarget,St.relatedTarget))&&$t(Tt,St)}function $t(Tt,St){var Dt={id:et.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:ut(St),currentTime:et.now()};Er(Tt,St,[Dt])}function Lt(Tt,St){St=et.getEvent(St),Bt(Tt,St)}function Mt(Tt,St){St=et.getEvent(St),!(St.currentTarget===St.relatedTarget||Ct(St.currentTarget,St.relatedTarget))&&Bt(Tt,St)}function Bt(Tt,St){var Dt={id:et.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:ut(St),currentTime:et.now()};xr(Tt,St,[Dt])}function Pt(Tt){return et.Browser.vendor===et.BROWSERS.IE&&et.Browser.version<9?Tt===1?0:Tt===2?2:Tt===4?1:-1:Tt}function Nt(Tt,St){var Dt;St=et.getEvent(St),Dt={id:et.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:ut(St),currentTime:et.now()},Cr(Tt,St,[Dt],Pt(St.button))&&(et.stopEvent(St),ot(Tt,"mouse")),(Tt.clickHandler||Tt.dblClickHandler||Tt.pressHandler||Tt.dragHandler||Tt.dragEndHandler)&&et.cancelEvent(St)}function It(Tt,St){Ut(Tt,St)}function Ft(Tt,St){Ut(Tt,St),et.stopEvent(St)}function Ut(Tt,St){var Dt;St=et.getEvent(St),Dt={id:et.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:ut(St),currentTime:et.now()},wr(Tt,St,[Dt],Pt(St.button))&&at(Tt,"mouse")}function Ht(Tt,St){Gt(Tt,St)}function jt(Tt,St){Gt(Tt,St),et.stopEvent(St)}function Gt(Tt,St){var Dt;St=et.getEvent(St),Dt={id:et.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:ut(St),currentTime:et.now()},Ar(Tt,St,[Dt])}function tr(Tt,St,Dt){var Ot,Kt=Dt.getLength(),er=[];if(Dt.type==="touch"||Dt.contacts>0){for(Ot=0;Ot<Kt;Ot++)er.push(Dt.getByIndex(Ot));er.length>0&&(wr(Tt,St,er,0),Dt.captureCount=1,at(Tt,Dt.type),xr(Tt,St,er))}}function Yt(Tt,St){var Dt,Ot,Kt,er=St.changedTouches.length,Zt=[],Xt,ir=Tt.getActivePointersListByType("touch");for(Dt=et.now(),ir.getLength()>St.touches.length-er&&(et.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),tr(Tt,St,ir)),Ot=0;Ot<er;Ot++)Zt.push({id:St.changedTouches[Ot].identifier,type:"touch",currentPos:ut(St.changedTouches[Ot]),currentTime:Dt});for(Er(Tt,St,Zt),Ot=0;Ot<_e.length;Ot++)if(_e[Ot]!==Tt&&_e[Ot].isTracking()&&Ct(_e[Ot].element,Tt.element)){for(Xt=[],Kt=0;Kt<er;Kt++)Xt.push({id:St.changedTouches[Kt].identifier,type:"touch",currentPos:ut(St.changedTouches[Kt]),currentTime:Dt});Er(_e[Ot],St,Xt)}Cr(Tt,St,Zt,0)&&(et.stopEvent(St),ot(Tt,"touch",er)),et.cancelEvent(St)}function Jt(Tt,St){qt(Tt,St)}function rr(Tt,St){qt(Tt,St),et.stopEvent(St)}function qt(Tt,St){var Dt,Ot,Kt,er=St.changedTouches.length,Zt=[],Xt;for(Dt=et.now(),Ot=0;Ot<er;Ot++)Zt.push({id:St.changedTouches[Ot].identifier,type:"touch",currentPos:ut(St.changedTouches[Ot]),currentTime:Dt});for(wr(Tt,St,Zt,0)&&at(Tt,"touch",er),xr(Tt,St,Zt),Ot=0;Ot<_e.length;Ot++)if(_e[Ot]!==Tt&&_e[Ot].isTracking()&&Ct(_e[Ot].element,Tt.element)){for(Xt=[],Kt=0;Kt<er;Kt++)Xt.push({id:St.changedTouches[Kt].identifier,type:"touch",currentPos:ut(St.changedTouches[Kt]),currentTime:Dt});xr(_e[Ot],St,Xt)}et.cancelEvent(St)}function nr(Tt,St){fr(Tt,St)}function vr(Tt,St){fr(Tt,St),et.stopEvent(St)}function fr(Tt,St){var Dt,Ot=St.changedTouches.length,Kt=[];for(Dt=0;Dt<Ot;Dt++)Kt.push({id:St.changedTouches[Dt].identifier,type:"touch",currentPos:ut(St.changedTouches[Dt]),currentTime:et.now()});Ar(Tt,St,Kt),et.cancelEvent(St)}function hr(Tt,St){var Dt=Tt.getActivePointersListByType("touch");tr(Tt,St,Dt)}function pr(Tt,St){return St.stopPropagation(),St.preventDefault(),!1}function Et(Tt,St){return St.stopPropagation(),St.preventDefault(),!1}function Rt(Tt,St){var Dt;St.currentTarget===St.relatedTarget||Ct(St.currentTarget,St.relatedTarget)||(Dt={id:St.pointerId,type:lt(St),isPrimary:St.isPrimary,currentPos:ut(St),currentTime:et.now()},Er(Tt,St,[Dt]))}function Vt(Tt,St){var Dt;St.currentTarget===St.relatedTarget||Ct(St.currentTarget,St.relatedTarget)||(Dt={id:St.pointerId,type:lt(St),isPrimary:St.isPrimary,currentPos:ut(St),currentTime:et.now()},xr(Tt,St,[Dt]))}function zt(Tt,St){var Dt;Dt={id:St.pointerId,type:lt(St),isPrimary:St.isPrimary,currentPos:ut(St),currentTime:et.now()},Cr(Tt,St,[Dt],St.button)&&(et.stopEvent(St),ot(Tt,Dt.type)),(Tt.clickHandler||Tt.dblClickHandler||Tt.pressHandler||Tt.dragHandler||Tt.dragEndHandler||Tt.pinchHandler)&&et.cancelEvent(St)}function Wt(Tt,St){Qt(Tt,St)}function ar(Tt,St){var Dt=Tt.getActivePointersListByType(lt(St));Dt.getById(St.pointerId)&&Qt(Tt,St),et.stopEvent(St)}function Qt(Tt,St){var Dt;Dt={id:St.pointerId,type:lt(St),isPrimary:St.isPrimary,currentPos:ut(St),currentTime:et.now()},wr(Tt,St,[Dt],St.button)&&at(Tt,Dt.type)}function mr(Tt,St){dr(Tt,St)}function gr(Tt,St){var Dt=Tt.getActivePointersListByType(lt(St));Dt.getById(St.pointerId)&&dr(Tt,St),et.stopEvent(St)}function dr(Tt,St){var Dt;Dt={id:St.pointerId,type:lt(St),isPrimary:St.isPrimary,currentPos:ut(St),currentTime:et.now()},Ar(Tt,St,[Dt])}function sr(Tt,St){var Dt;Dt={id:St.pointerId,type:lt(St)},Or(Tt,St,[Dt])}function br(Tt,St){return Object.prototype.hasOwnProperty.call(St,"isPrimary")||(Tt.getLength()===0?St.isPrimary=!0:St.isPrimary=!1),St.speed=0,St.direction=0,St.contactPos=St.currentPos,St.contactTime=St.currentTime,St.lastPos=St.currentPos,St.lastTime=St.currentTime,Tt.add(St)}function cr(Tt,St){var Dt,Ot;return Tt.getById(St.id)?(Dt=Tt.removeById(St.id),Object.prototype.hasOwnProperty.call(St,"isPrimary")||(Ot=Tt.getPrimary(),Ot||(Ot=Tt.getByIndex(0),Ot&&(Ot.isPrimary=!0)))):Dt=Tt.getLength(),Dt}function Er(Tt,St,Dt){var Ot=Tt.getActivePointersListByType(Dt[0].type),Kt,er=Dt.length,Zt,Xt,ir;for(Kt=0;Kt<er;Kt++)Zt=Dt[Kt],Xt=Ot.getById(Zt.id),Xt?(Xt.insideElement=!0,Xt.lastPos=Xt.currentPos,Xt.lastTime=Xt.currentTime,Xt.currentPos=Zt.currentPos,Xt.currentTime=Zt.currentTime,Zt=Xt):(Zt.captured=!1,Zt.insideElementPressed=!1,Zt.insideElement=!0,br(Ot,Zt)),Tt.enterHandler&&(ir=Tt.enterHandler({eventSource:Tt,pointerType:Zt.type,position:dt(Zt.currentPos,Tt.element),buttons:Ot.buttons,pointers:Tt.getActivePointerCount(),insideElementPressed:Zt.insideElementPressed,buttonDownAny:Ot.buttons!==0,isTouchEvent:Zt.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),ir===!1&&et.cancelEvent(St))}function xr(Tt,St,Dt){var Ot=Tt.getActivePointersListByType(Dt[0].type),Kt,er=Dt.length,Zt,Xt,ir;for(Kt=0;Kt<er;Kt++)Zt=Dt[Kt],Xt=Ot.getById(Zt.id),Xt&&(Xt.captured?(Xt.insideElement=!1,Xt.lastPos=Xt.currentPos,Xt.lastTime=Xt.currentTime,Xt.currentPos=Zt.currentPos,Xt.currentTime=Zt.currentTime):cr(Ot,Xt),Zt=Xt),Tt.exitHandler&&(ir=Tt.exitHandler({eventSource:Tt,pointerType:Zt.type,position:Zt.currentPos&&dt(Zt.currentPos,Tt.element),buttons:Ot.buttons,pointers:Tt.getActivePointerCount(),insideElementPressed:Xt?Xt.insideElementPressed:!1,buttonDownAny:Ot.buttons!==0,isTouchEvent:Zt.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),ir===!1&&et.cancelEvent(St))}function Cr(Tt,St,Dt,Ot){var Kt=tt[Tt.hash],er,Zt=Tt.getActivePointersListByType(Dt[0].type),Xt,ir=Dt.length,lr,ur;typeof St.buttons<"u"?Zt.buttons=St.buttons:et.Browser.vendor===et.BROWSERS.IE&&et.Browser.version<9?Ot===0?Zt.buttons+=1:Ot===1?Zt.buttons+=4:Ot===2?Zt.buttons+=2:Ot===3?Zt.buttons+=8:Ot===4?Zt.buttons+=16:Ot===5&&(Zt.buttons+=32):Ot===0?Zt.buttons|=1:Ot===1?Zt.buttons|=4:Ot===2?Zt.buttons|=2:Ot===3?Zt.buttons|=8:Ot===4?Zt.buttons|=16:Ot===5&&(Zt.buttons|=32);var yr=Tt.getActivePointersListsExceptType(Dt[0].type);for(Xt=0;Xt<yr.length;Xt++)tr(Tt,St,yr[Xt]);if(Ot!==0)return Tt.nonPrimaryPressHandler&&(er=Tt.nonPrimaryPressHandler({eventSource:Tt,pointerType:Dt[0].type,position:dt(Dt[0].currentPos,Tt.element),button:Ot,buttons:Zt.buttons,isTouchEvent:Dt[0].type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),er===!1&&et.cancelEvent(St)),!1;for(Xt=0;Xt<ir;Xt++)lr=Dt[Xt],ur=Zt.getById(lr.id),ur?(ur.captured=!0,ur.insideElementPressed=!0,ur.insideElement=!0,ur.contactPos=lr.currentPos,ur.contactTime=lr.currentTime,ur.lastPos=ur.currentPos,ur.lastTime=ur.currentTime,ur.currentPos=lr.currentPos,ur.currentTime=lr.currentTime,lr=ur):(lr.captured=!0,lr.insideElementPressed=!0,lr.insideElement=!0,br(Zt,lr)),Zt.addContact(),(Tt.dragHandler||Tt.dragEndHandler||Tt.pinchHandler)&&et.MouseTracker.gesturePointVelocityTracker.addPoint(Tt,lr),Zt.contacts===1?Tt.pressHandler&&(er=Tt.pressHandler({eventSource:Tt,pointerType:lr.type,position:dt(lr.contactPos,Tt.element),buttons:Zt.buttons,isTouchEvent:lr.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),er===!1&&et.cancelEvent(St)):Zt.contacts===2&&Tt.pinchHandler&&lr.type==="touch"&&(Kt.pinchGPoints=Zt.asArray(),Kt.lastPinchDist=Kt.currentPinchDist=Kt.pinchGPoints[0].currentPos.distanceTo(Kt.pinchGPoints[1].currentPos),Kt.lastPinchCenter=Kt.currentPinchCenter=ft(Kt.pinchGPoints[0].currentPos,Kt.pinchGPoints[1].currentPos));return!0}function wr(Tt,St,Dt,Ot){var Kt=tt[Tt.hash],er=Tt.getActivePointersListByType(Dt[0].type),Zt,Xt,ir,lr,ur=Dt.length,yr,or,_r=!1,$r=!1,Rr;if(typeof St.buttons<"u"?er.buttons=St.buttons:et.Browser.vendor===et.BROWSERS.IE&&et.Browser.version<9?Ot===0?er.buttons-=1:Ot===1?er.buttons-=4:Ot===2?er.buttons-=2:Ot===3?er.buttons-=8:Ot===4?er.buttons-=16:Ot===5&&(er.buttons-=32):Ot===0?er.buttons^=-2:Ot===1?er.buttons^=-5:Ot===2?er.buttons^=-3:Ot===3?er.buttons^=-9:Ot===4?er.buttons^=-17:Ot===5&&(er.buttons^=-33),Ot!==0){Tt.nonPrimaryReleaseHandler&&(Zt=Tt.nonPrimaryReleaseHandler({eventSource:Tt,pointerType:Dt[0].type,position:dt(Dt[0].currentPos,Tt.element),button:Ot,buttons:er.buttons,isTouchEvent:Dt[0].type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Zt===!1&&et.cancelEvent(St));var Nr=Tt.getActivePointersListByType("mouse");return tr(Tt,St,Nr),!1}if(typeof Dt[0].currentPos>"u")return tr(Tt,St,er),!1;for(lr=0;lr<ur;lr++)yr=Dt[lr],or=er.getById(yr.id),or&&(or.captured&&(or.captured=!1,_r=!0,$r=!0),or.lastPos=or.currentPos,or.lastTime=or.currentTime,or.currentPos=yr.currentPos,or.currentTime=yr.currentTime,or.insideElement||cr(er,or),Xt=or.currentPos,ir=or.currentTime,$r?(er.removeContact(),(Tt.dragHandler||Tt.dragEndHandler||Tt.pinchHandler)&&et.MouseTracker.gesturePointVelocityTracker.removePoint(Tt,or),er.contacts===0?(Tt.releaseHandler&&(Zt=Tt.releaseHandler({eventSource:Tt,pointerType:or.type,position:dt(Xt,Tt.element),buttons:er.buttons,insideElementPressed:or.insideElementPressed,insideElementReleased:or.insideElement,isTouchEvent:or.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Zt===!1&&et.cancelEvent(St)),Tt.dragEndHandler&&!or.currentPos.equals(or.contactPos)&&(Zt=Tt.dragEndHandler({eventSource:Tt,pointerType:or.type,position:dt(or.currentPos,Tt.element),speed:or.speed,direction:or.direction,shift:St.shiftKey,isTouchEvent:or.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Zt===!1&&et.cancelEvent(St)),(Tt.clickHandler||Tt.dblClickHandler)&&or.insideElement&&(Rr=ir-or.contactTime<=Tt.clickTimeThreshold&&or.contactPos.distanceTo(Xt)<=Tt.clickDistThreshold,Tt.clickHandler&&(Zt=Tt.clickHandler({eventSource:Tt,pointerType:or.type,position:dt(or.currentPos,Tt.element),quick:Rr,shift:St.shiftKey,isTouchEvent:or.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Zt===!1&&et.cancelEvent(St)),Tt.dblClickHandler&&Rr&&(er.clicks++,er.clicks===1?(Kt.lastClickPos=Xt,Kt.dblClickTimeOut=setTimeout(function(){er.clicks=0},Tt.dblClickTimeThreshold)):er.clicks===2&&(clearTimeout(Kt.dblClickTimeOut),er.clicks=0,Kt.lastClickPos.distanceTo(Xt)<=Tt.dblClickDistThreshold&&(Zt=Tt.dblClickHandler({eventSource:Tt,pointerType:or.type,position:dt(or.currentPos,Tt.element),shift:St.shiftKey,isTouchEvent:or.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Zt===!1&&et.cancelEvent(St)),Kt.lastClickPos=null)))):er.contacts===2&&Tt.pinchHandler&&or.type==="touch"&&(Kt.pinchGPoints=er.asArray(),Kt.lastPinchDist=Kt.currentPinchDist=Kt.pinchGPoints[0].currentPos.distanceTo(Kt.pinchGPoints[1].currentPos),Kt.lastPinchCenter=Kt.currentPinchCenter=ft(Kt.pinchGPoints[0].currentPos,Kt.pinchGPoints[1].currentPos))):Tt.releaseHandler&&(Zt=Tt.releaseHandler({eventSource:Tt,pointerType:or.type,position:dt(Xt,Tt.element),buttons:er.buttons,insideElementPressed:or.insideElementPressed,insideElementReleased:or.insideElement,isTouchEvent:or.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),Zt===!1&&et.cancelEvent(St)));return _r}function Ar(Tt,St,Dt){var Ot=tt[Tt.hash],Kt=Tt.getActivePointersListByType(Dt[0].type),er,Zt=Dt.length,Xt,ir,lr,ur,yr;for(typeof St.buttons<"u"&&(Kt.buttons=St.buttons),er=0;er<Zt;er++)Xt=Dt[er],ir=Kt.getById(Xt.id),ir?(Object.prototype.hasOwnProperty.call(Xt,"isPrimary")&&(ir.isPrimary=Xt.isPrimary),ir.lastPos=ir.currentPos,ir.lastTime=ir.currentTime,ir.currentPos=Xt.currentPos,ir.currentTime=Xt.currentTime):(Xt.captured=!1,Xt.insideElementPressed=!1,Xt.insideElement=!0,br(Kt,Xt));Tt.stopHandler&&Dt[0].type==="mouse"&&(clearTimeout(Tt.stopTimeOut),Tt.stopTimeOut=setTimeout(function(){Mr(Tt,St,Dt[0].type)},Tt.stopDelay)),Kt.contacts===0?Tt.moveHandler&&(yr=Tt.moveHandler({eventSource:Tt,pointerType:Dt[0].type,position:dt(Dt[0].currentPos,Tt.element),buttons:Kt.buttons,isTouchEvent:Dt[0].type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),yr===!1&&et.cancelEvent(St)):Kt.contacts===1?(Tt.moveHandler&&(ir=Kt.asArray()[0],yr=Tt.moveHandler({eventSource:Tt,pointerType:ir.type,position:dt(ir.currentPos,Tt.element),buttons:Kt.buttons,isTouchEvent:ir.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),yr===!1&&et.cancelEvent(St)),Tt.dragHandler&&(ir=Kt.asArray()[0],ur=ir.currentPos.minus(ir.lastPos),yr=Tt.dragHandler({eventSource:Tt,pointerType:ir.type,position:dt(ir.currentPos,Tt.element),buttons:Kt.buttons,delta:ur,speed:ir.speed,direction:ir.direction,shift:St.shiftKey,isTouchEvent:ir.type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),yr===!1&&et.cancelEvent(St))):Kt.contacts===2&&(Tt.moveHandler&&(lr=Kt.asArray(),yr=Tt.moveHandler({eventSource:Tt,pointerType:lr[0].type,position:dt(ft(lr[0].currentPos,lr[1].currentPos),Tt.element),buttons:Kt.buttons,isTouchEvent:lr[0].type==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),yr===!1&&et.cancelEvent(St)),Tt.pinchHandler&&Dt[0].type==="touch"&&(ur=Ot.pinchGPoints[0].currentPos.distanceTo(Ot.pinchGPoints[1].currentPos),ur!=Ot.currentPinchDist&&(Ot.lastPinchDist=Ot.currentPinchDist,Ot.currentPinchDist=ur,Ot.lastPinchCenter=Ot.currentPinchCenter,Ot.currentPinchCenter=ft(Ot.pinchGPoints[0].currentPos,Ot.pinchGPoints[1].currentPos),yr=Tt.pinchHandler({eventSource:Tt,pointerType:"touch",gesturePoints:Ot.pinchGPoints,lastCenter:dt(Ot.lastPinchCenter,Tt.element),center:dt(Ot.currentPinchCenter,Tt.element),lastDistance:Ot.lastPinchDist,distance:Ot.currentPinchDist,shift:St.shiftKey,originalEvent:St,preventDefaultAction:!1,userData:Tt.userData}),yr===!1&&et.cancelEvent(St))))}function Or(Tt,St,Dt){wr(Tt,St,Dt,0),xr(Tt,St,Dt)}function Mr(Tt,St,Dt){Tt.stopHandler&&Tt.stopHandler({eventSource:Tt,pointerType:Dt,position:ct(St,Tt.element),buttons:Tt.getActivePointersListByType(Dt).buttons,isTouchEvent:Dt==="touch",originalEvent:St,preventDefaultAction:!1,userData:Tt.userData})}var Pr=function(){try{return window.self!==window.top}catch{return!0}}();function Ir(Tt){try{return Tt.addEventListener&&Tt.removeEventListener}catch{return!1}}}(OpenSeadragon),function(et){et.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},et.Control=function(_e,tt,rt){var nt=_e.parentNode;typeof tt=="number"&&(et.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),tt={anchor:tt}),tt.attachToViewer=typeof tt.attachToViewer>"u"?!0:tt.attachToViewer,this.autoFade=typeof tt.autoFade>"u"?!0:tt.autoFade,this.element=_e,this.anchor=tt.anchor,this.container=rt,this.anchor==et.ControlAnchor.ABSOLUTE?(this.wrapper=et.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof tt.top=="number"?tt.top+"px":tt.top,this.wrapper.style.left=typeof tt.left=="number"?tt.left+"px":tt.left,this.wrapper.style.height=typeof tt.height=="number"?tt.height+"px":tt.height,this.wrapper.style.width=typeof tt.width=="number"?tt.width+"px":tt.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=et.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==et.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),tt.attachToViewer?this.anchor==et.ControlAnchor.TOP_RIGHT||this.anchor==et.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):nt.appendChild(this.wrapper)},et.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(_e){this.wrapper.style.display=_e?this.anchor==et.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(_e){this.element[et.SIGNAL]&&et.Browser.vendor==et.BROWSERS.IE?et.setElementOpacity(this.element,_e,!0):et.setElementOpacity(this.wrapper,_e,!0)}}}(OpenSeadragon),function(et){et.ControlDock=function(tt){var rt=["topleft","topright","bottomright","bottomleft"],nt,it;for(et.extend(!0,this,{id:"controldock-"+et.now()+"-"+Math.floor(Math.random()*1e6),container:et.makeNeutralElement("div"),controls:[]},tt),this.container.onsubmit=function(){return!1},this.element&&(this.element=et.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),it=0;it<rt.length;it++)nt=rt[it],this.controls[nt]=et.makeNeutralElement("div"),this.controls[nt].style.position="absolute",nt.match("left")&&(this.controls[nt].style.left="0px"),nt.match("right")&&(this.controls[nt].style.right="0px"),nt.match("top")&&(this.controls[nt].style.top="0px"),nt.match("bottom")&&(this.controls[nt].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},et.ControlDock.prototype={addControl:function(tt,rt){tt=et.getElement(tt);var nt=null;if(!(_e(this,tt)>=0)){switch(rt.anchor){case et.ControlAnchor.TOP_RIGHT:nt=this.controls.topright,tt.style.position="relative",tt.style.paddingRight="0px",tt.style.paddingTop="0px";break;case et.ControlAnchor.BOTTOM_RIGHT:nt=this.controls.bottomright,tt.style.position="relative",tt.style.paddingRight="0px",tt.style.paddingBottom="0px";break;case et.ControlAnchor.BOTTOM_LEFT:nt=this.controls.bottomleft,tt.style.position="relative",tt.style.paddingLeft="0px",tt.style.paddingBottom="0px";break;case et.ControlAnchor.TOP_LEFT:nt=this.controls.topleft,tt.style.position="relative",tt.style.paddingLeft="0px",tt.style.paddingTop="0px";break;case et.ControlAnchor.ABSOLUTE:nt=this.container,tt.style.margin="0px",tt.style.padding="0px";break;default:case et.ControlAnchor.NONE:nt=this.container,tt.style.margin="0px",tt.style.padding="0px";break}this.controls.push(new et.Control(tt,rt,nt)),tt.style.display="inline-block"}},removeControl:function(tt){tt=et.getElement(tt);var rt=_e(this,tt);return rt>=0&&(this.controls[rt].destroy(),this.controls.splice(rt,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var tt;for(tt=this.controls.length-1;tt>=0;tt--)if(this.controls[tt].isVisible())return!0;return!1},setControlsEnabled:function(tt){var rt;for(rt=this.controls.length-1;rt>=0;rt--)this.controls[rt].setVisible(tt);return this}};function _e(tt,rt){var nt=tt.controls,it;for(it=nt.length-1;it>=0;it--)if(nt[it].element==rt)return it;return-1}}(OpenSeadragon),function(et){et.Placement=et.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(et){var _e={},tt=1;et.Viewer=function(Et){var Rt=arguments,Vt=this,zt;if(et.isPlainObject(Et)||(Et={id:Rt[0],xmlPath:Rt.length>1?Rt[1]:void 0,prefixUrl:Rt.length>2?Rt[2]:void 0,controls:Rt.length>3?Rt[3]:void 0,overlays:Rt.length>4?Rt[4]:void 0}),Et.config&&(et.extend(!0,Et,Et.config),delete Et.config),et.extend(!0,this,{id:Et.id,hash:Et.hash||tt++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},et.DEFAULT_SETTINGS,Et),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof _e[this.hash]<"u"&&et.console.warn("Hash "+this.hash+" has already been used."),_e[this.hash]={fsBoundsDelta:new et.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=et.now(),et.EventSource.call(this),this.addHandler("open-failed",function(Wt){var ar=et.getString("Errors.OpenFailed",Wt.eventSource,Wt.message);Vt._showMessage(ar)}),et.ControlDock.call(this,Et),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=et.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(Wt){Wt.width="100%",Wt.height="100%",Wt.overflow="hidden",Wt.position="absolute",Wt.top="0px",Wt.left="0px"}(this.canvas.style),et.setElementTouchActionNone(this.canvas),Et.tabIndex!==""&&(this.canvas.tabIndex=Et.tabIndex===void 0?0:Et.tabIndex),this.container.className="openseadragon-container",function(Wt){Wt.width="100%",Wt.height="100%",Wt.position="relative",Wt.overflow="hidden",Wt.left="0px",Wt.top="0px",Wt.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new et.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:et.delegate(this,pt),keyHandler:et.delegate(this,mt),clickHandler:et.delegate(this,ht),dblClickHandler:et.delegate(this,gt),dragHandler:et.delegate(this,vt),dragEndHandler:et.delegate(this,yt),enterHandler:et.delegate(this,bt),exitHandler:et.delegate(this,xt),pressHandler:et.delegate(this,_t),releaseHandler:et.delegate(this,wt),nonPrimaryPressHandler:et.delegate(this,Ct),nonPrimaryReleaseHandler:et.delegate(this,kt),scrollHandler:et.delegate(this,$t),pinchHandler:et.delegate(this,At)}),this.outerTracker=new et.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:et.delegate(this,Lt),exitHandler:et.delegate(this,Mt)}),this.toolbar&&(this.toolbar=new et.ControlDock({element:this.toolbar})),this.bindStandardControls(),_e[this.hash].prevContainerSize=rt(this.container),this.world=new et.World({viewer:this}),this.world.addHandler("add-item",function(Wt){Vt.source=Vt.world.getItemAt(0).source,_e[Vt.hash].forceRedraw=!0,Vt._updateRequestId||(Vt._updateRequestId=ot(Vt,Bt))}),this.world.addHandler("remove-item",function(Wt){Vt.world.getItemCount()?Vt.source=Vt.world.getItemAt(0).source:Vt.source=null,_e[Vt.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(Wt){Vt.viewport&&Vt.viewport._setContentBounds(Vt.world.getHomeBounds(),Vt.world.getContentFactor())}),this.world.addHandler("item-index-change",function(Wt){Vt.source=Vt.world.getItemAt(0).source}),this.viewport=new et.Viewport({containerSize:_e[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new et.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:Et.timeout}),this.tileCache=new et.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new et.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=et.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(zt=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(zt,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(zt=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(zt,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new et.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),zt=0;zt<this.customControls.length;zt++)this.addControl(this.customControls[zt].id,{anchor:this.customControls[zt].anchor});et.requestAnimationFrame(function(){lt(Vt)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},et.extend(et.Viewer.prototype,et.EventSource.prototype,et.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(Et){return et.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(Et)},openTileSource:function(Et){return et.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(Et)},open:function(Et,Rt){var Vt=this;if(this.close(),!!Et){if(this.sequenceMode&&et.isArray(Et)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof Rt<"u"&&!isNaN(Rt)&&(this.initialPage=Rt),this.tileSources=Et,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(et.isArray(Et)||(Et=[Et]),!!Et.length){this._opening=!0;for(var zt=Et.length,Wt=0,ar=0,Qt,mr=function(){if(Wt+ar===zt)if(Wt){(Vt._firstOpen||!Vt.preserveViewport)&&(Vt.viewport.goHome(!0),Vt.viewport.update()),Vt._firstOpen=!1;var sr=Et[0];if(sr.tileSource&&(sr=sr.tileSource),Vt.overlays&&!Vt.preserveOverlays)for(var br=0;br<Vt.overlays.length;br++)Vt.currentOverlays[br]=it(Vt,Vt.overlays[br]);Vt._drawOverlays(),Vt._opening=!1,Vt.raiseEvent("open",{source:sr})}else Vt._opening=!1,Vt.raiseEvent("open-failed",Qt)},gr=function(sr){(!et.isPlainObject(sr)||!sr.tileSource)&&(sr={tileSource:sr}),sr.index!==void 0&&(et.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete sr.index),sr.collectionImmediately===void 0&&(sr.collectionImmediately=!0);var br=sr.success;sr.success=function(Er){if(Wt++,sr.tileSource.overlays)for(var xr=0;xr<sr.tileSource.overlays.length;xr++)Vt.addOverlay(sr.tileSource.overlays[xr]);br&&br(Er),mr()};var cr=sr.error;sr.error=function(Er){ar++,Qt||(Qt=Er),cr&&cr(Er),mr()},Vt.addTiledImage(sr)},dr=0;dr<Et.length;dr++)gr(Et[dr]);return this}}},close:function(){return _e[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),_e[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(_e[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(et.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),_e[this.hash]=null,delete _e[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(Et){return this.innerTracker.setTracking(Et),this.outerTracker.setTracking(Et),this.raiseEvent("mouse-enabled",{enabled:Et}),this},areControlsEnabled:function(){var Et=this.controls.length,Rt;for(Rt=0;Rt<this.controls.length;Rt++)Et=Et&&this.controls[Rt].isVisible();return Et},setControlsEnabled:function(Et){return Et?ct(this):lt(this),this.raiseEvent("controls-enabled",{enabled:Et}),this},setDebugMode:function(Et){for(var Rt=0;Rt<this.world.getItemCount();Rt++)this.world.getItemAt(Rt).debugMode=Et;this.debugMode=Et,this.forceRedraw()},isFullPage:function(){return _e[this.hash].fullPage},setFullPage:function(Et){var Rt=document.body,Vt=Rt.style,zt=document.documentElement.style,Wt=this,ar,Qt;if(Et==this.isFullPage())return this;var mr={fullPage:Et,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",mr),mr.preventDefaultAction)return this;if(Et){for(this.elementSize=et.getElementSize(this.element),this.pageScroll=et.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=Vt.margin,this.docMargin=zt.margin,Vt.margin="0",zt.margin="0",this.bodyPadding=Vt.padding,this.docPadding=zt.padding,Vt.padding="0",zt.padding="0",this.bodyWidth=Vt.width,this.docWidth=zt.width,Vt.width="100%",zt.width="100%",this.bodyHeight=Vt.height,this.docHeight=zt.height,Vt.height="100%",zt.height="100%",this.previousBody=[],_e[this.hash].prevElementParent=this.element.parentNode,_e[this.hash].prevNextSibling=this.element.nextSibling,_e[this.hash].prevElementWidth=this.element.style.width,_e[this.hash].prevElementHeight=this.element.style.height,ar=Rt.childNodes.length,Qt=0;Qt<ar;Qt++)this.previousBody.push(Rt.childNodes[0]),Rt.removeChild(Rt.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,Rt.appendChild(this.toolbar.element),et.addClass(this.toolbar.element,"fullpage")),et.addClass(this.element,"fullpage"),Rt.appendChild(this.element),this.element.style.height=et.getWindowSize().y+"px",this.element.style.width=et.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=et.getElementSize(this.element).y-et.getElementSize(this.toolbar.element).y+"px"),_e[this.hash].fullPage=!0,et.delegate(this,Lt)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,Vt.margin=this.bodyMargin,zt.margin=this.docMargin,Vt.padding=this.bodyPadding,zt.padding=this.docPadding,Vt.width=this.bodyWidth,zt.width=this.docWidth,Vt.height=this.bodyHeight,zt.height=this.docHeight,Rt.removeChild(this.element),ar=this.previousBody.length,Qt=0;Qt<ar;Qt++)Rt.appendChild(this.previousBody.shift());et.removeClass(this.element,"fullpage"),_e[this.hash].prevElementParent.insertBefore(this.element,_e[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(Rt.removeChild(this.toolbar.element),et.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=_e[this.hash].prevElementWidth,this.element.style.height=_e[this.hash].prevElementHeight;var gr=0,dr=function(){et.setPageScroll(Wt.pageScroll);var sr=et.getPageScroll();gr++,gr<10&&(sr.x!==Wt.pageScroll.x||sr.y!==Wt.pageScroll.y)&&et.requestAnimationFrame(dr)};et.requestAnimationFrame(dr),_e[this.hash].fullPage=!1,et.delegate(this,Mt)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:Et}),this},setFullScreen:function(Et){var Rt=this;if(!et.supportsFullScreen)return this.setFullPage(Et);if(et.isFullScreen()===Et)return this;var Vt={fullScreen:Et,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",Vt),Vt.preventDefaultAction)return this;if(Et){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var zt=function(){var Wt=et.isFullScreen();Wt||(et.removeEvent(document,et.fullScreenEventName,zt),et.removeEvent(document,et.fullScreenErrorEventName,zt),Rt.setFullPage(!1),Rt.isFullPage()&&(Rt.element.style.width=Rt.fullPageStyleWidth,Rt.element.style.height=Rt.fullPageStyleHeight)),Rt.navigator&&Rt.viewport&&setTimeout(function(){Rt.navigator.update(Rt.viewport)}),Rt.raiseEvent("full-screen",{fullScreen:Wt})};et.addEvent(document,et.fullScreenEventName,zt),et.addEvent(document,et.fullScreenErrorEventName,zt),et.requestFullScreen(document.body)}else et.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(Et){return this.container.style.visibility=Et?"":"hidden",this.raiseEvent("visible",{visible:Et}),this},addTiledImage:function(Et){et.console.assert(Et,"[Viewer.addTiledImage] options is required"),et.console.assert(Et.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),et.console.assert(!Et.replace||Et.index>-1&&Et.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var Rt=this;Et.replace&&(Et.replaceItem=Rt.world.getItemAt(Et.index)),this._hideMessage(),Et.placeholderFillStyle===void 0&&(Et.placeholderFillStyle=this.placeholderFillStyle),Et.opacity===void 0&&(Et.opacity=this.opacity),Et.preload===void 0&&(Et.preload=this.preload),Et.compositeOperation===void 0&&(Et.compositeOperation=this.compositeOperation),Et.crossOriginPolicy===void 0&&(Et.crossOriginPolicy=Et.tileSource.crossOriginPolicy!==void 0?Et.tileSource.crossOriginPolicy:this.crossOriginPolicy),Et.ajaxWithCredentials===void 0&&(Et.ajaxWithCredentials=this.ajaxWithCredentials),Et.loadTilesWithAjax===void 0&&(Et.loadTilesWithAjax=this.loadTilesWithAjax),Et.ajaxHeaders===void 0||Et.ajaxHeaders===null?Et.ajaxHeaders=this.ajaxHeaders:et.isPlainObject(Et.ajaxHeaders)&&et.isPlainObject(this.ajaxHeaders)&&(Et.ajaxHeaders=et.extend({},this.ajaxHeaders,Et.ajaxHeaders));var Vt={options:Et};function zt(Qt){for(var mr=0;mr<Rt._loadQueue.length;mr++)if(Rt._loadQueue[mr]===Vt){Rt._loadQueue.splice(mr,1);break}Rt._loadQueue.length===0&&Wt(Vt),Rt.raiseEvent("add-item-failed",Qt),Et.error&&Et.error(Qt)}function Wt(Qt){Rt.collectionMode&&(Rt.world.arrange({immediately:Qt.options.collectionImmediately,rows:Rt.collectionRows,columns:Rt.collectionColumns,layout:Rt.collectionLayout,tileSize:Rt.collectionTileSize,tileMargin:Rt.collectionTileMargin}),Rt.world.setAutoRefigureSizes(!0))}if(et.isArray(Et.tileSource)){setTimeout(function(){zt({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:Et.tileSource,options:Et})});return}this._loadQueue.push(Vt);function ar(){for(var Qt,mr,gr;Rt._loadQueue.length&&(Qt=Rt._loadQueue[0],!!Qt.tileSource);){if(Rt._loadQueue.splice(0,1),Qt.options.replace){var dr=Rt.world.getIndexOfItem(Qt.options.replaceItem);dr!=-1&&(Qt.options.index=dr),Rt.world.removeItem(Qt.options.replaceItem)}mr=new et.TiledImage({viewer:Rt,source:Qt.tileSource,viewport:Rt.viewport,drawer:Rt.drawer,tileCache:Rt.tileCache,imageLoader:Rt.imageLoader,x:Qt.options.x,y:Qt.options.y,width:Qt.options.width,height:Qt.options.height,fitBounds:Qt.options.fitBounds,fitBoundsPlacement:Qt.options.fitBoundsPlacement,clip:Qt.options.clip,placeholderFillStyle:Qt.options.placeholderFillStyle,opacity:Qt.options.opacity,preload:Qt.options.preload,degrees:Qt.options.degrees,compositeOperation:Qt.options.compositeOperation,springStiffness:Rt.springStiffness,animationTime:Rt.animationTime,minZoomImageRatio:Rt.minZoomImageRatio,wrapHorizontal:Rt.wrapHorizontal,wrapVertical:Rt.wrapVertical,immediateRender:Rt.immediateRender,blendTime:Rt.blendTime,alwaysBlend:Rt.alwaysBlend,minPixelRatio:Rt.minPixelRatio,smoothTileEdgesMinZoom:Rt.smoothTileEdgesMinZoom,iOSDevice:Rt.iOSDevice,crossOriginPolicy:Qt.options.crossOriginPolicy,ajaxWithCredentials:Qt.options.ajaxWithCredentials,loadTilesWithAjax:Qt.options.loadTilesWithAjax,ajaxHeaders:Qt.options.ajaxHeaders,debugMode:Rt.debugMode}),Rt.collectionMode&&Rt.world.setAutoRefigureSizes(!1),Rt.world.addItem(mr,{index:Qt.options.index}),Rt._loadQueue.length===0&&Wt(Qt),Rt.world.getItemCount()===1&&!Rt.preserveViewport&&Rt.viewport.goHome(!0),Rt.navigator&&(gr=et.extend({},Qt.options,{replace:!1,originalTiledImage:mr,tileSource:Qt.tileSource}),Rt.navigator.addTiledImage(gr)),Qt.options.success&&Qt.options.success({item:mr})}}nt(this,Et.tileSource,Et,function(Qt){Vt.tileSource=Qt,ar()},function(Qt){Qt.options=Et,zt(Qt),ar()})},addSimpleImage:function(Et){et.console.assert(Et,"[Viewer.addSimpleImage] options is required"),et.console.assert(Et.url,"[Viewer.addSimpleImage] options.url is required");var Rt=et.extend({},Et,{tileSource:{type:"image",url:Et.url}});delete Rt.url,this.addTiledImage(Rt)},addLayer:function(Et){var Rt=this;et.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var Vt=et.extend({},Et,{success:function(zt){Rt.raiseEvent("add-layer",{options:Et,drawer:zt.item})},error:function(zt){Rt.raiseEvent("add-layer-failed",zt)}});return this.addTiledImage(Vt),this},getLayerAtLevel:function(Et){return et.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(Et)},getLevelOfLayer:function(Et){return et.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(Et)},getLayersCount:function(){return et.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(Et,Rt){return et.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(Et,Rt)},removeLayer:function(Et){return et.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(Et)},forceRedraw:function(){return _e[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var Et=et.delegate(this,dt),Rt=et.delegate(this,ft),Vt=et.delegate(this,pr),zt=et.delegate(this,hr),Wt=this.navImages,ar=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(ar=!1),this.previousButton=new et.Button({element:this.previousButton?et.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.PreviousPage"),srcRest:It(this.prefixUrl,Wt.previous.REST),srcGroup:It(this.prefixUrl,Wt.previous.GROUP),srcHover:It(this.prefixUrl,Wt.previous.HOVER),srcDown:It(this.prefixUrl,Wt.previous.DOWN),onRelease:zt,onFocus:Et,onBlur:Rt}),this.nextButton=new et.Button({element:this.nextButton?et.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.NextPage"),srcRest:It(this.prefixUrl,Wt.next.REST),srcGroup:It(this.prefixUrl,Wt.next.GROUP),srcHover:It(this.prefixUrl,Wt.next.HOVER),srcDown:It(this.prefixUrl,Wt.next.DOWN),onRelease:Vt,onFocus:Et,onBlur:Rt}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),ar&&(this.paging=new et.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:et.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||et.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var Et=et.delegate(this,Ft),Rt=et.delegate(this,Ht),Vt=et.delegate(this,tr),zt=et.delegate(this,Ut),Wt=et.delegate(this,Yt),ar=et.delegate(this,rr),Qt=et.delegate(this,qt),mr=et.delegate(this,nr),gr=et.delegate(this,vr),dr=et.delegate(this,fr),sr=et.delegate(this,dt),br=et.delegate(this,ft),cr=this.navImages,Er=[],xr=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(xr=!1),this.showZoomControl&&(Er.push(this.zoomInButton=new et.Button({element:this.zoomInButton?et.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.ZoomIn"),srcRest:It(this.prefixUrl,cr.zoomIn.REST),srcGroup:It(this.prefixUrl,cr.zoomIn.GROUP),srcHover:It(this.prefixUrl,cr.zoomIn.HOVER),srcDown:It(this.prefixUrl,cr.zoomIn.DOWN),onPress:Et,onRelease:Rt,onClick:Vt,onEnter:Et,onExit:Rt,onFocus:sr,onBlur:br})),Er.push(this.zoomOutButton=new et.Button({element:this.zoomOutButton?et.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.ZoomOut"),srcRest:It(this.prefixUrl,cr.zoomOut.REST),srcGroup:It(this.prefixUrl,cr.zoomOut.GROUP),srcHover:It(this.prefixUrl,cr.zoomOut.HOVER),srcDown:It(this.prefixUrl,cr.zoomOut.DOWN),onPress:zt,onRelease:Rt,onClick:Wt,onEnter:zt,onExit:Rt,onFocus:sr,onBlur:br}))),this.showHomeControl&&Er.push(this.homeButton=new et.Button({element:this.homeButton?et.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.Home"),srcRest:It(this.prefixUrl,cr.home.REST),srcGroup:It(this.prefixUrl,cr.home.GROUP),srcHover:It(this.prefixUrl,cr.home.HOVER),srcDown:It(this.prefixUrl,cr.home.DOWN),onRelease:ar,onFocus:sr,onBlur:br})),this.showFullPageControl&&Er.push(this.fullPageButton=new et.Button({element:this.fullPageButton?et.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.FullPage"),srcRest:It(this.prefixUrl,cr.fullpage.REST),srcGroup:It(this.prefixUrl,cr.fullpage.GROUP),srcHover:It(this.prefixUrl,cr.fullpage.HOVER),srcDown:It(this.prefixUrl,cr.fullpage.DOWN),onRelease:Qt,onFocus:sr,onBlur:br})),this.showRotationControl&&(Er.push(this.rotateLeftButton=new et.Button({element:this.rotateLeftButton?et.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.RotateLeft"),srcRest:It(this.prefixUrl,cr.rotateleft.REST),srcGroup:It(this.prefixUrl,cr.rotateleft.GROUP),srcHover:It(this.prefixUrl,cr.rotateleft.HOVER),srcDown:It(this.prefixUrl,cr.rotateleft.DOWN),onRelease:mr,onFocus:sr,onBlur:br})),Er.push(this.rotateRightButton=new et.Button({element:this.rotateRightButton?et.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.RotateRight"),srcRest:It(this.prefixUrl,cr.rotateright.REST),srcGroup:It(this.prefixUrl,cr.rotateright.GROUP),srcHover:It(this.prefixUrl,cr.rotateright.HOVER),srcDown:It(this.prefixUrl,cr.rotateright.DOWN),onRelease:gr,onFocus:sr,onBlur:br}))),this.showFlipControl&&Er.push(this.flipButton=new et.Button({element:this.flipButton?et.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:et.getString("Tooltips.Flip"),srcRest:It(this.prefixUrl,cr.flip.REST),srcGroup:It(this.prefixUrl,cr.flip.GROUP),srcHover:It(this.prefixUrl,cr.flip.HOVER),srcDown:It(this.prefixUrl,cr.flip.DOWN),onRelease:dr,onFocus:sr,onBlur:br})),xr&&(this.buttons=new et.ButtonGroup({buttons:Er,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",et.delegate(this,Jt)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||et.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||et.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(Et){return this.tileSources&&Et>=0&&Et<this.tileSources.length&&(this._sequenceIndex=Et,this._updateSequenceButtons(Et),this.open(this.tileSources[Et]),this.referenceStrip&&this.referenceStrip.setFocus(Et),this.raiseEvent("page",{page:Et})),this},addOverlay:function(Et,Rt,Vt,zt){var Wt;if(et.isPlainObject(Et)?Wt=Et:Wt={element:Et,location:Rt,placement:Vt,onDraw:zt},Et=et.getElement(Wt.element),st(this.currentOverlays,Et)>=0)return this;var ar=it(this,Wt);return this.currentOverlays.push(ar),ar.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:Et,location:Wt.location,placement:Wt.placement}),this},updateOverlay:function(Et,Rt,Vt){var zt;return Et=et.getElement(Et),zt=st(this.currentOverlays,Et),zt>=0&&(this.currentOverlays[zt].update(Rt,Vt),_e[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:Et,location:Rt,placement:Vt})),this},removeOverlay:function(Et){var Rt;return Et=et.getElement(Et),Rt=st(this.currentOverlays,Et),Rt>=0&&(this.currentOverlays[Rt].destroy(),this.currentOverlays.splice(Rt,1),_e[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:Et})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return _e[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(Et){var Rt;return Et=et.getElement(Et),Rt=st(this.currentOverlays,Et),Rt>=0?this.currentOverlays[Rt]:null},_updateSequenceButtons:function(Et){this.nextButton&&(!this.tileSources||this.tileSources.length-1===Et?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(Et>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(Et){this._hideMessage();var Rt=et.makeNeutralElement("div");Rt.appendChild(document.createTextNode(Et)),this.messageDiv=et.makeCenteredNode(Rt),et.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var Et=this.messageDiv;Et&&(Et.parentNode.removeChild(Et),delete this.messageDiv)},gestureSettingsByDeviceType:function(Et){switch(Et){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var Et,Rt=this.currentOverlays.length;for(Et=0;Et<Rt;Et++)this.currentOverlays[Et].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new et.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else et.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function rt(Et){return Et=et.getElement(Et),new et.Point(Et.clientWidth===0?1:Et.clientWidth,Et.clientHeight===0?1:Et.clientHeight)}function nt(Et,Rt,Vt,zt,Wt){var ar=Et;if(et.type(Rt)=="string"){if(Rt.match(/^\s*<.*>\s*$/))Rt=et.parseXml(Rt);else if(Rt.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var Qt=et.parseJSON(Rt);Rt=Qt}catch{}}function mr(gr,dr){gr.ready?zt(gr):(gr.addHandler("ready",function(){zt(gr)}),gr.addHandler("open-failed",function(sr){Wt({message:sr.message,source:dr})}))}setTimeout(function(){if(et.type(Rt)=="string")Rt=new et.TileSource({url:Rt,crossOriginPolicy:Vt.crossOriginPolicy!==void 0?Vt.crossOriginPolicy:Et.crossOriginPolicy,ajaxWithCredentials:Et.ajaxWithCredentials,ajaxHeaders:Et.ajaxHeaders,useCanvas:Et.useCanvas,success:function(br){zt(br.tileSource)}}),Rt.addHandler("open-failed",function(br){Wt(br)});else if(et.isPlainObject(Rt)||Rt.nodeType)if(Rt.crossOriginPolicy===void 0&&(Vt.crossOriginPolicy!==void 0||Et.crossOriginPolicy!==void 0)&&(Rt.crossOriginPolicy=Vt.crossOriginPolicy!==void 0?Vt.crossOriginPolicy:Et.crossOriginPolicy),Rt.ajaxWithCredentials===void 0&&(Rt.ajaxWithCredentials=Et.ajaxWithCredentials),Rt.useCanvas===void 0&&(Rt.useCanvas=Et.useCanvas),et.isFunction(Rt.getTileUrl)){var gr=new et.TileSource(Rt);gr.getTileUrl=Rt.getTileUrl,zt(gr)}else{var dr=et.TileSource.determineType(ar,Rt);if(!dr){Wt({message:"Unable to load TileSource",source:Rt});return}var sr=dr.prototype.configure.apply(ar,[Rt]);mr(new dr(sr),Rt)}else mr(Rt,Rt)})}function it(Et,Rt){if(Rt instanceof et.Overlay)return Rt;var Vt=null;if(Rt.element)Vt=et.getElement(Rt.element);else{var zt=Rt.id?Rt.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);Vt=et.getElement(Rt.id),Vt||(Vt=document.createElement("a"),Vt.href="#/overlay/"+zt),Vt.id=zt,et.addClass(Vt,Rt.className?Rt.className:"openseadragon-overlay")}var Wt=Rt.location,ar=Rt.width,Qt=Rt.height;if(!Wt){var mr=Rt.x,gr=Rt.y;if(Rt.px!==void 0){var dr=Et.viewport.imageToViewportRectangle(new et.Rect(Rt.px,Rt.py,ar||0,Qt||0));mr=dr.x,gr=dr.y,ar=ar!==void 0?dr.width:void 0,Qt=Qt!==void 0?dr.height:void 0}Wt=new et.Point(mr,gr)}var sr=Rt.placement;return sr&&et.type(sr)==="string"&&(sr=et.Placement[Rt.placement.toUpperCase()]),new et.Overlay({element:Vt,location:Wt,placement:sr,onDraw:Rt.onDraw,checkResize:Rt.checkResize,width:ar,height:Qt,rotationMode:Rt.rotationMode})}function st(Et,Rt){var Vt;for(Vt=Et.length-1;Vt>=0;Vt--)if(Et[Vt].element===Rt)return Vt;return-1}function ot(Et,Rt){return et.requestAnimationFrame(function(){Rt(Et)})}function at(Et){et.requestAnimationFrame(function(){ut(Et)})}function lt(Et){Et.autoHideControls&&(Et.controlsShouldFade=!0,Et.controlsFadeBeginTime=et.now()+Et.controlsFadeDelay,window.setTimeout(function(){at(Et)},Et.controlsFadeDelay))}function ut(Et){var Rt,Vt,zt,Wt;if(Et.controlsShouldFade){for(Rt=et.now(),Vt=Rt-Et.controlsFadeBeginTime,zt=1-Vt/Et.controlsFadeLength,zt=Math.min(1,zt),zt=Math.max(0,zt),Wt=Et.controls.length-1;Wt>=0;Wt--)Et.controls[Wt].autoFade&&Et.controls[Wt].setOpacity(zt);zt>0&&at(Et)}}function ct(Et){var Rt;for(Et.controlsShouldFade=!1,Rt=Et.controls.length-1;Rt>=0;Rt--)Et.controls[Rt].setOpacity(1)}function dt(){ct(this)}function ft(){lt(this)}function pt(Et){var Rt={originalEvent:Et.originalEvent,preventDefaultAction:Et.preventDefaultAction,preventVerticalPan:Et.preventVerticalPan,preventHorizontalPan:Et.preventHorizontalPan};if(this.raiseEvent("canvas-key",Rt),!Rt.preventDefaultAction&&!Et.ctrl&&!Et.alt&&!Et.meta)switch(Et.keyCode){case 38:return Rt.preventVerticalPan||(Et.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new et.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return Rt.preventVerticalPan||(Et.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new et.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return Rt.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new et.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return Rt.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new et.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function mt(Et){var Rt={originalEvent:Et.originalEvent,preventDefaultAction:Et.preventDefaultAction,preventVerticalPan:Et.preventVerticalPan,preventHorizontalPan:Et.preventHorizontalPan};if(this.raiseEvent("canvas-key",Rt),!Rt.preventDefaultAction&&!Et.ctrl&&!Et.alt&&!Et.meta)switch(Et.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return Rt.preventVerticalPan||(Et.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new et.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return Rt.preventVerticalPan||(Et.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new et.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return Rt.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new et.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return Rt.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new et.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(et.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(et.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(et.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(et.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function ht(Et){var Rt,Vt=document.activeElement==this.canvas;Vt||this.canvas.focus(),this.viewport.flipped&&(Et.position.x=this.viewport.getContainerSize().x-Et.position.x);var zt={tracker:Et.eventSource,position:Et.position,quick:Et.quick,shift:Et.shift,originalEvent:Et.originalEvent,preventDefaultAction:Et.preventDefaultAction};this.raiseEvent("canvas-click",zt),!zt.preventDefaultAction&&this.viewport&&Et.quick&&(Rt=this.gestureSettingsByDeviceType(Et.pointerType),Rt.clickToZoom&&(this.viewport.zoomBy(Et.shift?1/this.zoomPerClick:this.zoomPerClick,Rt.zoomToRefPoint?this.viewport.pointFromPixel(Et.position,!0):null),this.viewport.applyConstraints()))}function gt(Et){var Rt,Vt={tracker:Et.eventSource,position:Et.position,shift:Et.shift,originalEvent:Et.originalEvent,preventDefaultAction:Et.preventDefaultAction};this.raiseEvent("canvas-double-click",Vt),!Vt.preventDefaultAction&&this.viewport&&(Rt=this.gestureSettingsByDeviceType(Et.pointerType),Rt.dblClickToZoom&&(this.viewport.zoomBy(Et.shift?1/this.zoomPerClick:this.zoomPerClick,Rt.zoomToRefPoint?this.viewport.pointFromPixel(Et.position,!0):null),this.viewport.applyConstraints()))}function vt(Et){var Rt,Vt={tracker:Et.eventSource,position:Et.position,delta:Et.delta,speed:Et.speed,direction:Et.direction,shift:Et.shift,originalEvent:Et.originalEvent,preventDefaultAction:Et.preventDefaultAction};if(this.raiseEvent("canvas-drag",Vt),!Vt.preventDefaultAction&&this.viewport){if(Rt=this.gestureSettingsByDeviceType(Et.pointerType),this.panHorizontal||(Et.delta.x=0),this.panVertical||(Et.delta.y=0),this.viewport.flipped&&(Et.delta.x=-Et.delta.x),this.constrainDuringPan){var zt=this.viewport.deltaPointsFromPixels(Et.delta.negate());this.viewport.centerSpringX.target.value+=zt.x,this.viewport.centerSpringY.target.value+=zt.y;var Wt=this.viewport.getBounds(),ar=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=zt.x,this.viewport.centerSpringY.target.value-=zt.y,Wt.x!=ar.x&&(Et.delta.x=0),Wt.y!=ar.y&&(Et.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(Et.delta.negate()),Rt.flickEnabled&&!this.constrainDuringPan)}}function yt(Et){if(!Et.preventDefaultAction&&this.viewport){var Rt=this.gestureSettingsByDeviceType(Et.pointerType);if(Rt.flickEnabled&&Et.speed>=Rt.flickMinSpeed){var Vt=0;this.panHorizontal&&(Vt=Rt.flickMomentum*Et.speed*Math.cos(Et.direction));var zt=0;this.panVertical&&(zt=Rt.flickMomentum*Et.speed*Math.sin(Et.direction));var Wt=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),ar=this.viewport.pointFromPixel(new et.Point(Wt.x-Vt,Wt.y-zt));this.viewport.panTo(ar,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:Et.eventSource,position:Et.position,speed:Et.speed,direction:Et.direction,shift:Et.shift,originalEvent:Et.originalEvent})}function bt(Et){this.raiseEvent("canvas-enter",{tracker:Et.eventSource,pointerType:Et.pointerType,position:Et.position,buttons:Et.buttons,pointers:Et.pointers,insideElementPressed:Et.insideElementPressed,buttonDownAny:Et.buttonDownAny,originalEvent:Et.originalEvent})}function xt(Et){window.location!=window.parent.location&&et.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:Et.eventSource,pointerType:Et.pointerType,position:Et.position,buttons:Et.buttons,pointers:Et.pointers,insideElementPressed:Et.insideElementPressed,buttonDownAny:Et.buttonDownAny,originalEvent:Et.originalEvent})}function _t(Et){this.raiseEvent("canvas-press",{tracker:Et.eventSource,pointerType:Et.pointerType,position:Et.position,insideElementPressed:Et.insideElementPressed,insideElementReleased:Et.insideElementReleased,originalEvent:Et.originalEvent})}function wt(Et){this.raiseEvent("canvas-release",{tracker:Et.eventSource,pointerType:Et.pointerType,position:Et.position,insideElementPressed:Et.insideElementPressed,insideElementReleased:Et.insideElementReleased,originalEvent:Et.originalEvent})}function Ct(Et){this.raiseEvent("canvas-nonprimary-press",{tracker:Et.eventSource,position:Et.position,pointerType:Et.pointerType,button:Et.button,buttons:Et.buttons,originalEvent:Et.originalEvent})}function kt(Et){this.raiseEvent("canvas-nonprimary-release",{tracker:Et.eventSource,position:Et.position,pointerType:Et.pointerType,button:Et.button,buttons:Et.buttons,originalEvent:Et.originalEvent})}function At(Et){var Rt,Vt,zt,Wt;if(!Et.preventDefaultAction&&this.viewport&&(Rt=this.gestureSettingsByDeviceType(Et.pointerType),Rt.pinchToZoom&&(Vt=this.viewport.pointFromPixel(Et.center,!0),zt=this.viewport.pointFromPixel(Et.lastCenter,!0),Wt=zt.minus(Vt),this.panHorizontal||(Wt.x=0),this.panVertical||(Wt.y=0),this.viewport.zoomBy(Et.distance/Et.lastDistance,Vt,!0),Rt.zoomToRefPoint&&this.viewport.panBy(Wt,!0),this.viewport.applyConstraints()),Rt.pinchRotate)){var ar=Math.atan2(Et.gesturePoints[0].currentPos.y-Et.gesturePoints[1].currentPos.y,Et.gesturePoints[0].currentPos.x-Et.gesturePoints[1].currentPos.x),Qt=Math.atan2(Et.gesturePoints[0].lastPos.y-Et.gesturePoints[1].lastPos.y,Et.gesturePoints[0].lastPos.x-Et.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(ar-Qt)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:Et.eventSource,gesturePoints:Et.gesturePoints,lastCenter:Et.lastCenter,center:Et.center,lastDistance:Et.lastDistance,distance:Et.distance,shift:Et.shift,originalEvent:Et.originalEvent}),!1}function $t(Et){var Rt,Vt,zt,Wt;if(zt=et.now(),Wt=zt-this._lastScrollTime,Wt>this.minScrollDeltaTime){if(this._lastScrollTime=zt,this.viewport.flipped&&(Et.position.x=this.viewport.getContainerSize().x-Et.position.x),!Et.preventDefaultAction&&this.viewport&&(Rt=this.gestureSettingsByDeviceType(Et.pointerType),Rt.scrollToZoom&&(Vt=Math.pow(this.zoomPerScroll,Et.scroll),this.viewport.zoomBy(Vt,Rt.zoomToRefPoint?this.viewport.pointFromPixel(Et.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:Et.eventSource,position:Et.position,scroll:Et.scroll,shift:Et.shift,originalEvent:Et.originalEvent}),Rt&&Rt.scrollToZoom)return!1}else if(Rt=this.gestureSettingsByDeviceType(Et.pointerType),Rt&&Rt.scrollToZoom)return!1}function Lt(Et){_e[this.hash].mouseInside=!0,ct(this),this.raiseEvent("container-enter",{tracker:Et.eventSource,position:Et.position,buttons:Et.buttons,pointers:Et.pointers,insideElementPressed:Et.insideElementPressed,buttonDownAny:Et.buttonDownAny,originalEvent:Et.originalEvent})}function Mt(Et){Et.pointers<1&&(_e[this.hash].mouseInside=!1,_e[this.hash].animating||lt(this)),this.raiseEvent("container-exit",{tracker:Et.eventSource,position:Et.position,buttons:Et.buttons,pointers:Et.pointers,insideElementPressed:Et.insideElementPressed,buttonDownAny:Et.buttonDownAny,originalEvent:Et.originalEvent})}function Bt(Et){Pt(Et),Et.isOpen()?Et._updateRequestId=ot(Et,Bt):Et._updateRequestId=!1}function Pt(Et){if(!Et._opening){if(Et.autoResize){var Rt=rt(Et.container),Vt=_e[Et.hash].prevContainerSize;if(!Rt.equals(Vt)){var zt=Et.viewport;if(Et.preserveImageSizeOnResize){var Wt=Vt.x/Rt.x,ar=zt.getZoom()*Wt,Qt=zt.getCenter();zt.resize(Rt,!1),zt.zoomTo(ar,null,!0),zt.panTo(Qt,!0)}else{var mr=zt.getBounds();zt.resize(Rt,!0),zt.fitBoundsWithConstraints(mr,!0)}_e[Et.hash].prevContainerSize=Rt,_e[Et.hash].forceRedraw=!0}}var gr=Et.viewport.update(),dr=Et.world.update()||gr;gr&&Et.raiseEvent("viewport-change"),Et.referenceStrip&&(dr=Et.referenceStrip.update(Et.viewport)||dr),!_e[Et.hash].animating&&dr&&(Et.raiseEvent("animation-start"),ct(Et)),(dr||_e[Et.hash].forceRedraw||Et.world.needsDraw())&&(Nt(Et),Et._drawOverlays(),Et.navigator&&Et.navigator.update(Et.viewport),_e[Et.hash].forceRedraw=!1,dr&&Et.raiseEvent("animation")),_e[Et.hash].animating&&!dr&&(Et.raiseEvent("animation-finish"),_e[Et.hash].mouseInside||lt(Et)),_e[Et.hash].animating=dr}}function Nt(Et){Et.imageLoader.clear(),Et.drawer.clear(),Et.world.draw(),Et.raiseEvent("update-viewport",{})}function It(Et,Rt){return Et?Et+Rt:Rt}function Ft(){_e[this.hash].lastZoomTime=et.now(),_e[this.hash].zoomFactor=this.zoomPerSecond,_e[this.hash].zooming=!0,jt(this)}function Ut(){_e[this.hash].lastZoomTime=et.now(),_e[this.hash].zoomFactor=1/this.zoomPerSecond,_e[this.hash].zooming=!0,jt(this)}function Ht(){_e[this.hash].zooming=!1}function jt(Et){et.requestAnimationFrame(et.delegate(Et,Gt))}function Gt(){var Et,Rt,Vt;_e[this.hash].zooming&&this.viewport&&(Et=et.now(),Rt=Et-_e[this.hash].lastZoomTime,Vt=Math.pow(_e[this.hash].zoomFactor,Rt/1e3),this.viewport.zoomBy(Vt),this.viewport.applyConstraints(),_e[this.hash].lastZoomTime=Et,jt(this))}function tr(){this.viewport&&(_e[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Yt(){this.viewport&&(_e[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Jt(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function rr(){this.viewport&&this.viewport.goHome()}function qt(){this.isFullPage()&&!et.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function nr(){if(this.viewport){var Et=this.viewport.getRotation();this.viewport.flipped?Et=et.positiveModulo(Et+this.rotationIncrement,360):Et=et.positiveModulo(Et-this.rotationIncrement,360),this.viewport.setRotation(Et)}}function vr(){if(this.viewport){var Et=this.viewport.getRotation();this.viewport.flipped?Et=et.positiveModulo(Et-this.rotationIncrement,360):Et=et.positiveModulo(Et+this.rotationIncrement,360),this.viewport.setRotation(Et)}}function fr(){this.viewport.toggleFlip()}function hr(){var Et=this._sequenceIndex-1;this.navPrevNextWrap&&Et<0&&(Et+=this.tileSources.length),this.goToPage(Et)}function pr(){var Et=this._sequenceIndex+1;this.navPrevNextWrap&&Et>=this.tileSources.length&&(Et=0),this.goToPage(Et)}}(OpenSeadragon),function(et){et.Navigator=function(ot){var at=ot.viewer,lt=this,ut,ct;ot.id?(this.element=document.getElementById(ot.id),ot.controlOptions={anchor:et.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(ot.id="navigator-"+et.now(),this.element=et.makeNeutralElement("div"),ot.controlOptions={anchor:et.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:ot.autoFade},ot.position&&(ot.position=="BOTTOM_RIGHT"?ot.controlOptions.anchor=et.ControlAnchor.BOTTOM_RIGHT:ot.position=="BOTTOM_LEFT"?ot.controlOptions.anchor=et.ControlAnchor.BOTTOM_LEFT:ot.position=="TOP_RIGHT"?ot.controlOptions.anchor=et.ControlAnchor.TOP_RIGHT:ot.position=="TOP_LEFT"?ot.controlOptions.anchor=et.ControlAnchor.TOP_LEFT:ot.position=="ABSOLUTE"&&(ot.controlOptions.anchor=et.ControlAnchor.ABSOLUTE,ot.controlOptions.top=ot.top,ot.controlOptions.left=ot.left,ot.controlOptions.height=ot.height,ot.controlOptions.width=ot.width))),this.element.id=ot.id,this.element.className+=" navigator",ot=et.extend(!0,{sizeRatio:et.DEFAULT_SETTINGS.navigatorSizeRatio},ot,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:ot.autoResize,minZoomImageRatio:1,background:ot.background,opacity:ot.opacity,borderColor:ot.borderColor,displayRegionColor:ot.displayRegionColor}),ot.minPixelRatio=this.minPixelRatio=at.minPixelRatio,et.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new et.Point(1,1),this.totalBorderWidths=new et.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),ot.controlOptions.anchor!=et.ControlAnchor.NONE&&function(pt,mt){pt.margin="0px",pt.border=mt+"px solid "+ot.borderColor,pt.padding="0px",pt.background=ot.background,pt.opacity=ot.opacity,pt.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=et.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(pt,mt){pt.position="relative",pt.top="0px",pt.left="0px",pt.fontSize="0px",pt.overflow="hidden",pt.border=mt+"px solid "+ot.displayRegionColor,pt.margin="0px",pt.padding="0px",pt.background="transparent",pt.float="left",pt.cssFloat="left",pt.styleFloat="left",pt.zIndex=999999999,pt.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=et.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",at.addControl(this.element,ot.controlOptions),this._resizeWithViewer=ot.controlOptions.anchor!=et.ControlAnchor.ABSOLUTE&&ot.controlOptions.anchor!=et.ControlAnchor.NONE,ot.width&&ot.height?(this.setWidth(ot.width),this.setHeight(ot.height)):this._resizeWithViewer&&(ut=et.getElementSize(at.element),this.element.style.height=Math.round(ut.y*ot.sizeRatio)+"px",this.element.style.width=Math.round(ut.x*ot.sizeRatio)+"px",this.oldViewerSize=ut,ct=et.getElementSize(this.element),this.elementArea=ct.x*ct.y),this.oldContainerSize=new et.Point(0,0),et.Viewer.apply(this,[ot]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function dt(pt){it(lt.displayRegionContainer,pt),it(lt.displayRegion,-pt),lt.viewport.setRotation(pt)}if(ot.navigatorRotate){var ft=ot.viewer.viewport?ot.viewer.viewport.getRotation():ot.viewer.degrees||0;dt(ft),ot.viewer.addHandler("rotate",function(pt){dt(pt.degrees)})}this.innerTracker.destroy(),this.innerTracker=new et.MouseTracker({element:this.element,dragHandler:et.delegate(this,tt),clickHandler:et.delegate(this,_e),releaseHandler:et.delegate(this,rt),scrollHandler:et.delegate(this,nt)}),this.addHandler("reset-size",function(){lt.viewport&&lt.viewport.goHome(!0)}),at.world.addHandler("item-index-change",function(pt){window.setTimeout(function(){var mt=lt.world.getItemAt(pt.previousIndex);lt.world.setItemIndex(mt,pt.newIndex)},1)}),at.world.addHandler("remove-item",function(pt){var mt=pt.item,ht=lt._getMatchingItem(mt);ht&&lt.world.removeItem(ht)}),this.update(at.viewport)},et.extend(et.Navigator.prototype,et.EventSource.prototype,et.Viewer.prototype,{updateSize:function(){if(this.viewport){var ot=new et.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);ot.equals(this.oldContainerSize)||(this.viewport.resize(ot,!0),this.viewport.goHome(!0),this.oldContainerSize=ot,this.drawer.clear(),this.world.draw())}},setWidth:function(ot){this.width=ot,this.element.style.width=typeof ot=="number"?ot+"px":ot,this._resizeWithViewer=!1},setHeight:function(ot){this.height=ot,this.element.style.height=typeof ot=="number"?ot+"px":ot,this._resizeWithViewer=!1},setFlip:function(ot){return this.viewport.setFlip(ot),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(ot){st(this.displayRegion,ot),st(this.canvas,ot),st(this.element,ot)},update:function(ot){var at,lt,ut,ct,dt,ft;if(at=et.getElementSize(this.viewer.element),this._resizeWithViewer&&at.x&&at.y&&!at.equals(this.oldViewerSize)&&(this.oldViewerSize=at,this.maintainSizeRatio||!this.elementArea?(lt=at.x*this.sizeRatio,ut=at.y*this.sizeRatio):(lt=Math.sqrt(this.elementArea*(at.x/at.y)),ut=this.elementArea/lt),this.element.style.width=Math.round(lt)+"px",this.element.style.height=Math.round(ut)+"px",this.elementArea||(this.elementArea=lt*ut),this.updateSize()),ot&&this.viewport){ct=ot.getBoundsNoRotate(!0),dt=this.viewport.pixelFromPointNoRotate(ct.getTopLeft(),!1),ft=this.viewport.pixelFromPointNoRotate(ct.getBottomRight(),!1).minus(this.totalBorderWidths);var pt=this.displayRegion.style;pt.display=this.world.getItemCount()?"block":"none",pt.top=Math.round(dt.y)+"px",pt.left=Math.round(dt.x)+"px";var mt=Math.abs(dt.x-ft.x),ht=Math.abs(dt.y-ft.y);pt.width=Math.round(Math.max(mt,0))+"px",pt.height=Math.round(Math.max(ht,0))+"px"}},addTiledImage:function(ot){var at=this,lt=ot.originalTiledImage;delete ot.original;var ut=et.extend({},ot,{success:function(ct){var dt=ct.item;dt._originalForNavigator=lt,at._matchBounds(dt,lt,!0);function ft(){at._matchBounds(dt,lt)}function pt(){at._matchOpacity(dt,lt)}function mt(){at._matchCompositeOperation(dt,lt)}lt.addHandler("bounds-change",ft),lt.addHandler("clip-change",ft),lt.addHandler("opacity-change",pt),lt.addHandler("composite-operation-change",mt)}});return et.Viewer.prototype.addTiledImage.apply(this,[ut])},_getMatchingItem:function(ot){for(var at=this.world.getItemCount(),lt,ut=0;ut<at;ut++)if(lt=this.world.getItemAt(ut),lt._originalForNavigator===ot)return lt;return null},_matchBounds:function(ot,at,lt){var ut=at.getBoundsNoRotate();ot.setPosition(ut.getTopLeft(),lt),ot.setWidth(ut.width,lt),ot.setRotation(at.getRotation(),lt),ot.setClip(at.getClip())},_matchOpacity:function(ot,at){ot.setOpacity(at.opacity)},_matchCompositeOperation:function(ot,at){ot.setCompositeOperation(at.compositeOperation)}});function _e(ot){var at={tracker:ot.eventSource,position:ot.position,quick:ot.quick,shift:ot.shift,originalEvent:ot.originalEvent,preventDefaultAction:ot.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",at),!at.preventDefaultAction&&ot.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(ot.position.x=this.viewport.getContainerSize().x-ot.position.x);var lt=this.viewport.pointFromPixel(ot.position);this.panVertical?this.panHorizontal||(lt.x=this.viewer.viewport.getCenter(!0).x):lt.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(lt),this.viewer.viewport.applyConstraints()}}function tt(ot){var at={tracker:ot.eventSource,position:ot.position,delta:ot.delta,speed:ot.speed,direction:ot.direction,shift:ot.shift,originalEvent:ot.originalEvent,preventDefaultAction:ot.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",at),!at.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(ot.delta.x=0),this.panVertical||(ot.delta.y=0),this.viewer.viewport.flipped&&(ot.delta.x=-ot.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(ot.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function rt(ot){ot.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function nt(ot){return this.viewer.raiseEvent("navigator-scroll",{tracker:ot.eventSource,position:ot.position,scroll:ot.scroll,shift:ot.shift,originalEvent:ot.originalEvent}),!1}function it(ot,at){st(ot,"rotate("+at+"deg)")}function st(ot,at){ot.style.webkitTransform=at,ot.style.mozTransform=at,ot.style.msTransform=at,ot.style.oTransform=at,ot.style.transform=at}}(OpenSeadragon),function(et){var _e={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};et.extend(et,{getString:function(tt){var rt=tt.split("."),nt=null,it=arguments,st=_e,ot;for(ot=0;ot<rt.length-1;ot++)st=st[rt[ot]]||{};return nt=st[rt[ot]],typeof nt!="string"&&(et.console.log("Untranslated source string:",tt),nt=""),nt.replace(/\{\d+\}/g,function(at){var lt=parseInt(at.match(/\d+/),10)+1;return lt<it.length?it[lt]:""})},setString:function(tt,rt){var nt=tt.split("."),it=_e,st;for(st=0;st<nt.length-1;st++)it[nt[st]]||(it[nt[st]]={}),it=it[nt[st]];it[nt[st]]=rt}})}(OpenSeadragon),function(et){et.Point=function(_e,tt){this.x=typeof _e=="number"?_e:0,this.y=typeof tt=="number"?tt:0},et.Point.prototype={clone:function(){return new et.Point(this.x,this.y)},plus:function(_e){return new et.Point(this.x+_e.x,this.y+_e.y)},minus:function(_e){return new et.Point(this.x-_e.x,this.y-_e.y)},times:function(_e){return new et.Point(this.x*_e,this.y*_e)},divide:function(_e){return new et.Point(this.x/_e,this.y/_e)},negate:function(){return new et.Point(-this.x,-this.y)},distanceTo:function(_e){return Math.sqrt(Math.pow(this.x-_e.x,2)+Math.pow(this.y-_e.y,2))},squaredDistanceTo:function(_e){return Math.pow(this.x-_e.x,2)+Math.pow(this.y-_e.y,2)},apply:function(_e){return new et.Point(_e(this.x),_e(this.y))},equals:function(_e){return _e instanceof et.Point&&this.x===_e.x&&this.y===_e.y},rotate:function(_e,tt){tt=tt||new et.Point(0,0);var rt,nt;if(_e%90===0){var it=et.positiveModulo(_e,360);switch(it){case 0:rt=1,nt=0;break;case 90:rt=0,nt=1;break;case 180:rt=-1,nt=0;break;case 270:rt=0,nt=-1;break}}else{var st=_e*Math.PI/180;rt=Math.cos(st),nt=Math.sin(st)}var ot=rt*(this.x-tt.x)-nt*(this.y-tt.y)+tt.x,at=nt*(this.x-tt.x)+rt*(this.y-tt.y)+tt.y;return new et.Point(ot,at)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(OpenSeadragon),function(et){et.TileSource=function(tt,rt,nt,it,st,ot){var at=this,lt=arguments,ut,ct;if(et.isPlainObject(tt)?ut=tt:ut={width:lt[0],height:lt[1],tileSize:lt[2],tileOverlap:lt[3],minLevel:lt[4],maxLevel:lt[5]},et.EventSource.call(this),et.extend(!0,this,ut),!this.success){for(ct=0;ct<arguments.length;ct++)if(et.isFunction(arguments[ct])){this.success=arguments[ct];break}}this.success&&this.addHandler("ready",function(dt){at.success(dt)}),et.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new et.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=ut.width&&ut.height?ut.width/ut.height:1,this.dimensions=new et.Point(ut.width,ut.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=ut.tileOverlap?ut.tileOverlap:0,this.minLevel=ut.minLevel?ut.minLevel:0,this.maxLevel=ut.maxLevel!==void 0&&ut.maxLevel!==null?ut.maxLevel:ut.width&&ut.height?Math.ceil(Math.log(Math.max(ut.width,ut.height))/Math.log(2)):0,this.success&&et.isFunction(this.success)&&this.success(this))},et.TileSource.prototype={getTileSize:function(tt){return et.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(tt){return this._tileWidth?this._tileWidth:this.getTileSize(tt)},getTileHeight:function(tt){return this._tileHeight?this._tileHeight:this.getTileSize(tt)},getLevelScale:function(tt){var rt={},nt;for(nt=0;nt<=this.maxLevel;nt++)rt[nt]=1/Math.pow(2,this.maxLevel-nt);return this.getLevelScale=function(it){return rt[it]},this.getLevelScale(tt)},getNumTiles:function(tt){var rt=this.getLevelScale(tt),nt=Math.ceil(rt*this.dimensions.x/this.getTileWidth(tt)),it=Math.ceil(rt*this.dimensions.y/this.getTileHeight(tt));return new et.Point(nt,it)},getPixelRatio:function(tt){var rt=this.dimensions.times(this.getLevelScale(tt)),nt=1/rt.x,it=1/rt.y;return new et.Point(nt,it)},getClosestLevel:function(){var tt,rt;for(tt=this.minLevel+1;tt<=this.maxLevel&&(rt=this.getNumTiles(tt),!(rt.x>1||rt.y>1));tt++);return tt-1},getTileAtPoint:function(tt,rt){var nt=rt.x>=0&&rt.x<=1&&rt.y>=0&&rt.y<=1/this.aspectRatio;et.console.assert(nt,"[TileSource.getTileAtPoint] must be called with a valid point.");var it=this.dimensions.x*this.getLevelScale(tt),st=rt.x*it,ot=rt.y*it,at=Math.floor(st/this.getTileWidth(tt)),lt=Math.floor(ot/this.getTileHeight(tt));rt.x>=1&&(at=this.getNumTiles(tt).x-1);var ut=1e-15;return rt.y>=1/this.aspectRatio-ut&&(lt=this.getNumTiles(tt).y-1),new et.Point(at,lt)},getTileBounds:function(tt,rt,nt,it){var st=this.dimensions.times(this.getLevelScale(tt)),ot=this.getTileWidth(tt),at=this.getTileHeight(tt),lt=rt===0?0:ot*rt-this.tileOverlap,ut=nt===0?0:at*nt-this.tileOverlap,ct=ot+(rt===0?1:2)*this.tileOverlap,dt=at+(nt===0?1:2)*this.tileOverlap,ft=1/st.x;return ct=Math.min(ct,st.x-lt),dt=Math.min(dt,st.y-ut),it?new et.Rect(0,0,ct,dt):new et.Rect(lt*ft,ut*ft,ct*ft,dt*ft)},getImageInfo:function(tt){var rt=this,nt,it,st,ot,at,lt,ut;tt&&(at=tt.split("/"),lt=at[at.length-1],ut=lt.lastIndexOf("."),ut>-1&&(at[at.length-1]=lt.slice(0,ut))),it=function(ct){typeof ct=="string"&&(ct=et.parseXml(ct));var dt=et.TileSource.determineType(rt,ct,tt);if(!dt){rt.raiseEvent("open-failed",{message:"Unable to load TileSource",source:tt});return}ot=dt.prototype.configure.apply(rt,[ct,tt]),ot.ajaxWithCredentials===void 0&&(ot.ajaxWithCredentials=rt.ajaxWithCredentials),st=new dt(ot),rt.ready=!0,rt.raiseEvent("ready",{tileSource:st})},tt.match(/\.js$/)?(nt=tt.split("/").pop().replace(".js",""),et.jsonp({url:tt,async:!1,callbackName:nt,callback:it})):et.makeAjaxRequest({url:tt,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(ct){var dt=_e(ct);it(dt)},error:function(ct,dt){var ft;try{ft="HTTP "+ct.status+" attempting to load TileSource"}catch{var pt;typeof dt>"u"||!dt.toString?pt="Unknown error":pt=dt.toString(),ft=pt+" attempting to load TileSource"}rt.raiseEvent("open-failed",{message:ft,source:tt})}})},supports:function(tt,rt){return!1},configure:function(tt,rt){throw new Error("Method not implemented.")},getTileUrl:function(tt,rt,nt){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(tt,rt,nt){return{}},tileExists:function(tt,rt,nt){var it=this.getNumTiles(tt);return tt>=this.minLevel&&tt<=this.maxLevel&&rt>=0&&nt>=0&&rt<it.x&&nt<it.y}},et.extend(!0,et.TileSource.prototype,et.EventSource.prototype);function _e(tt){var rt=tt.responseText,nt=tt.status,it,st;if(tt){if(tt.status!==200&&tt.status!==0)throw nt=tt.status,it=nt==404?"Not Found":tt.statusText,new Error(et.getString("Errors.Status",nt,it))}else throw new Error(et.getString("Errors.Security"));if(rt.match(/\s*<.*/))try{st=tt.responseXML&&tt.responseXML.documentElement?tt.responseXML:et.parseXml(rt)}catch{st=tt.responseText}else if(rt.match(/\s*[\{\[].*/))try{st=et.parseJSON(rt)}catch{st=rt}else st=rt;return st}et.TileSource.determineType=function(tt,rt,nt){var it;for(it in OpenSeadragon)if(it.match(/.+TileSource$/)&&et.isFunction(OpenSeadragon[it])&&et.isFunction(OpenSeadragon[it].prototype.supports)&&OpenSeadragon[it].prototype.supports.call(tt,rt,nt))return OpenSeadragon[it];et.console.error("No TileSource was able to open %s %s",nt,rt)}}(OpenSeadragon),function(et){et.DziTileSource=function(rt,nt,it,st,ot,at,lt,ut,ct){var dt,ft,pt,mt;if(et.isPlainObject(rt)?mt=rt:mt={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=mt.tilesUrl,this.fileFormat=mt.fileFormat,this.displayRects=mt.displayRects,this.displayRects)for(dt=this.displayRects.length-1;dt>=0;dt--)for(ft=this.displayRects[dt],pt=ft.minLevel;pt<=ft.maxLevel;pt++)this._levelRects[pt]||(this._levelRects[pt]=[]),this._levelRects[pt].push(ft);et.TileSource.apply(this,[mt])},et.extend(et.DziTileSource.prototype,et.TileSource.prototype,{supports:function(rt,nt){var it;return rt.Image?it=rt.Image.xmlns:rt.documentElement&&(rt.documentElement.localName=="Image"||rt.documentElement.tagName=="Image")&&(it=rt.documentElement.namespaceURI),it=(it||"").toLowerCase(),it.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||it.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(rt,nt){var it;return et.isPlainObject(rt)?it=tt(this,rt):it=_e(this,rt),nt&&!it.tilesUrl&&(it.tilesUrl=nt.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),nt.search(/\.(dzi|xml|js)\?/)!=-1?it.queryParams=nt.match(/\?.*/):it.queryParams=""),it},getTileUrl:function(rt,nt,it){return[this.tilesUrl,rt,"/",nt,"_",it,".",this.fileFormat,this.queryParams].join("")},tileExists:function(rt,nt,it){var st=this._levelRects[rt],ot,at,lt,ut,ct,dt,ft;if(this.minLevel&&rt<this.minLevel||this.maxLevel&&rt>this.maxLevel)return!1;if(!st||!st.length)return!0;for(ft=st.length-1;ft>=0;ft--)if(ot=st[ft],!(rt<ot.minLevel||rt>ot.maxLevel)&&(at=this.getLevelScale(rt),lt=ot.x*at,ut=ot.y*at,ct=lt+ot.width*at,dt=ut+ot.height*at,lt=Math.floor(lt/this._tileWidth),ut=Math.floor(ut/this._tileWidth),ct=Math.ceil(ct/this._tileWidth),dt=Math.ceil(dt/this._tileWidth),lt<=nt&&nt<ct&&ut<=it&&it<dt))return!0;return!1}});function _e(rt,nt){if(!nt||!nt.documentElement)throw new Error(et.getString("Errors.Xml"));var it=nt.documentElement,st=it.localName||it.tagName,ot=nt.documentElement.namespaceURI,at=null,lt=[],ut,ct,dt,ft,pt;if(st=="Image")try{if(ft=it.getElementsByTagName("Size")[0],ft===void 0&&(ft=it.getElementsByTagNameNS(ot,"Size")[0]),at={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:it.getAttribute("Url"),Format:it.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(it.getAttribute("Overlap"),10),TileSize:parseInt(it.getAttribute("TileSize"),10),Size:{Height:parseInt(ft.getAttribute("Height"),10),Width:parseInt(ft.getAttribute("Width"),10)}}},!et.imageFormatSupported(at.Image.Format))throw new Error(et.getString("Errors.ImageFormat",at.Image.Format.toUpperCase()));for(ut=it.getElementsByTagName("DisplayRect"),ut===void 0&&(ut=it.getElementsByTagNameNS(ot,"DisplayRect")[0]),pt=0;pt<ut.length;pt++)ct=ut[pt],dt=ct.getElementsByTagName("Rect")[0],dt===void 0&&(dt=ct.getElementsByTagNameNS(ot,"Rect")[0]),lt.push({Rect:{X:parseInt(dt.getAttribute("X"),10),Y:parseInt(dt.getAttribute("Y"),10),Width:parseInt(dt.getAttribute("Width"),10),Height:parseInt(dt.getAttribute("Height"),10),MinLevel:parseInt(ct.getAttribute("MinLevel"),10),MaxLevel:parseInt(ct.getAttribute("MaxLevel"),10)}});return lt.length&&(at.Image.DisplayRect=lt),tt(rt,at)}catch(gt){throw gt instanceof Error?gt:new Error(et.getString("Errors.Dzi"))}else{if(st=="Collection")throw new Error(et.getString("Errors.Dzc"));if(st=="Error"){var mt=it.getElementsByTagName("Message")[0],ht=mt.firstChild.nodeValue;throw new Error(ht)}}throw new Error(et.getString("Errors.Dzi"))}function tt(rt,nt){var it=nt.Image,st=it.Url,ot=it.Format,at=it.Size,lt=it.DisplayRect||[],ut=parseInt(at.Width,10),ct=parseInt(at.Height,10),dt=parseInt(it.TileSize,10),ft=parseInt(it.Overlap,10),pt=[],mt,ht;for(ht=0;ht<lt.length;ht++)mt=lt[ht].Rect,pt.push(new et.DisplayRect(parseInt(mt.X,10),parseInt(mt.Y,10),parseInt(mt.Width,10),parseInt(mt.Height,10),parseInt(mt.MinLevel,10),parseInt(mt.MaxLevel,10)));return et.extend(!0,{width:ut,height:ct,tileSize:dt,tileOverlap:ft,minLevel:null,maxLevel:null,tilesUrl:st,fileFormat:ot,displayRects:pt},nt)}}(OpenSeadragon),function(et){et.IIIFTileSource=function(it){if(et.extend(!0,this,it),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(it.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=it.version,this.tile_width&&this.tile_height)it.tileWidth=this.tile_width,it.tileHeight=this.tile_height;else if(this.tile_width)it.tileSize=this.tile_width;else if(this.tile_height)it.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)it.tileWidth=this.tiles[0].width,it.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var st=0;st<this.tiles.length;st++)for(var ot=0;ot<this.tiles[st].scaleFactors.length;ot++){var at=this.tiles[st].scaleFactors[ot];this.scale_factors.push(at),it.tileSizePerScaleFactor[at]={width:this.tiles[st].width,height:this.tiles[st].height||this.tiles[st].width}}}else if(_e(it)){for(var lt=Math.min(this.height,this.width),ut=[256,512,1024],ct=[],dt=0;dt<ut.length;dt++)ut[dt]<=lt&&ct.push(ut[dt]);ct.length>0?it.tileSize=Math.max.apply(null,ct):it.tileSize=lt}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,it.levels=tt(this),et.extend(!0,it,{width:it.levels[it.levels.length-1].width,height:it.levels[it.levels.length-1].height,tileSize:Math.max(it.height,it.width),tileOverlap:0,minLevel:0,maxLevel:it.levels.length-1}),this.levels=it.levels):et.console.error("Nothing in the info.json to construct image pyramids from");if(!it.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)it.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var ft=Math.max.apply(null,this.scale_factors);it.maxLevel=Math.round(Math.log(ft)*Math.LOG2E)}et.TileSource.apply(this,[it])},et.extend(et.IIIFTileSource.prototype,et.TileSource.prototype,{supports:function(it,st){return it.protocol&&it.protocol=="http://iiif.io/api/image"||it["@context"]&&(it["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||it["@context"]=="http://iiif.io/api/image/1/context.json")||it.profile&&it.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||it.identifier&&it.width&&it.height?!0:!!(it.documentElement&&it.documentElement.tagName=="info"&&it.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(it,st){if(et.isPlainObject(it)){if(!it["@context"])it["@context"]="http://iiif.io/api/image/1.0/context.json",it["@id"]=st.replace("/info.json",""),it.version=1;else{var at=it["@context"];if(Array.isArray(at)){for(var lt=0;lt<at.length;lt++)if(typeof at[lt]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(at[lt])||at[lt]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){at=at[lt];break}}switch(at){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":it.version=1;break;case"http://iiif.io/api/image/2/context.json":it.version=2;break;case"http://iiif.io/api/image/3/context.json":it.version=3;break;default:et.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!it["@id"]&&it.id&&(it["@id"]=it.id),it.preferredFormats){for(var ut=0;ut<it.preferredFormats.length;ut++)if(OpenSeadragon.imageFormatSupported(it.preferredFormats[ut])){it.tileFormat=it.preferredFormats[ut];break}}return it}else{var ot=rt(it);return ot["@context"]="http://iiif.io/api/image/1.0/context.json",ot["@id"]=st.replace("/info.xml",""),ot.version=1,ot}},getTileWidth:function(it){if(this.emulateLegacyImagePyramid)return et.TileSource.prototype.getTileWidth.call(this,it);var st=Math.pow(2,this.maxLevel-it);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[st]?this.tileSizePerScaleFactor[st].width:this._tileWidth},getTileHeight:function(it){if(this.emulateLegacyImagePyramid)return et.TileSource.prototype.getTileHeight.call(this,it);var st=Math.pow(2,this.maxLevel-it);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[st]?this.tileSizePerScaleFactor[st].height:this._tileHeight},getLevelScale:function(it){if(this.emulateLegacyImagePyramid){var st=NaN;return this.levels.length>0&&it>=this.minLevel&&it<=this.maxLevel&&(st=this.levels[it].width/this.levels[this.maxLevel].width),st}return et.TileSource.prototype.getLevelScale.call(this,it)},getNumTiles:function(it){if(this.emulateLegacyImagePyramid){var st=this.getLevelScale(it);return st?new et.Point(1,1):new et.Point(0,0)}return et.TileSource.prototype.getNumTiles.call(this,it)},getTileAtPoint:function(it,st){return this.emulateLegacyImagePyramid?new et.Point(0,0):et.TileSource.prototype.getTileAtPoint.call(this,it,st)},getTileUrl:function(it,st,ot){if(this.emulateLegacyImagePyramid){var at=null;return this.levels.length>0&&it>=this.minLevel&&it<=this.maxLevel&&(at=this.levels[it].url),at}var lt="0",ut=Math.pow(.5,this.maxLevel-it),ct=Math.ceil(this.width*ut),dt=Math.ceil(this.height*ut),ft,pt,mt,ht,gt,vt,yt,bt,xt,_t,wt,Ct,kt,At;return ft=this.getTileWidth(it),pt=this.getTileHeight(it),mt=Math.ceil(ft/ut),ht=Math.ceil(pt/ut),this.version===1?kt="native."+this.tileFormat:kt="default."+this.tileFormat,ct<ft&&dt<pt?(this.version===2&&ct===this.width||this.version===3&&ct===this.width&&dt===this.height?_t="max":this.version===3?_t=ct+","+dt:_t=ct+",",gt="full"):(vt=st*mt,yt=ot*ht,bt=Math.min(mt,this.width-vt),xt=Math.min(ht,this.height-yt),st===0&&ot===0&&bt===this.width&&xt===this.height?gt="full":gt=[vt,yt,bt,xt].join(","),wt=Math.ceil(bt*ut),Ct=Math.ceil(xt*ut),this.version===2&&wt===this.width||this.version===3&&wt===this.width&&Ct===this.height?_t="max":this.version===3?_t=wt+","+Ct:_t=wt+","),At=[this["@id"],gt,_t,lt,kt].join("/"),At},__testonly__:{canBeTiled:_e,constructLevels:tt}});function _e(it){var st=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],ot=Array.isArray(it.profile)?it.profile[0]:it.profile,at=st.indexOf(ot)!==-1,lt=!1;return it.version===2&&it.profile.length>1&&it.profile[1].supports&&(lt=it.profile[1].supports.indexOf("sizeByW")!==-1),it.version===3&&it.extraFeatures&&(lt=it.extraFeatures.indexOf("sizeByWh")!==-1),!at||lt}function tt(it){for(var st=[],ot=0;ot<it.sizes.length;ot++)st.push({url:it["@id"]+"/full/"+it.sizes[ot].width+","+(it.version===3?it.sizes[ot].height:"")+"/0/default."+it.tileFormat,width:it.sizes[ot].width,height:it.sizes[ot].height});return st.sort(function(at,lt){return at.width-lt.width})}function rt(it){if(!it||!it.documentElement)throw new Error(et.getString("Errors.Xml"));var st=it.documentElement,ot=st.tagName,at=null;if(ot=="info")try{return at={},nt(st,at),at}catch(lt){throw lt instanceof Error?lt:new Error(et.getString("Errors.IIIF"))}throw new Error(et.getString("Errors.IIIF"))}function nt(it,st,ot){var at,lt;if(it.nodeType==3&&ot)lt=it.nodeValue.trim(),lt.match(/^\d*$/)&&(lt=Number(lt)),st[ot]?(et.isArray(st[ot])||(st[ot]=[st[ot]]),st[ot].push(lt)):st[ot]=lt;else if(it.nodeType==1)for(at=0;at<it.childNodes.length;at++)nt(it.childNodes[at],st,it.nodeName)}}(OpenSeadragon),function(et){et.OsmTileSource=function(_e,tt,rt,nt,it){var st;et.isPlainObject(_e)?st=_e:st={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!st.width||!st.height)&&(st.width=65572864,st.height=65572864),st.tileSize||(st.tileSize=256,st.tileOverlap=0),st.tilesUrl||(st.tilesUrl="http://tile.openstreetmap.org/"),st.minLevel=8,et.TileSource.apply(this,[st])},et.extend(et.OsmTileSource.prototype,et.TileSource.prototype,{supports:function(_e,tt){return _e.type&&_e.type=="openstreetmaps"},configure:function(_e,tt){return _e},getTileUrl:function(_e,tt,rt){return this.tilesUrl+(_e-8)+"/"+tt+"/"+rt+".png"}})}(OpenSeadragon),function(et){et.TmsTileSource=function(_e,tt,rt,nt,it){var st;et.isPlainObject(_e)?st=_e:st={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var ot=Math.ceil(st.width/256)*256,at=Math.ceil(st.height/256)*256,lt;ot>at?lt=ot/256:lt=at/256,st.maxLevel=Math.ceil(Math.log(lt)/Math.log(2))-1,st.tileSize=256,st.width=ot,st.height=at,et.TileSource.apply(this,[st])},et.extend(et.TmsTileSource.prototype,et.TileSource.prototype,{supports:function(_e,tt){return _e.type&&_e.type=="tiledmapservice"},configure:function(_e,tt){return _e},getTileUrl:function(_e,tt,rt){var nt=this.getNumTiles(_e).y-1;return this.tilesUrl+_e+"/"+tt+"/"+(nt-rt)+".png"}})}(OpenSeadragon),function(et){et.ZoomifyTileSource=function(_e){_e.tileSize=256;var tt={x:_e.width,y:_e.height};for(_e.imageSizes=[{x:_e.width,y:_e.height}],_e.gridSize=[this._getGridSize(_e.width,_e.height,_e.tileSize)];parseInt(tt.x,10)>_e.tileSize||parseInt(tt.y,10)>_e.tileSize;)tt.x=Math.floor(tt.x/2),tt.y=Math.floor(tt.y/2),_e.imageSizes.push({x:tt.x,y:tt.y}),_e.gridSize.push(this._getGridSize(tt.x,tt.y,_e.tileSize));_e.imageSizes.reverse(),_e.gridSize.reverse(),_e.minLevel=0,_e.maxLevel=_e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[_e])},et.extend(et.ZoomifyTileSource.prototype,et.TileSource.prototype,{_getGridSize:function(_e,tt,rt){return{x:Math.ceil(_e/rt),y:Math.ceil(tt/rt)}},_calculateAbsoluteTileNumber:function(_e,tt,rt){for(var nt=0,it={},st=0;st<_e;st++)it=this.gridSize[st],nt+=it.x*it.y;return it=this.gridSize[_e],nt+=it.x*rt+tt,nt},supports:function(_e,tt){return _e.type&&_e.type=="zoomifytileservice"},configure:function(_e,tt){return _e},getTileUrl:function(_e,tt,rt){var nt=0,it=this._calculateAbsoluteTileNumber(_e,tt,rt);return nt=Math.floor(it/256),this.tilesUrl+"TileGroup"+nt+"/"+_e+"-"+tt+"-"+rt+".jpg"}})}(OpenSeadragon),function(et){et.LegacyTileSource=function(nt){var it,st,ot;et.isArray(nt)&&(it={type:"legacy-image-pyramid",levels:nt}),it.levels=_e(it.levels),it.levels.length>0?(st=it.levels[it.levels.length-1].width,ot=it.levels[it.levels.length-1].height):(st=0,ot=0,et.console.error("No supported image formats found")),et.extend(!0,it,{width:st,height:ot,tileSize:Math.max(ot,st),tileOverlap:0,minLevel:0,maxLevel:it.levels.length>0?it.levels.length-1:0}),et.TileSource.apply(this,[it]),this.levels=it.levels},et.extend(et.LegacyTileSource.prototype,et.TileSource.prototype,{supports:function(nt,it){return nt.type&&nt.type=="legacy-image-pyramid"||nt.documentElement&&nt.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(nt,it){var st;return et.isPlainObject(nt)?st=rt(this,nt):st=tt(this,nt),st},getLevelScale:function(nt){var it=NaN;return this.levels.length>0&&nt>=this.minLevel&&nt<=this.maxLevel&&(it=this.levels[nt].width/this.levels[this.maxLevel].width),it},getNumTiles:function(nt){var it=this.getLevelScale(nt);return it?new et.Point(1,1):new et.Point(0,0)},getTileUrl:function(nt,it,st){var ot=null;return this.levels.length>0&&nt>=this.minLevel&&nt<=this.maxLevel&&(ot=this.levels[nt].url),ot}});function _e(nt){var it=[],st,ot;for(ot=0;ot<nt.length;ot++)st=nt[ot],st.height&&st.width&&st.url?it.push({url:st.url,width:Number(st.width),height:Number(st.height)}):et.console.error("Unsupported image format: %s",st.url?st.url:"<no URL>");return it.sort(function(at,lt){return at.height-lt.height})}function tt(nt,it){if(!it||!it.documentElement)throw new Error(et.getString("Errors.Xml"));var st=it.documentElement,ot=st.tagName,at=null,lt=[],ut,ct;if(ot=="image")try{for(at={type:st.getAttribute("type"),levels:[]},lt=st.getElementsByTagName("level"),ct=0;ct<lt.length;ct++)ut=lt[ct],at.levels.push({url:ut.getAttribute("url"),width:parseInt(ut.getAttribute("width"),10),height:parseInt(ut.getAttribute("height"),10)});return rt(nt,at)}catch(dt){throw dt instanceof Error?dt:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(ot=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(ot=="error")throw new Error("Error: "+it)}throw new Error("Unknown element "+ot)}function rt(nt,it){return it.levels}}(OpenSeadragon),function(et){et.ImageTileSource=function(_e){_e=et.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},_e),et.TileSource.apply(this,[_e])},et.extend(et.ImageTileSource.prototype,et.TileSource.prototype,{supports:function(_e,tt){return _e.type&&_e.type==="image"},configure:function(_e,tt){return _e},getImageInfo:function(_e){var tt=this._image=new Image,rt=this;this.crossOriginPolicy&&(tt.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(tt.useCredentials=this.ajaxWithCredentials),et.addEvent(tt,"load",function(){rt.width=Object.prototype.hasOwnProperty.call(tt,"naturalWidth")?tt.naturalWidth:tt.width,rt.height=Object.prototype.hasOwnProperty.call(tt,"naturalHeight")?tt.naturalHeight:tt.height,rt.aspectRatio=rt.width/rt.height,rt.dimensions=new et.Point(rt.width,rt.height),rt._tileWidth=rt.width,rt._tileHeight=rt.height,rt.tileOverlap=0,rt.minLevel=0,rt.levels=rt._buildLevels(),rt.maxLevel=rt.levels.length-1,rt.ready=!0,rt.raiseEvent("ready",{tileSource:rt})}),et.addEvent(tt,"error",function(){rt.raiseEvent("open-failed",{message:"Error loading image at "+_e,source:_e})}),tt.src=_e},getLevelScale:function(_e){var tt=NaN;return _e>=this.minLevel&&_e<=this.maxLevel&&(tt=this.levels[_e].width/this.levels[this.maxLevel].width),tt},getNumTiles:function(_e){var tt=this.getLevelScale(_e);return tt?new et.Point(1,1):new et.Point(0,0)},getTileUrl:function(_e,tt,rt){var nt=null;return _e>=this.minLevel&&_e<=this.maxLevel&&(nt=this.levels[_e].url),nt},getContext2D:function(_e,tt,rt){var nt=null;return _e>=this.minLevel&&_e<=this.maxLevel&&(nt=this.levels[_e].context2D),nt},_buildLevels:function(){var _e=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!et.supportsCanvas||!this.useCanvas)return delete this._image,_e;var tt=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,rt=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,nt=document.createElement("canvas"),it=nt.getContext("2d");if(nt.width=tt,nt.height=rt,it.drawImage(this._image,0,0,tt,rt),_e[0].context2D=it,delete this._image,et.isCanvasTainted(nt))return _e;for(;tt>=2&&rt>=2;){tt=Math.floor(tt/2),rt=Math.floor(rt/2);var st=document.createElement("canvas"),ot=st.getContext("2d");st.width=tt,st.height=rt,ot.drawImage(nt,0,0,tt,rt),_e.splice(0,0,{context2D:ot,width:tt,height:rt}),nt=st,it=ot}return _e}})}(OpenSeadragon),function(et){et.TileSourceCollection=function(_e,tt,rt,nt){et.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(et){et.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},et.Button=function(ot){var at=this;et.EventSource.call(this),et.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:et.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:et.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},ot),this.element=ot.element||et.makeNeutralElement("div"),ot.element||(this.imgRest=et.makeTransparentImage(this.srcRest),this.imgGroup=et.makeTransparentImage(this.srcGroup),this.imgHover=et.makeTransparentImage(this.srcHover),this.imgDown=et.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",et.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",et.Browser.vendor==et.BROWSERS.FIREFOX&&et.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=et.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new et.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(lt){lt.insideElementPressed?(it(at,et.ButtonState.DOWN),at.raiseEvent("enter",{originalEvent:lt.originalEvent})):lt.buttonDownAny||it(at,et.ButtonState.HOVER)},focusHandler:function(lt){this.enterHandler(lt),at.raiseEvent("focus",{originalEvent:lt.originalEvent})},exitHandler:function(lt){st(at,et.ButtonState.GROUP),lt.insideElementPressed&&at.raiseEvent("exit",{originalEvent:lt.originalEvent})},blurHandler:function(lt){this.exitHandler(lt),at.raiseEvent("blur",{originalEvent:lt.originalEvent})},pressHandler:function(lt){it(at,et.ButtonState.DOWN),at.raiseEvent("press",{originalEvent:lt.originalEvent})},releaseHandler:function(lt){lt.insideElementPressed&&lt.insideElementReleased?(st(at,et.ButtonState.HOVER),at.raiseEvent("release",{originalEvent:lt.originalEvent})):lt.insideElementPressed?st(at,et.ButtonState.GROUP):it(at,et.ButtonState.HOVER)},clickHandler:function(lt){lt.quick&&at.raiseEvent("click",{originalEvent:lt.originalEvent})},keyHandler:function(lt){return lt.keyCode===13?(at.raiseEvent("click",{originalEvent:lt.originalEvent}),at.raiseEvent("release",{originalEvent:lt.originalEvent}),!1):!0}}),st(this,et.ButtonState.REST)},et.extend(et.Button.prototype,et.EventSource.prototype,{notifyGroupEnter:function(){it(this,et.ButtonState.GROUP)},notifyGroupExit:function(){st(this,et.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,et.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,et.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function _e(ot){et.requestAnimationFrame(function(){tt(ot)})}function tt(ot){var at,lt,ut;ot.shouldFade&&(at=et.now(),lt=at-ot.fadeBeginTime,ut=1-lt/ot.fadeLength,ut=Math.min(1,ut),ut=Math.max(0,ut),ot.imgGroup&&et.setElementOpacity(ot.imgGroup,ut,!0),ut>0&&_e(ot))}function rt(ot){ot.shouldFade=!0,ot.fadeBeginTime=et.now()+ot.fadeDelay,window.setTimeout(function(){_e(ot)},ot.fadeDelay)}function nt(ot){ot.shouldFade=!1,ot.imgGroup&&et.setElementOpacity(ot.imgGroup,1,!0)}function it(ot,at){ot.element.disabled||(at>=et.ButtonState.GROUP&&ot.currentState==et.ButtonState.REST&&(nt(ot),ot.currentState=et.ButtonState.GROUP),at>=et.ButtonState.HOVER&&ot.currentState==et.ButtonState.GROUP&&(ot.imgHover&&(ot.imgHover.style.visibility=""),ot.currentState=et.ButtonState.HOVER),at>=et.ButtonState.DOWN&&ot.currentState==et.ButtonState.HOVER&&(ot.imgDown&&(ot.imgDown.style.visibility=""),ot.currentState=et.ButtonState.DOWN))}function st(ot,at){ot.element.disabled||(at<=et.ButtonState.HOVER&&ot.currentState==et.ButtonState.DOWN&&(ot.imgDown&&(ot.imgDown.style.visibility="hidden"),ot.currentState=et.ButtonState.HOVER),at<=et.ButtonState.GROUP&&ot.currentState==et.ButtonState.HOVER&&(ot.imgHover&&(ot.imgHover.style.visibility="hidden"),ot.currentState=et.ButtonState.GROUP),at<=et.ButtonState.REST&&ot.currentState==et.ButtonState.GROUP&&(rt(ot),ot.currentState=et.ButtonState.REST))}}(OpenSeadragon),function(et){et.ButtonGroup=function(_e){et.extend(!0,this,{buttons:[],clickTimeThreshold:et.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:et.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},_e);var tt=this.buttons.concat([]),rt=this,nt;if(this.element=_e.element||et.makeNeutralElement("div"),!_e.group)for(this.element.style.display="inline-block",nt=0;nt<tt.length;nt++)this.element.appendChild(tt[nt].element);et.setElementTouchActionNone(this.element),this.tracker=new et.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(it){var st;for(st=0;st<rt.buttons.length;st++)rt.buttons[st].notifyGroupEnter()},exitHandler:function(it){var st;if(!it.insideElementPressed)for(st=0;st<rt.buttons.length;st++)rt.buttons[st].notifyGroupExit()}})},et.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(et){et.Rect=function(_e,tt,rt,nt,it){this.x=typeof _e=="number"?_e:0,this.y=typeof tt=="number"?tt:0,this.width=typeof rt=="number"?rt:0,this.height=typeof nt=="number"?nt:0,this.degrees=typeof it=="number"?it:0,this.degrees=et.positiveModulo(this.degrees,360);var st,ot;this.degrees>=270?(st=this.getTopRight(),this.x=st.x,this.y=st.y,ot=this.height,this.height=this.width,this.width=ot,this.degrees-=270):this.degrees>=180?(st=this.getBottomRight(),this.x=st.x,this.y=st.y,this.degrees-=180):this.degrees>=90&&(st=this.getBottomLeft(),this.x=st.x,this.y=st.y,ot=this.height,this.height=this.width,this.width=ot,this.degrees-=90)},et.Rect.fromSummits=function(_e,tt,rt){var nt=_e.distanceTo(tt),it=_e.distanceTo(rt),st=tt.minus(_e),ot=Math.atan(st.y/st.x);return st.x<0?ot+=Math.PI:st.y<0&&(ot+=2*Math.PI),new et.Rect(_e.x,_e.y,nt,it,ot/Math.PI*180)},et.Rect.prototype={clone:function(){return new et.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new et.Point(this.x,this.y)},getBottomRight:function(){return new et.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new et.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new et.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new et.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new et.Point(this.width,this.height)},equals:function(_e){return _e instanceof et.Rect&&this.x===_e.x&&this.y===_e.y&&this.width===_e.width&&this.height===_e.height&&this.degrees===_e.degrees},times:function(_e){return new et.Rect(this.x*_e,this.y*_e,this.width*_e,this.height*_e,this.degrees)},translate:function(_e){return new et.Rect(this.x+_e.x,this.y+_e.y,this.width,this.height,this.degrees)},union:function(_e){var tt=this.getBoundingBox(),rt=_e.getBoundingBox(),nt=Math.min(tt.x,rt.x),it=Math.min(tt.y,rt.y),st=Math.max(tt.x+tt.width,rt.x+rt.width),ot=Math.max(tt.y+tt.height,rt.y+rt.height);return new et.Rect(nt,it,st-nt,ot-it)},intersection:function(_e){var tt=1e-10,rt=[],nt=this.getTopLeft();_e.containsPoint(nt,tt)&&rt.push(nt);var it=this.getTopRight();_e.containsPoint(it,tt)&&rt.push(it);var st=this.getBottomLeft();_e.containsPoint(st,tt)&&rt.push(st);var ot=this.getBottomRight();_e.containsPoint(ot,tt)&&rt.push(ot);var at=_e.getTopLeft();this.containsPoint(at,tt)&&rt.push(at);var lt=_e.getTopRight();this.containsPoint(lt,tt)&&rt.push(lt);var ut=_e.getBottomLeft();this.containsPoint(ut,tt)&&rt.push(ut);var ct=_e.getBottomRight();this.containsPoint(ct,tt)&&rt.push(ct);for(var dt=this._getSegments(),ft=_e._getSegments(),pt=0;pt<dt.length;pt++)for(var mt=dt[pt],ht=0;ht<ft.length;ht++){var gt=ft[ht],vt=yt(mt[0],mt[1],gt[0],gt[1]);vt&&rt.push(vt)}function yt(At,$t,Lt,Mt){var Bt=$t.minus(At),Pt=Mt.minus(Lt),Nt=-Pt.x*Bt.y+Bt.x*Pt.y;if(Nt===0)return null;var It=(Bt.x*(At.y-Lt.y)-Bt.y*(At.x-Lt.x))/Nt,Ft=(Pt.x*(At.y-Lt.y)-Pt.y*(At.x-Lt.x))/Nt;return-tt<=It&&It<=1-tt&&-tt<=Ft&&Ft<=1-tt?new et.Point(At.x+Ft*Bt.x,At.y+Ft*Bt.y):null}if(rt.length===0)return null;for(var bt=rt[0].x,xt=rt[0].x,_t=rt[0].y,wt=rt[0].y,Ct=1;Ct<rt.length;Ct++){var kt=rt[Ct];kt.x<bt&&(bt=kt.x),kt.x>xt&&(xt=kt.x),kt.y<_t&&(_t=kt.y),kt.y>wt&&(wt=kt.y)}return new et.Rect(bt,_t,xt-bt,wt-_t)},_getSegments:function(){var _e=this.getTopLeft(),tt=this.getTopRight(),rt=this.getBottomLeft(),nt=this.getBottomRight();return[[_e,tt],[tt,nt],[nt,rt],[rt,_e]]},rotate:function(_e,tt){if(_e=et.positiveModulo(_e,360),_e===0)return this.clone();tt=tt||this.getCenter();var rt=this.getTopLeft().rotate(_e,tt),nt=this.getTopRight().rotate(_e,tt),it=nt.minus(rt);it=it.apply(function(ot){var at=1e-15;return Math.abs(ot)<at?0:ot});var st=Math.atan(it.y/it.x);return it.x<0?st+=Math.PI:it.y<0&&(st+=2*Math.PI),new et.Rect(rt.x,rt.y,this.width,this.height,st/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var _e=this.getTopLeft(),tt=this.getTopRight(),rt=this.getBottomLeft(),nt=this.getBottomRight(),it=Math.min(_e.x,tt.x,rt.x,nt.x),st=Math.max(_e.x,tt.x,rt.x,nt.x),ot=Math.min(_e.y,tt.y,rt.y,nt.y),at=Math.max(_e.y,tt.y,rt.y,nt.y);return new et.Rect(it,ot,st-it,at-ot)},getIntegerBoundingBox:function(){var _e=this.getBoundingBox(),tt=Math.floor(_e.x),rt=Math.floor(_e.y),nt=Math.ceil(_e.width+_e.x-tt),it=Math.ceil(_e.height+_e.y-rt);return new et.Rect(tt,rt,nt,it)},containsPoint:function(_e,tt){tt=tt||0;var rt=this.getTopLeft(),nt=this.getTopRight(),it=this.getBottomLeft(),st=nt.minus(rt),ot=it.minus(rt);return(_e.x-rt.x)*st.x+(_e.y-rt.y)*st.y>=-tt&&(_e.x-nt.x)*st.x+(_e.y-nt.y)*st.y<=tt&&(_e.x-rt.x)*ot.x+(_e.y-rt.y)*ot.y>=-tt&&(_e.x-it.x)*ot.x+(_e.y-it.y)*ot.y<=tt},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(OpenSeadragon),function(et){var _e={};et.ReferenceStrip=function(lt){var ut=this,ct=lt.viewer,dt=et.getElementSize(ct.element),ft,pt,mt;for(lt.id||(lt.id="referencestrip-"+et.now(),this.element=et.makeNeutralElement("div"),this.element.id=lt.id,this.element.className="referencestrip"),lt=et.extend(!0,{sizeRatio:et.DEFAULT_SETTINGS.referenceStripSizeRatio,position:et.DEFAULT_SETTINGS.referenceStripPosition,scroll:et.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:et.DEFAULT_SETTINGS.clickTimeThreshold},lt,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),et.extend(this,lt),_e[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,pt=this.element.style,pt.marginTop="0px",pt.marginRight="0px",pt.marginBottom="0px",pt.marginLeft="0px",pt.left="0px",pt.bottom="0px",pt.border="0px",pt.background="#000",pt.position="relative",et.setElementTouchActionNone(this.element),et.setElementOpacity(this.element,.8),this.viewer=ct,this.innerTracker=new et.MouseTracker({element:this.element,dragHandler:et.delegate(this,tt),scrollHandler:et.delegate(this,rt),enterHandler:et.delegate(this,it),exitHandler:et.delegate(this,st),keyDownHandler:et.delegate(this,ot),keyHandler:et.delegate(this,at)}),lt.width&&lt.height?(this.element.style.width=lt.width+"px",this.element.style.height=lt.height+"px",ct.addControl(this.element,{anchor:et.ControlAnchor.BOTTOM_LEFT})):lt.scroll=="horizontal"?(this.element.style.width=dt.x*lt.sizeRatio*ct.tileSources.length+12*ct.tileSources.length+"px",this.element.style.height=dt.y*lt.sizeRatio+"px",ct.addControl(this.element,{anchor:et.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=dt.y*lt.sizeRatio*ct.tileSources.length+12*ct.tileSources.length+"px",this.element.style.width=dt.x*lt.sizeRatio+"px",ct.addControl(this.element,{anchor:et.ControlAnchor.TOP_LEFT})),this.panelWidth=dt.x*this.sizeRatio+8,this.panelHeight=dt.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},mt=0;mt<ct.tileSources.length;mt++)ft=et.makeNeutralElement("div"),ft.id=this.element.id+"-"+mt,ft.style.width=ut.panelWidth+"px",ft.style.height=ut.panelHeight+"px",ft.style.display="inline",ft.style.float="left",ft.style.cssFloat="left",ft.style.styleFloat="left",ft.style.padding="2px",et.setElementTouchActionNone(ft),ft.innerTracker=new et.MouseTracker({element:ft,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(ht){ht.eventSource.dragging=et.now()},releaseHandler:function(ht){var gt=ht.eventSource,vt=gt.element.id,yt=Number(vt.split("-")[2]),bt=et.now();ht.insideElementPressed&&ht.insideElementReleased&&gt.dragging&&bt-gt.dragging<gt.clickTimeThreshold&&(gt.dragging=null,ct.goToPage(yt))}}),this.element.appendChild(ft),ft.activePanel=!1,this.panels.push(ft);nt(this,this.scroll=="vertical"?dt.y:dt.x,0),this.setFocus(0)},et.extend(et.ReferenceStrip.prototype,et.EventSource.prototype,et.Viewer.prototype,{setFocus:function(lt){var ut=this.element.querySelector("#"+this.element.id+"-"+lt),ct=et.getElementSize(this.viewer.canvas),dt=Number(this.element.style.width.replace("px","")),ft=Number(this.element.style.height.replace("px","")),pt=-Number(this.element.style.marginLeft.replace("px","")),mt=-Number(this.element.style.marginTop.replace("px","")),ht;this.currentSelected!==ut&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=ut,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(ht=Number(lt)*(this.panelWidth+3),ht>pt+ct.x-this.panelWidth?(ht=Math.min(ht,dt-ct.x),this.element.style.marginLeft=-ht+"px",nt(this,ct.x,-ht)):ht<pt&&(ht=Math.max(0,ht-ct.x/2),this.element.style.marginLeft=-ht+"px",nt(this,ct.x,-ht))):(ht=Number(lt)*(this.panelHeight+3),ht>mt+ct.y-this.panelHeight?(ht=Math.min(ht,ft-ct.y),this.element.style.marginTop=-ht+"px",nt(this,ct.y,-ht)):ht<mt&&(ht=Math.max(0,ht-ct.y/2),this.element.style.marginTop=-ht+"px",nt(this,ct.y,-ht))),this.currentPage=lt,it.call(this,{eventSource:this.innerTracker}))},update:function(){return _e[this.id].animating?(et.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var lt in this.miniViewers)this.miniViewers[lt].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function tt(lt){var ut=Number(this.element.style.marginLeft.replace("px","")),ct=Number(this.element.style.marginTop.replace("px","")),dt=Number(this.element.style.width.replace("px","")),ft=Number(this.element.style.height.replace("px","")),pt=et.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-lt.delta.x>0?ut>-(dt-pt.x)&&(this.element.style.marginLeft=ut+lt.delta.x*2+"px",nt(this,pt.x,ut+lt.delta.x*2)):-lt.delta.x<0&&ut<0&&(this.element.style.marginLeft=ut+lt.delta.x*2+"px",nt(this,pt.x,ut+lt.delta.x*2)):-lt.delta.y>0?ct>-(ft-pt.y)&&(this.element.style.marginTop=ct+lt.delta.y*2+"px",nt(this,pt.y,ct+lt.delta.y*2)):-lt.delta.y<0&&ct<0&&(this.element.style.marginTop=ct+lt.delta.y*2+"px",nt(this,pt.y,ct+lt.delta.y*2))),!1}function rt(lt){var ut=Number(this.element.style.marginLeft.replace("px","")),ct=Number(this.element.style.marginTop.replace("px","")),dt=Number(this.element.style.width.replace("px","")),ft=Number(this.element.style.height.replace("px","")),pt=et.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?lt.scroll>0?ut>-(dt-pt.x)&&(this.element.style.marginLeft=ut-lt.scroll*60+"px",nt(this,pt.x,ut-lt.scroll*60)):lt.scroll<0&&ut<0&&(this.element.style.marginLeft=ut-lt.scroll*60+"px",nt(this,pt.x,ut-lt.scroll*60)):lt.scroll<0?ct>pt.y-ft&&(this.element.style.marginTop=ct+lt.scroll*60+"px",nt(this,pt.y,ct+lt.scroll*60)):lt.scroll>0&&ct<0&&(this.element.style.marginTop=ct+lt.scroll*60+"px",nt(this,pt.y,ct+lt.scroll*60))),!1}function nt(lt,ut,ct){var dt,ft,pt,mt,ht,gt,vt;for(lt.scroll=="horizontal"?dt=lt.panelWidth:dt=lt.panelHeight,ft=Math.ceil(ut/dt)+5,pt=Math.ceil((Math.abs(ct)+ut)/dt)+1,ft=pt-ft,ft=ft<0?0:ft,gt=ft;gt<pt&&gt<lt.panels.length;gt++)if(vt=lt.panels[gt],!vt.activePanel){var yt,bt=lt.viewer.tileSources[gt];bt.referenceStripThumbnailUrl?yt={type:"image",url:bt.referenceStripThumbnailUrl}:yt=bt,mt=new et.Viewer({id:vt.id,tileSources:[yt],element:vt,navigatorSizeRatio:lt.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:lt.viewer.loadTilesWithAjax,ajaxHeaders:lt.viewer.ajaxHeaders,useCanvas:lt.useCanvas}),mt.displayRegion=et.makeNeutralElement("div"),mt.displayRegion.id=vt.id+"-displayregion",mt.displayRegion.className="displayregion",ht=mt.displayRegion.style,ht.position="relative",ht.top="0px",ht.left="0px",ht.fontSize="0px",ht.overflow="hidden",ht.float="left",ht.cssFloat="left",ht.styleFloat="left",ht.zIndex=999999999,ht.cursor="default",ht.width=lt.panelWidth-4+"px",ht.height=lt.panelHeight-4+"px",mt.displayRegion.innerTracker=new et.MouseTracker({element:mt.displayRegion,startDisabled:!0}),vt.getElementsByTagName("div")[0].appendChild(mt.displayRegion),lt.miniViewers[vt.id]=mt,vt.activePanel=!0}}function it(lt){var ut=lt.eventSource.element;return this.scroll=="horizontal"?ut.style.marginBottom="0px":ut.style.marginLeft="0px",!1}function st(lt){var ut=lt.eventSource.element;return this.scroll=="horizontal"?ut.style.marginBottom="-"+et.getElementSize(ut).y/2+"px":ut.style.marginLeft="-"+et.getElementSize(ut).x/2+"px",!1}function ot(lt){if(!lt.preventDefaultAction&&!lt.ctrl&&!lt.alt&&!lt.meta)switch(lt.keyCode){case 38:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function at(lt){if(!lt.preventDefaultAction&&!lt.ctrl&&!lt.alt&&!lt.meta)switch(lt.keyCode){case 61:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}}(OpenSeadragon),function(et){et.DisplayRect=function(_e,tt,rt,nt,it,st){et.Rect.apply(this,[_e,tt,rt,nt]),this.minLevel=it,this.maxLevel=st},et.extend(et.DisplayRect.prototype,et.Rect.prototype)}(OpenSeadragon),function(et){et.Spring=function(tt){var rt=arguments;typeof tt!="object"&&(tt={initial:rt.length&&typeof rt[0]=="number"?rt[0]:void 0,springStiffness:rt.length>1?rt[1].springStiffness:5,animationTime:rt.length>1?rt[1].animationTime:1.5}),et.console.assert(typeof tt.springStiffness=="number"&&tt.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),et.console.assert(typeof tt.animationTime=="number"&&tt.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),tt.exponential&&(this._exponential=!0,delete tt.exponential),et.extend(!0,this,tt),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:et.now()},et.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},et.Spring.prototype={resetTo:function(tt){et.console.assert(!this._exponential||tt!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=tt,this.start.time=this.target.time=this.current.time=et.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(tt){et.console.assert(!this._exponential||tt!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=tt,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(tt){this.start.value+=tt,this.target.value+=tt,this._exponential&&(et.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(tt){this._exponential=tt,this._exponential&&(et.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=et.now();var tt,rt;this._exponential?(tt=this.start._logValue,rt=this.target._logValue):(tt=this.start.value,rt=this.target.value);var nt=this.current.time>=this.target.time?rt:tt+(rt-tt)*_e(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),it=this.current.value;return this._exponential?this.current.value=Math.exp(nt):this.current.value=nt,it!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function _e(tt,rt){return(1-Math.exp(tt*-rt))/(1-Math.exp(-tt))}}(OpenSeadragon),function(et){function _e(rt){et.extend(!0,this,{timeout:et.DEFAULT_SETTINGS.timeout,jobId:null},rt),this.image=null}_e.prototype={errorMsg:null,start:function(){var rt=this,nt=this.abort;this.image=new Image,this.image.onload=function(){rt.finish(!0)},this.image.onabort=this.image.onerror=function(){rt.errorMsg="Image load aborted",rt.finish(!1)},this.jobId=window.setTimeout(function(){rt.errorMsg="Image load exceeded timeout ("+rt.timeout+" ms)",rt.finish(!1)},this.timeout),this.loadWithAjax?(this.request=et.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(it){var st;try{st=new window.Blob([it.response])}catch(ut){var ot=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(ut.name==="TypeError"&&ot){var at=new ot;at.append(it.response),st=at.getBlob()}}st.size===0&&(rt.errorMsg="Empty image response.",rt.finish(!1));var lt=(window.URL||window.webkitURL).createObjectURL(st);rt.image.src=lt},error:function(it){rt.errorMsg="Image load aborted - XHR error",rt.finish(!1)}}),this.abort=function(){rt.request.abort(),typeof nt=="function"&&nt()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(rt){this.image.onload=this.image.onerror=this.image.onabort=null,rt||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},et.ImageLoader=function(rt){et.extend(!0,this,{jobLimit:et.DEFAULT_SETTINGS.imageLoaderLimit,timeout:et.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},rt)},et.ImageLoader.prototype={addJob:function(rt){var nt=this,it=function(at){tt(nt,at,rt.callback)},st={src:rt.src,loadWithAjax:rt.loadWithAjax,ajaxHeaders:rt.loadWithAjax?rt.ajaxHeaders:null,crossOriginPolicy:rt.crossOriginPolicy,ajaxWithCredentials:rt.ajaxWithCredentials,callback:it,abort:rt.abort,timeout:this.timeout},ot=new _e(st);!this.jobLimit||this.jobsInProgress<this.jobLimit?(ot.start(),this.jobsInProgress++):this.jobQueue.push(ot)},clear:function(){for(var rt=0;rt<this.jobQueue.length;rt++){var nt=this.jobQueue[rt];typeof nt.abort=="function"&&nt.abort()}this.jobQueue=[]}};function tt(rt,nt,it){var st;rt.jobsInProgress--,(!rt.jobLimit||rt.jobsInProgress<rt.jobLimit)&&rt.jobQueue.length>0&&(st=rt.jobQueue.shift(),st.start(),rt.jobsInProgress++),it(nt.image,nt.errorMsg,nt.request)}}(OpenSeadragon),function(et){et.Tile=function(_e,tt,rt,nt,it,st,ot,at,lt,ut){this.level=_e,this.x=tt,this.y=rt,this.bounds=nt,this.sourceBounds=ut,this.exists=it,this.url=st,this.context2D=ot,this.loadWithAjax=at,this.ajaxHeaders=lt,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},et.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(_e){if(!this.cacheImageRecord){et.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){et.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=et.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=_e&&_e.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",et.setElementOpacity(this.element,this.opacity)},drawCanvas:function(_e,tt,rt,nt){var it=this.position.times(et.pixelDensityRatio),st=this.size.times(et.pixelDensityRatio),ot;if(!this.context2D&&!this.cacheImageRecord){et.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(ot=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!ot){et.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}_e.save(),_e.globalAlpha=this.opacity,typeof rt=="number"&&rt!==1&&(it=it.times(rt),st=st.times(rt)),nt instanceof et.Point&&(it=it.plus(nt)),_e.globalAlpha===1&&this._hasTransparencyChannel()&&_e.clearRect(it.x,it.y,st.x,st.y),tt({context:_e,tile:this,rendered:ot});var at,lt;this.sourceBounds?(at=Math.min(this.sourceBounds.width,ot.canvas.width),lt=Math.min(this.sourceBounds.height,ot.canvas.height)):(at=ot.canvas.width,lt=ot.canvas.height),_e.drawImage(ot.canvas,0,0,at,lt,it.x,it.y,st.x,st.y),_e.restore()},getScaleForEdgeSmoothing:function(){var _e;if(this.cacheImageRecord)_e=this.cacheImageRecord.getRenderedContext();else if(this.context2D)_e=this.context2D;else return et.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return _e.canvas.width/(this.size.x*et.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(_e,tt,rt){var nt=Math.max(1,Math.ceil((rt.x-tt.x)/2)),it=Math.max(1,Math.ceil((rt.y-tt.y)/2));return new et.Point(nt,it).minus(this.position.times(et.pixelDensityRatio).times(_e||1).apply(function(st){return st%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(et){et.OverlayPlacement=et.Placement,et.OverlayRotationMode=et.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),et.Overlay=function(_e,tt,rt){var nt;et.isPlainObject(_e)?nt=_e:nt={element:_e,location:tt,placement:rt},this.element=nt.element,this.style=nt.element.style,this._init(nt)},et.Overlay.prototype={_init:function(_e){this.location=_e.location,this.placement=_e.placement===void 0?et.Placement.TOP_LEFT:_e.placement,this.onDraw=_e.onDraw,this.checkResize=_e.checkResize===void 0?!0:_e.checkResize,this.width=_e.width===void 0?null:_e.width,this.height=_e.height===void 0?null:_e.height,this.rotationMode=_e.rotationMode||et.OverlayRotationMode.EXACT,this.location instanceof et.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=et.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new et.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(_e,tt){var rt=et.Placement.properties[this.placement];rt&&(rt.isHorizontallyCentered?_e.x-=tt.x/2:rt.isRight&&(_e.x-=tt.x),rt.isVerticallyCentered?_e.y-=tt.y/2:rt.isBottom&&(_e.y-=tt.y))},destroy:function(){var _e=this.element,tt=this.style;_e.parentNode&&(_e.parentNode.removeChild(_e),_e.prevElementParent&&(tt.display="none",document.body.appendChild(_e))),this.onDraw=null,tt.top="",tt.left="",tt.position="",this.width!==null&&(tt.width=""),this.height!==null&&(tt.height="");var rt=et.getCssPropertyWithVendorPrefix("transformOrigin"),nt=et.getCssPropertyWithVendorPrefix("transform");rt&&nt&&(tt[rt]="",tt[nt]="")},drawHTML:function(_e,tt){var rt=this.element;rt.parentNode!==_e&&(rt.prevElementParent=rt.parentNode,rt.prevNextSibling=rt.nextSibling,_e.appendChild(rt),this.style.position="absolute",this.size=et.getElementSize(rt));var nt=this._getOverlayPositionAndSize(tt),it=nt.position,st=this.size=nt.size,ot=nt.rotate;if(this.onDraw)this.onDraw(it,st,this.element);else{var at=this.style;at.left=it.x+"px",at.top=it.y+"px",this.width!==null&&(at.width=st.x+"px"),this.height!==null&&(at.height=st.y+"px");var lt=et.getCssPropertyWithVendorPrefix("transformOrigin"),ut=et.getCssPropertyWithVendorPrefix("transform");lt&&ut&&(ot?(at[lt]=this._getTransformOrigin(),at[ut]="rotate("+ot+"deg)"):(at[lt]="",at[ut]="")),at.display!=="none"&&(at.display="block")}},_getOverlayPositionAndSize:function(_e){var tt=_e.pixelFromPoint(this.location,!0),rt=this._getSizeInPixels(_e);this.adjust(tt,rt);var nt=0;if(_e.degrees&&this.rotationMode!==et.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===et.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var it=new et.Rect(tt.x,tt.y,rt.x,rt.y),st=this._getBoundingBox(it,_e.degrees);tt=st.getTopLeft(),rt=st.getSize()}else nt=_e.degrees;return{position:tt,size:rt,rotate:nt}},_getSizeInPixels:function(_e){var tt=this.size.x,rt=this.size.y;if(this.width!==null||this.height!==null){var nt=_e.deltaPixelsFromPointsNoRotate(new et.Point(this.width||0,this.height||0),!0);this.width!==null&&(tt=nt.x),this.height!==null&&(rt=nt.y)}if(this.checkResize&&(this.width===null||this.height===null)){var it=this.size=et.getElementSize(this.element);this.width===null&&(tt=it.x),this.height===null&&(rt=it.y)}return new et.Point(tt,rt)},_getBoundingBox:function(_e,tt){var rt=this._getPlacementPoint(_e);return _e.rotate(tt,rt).getBoundingBox()},_getPlacementPoint:function(_e){var tt=new et.Point(_e.x,_e.y),rt=et.Placement.properties[this.placement];return rt&&(rt.isHorizontallyCentered?tt.x+=_e.width/2:rt.isRight&&(tt.x+=_e.width),rt.isVerticallyCentered?tt.y+=_e.height/2:rt.isBottom&&(tt.y+=_e.height)),tt},_getTransformOrigin:function(){var _e="",tt=et.Placement.properties[this.placement];return tt&&(tt.isLeft?_e="left":tt.isRight&&(_e="right"),tt.isTop?_e+=" top":tt.isBottom&&(_e+=" bottom")),_e},update:function(_e,tt){var rt=et.isPlainObject(_e)?_e:{location:_e,placement:tt};this._init({location:rt.location||this.location,placement:rt.placement!==void 0?rt.placement:this.placement,onDraw:rt.onDraw||this.onDraw,checkResize:rt.checkResize||this.checkResize,width:rt.width!==void 0?rt.width:this.width,height:rt.height!==void 0?rt.height:this.height,rotationMode:rt.rotationMode||this.rotationMode})},getBounds:function(_e){et.console.assert(_e,"A viewport must now be passed to Overlay.getBounds.");var tt=this.width,rt=this.height;if(tt===null||rt===null){var nt=_e.deltaPointsFromPixelsNoRotate(this.size,!0);tt===null&&(tt=nt.x),rt===null&&(rt=nt.y)}var it=this.location.clone();return this.adjust(it,new et.Point(tt,rt)),this._adjustBoundsForRotation(_e,new et.Rect(it.x,it.y,tt,rt))},_adjustBoundsForRotation:function(_e,tt){if(!_e||_e.degrees===0||this.rotationMode===et.OverlayRotationMode.EXACT)return tt;if(this.rotationMode===et.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return tt;var rt=this._getOverlayPositionAndSize(_e);return _e.viewerElementToViewportRectangle(new et.Rect(rt.position.x,rt.position.y,rt.size.x,rt.size.y))}return tt.rotate(-_e.degrees,this._getPlacementPoint(tt))}}}(OpenSeadragon),function(et){et.Drawer=function(_e){et.console.assert(_e.viewer,"[Drawer] options.viewer is required");var tt=arguments;if(et.isPlainObject(_e)||(_e={source:tt[0],viewport:tt[1],element:tt[2]}),et.console.assert(_e.viewport,"[Drawer] options.viewport is required"),et.console.assert(_e.element,"[Drawer] options.element is required"),_e.source&&et.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=_e.viewer,this.viewport=_e.viewport,this.debugGridColor=typeof _e.debugGridColor=="string"?[_e.debugGridColor]:_e.debugGridColor||et.DEFAULT_SETTINGS.debugGridColor,_e.opacity&&et.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=et.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=et.getElement(_e.element),this.canvas=et.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var rt=this._calculateCanvasSize();this.canvas.width=rt.x,this.canvas.height=rt.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",et.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},et.Drawer.prototype={addOverlay:function(_e,tt,rt,nt){return et.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(_e,tt,rt,nt),this},updateOverlay:function(_e,tt,rt){return et.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(_e,tt,rt),this},removeOverlay:function(_e){return et.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(_e),this},clearOverlays:function(){return et.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(_e){var tt=this.viewport.pixelFromPointNoRotate(_e,!0);return new et.Point(tt.x*et.pixelDensityRatio,tt.y*et.pixelDensityRatio)},clipWithPolygons:function(_e,tt){if(this.useCanvas){var rt=this._getContext(tt);rt.beginPath(),_e.forEach(function(nt){nt.forEach(function(it,st){rt[st===0?"moveTo":"lineTo"](it.x,it.y)})}),rt.clip()}},setOpacity:function(_e){et.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var tt=this.viewer.world,rt=0;rt<tt.getItemCount();rt++)tt.getItemAt(rt).setOpacity(_e);return this},getOpacity:function(){et.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var _e=this.viewer.world,tt=0,rt=0;rt<_e.getItemCount();rt++){var nt=_e.getItemAt(rt).getOpacity();nt>tt&&(tt=nt)}return tt},needsUpdate:function(){return et.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return et.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return et.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return et.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var _e=this._calculateCanvasSize();if((this.canvas.width!=_e.x||this.canvas.height!=_e.y)&&(this.canvas.width=_e.x,this.canvas.height=_e.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var tt=this._calculateSketchCanvasSize();this.sketchCanvas.width=tt.x,this.sketchCanvas.height=tt.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(_e,tt){if(this.useCanvas){var rt=this._getContext(_e);if(tt)rt.clearRect(tt.x,tt.y,tt.width,tt.height);else{var nt=rt.canvas;rt.clearRect(0,0,nt.width,nt.height)}}},viewportToDrawerRectangle:function(_e){var tt=this.viewport.pixelFromPointNoRotate(_e.getTopLeft(),!0),rt=this.viewport.deltaPixelsFromPointsNoRotate(_e.getSize(),!0);return new et.Rect(tt.x*et.pixelDensityRatio,tt.y*et.pixelDensityRatio,rt.x*et.pixelDensityRatio,rt.y*et.pixelDensityRatio)},drawTile:function(_e,tt,rt,nt,it){if(et.console.assert(_e,"[Drawer.drawTile] tile is required"),et.console.assert(tt,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var st=this._getContext(rt);nt=nt||1,_e.drawCanvas(st,tt,nt,it)}else _e.drawHTML(this.canvas)},_getContext:function(_e){var tt=this.context;if(_e){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var rt=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=rt.x,this.sketchCanvas.height=rt.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var nt=this;this.viewer.addHandler("rotate",function it(){if(nt.viewport.getRotation()!==0){nt.viewer.removeHandler("rotate",it);var st=nt._calculateSketchCanvasSize();nt.sketchCanvas.width=st.x,nt.sketchCanvas.height=st.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}tt=this.sketchContext}return tt},saveContext:function(_e){this.useCanvas&&this._getContext(_e).save()},restoreContext:function(_e){this.useCanvas&&this._getContext(_e).restore()},setClip:function(_e,tt){if(this.useCanvas){var rt=this._getContext(tt);rt.beginPath(),rt.rect(_e.x,_e.y,_e.width,_e.height),rt.clip()}},drawRectangle:function(_e,tt,rt){if(this.useCanvas){var nt=this._getContext(rt);nt.save(),nt.fillStyle=tt,nt.fillRect(_e.x,_e.y,_e.width,_e.height),nt.restore()}},blendSketch:function(_e,tt,rt,nt){var it=_e;if(et.isPlainObject(it)||(it={opacity:_e,scale:tt,translate:rt,compositeOperation:nt}),!(!this.useCanvas||!this.sketchCanvas)){_e=it.opacity,nt=it.compositeOperation;var st=it.bounds;if(this.context.save(),this.context.globalAlpha=_e,nt&&(this.context.globalCompositeOperation=nt),st)st.x<0&&(st.width+=st.x,st.x=0),st.x+st.width>this.canvas.width&&(st.width=this.canvas.width-st.x),st.y<0&&(st.height+=st.y,st.y=0),st.y+st.height>this.canvas.height&&(st.height=this.canvas.height-st.y),this.context.drawImage(this.sketchCanvas,st.x,st.y,st.width,st.height,st.x,st.y,st.width,st.height);else{tt=it.scale||1,rt=it.translate;var ot=rt instanceof et.Point?rt:new et.Point(0,0),at=0,lt=0;if(rt){var ut=this.sketchCanvas.width-this.canvas.width,ct=this.sketchCanvas.height-this.canvas.height;at=Math.round(ut/2),lt=Math.round(ct/2)}this.context.drawImage(this.sketchCanvas,ot.x-at*tt,ot.y-lt*tt,(this.canvas.width+2*at)*tt,(this.canvas.height+2*lt)*tt,-at,-lt,this.canvas.width+2*at,this.canvas.height+2*lt)}this.context.restore()}},drawDebugInfo:function(_e,tt,rt,nt){if(this.useCanvas){var it=this.viewer.world.getIndexOfItem(nt)%this.debugGridColor.length,st=this.context;st.save(),st.lineWidth=2*et.pixelDensityRatio,st.font="small-caps bold "+13*et.pixelDensityRatio+"px arial",st.strokeStyle=this.debugGridColor[it],st.fillStyle=this.debugGridColor[it],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),nt.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:nt.getRotation(!0),point:nt.viewport.pixelFromPointNoRotate(nt._getRotationPoint(!0),!0)}),nt.viewport.degrees===0&&nt.getRotation(!0)%360===0&&nt._drawer.viewer.viewport.getFlip()&&nt._drawer._flip(),st.strokeRect(_e.position.x*et.pixelDensityRatio,_e.position.y*et.pixelDensityRatio,_e.size.x*et.pixelDensityRatio,_e.size.y*et.pixelDensityRatio);var ot=(_e.position.x+_e.size.x/2)*et.pixelDensityRatio,at=(_e.position.y+_e.size.y/2)*et.pixelDensityRatio;st.translate(ot,at),st.rotate(Math.PI/180*-this.viewport.degrees),st.translate(-ot,-at),_e.x===0&&_e.y===0&&(st.fillText("Zoom: "+this.viewport.getZoom(),_e.position.x*et.pixelDensityRatio,(_e.position.y-30)*et.pixelDensityRatio),st.fillText("Pan: "+this.viewport.getBounds().toString(),_e.position.x*et.pixelDensityRatio,(_e.position.y-20)*et.pixelDensityRatio)),st.fillText("Level: "+_e.level,(_e.position.x+10)*et.pixelDensityRatio,(_e.position.y+20)*et.pixelDensityRatio),st.fillText("Column: "+_e.x,(_e.position.x+10)*et.pixelDensityRatio,(_e.position.y+30)*et.pixelDensityRatio),st.fillText("Row: "+_e.y,(_e.position.x+10)*et.pixelDensityRatio,(_e.position.y+40)*et.pixelDensityRatio),st.fillText("Order: "+rt+" of "+tt,(_e.position.x+10)*et.pixelDensityRatio,(_e.position.y+50)*et.pixelDensityRatio),st.fillText("Size: "+_e.size.toString(),(_e.position.x+10)*et.pixelDensityRatio,(_e.position.y+60)*et.pixelDensityRatio),st.fillText("Position: "+_e.position.toString(),(_e.position.x+10)*et.pixelDensityRatio,(_e.position.y+70)*et.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),nt.getRotation(!0)%360!==0&&this._restoreRotationChanges(),nt.viewport.degrees===0&&nt.getRotation(!0)%360===0&&nt._drawer.viewer.viewport.getFlip()&&nt._drawer._flip(),st.restore()}},debugRect:function(_e){if(this.useCanvas){var tt=this.context;tt.save(),tt.lineWidth=2*et.pixelDensityRatio,tt.strokeStyle=this.debugGridColor[0],tt.fillStyle=this.debugGridColor[0],tt.strokeRect(_e.x*et.pixelDensityRatio,_e.y*et.pixelDensityRatio,_e.width*et.pixelDensityRatio,_e.height*et.pixelDensityRatio),tt.restore()}},setImageSmoothingEnabled:function(_e){this.useCanvas&&(this._imageSmoothingEnabled=_e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(_e){_e.msImageSmoothingEnabled=this._imageSmoothingEnabled,_e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(_e){var tt=this._getContext(_e).canvas;return new et.Point(tt.width,tt.height)},getCanvasCenter:function(){return new et.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(_e){var tt=_e.point?_e.point.times(et.pixelDensityRatio):this.getCanvasCenter(),rt=this._getContext(_e.useSketch);rt.save(),rt.translate(tt.x,tt.y),this.viewer.viewport.flipped?(rt.rotate(Math.PI/180*-_e.degrees),rt.scale(-1,1)):rt.rotate(Math.PI/180*_e.degrees),rt.translate(-tt.x,-tt.y)},_flip:function(_e){_e=_e||{};var tt=_e.point?_e.point.times(et.pixelDensityRatio):this.getCanvasCenter(),rt=this._getContext(_e.useSketch);rt.translate(tt.x,0),rt.scale(-1,1),rt.translate(-tt.x,0)},_restoreRotationChanges:function(_e){var tt=this._getContext(_e);tt.restore()},_calculateCanvasSize:function(){var _e=et.pixelDensityRatio,tt=this.viewport.getContainerSize();return{x:Math.round(tt.x*_e),y:Math.round(tt.y*_e)}},_calculateSketchCanvasSize:function(){var _e=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return _e;var tt=Math.ceil(Math.sqrt(_e.x*_e.x+_e.y*_e.y));return{x:tt,y:tt}}}}(OpenSeadragon),function(et){et.Viewport=function(_e){var tt=arguments;tt.length&&tt[0]instanceof et.Point&&(_e={containerSize:tt[0],contentSize:tt[1],config:tt[2]}),_e.config&&(et.extend(!0,_e,_e.config),delete _e.config),this._margins=et.extend({left:0,top:0,right:0,bottom:0},_e.margins||{}),delete _e.margins,et.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:et.DEFAULT_SETTINGS.springStiffness,animationTime:et.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:et.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:et.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:et.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:et.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:et.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:et.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:et.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:et.DEFAULT_SETTINGS.maxZoomLevel,degrees:et.DEFAULT_SETTINGS.degrees,flipped:et.DEFAULT_SETTINGS.flipped,homeFillsViewer:et.DEFAULT_SETTINGS.homeFillsViewer},_e),this._updateContainerInnerSize(),this.centerSpringX=new et.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new et.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new et.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new et.Rect(0,0,1,1),1),this.goHome(!0),this.update()},et.Viewport.prototype={resetContentSize:function(_e){return et.console.assert(_e,"[Viewport.resetContentSize] contentSize is required"),et.console.assert(_e instanceof et.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),et.console.assert(_e.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),et.console.assert(_e.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new et.Rect(0,0,1,_e.y/_e.x),_e.x),this},setHomeBounds:function(_e,tt){et.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(_e,tt)},_setContentBounds:function(_e,tt){et.console.assert(_e,"[Viewport._setContentBounds] bounds is required"),et.console.assert(_e instanceof et.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),et.console.assert(_e.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),et.console.assert(_e.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=_e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(tt),this._contentBounds=_e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(tt),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:tt,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var _e=this._contentAspectRatio/this.getAspectRatio(),tt;return this.homeFillsViewer?tt=_e>=1?_e:1:tt=_e>=1?1:_e,tt/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var _e=this._contentBounds.getCenter(),tt=1/this.getHomeZoom(),rt=tt/this.getAspectRatio();return new et.Rect(_e.x-tt/2,_e.y-rt/2,tt,rt)},goHome:function(_e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:_e}),this.fitBounds(this.getHomeBounds(),_e)},getMinZoom:function(){var _e=this.getHomeZoom(),tt=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*_e;return tt},getMaxZoom:function(){var _e=this.maxZoomLevel;return _e||(_e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,_e/=this._contentBounds.width),Math.max(_e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new et.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return et.extend({},this._margins)},setMargins:function(_e){et.console.assert(et.type(_e)==="object","[Viewport.setMargins] margins must be an object"),this._margins=et.extend({left:0,top:0,right:0,bottom:0},_e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(_e){return this.getBoundsNoRotate(_e).rotate(-this.getRotation())},getBoundsNoRotate:function(_e){var tt=this.getCenter(_e),rt=1/this.getZoom(_e),nt=rt/this.getAspectRatio();return new et.Rect(tt.x-rt/2,tt.y-nt/2,rt,nt)},getBoundsWithMargins:function(_e){return this.getBoundsNoRotateWithMargins(_e).rotate(-this.getRotation(),this.getCenter(_e))},getBoundsNoRotateWithMargins:function(_e){var tt=this.getBoundsNoRotate(_e),rt=this._containerInnerSize.x*this.getZoom(_e);return tt.x-=this._margins.left/rt,tt.y-=this._margins.top/rt,tt.width+=(this._margins.left+this._margins.right)/rt,tt.height+=(this._margins.top+this._margins.bottom)/rt,tt},getCenter:function(_e){var tt=new et.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),rt=new et.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),nt,it,st,ot,at,lt,ut,ct;return _e?tt:this.zoomPoint?(nt=this.pixelFromPoint(this.zoomPoint,!0),it=this.getZoom(),st=1/it,ot=st/this.getAspectRatio(),at=new et.Rect(tt.x-st/2,tt.y-ot/2,st,ot),lt=this._pixelFromPoint(this.zoomPoint,at),ut=lt.minus(nt),ct=ut.divide(this._containerInnerSize.x*it),rt.plus(ct)):rt},getZoom:function(_e){return _e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(_e){return Math.max(Math.min(_e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(_e){var tt=new et.Rect(_e.x,_e.y,_e.width,_e.height);if(!this.wrapHorizontal){var rt=this.visibilityRatio*tt.width,nt=tt.x+tt.width,it=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,st=this._contentBoundsNoRotate.x-nt+rt,ot=it-tt.x-rt;rt>this._contentBoundsNoRotate.width?tt.x+=(st+ot)/2:ot<0?tt.x+=ot:st>0&&(tt.x+=st)}if(!this.wrapVertical){var at=this.visibilityRatio*tt.height,lt=tt.y+tt.height,ut=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,ct=this._contentBoundsNoRotate.y-lt+at,dt=ut-tt.y-at;at>this._contentBoundsNoRotate.height?tt.y+=(ct+dt)/2:dt<0?tt.y+=dt:ct>0&&(tt.y+=ct)}return tt},_raiseConstraintsEvent:function(_e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:_e})},applyConstraints:function(_e){var tt=this.getZoom(),rt=this._applyZoomConstraints(tt);tt!==rt&&this.zoomTo(rt,this.zoomPoint,_e);var nt=this.getBoundsNoRotate(),it=this._applyBoundaryConstraints(nt);return this._raiseConstraintsEvent(_e),(nt.x!==it.x||nt.y!==it.y||_e)&&this.fitBounds(it.rotate(-this.getRotation()),_e),this},ensureVisible:function(_e){return this.applyConstraints(_e)},_fitBounds:function(_e,tt){tt=tt||{};var rt=tt.immediately||!1,nt=tt.constraints||!1,it=this.getAspectRatio(),st=_e.getCenter(),ot=new et.Rect(_e.x,_e.y,_e.width,_e.height,_e.degrees+this.getRotation()).getBoundingBox();ot.getAspectRatio()>=it?ot.height=ot.width/it:ot.width=ot.height*it,ot.x=st.x-ot.width/2,ot.y=st.y-ot.height/2;var at=1/ot.width;if(nt){var lt=ot.getAspectRatio(),ut=this._applyZoomConstraints(at);at!==ut&&(at=ut,ot.width=1/at,ot.x=st.x-ot.width/2,ot.height=ot.width/lt,ot.y=st.y-ot.height/2),ot=this._applyBoundaryConstraints(ot),st=ot.getCenter(),this._raiseConstraintsEvent(rt)}if(rt)return this.panTo(st,!0),this.zoomTo(at,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var ct=this.getBounds(),dt=this.getZoom();if(dt===0||Math.abs(at/dt-1)<1e-8)return this.zoomTo(at,!0),this.panTo(st,rt);ot=ot.rotate(-this.getRotation());var ft=ot.getTopLeft().times(at).minus(ct.getTopLeft().times(dt)).divide(at-dt);return this.zoomTo(at,ft,rt)},fitBounds:function(_e,tt){return this._fitBounds(_e,{immediately:tt,constraints:!1})},fitBoundsWithConstraints:function(_e,tt){return this._fitBounds(_e,{immediately:tt,constraints:!0})},fitVertically:function(_e){var tt=new et.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(tt,_e)},fitHorizontally:function(_e){var tt=new et.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(tt,_e)},getConstrainedBounds:function(_e){var tt,rt;return tt=this.getBounds(_e),rt=this._applyBoundaryConstraints(tt),rt},panBy:function(_e,tt){var rt=new et.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(rt.plus(_e),tt)},panTo:function(_e,tt){return tt?(this.centerSpringX.resetTo(_e.x),this.centerSpringY.resetTo(_e.y)):(this.centerSpringX.springTo(_e.x),this.centerSpringY.springTo(_e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:_e,immediately:tt}),this},zoomBy:function(_e,tt,rt){return this.zoomTo(this.zoomSpring.target.value*_e,tt,rt)},zoomTo:function(_e,tt,rt){var nt=this;return this.zoomPoint=tt instanceof et.Point&&!isNaN(tt.x)&&!isNaN(tt.y)?tt:null,rt?this._adjustCenterSpringsForZoomPoint(function(){nt.zoomSpring.resetTo(_e)}):this.zoomSpring.springTo(_e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:_e,refPoint:tt,immediately:rt}),this},setRotation:function(_e){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=et.positiveModulo(_e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:_e}),this)},getRotation:function(){return this.degrees},resize:function(_e,tt){var rt=this.getBoundsNoRotate(),nt=rt,it;return this.containerSize.x=_e.x,this.containerSize.y=_e.y,this._updateContainerInnerSize(),tt&&(it=_e.x/this.containerSize.x,nt.width=rt.width*it,nt.height=nt.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:_e,maintain:tt}),this.fitBounds(nt,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new et.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var _e=this;this._adjustCenterSpringsForZoomPoint(function(){_e.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var tt=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,tt},_adjustCenterSpringsForZoomPoint:function(_e){if(this.zoomPoint){var tt=this.pixelFromPoint(this.zoomPoint,!0);_e();var rt=this.pixelFromPoint(this.zoomPoint,!0),nt=rt.minus(tt),it=this.deltaPointsFromPixels(nt,!0);this.centerSpringX.shiftBy(it.x),this.centerSpringY.shiftBy(it.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else _e()},deltaPixelsFromPointsNoRotate:function(_e,tt){return _e.times(this._containerInnerSize.x*this.getZoom(tt))},deltaPixelsFromPoints:function(_e,tt){return this.deltaPixelsFromPointsNoRotate(_e.rotate(this.getRotation()),tt)},deltaPointsFromPixelsNoRotate:function(_e,tt){return _e.divide(this._containerInnerSize.x*this.getZoom(tt))},deltaPointsFromPixels:function(_e,tt){return this.deltaPointsFromPixelsNoRotate(_e,tt).rotate(-this.getRotation())},pixelFromPointNoRotate:function(_e,tt){return this._pixelFromPointNoRotate(_e,this.getBoundsNoRotate(tt))},pixelFromPoint:function(_e,tt){return this._pixelFromPoint(_e,this.getBoundsNoRotate(tt))},_pixelFromPointNoRotate:function(_e,tt){return _e.minus(tt.getTopLeft()).times(this._containerInnerSize.x/tt.width).plus(new et.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(_e,tt){return this._pixelFromPointNoRotate(_e.rotate(this.getRotation(),this.getCenter(!0)),tt)},pointFromPixelNoRotate:function(_e,tt){var rt=this.getBoundsNoRotate(tt);return _e.minus(new et.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/rt.width).plus(rt.getTopLeft())},pointFromPixel:function(_e,tt){return this.pointFromPixelNoRotate(_e,tt).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(_e,tt){var rt=this._contentBoundsNoRotate.width;return new et.Point(_e*this._contentSizeNoRotate.x/rt,tt*this._contentSizeNoRotate.x/rt)},viewportToImageCoordinates:function(_e,tt){if(_e instanceof et.Point)return this.viewportToImageCoordinates(_e.x,_e.y);if(this.viewer){var rt=this.viewer.world.getItemCount();if(rt>1)et.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(rt===1){var nt=this.viewer.world.getItemAt(0);return nt.viewportToImageCoordinates(_e,tt,!0)}}return this._viewportToImageDelta(_e-this._contentBoundsNoRotate.x,tt-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(_e,tt){var rt=this._contentBoundsNoRotate.width;return new et.Point(_e/this._contentSizeNoRotate.x*rt,tt/this._contentSizeNoRotate.x*rt)},imageToViewportCoordinates:function(_e,tt){if(_e instanceof et.Point)return this.imageToViewportCoordinates(_e.x,_e.y);if(this.viewer){var rt=this.viewer.world.getItemCount();if(rt>1)et.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(rt===1){var nt=this.viewer.world.getItemAt(0);return nt.imageToViewportCoordinates(_e,tt,!0)}}var it=this._imageToViewportDelta(_e,tt);return it.x+=this._contentBoundsNoRotate.x,it.y+=this._contentBoundsNoRotate.y,it},imageToViewportRectangle:function(_e,tt,rt,nt){var it=_e;if(it instanceof et.Rect||(it=new et.Rect(_e,tt,rt,nt)),this.viewer){var st=this.viewer.world.getItemCount();if(st>1)et.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(st===1){var ot=this.viewer.world.getItemAt(0);return ot.imageToViewportRectangle(_e,tt,rt,nt,!0)}}var at=this.imageToViewportCoordinates(it.x,it.y),lt=this._imageToViewportDelta(it.width,it.height);return new et.Rect(at.x,at.y,lt.x,lt.y,it.degrees)},viewportToImageRectangle:function(_e,tt,rt,nt){var it=_e;if(it instanceof et.Rect||(it=new et.Rect(_e,tt,rt,nt)),this.viewer){var st=this.viewer.world.getItemCount();if(st>1)et.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(st===1){var ot=this.viewer.world.getItemAt(0);return ot.viewportToImageRectangle(_e,tt,rt,nt,!0)}}var at=this.viewportToImageCoordinates(it.x,it.y),lt=this._viewportToImageDelta(it.width,it.height);return new et.Rect(at.x,at.y,lt.x,lt.y,it.degrees)},viewerElementToImageCoordinates:function(_e){var tt=this.pointFromPixel(_e,!0);return this.viewportToImageCoordinates(tt)},imageToViewerElementCoordinates:function(_e){var tt=this.imageToViewportCoordinates(_e);return this.pixelFromPoint(tt,!0)},windowToImageCoordinates:function(_e){et.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var tt=_e.minus(et.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(tt)},imageToWindowCoordinates:function(_e){et.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var tt=this.imageToViewerElementCoordinates(_e);return tt.plus(et.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(_e){return this.pointFromPixel(_e,!0)},viewportToViewerElementCoordinates:function(_e){return this.pixelFromPoint(_e,!0)},viewerElementToViewportRectangle:function(_e){return et.Rect.fromSummits(this.pointFromPixel(_e.getTopLeft(),!0),this.pointFromPixel(_e.getTopRight(),!0),this.pointFromPixel(_e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(_e){return et.Rect.fromSummits(this.pixelFromPoint(_e.getTopLeft(),!0),this.pixelFromPoint(_e.getTopRight(),!0),this.pixelFromPoint(_e.getBottomLeft(),!0))},windowToViewportCoordinates:function(_e){et.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var tt=_e.minus(et.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(tt)},viewportToWindowCoordinates:function(_e){et.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var tt=this.viewportToViewerElementCoordinates(_e);return tt.plus(et.getElementPosition(this.viewer.element))},viewportToImageZoom:function(_e){if(this.viewer){var tt=this.viewer.world.getItemCount();if(tt>1)et.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(tt===1){var rt=this.viewer.world.getItemAt(0);return rt.viewportToImageZoom(_e)}}var nt=this._contentSizeNoRotate.x,it=this._containerInnerSize.x,st=this._contentBoundsNoRotate.width,ot=it/nt*st;return _e*ot},imageToViewportZoom:function(_e){if(this.viewer){var tt=this.viewer.world.getItemCount();if(tt>1)et.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(tt===1){var rt=this.viewer.world.getItemAt(0);return rt.imageToViewportZoom(_e)}}var nt=this._contentSizeNoRotate.x,it=this._containerInnerSize.x,st=this._contentBoundsNoRotate.width,ot=nt/it/st;return _e*ot},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(_e){return this.flipped===_e?this:(this.flipped=_e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:_e}),this)}}}(OpenSeadragon),function(et){et.TiledImage=function(ht){var gt=this;et.console.assert(ht.tileCache,"[TiledImage] options.tileCache is required"),et.console.assert(ht.drawer,"[TiledImage] options.drawer is required"),et.console.assert(ht.viewer,"[TiledImage] options.viewer is required"),et.console.assert(ht.imageLoader,"[TiledImage] options.imageLoader is required"),et.console.assert(ht.source,"[TiledImage] options.source is required"),et.console.assert(!ht.clip||ht.clip instanceof et.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),et.EventSource.call(this),this._tileCache=ht.tileCache,delete ht.tileCache,this._drawer=ht.drawer,delete ht.drawer,this._imageLoader=ht.imageLoader,delete ht.imageLoader,ht.clip instanceof et.Rect&&(this._clip=ht.clip.clone()),delete ht.clip;var vt=ht.x||0;delete ht.x;var yt=ht.y||0;delete ht.y,this.normHeight=ht.source.dimensions.y/ht.source.dimensions.x,this.contentAspectX=ht.source.dimensions.x/ht.source.dimensions.y;var bt=1;ht.width?(bt=ht.width,delete ht.width,ht.height&&(et.console.error("specifying both width and height to a tiledImage is not supported"),delete ht.height)):ht.height&&(bt=ht.height/this.normHeight,delete ht.height);var xt=ht.fitBounds;delete ht.fitBounds;var _t=ht.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete ht.fitBoundsPlacement;var wt=ht.degrees||0;delete ht.degrees,et.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:et.DEFAULT_SETTINGS.springStiffness,animationTime:et.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:et.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:et.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:et.DEFAULT_SETTINGS.wrapVertical,immediateRender:et.DEFAULT_SETTINGS.immediateRender,blendTime:et.DEFAULT_SETTINGS.blendTime,alwaysBlend:et.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:et.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:et.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:et.DEFAULT_SETTINGS.iOSDevice,debugMode:et.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:et.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:et.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:et.DEFAULT_SETTINGS.placeholderFillStyle,opacity:et.DEFAULT_SETTINGS.opacity,preload:et.DEFAULT_SETTINGS.preload,compositeOperation:et.DEFAULT_SETTINGS.compositeOperation},ht),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new et.Spring({initial:vt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new et.Spring({initial:yt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new et.Spring({initial:bt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new et.Spring({initial:wt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),xt&&this.fitBounds(xt,_t,!0),this._drawingHandler=function(Ct){gt.viewer.raiseEvent("tile-drawing",et.extend({tiledImage:gt},Ct))}},et.extend(et.TiledImage.prototype,et.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(ht){ht!==this._fullyLoaded&&(this._fullyLoaded=ht,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=et.now(),this._needsDraw=!0},update:function(){var ht=this._xSpring.update(),gt=this._ySpring.update(),vt=this._scaleSpring.update(),yt=this._degreesSpring.update();return ht||gt||vt||yt?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(ht){return this.getBoundsNoRotate(ht).rotate(this.getRotation(ht),this._getRotationPoint(ht))},getBoundsNoRotate:function(ht){return ht?new et.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new et.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return et.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(ht){var gt=this.getBoundsNoRotate(ht);if(this._clip){var vt=ht?this._worldWidthCurrent:this._worldWidthTarget,yt=vt/this.source.dimensions.x,bt=this._clip.times(yt);gt=new et.Rect(gt.x+bt.x,gt.y+bt.y,bt.width,bt.height)}return gt.rotate(this.getRotation(ht),this._getRotationPoint(ht))},getContentSize:function(){return new et.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(ht,gt,vt){var yt=vt?this._scaleSpring.current.value:this._scaleSpring.target.value;return new et.Point(ht*(this.source.dimensions.x/yt),gt*(this.source.dimensions.y*this.contentAspectX/yt))},viewportToImageCoordinates:function(ht,gt,vt){var yt;return ht instanceof et.Point?(vt=gt,yt=ht):yt=new et.Point(ht,gt),yt=yt.rotate(-this.getRotation(vt),this._getRotationPoint(vt)),vt?this._viewportToImageDelta(yt.x-this._xSpring.current.value,yt.y-this._ySpring.current.value):this._viewportToImageDelta(yt.x-this._xSpring.target.value,yt.y-this._ySpring.target.value)},_imageToViewportDelta:function(ht,gt,vt){var yt=vt?this._scaleSpring.current.value:this._scaleSpring.target.value;return new et.Point(ht/this.source.dimensions.x*yt,gt/this.source.dimensions.y/this.contentAspectX*yt)},imageToViewportCoordinates:function(ht,gt,vt){ht instanceof et.Point&&(vt=gt,gt=ht.y,ht=ht.x);var yt=this._imageToViewportDelta(ht,gt);return vt?(yt.x+=this._xSpring.current.value,yt.y+=this._ySpring.current.value):(yt.x+=this._xSpring.target.value,yt.y+=this._ySpring.target.value),yt.rotate(this.getRotation(vt),this._getRotationPoint(vt))},imageToViewportRectangle:function(ht,gt,vt,yt,bt){var xt=ht;xt instanceof et.Rect?bt=gt:xt=new et.Rect(ht,gt,vt,yt);var _t=this.imageToViewportCoordinates(xt.getTopLeft(),bt),wt=this._imageToViewportDelta(xt.width,xt.height,bt);return new et.Rect(_t.x,_t.y,wt.x,wt.y,xt.degrees+this.getRotation(bt))},viewportToImageRectangle:function(ht,gt,vt,yt,bt){var xt=ht;ht instanceof et.Rect?bt=gt:xt=new et.Rect(ht,gt,vt,yt);var _t=this.viewportToImageCoordinates(xt.getTopLeft(),bt),wt=this._viewportToImageDelta(xt.width,xt.height,bt);return new et.Rect(_t.x,_t.y,wt.x,wt.y,xt.degrees-this.getRotation(bt))},viewerElementToImageCoordinates:function(ht){var gt=this.viewport.pointFromPixel(ht,!0);return this.viewportToImageCoordinates(gt)},imageToViewerElementCoordinates:function(ht){var gt=this.imageToViewportCoordinates(ht);return this.viewport.pixelFromPoint(gt,!0)},windowToImageCoordinates:function(ht){var gt=ht.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(gt)},imageToWindowCoordinates:function(ht){var gt=this.imageToViewerElementCoordinates(ht);return gt.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(ht){var gt=this._scaleSpring.current.value;return ht=ht.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new et.Rect((ht.x-this._xSpring.current.value)/gt,(ht.y-this._ySpring.current.value)/gt,ht.width/gt,ht.height/gt,ht.degrees)},viewportToImageZoom:function(ht){var gt=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return gt*ht},imageToViewportZoom:function(ht){var gt=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return ht/gt},setPosition:function(ht,gt){var vt=this._xSpring.target.value===ht.x&&this._ySpring.target.value===ht.y;if(gt){if(vt&&this._xSpring.current.value===ht.x&&this._ySpring.current.value===ht.y)return;this._xSpring.resetTo(ht.x),this._ySpring.resetTo(ht.y),this._needsDraw=!0}else{if(vt)return;this._xSpring.springTo(ht.x),this._ySpring.springTo(ht.y),this._needsDraw=!0}vt||this._raiseBoundsChange()},setWidth:function(ht,gt){this._setScale(ht,gt)},setHeight:function(ht,gt){this._setScale(ht/this.normHeight,gt)},setCroppingPolygons:function(ht){var gt=function(yt){return yt instanceof et.Point||typeof yt.x=="number"&&typeof yt.y=="number"},vt=function(yt){return yt.map(function(bt){try{if(gt(bt))return{x:bt.x,y:bt.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!et.isArray(ht))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=ht.map(function(yt){return vt(yt)})}catch(yt){et.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),et.console.error(yt),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(ht,gt,vt){gt=gt||et.Placement.CENTER;var yt=et.Placement.properties[gt],bt=this.contentAspectX,xt=0,_t=0,wt=1,Ct=1;if(this._clip&&(bt=this._clip.getAspectRatio(),wt=this._clip.width/this.source.dimensions.x,Ct=this._clip.height/this.source.dimensions.y,ht.getAspectRatio()>bt?(xt=this._clip.x/this._clip.height*ht.height,_t=this._clip.y/this._clip.height*ht.height):(xt=this._clip.x/this._clip.width*ht.width,_t=this._clip.y/this._clip.width*ht.width)),ht.getAspectRatio()>bt){var kt=ht.height/Ct,At=0;yt.isHorizontallyCentered?At=(ht.width-ht.height*bt)/2:yt.isRight&&(At=ht.width-ht.height*bt),this.setPosition(new et.Point(ht.x-xt+At,ht.y-_t),vt),this.setHeight(kt,vt)}else{var $t=ht.width/wt,Lt=0;yt.isVerticallyCentered?Lt=(ht.height-ht.width/bt)/2:yt.isBottom&&(Lt=ht.height-ht.width/bt),this.setPosition(new et.Point(ht.x-xt,ht.y-_t+Lt),vt),this.setWidth($t,vt)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(ht){et.console.assert(!ht||ht instanceof et.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),ht instanceof et.Rect?this._clip=ht.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(ht){ht!==this.opacity&&(this.opacity=ht,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(ht){this._preload=!!ht,this._needsDraw=!0},getRotation:function(ht){return ht?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(ht,gt){this._degreesSpring.target.value===ht&&this._degreesSpring.isAtTargetValue()||(gt?this._degreesSpring.resetTo(ht):this._degreesSpring.springTo(ht),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(ht){return this.getBoundsNoRotate(ht).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(ht){ht!==this.compositeOperation&&(this.compositeOperation=ht,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(ht,gt){var vt=this._scaleSpring.target.value===ht;if(gt){if(vt&&this._scaleSpring.current.value===ht)return;this._scaleSpring.resetTo(ht),this._updateForScale(),this._needsDraw=!0}else{if(vt)return;this._scaleSpring.springTo(ht),this._updateForScale(),this._needsDraw=!0}vt||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var ht=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),gt=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,vt=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(gt/this.minPixelRatio)/Math.log(2))));return vt=Math.max(vt,this.source.minLevel||0),ht=Math.min(ht,vt),{lowestLevel:ht,highestLevel:vt}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var ht=this.lastDrawn.pop();ht.beingDrawn=!1}var gt=this.viewport,vt=this._viewportToTiledImageRectangle(gt.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var yt=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(vt=vt.intersection(yt),vt===null)return}for(var bt=this._getLevelsInterval(),xt=bt.lowestLevel,_t=bt.highestLevel,wt=null,Ct=!1,kt=et.now(),At=_t;At>=xt;At--){var $t=!1,Lt=gt.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(At),!0).x*this._scaleSpring.current.value;if(At===xt||!Ct&&Lt>=this.minPixelRatio)$t=!0,Ct=!0;else if(!Ct)continue;var Mt=gt.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(At),!1).x*this._scaleSpring.current.value,Bt=gt.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,Pt=this.immediateRender?1:Bt,Nt=Math.min(1,(Lt-.5)/.5),It=Pt/Math.abs(Pt-Mt);if(wt=_e(this,Ct,$t,At,Nt,It,vt,kt,wt),lt(this.coverage,At))break}pt(this,this.lastDrawn),wt&&!wt.context2D?(nt(this,wt,kt),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(ht,gt,vt){var yt,bt;this.wrapHorizontal?(yt=et.positiveModulo(gt.x,1),bt=et.positiveModulo(vt.x,1)):(yt=Math.max(0,gt.x),bt=Math.min(1,vt.x));var xt,_t,wt=1/this.source.aspectRatio;this.wrapVertical?(xt=et.positiveModulo(gt.y,wt),_t=et.positiveModulo(vt.y,wt)):(xt=Math.max(0,gt.y),_t=Math.min(wt,vt.y));var Ct=this.source.getTileAtPoint(ht,new et.Point(yt,xt)),kt=this.source.getTileAtPoint(ht,new et.Point(bt,_t)),At=this.source.getNumTiles(ht);return this.wrapHorizontal&&(Ct.x+=At.x*Math.floor(gt.x),kt.x+=At.x*Math.floor(vt.x)),this.wrapVertical&&(Ct.y+=At.y*Math.floor(gt.y/wt),kt.y+=At.y*Math.floor(vt.y/wt)),{topLeft:Ct,bottomRight:kt}}});function _e(ht,gt,vt,yt,bt,xt,_t,wt,Ct){var kt=_t.getBoundingBox().getTopLeft(),At=_t.getBoundingBox().getBottomRight();ht.viewer&&ht.viewer.raiseEvent("update-level",{tiledImage:ht,havedrawn:gt,level:yt,opacity:bt,visibility:xt,drawArea:_t,topleft:kt,bottomright:At,currenttime:wt,best:Ct}),dt(ht.coverage,yt),dt(ht.loadingCoverage,yt);for(var $t=ht._getCornerTiles(yt,kt,At),Lt=$t.topLeft,Mt=$t.bottomRight,Bt=ht.source.getNumTiles(yt),Pt=ht.viewport.pixelFromPoint(ht.viewport.getCenter()),Nt=Lt.x;Nt<=Mt.x;Nt++)for(var It=Lt.y;It<=Mt.y;It++){if(!ht.wrapHorizontal&&!ht.wrapVertical){var Ft=ht.source.getTileBounds(yt,Nt,It);if(_t.intersection(Ft)===null)continue}Ct=tt(ht,vt,gt,Nt,It,yt,bt,xt,Pt,Bt,wt,Ct)}return Ct}function tt(ht,gt,vt,yt,bt,xt,_t,wt,Ct,kt,At,$t){var Lt=rt(yt,bt,xt,ht,ht.source,ht.tilesMatrix,At,kt,ht._worldWidthCurrent,ht._worldHeightCurrent),Mt=vt;ht.viewer&&ht.viewer.raiseEvent("update-tile",{tiledImage:ht,tile:Lt}),ct(ht.coverage,xt,yt,bt,!1);var Bt=Lt.loaded||Lt.loading||ut(ht.loadingCoverage,xt,yt,bt);if(ct(ht.loadingCoverage,xt,yt,bt,Bt),!Lt.exists||(gt&&!Mt&&(ut(ht.coverage,xt,yt,bt)?ct(ht.coverage,xt,yt,bt,!0):Mt=!0),!Mt))return $t;if(ot(Lt,ht.source.tileOverlap,ht.viewport,Ct,wt,ht),!Lt.loaded)if(Lt.context2D)st(ht,Lt);else{var Pt=ht._tileCache.getImageRecord(Lt.cacheKey);if(Pt){var Nt=Pt.getImage();st(ht,Lt,Nt)}}if(Lt.loaded){var It=at(ht,Lt,yt,bt,xt,_t,At);It&&(ht._needsDraw=!0)}else Lt.loading?ht._tilesLoading++:Bt||($t=ft($t,Lt));return $t}function rt(ht,gt,vt,yt,bt,xt,_t,wt,Ct,kt){var At,$t,Lt,Mt,Bt,Pt,Nt,It,Ft;return xt[vt]||(xt[vt]={}),xt[vt][ht]||(xt[vt][ht]={}),xt[vt][ht][gt]||(At=(wt.x+ht%wt.x)%wt.x,$t=(wt.y+gt%wt.y)%wt.y,Lt=bt.getTileBounds(vt,At,$t),Mt=bt.getTileBounds(vt,At,$t,!0),Bt=bt.tileExists(vt,At,$t),Pt=bt.getTileUrl(vt,At,$t),yt.loadTilesWithAjax?(Nt=bt.getTileAjaxHeaders(vt,At,$t),et.isPlainObject(yt.ajaxHeaders)&&(Nt=et.extend({},yt.ajaxHeaders,Nt))):Nt=null,It=bt.getContext2D?bt.getContext2D(vt,At,$t):void 0,Lt.x+=(ht-At)/wt.x,Lt.y+=kt/Ct*((gt-$t)/wt.y),Ft=new et.Tile(vt,ht,gt,Lt,Bt,Pt,It,yt.loadTilesWithAjax,Nt,Mt),At===wt.x-1&&(Ft.isRightMost=!0),$t===wt.y-1&&(Ft.isBottomMost=!0),xt[vt][ht][gt]=Ft),Ft=xt[vt][ht][gt],Ft.lastTouchTime=_t,Ft}function nt(ht,gt,vt){gt.loading=!0,ht._imageLoader.addJob({src:gt.url,loadWithAjax:gt.loadWithAjax,ajaxHeaders:gt.ajaxHeaders,crossOriginPolicy:ht.crossOriginPolicy,ajaxWithCredentials:ht.ajaxWithCredentials,callback:function(yt,bt,xt){it(ht,gt,vt,yt,bt,xt)},abort:function(){gt.loading=!1}})}function it(ht,gt,vt,yt,bt,xt){if(!yt){et.console.log("Tile %s failed to load: %s - error: %s",gt,gt.url,bt),ht.viewer.raiseEvent("tile-load-failed",{tile:gt,tiledImage:ht,time:vt,message:bt,tileRequest:xt}),gt.loading=!1,gt.exists=!1;return}if(vt<ht.lastResetTime){et.console.log("Ignoring tile %s loaded before reset: %s",gt,gt.url),gt.loading=!1;return}var _t=function(){var wt=ht.source.getClosestLevel();st(ht,gt,yt,wt,xt)};ht._midDraw?window.setTimeout(_t,1):_t()}function st(ht,gt,vt,yt,bt){var xt=0;function _t(){return xt++,wt}function wt(){xt--,xt===0&&(gt.loading=!1,gt.loaded=!0,gt.context2D||ht._tileCache.cacheTile({image:vt,tile:gt,cutoff:yt,tiledImage:ht}),ht._needsDraw=!0)}ht.viewer.raiseEvent("tile-loaded",{tile:gt,tiledImage:ht,tileRequest:bt,image:vt,getCompletionCallback:_t}),_t()()}function ot(ht,gt,vt,yt,bt,xt){var _t=ht.bounds.getTopLeft();_t.x*=xt._scaleSpring.current.value,_t.y*=xt._scaleSpring.current.value,_t.x+=xt._xSpring.current.value,_t.y+=xt._ySpring.current.value;var wt=ht.bounds.getSize();wt.x*=xt._scaleSpring.current.value,wt.y*=xt._scaleSpring.current.value;var Ct=vt.pixelFromPointNoRotate(_t,!0),kt=vt.pixelFromPointNoRotate(_t,!1),At=vt.deltaPixelsFromPointsNoRotate(wt,!0),$t=vt.deltaPixelsFromPointsNoRotate(wt,!1),Lt=kt.plus($t.divide(2)),Mt=yt.squaredDistanceTo(Lt);gt||(At=At.plus(new et.Point(1,1))),ht.isRightMost&&xt.wrapHorizontal&&(At.x+=.75),ht.isBottomMost&&xt.wrapVertical&&(At.y+=.75),ht.position=Ct,ht.size=At,ht.squaredDistance=Mt,ht.visibility=bt}function at(ht,gt,vt,yt,bt,xt,_t){var wt=1e3*ht.blendTime,Ct,kt;if(gt.blendStart||(gt.blendStart=_t),Ct=_t-gt.blendStart,kt=wt?Math.min(1,Ct/wt):1,ht.alwaysBlend&&(kt*=xt),gt.opacity=kt,ht.lastDrawn.push(gt),kt===1)ct(ht.coverage,bt,vt,yt,!0),ht._hasOpaqueTile=!0;else if(Ct<wt)return!0;return!1}function lt(ht,gt,vt,yt){var bt,xt,_t,wt;if(!ht[gt])return!1;if(vt===void 0||yt===void 0){bt=ht[gt];for(_t in bt)if(Object.prototype.hasOwnProperty.call(bt,_t)){xt=bt[_t];for(wt in xt)if(Object.prototype.hasOwnProperty.call(xt,wt)&&!xt[wt])return!1}return!0}return ht[gt][vt]===void 0||ht[gt][vt][yt]===void 0||ht[gt][vt][yt]===!0}function ut(ht,gt,vt,yt){return vt===void 0||yt===void 0?lt(ht,gt+1):lt(ht,gt+1,2*vt,2*yt)&&lt(ht,gt+1,2*vt,2*yt+1)&&lt(ht,gt+1,2*vt+1,2*yt)&&lt(ht,gt+1,2*vt+1,2*yt+1)}function ct(ht,gt,vt,yt,bt){if(!ht[gt]){et.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",gt);return}ht[gt][vt]||(ht[gt][vt]={}),ht[gt][vt][yt]=bt}function dt(ht,gt){ht[gt]={}}function ft(ht,gt){return!ht||gt.visibility>ht.visibility||gt.visibility==ht.visibility&&gt.squaredDistance<ht.squaredDistance?gt:ht}function pt(ht,gt){if(!(ht.opacity===0||gt.length===0&&!ht.placeholderFillStyle)){var vt=gt[0],yt;vt&&(yt=ht.opacity<1||ht.compositeOperation&&ht.compositeOperation!=="source-over"||!ht._isBottomItem()&&vt._hasTransparencyChannel());var bt,xt,_t=ht.viewport.getZoom(!0),wt=ht.viewportToImageZoom(_t);gt.length>1&&wt>ht.smoothTileEdgesMinZoom&&!ht.iOSDevice&&ht.getRotation(!0)%360===0&&et.supportsCanvas&&(yt=!0,bt=vt.getScaleForEdgeSmoothing(),xt=vt.getTranslationForEdgeSmoothing(bt,ht._drawer.getCanvasSize(!1),ht._drawer.getCanvasSize(!0)));var Ct;yt&&(bt||(Ct=ht.viewport.viewportToViewerElementRectangle(ht.getClippedBounds(!0)).getIntegerBoundingBox(),ht._drawer.viewer.viewport.getFlip()&&(ht.viewport.degrees!==0||ht.getRotation(!0)%360!==0)&&(Ct.x=ht._drawer.viewer.container.clientWidth-(Ct.x+Ct.width)),Ct=Ct.times(et.pixelDensityRatio)),ht._drawer._clear(!0,Ct)),bt||(ht.viewport.degrees!==0&&ht._drawer._offsetForRotation({degrees:ht.viewport.degrees,useSketch:yt}),ht.getRotation(!0)%360!==0&&ht._drawer._offsetForRotation({degrees:ht.getRotation(!0),point:ht.viewport.pixelFromPointNoRotate(ht._getRotationPoint(!0),!0),useSketch:yt}),ht.viewport.degrees===0&&ht.getRotation(!0)%360===0&&ht._drawer.viewer.viewport.getFlip()&&ht._drawer._flip());var kt=!1;if(ht._clip){ht._drawer.saveContext(yt);var At=ht.imageToViewportRectangle(ht._clip,!0);At=At.rotate(-ht.getRotation(!0),ht._getRotationPoint(!0));var $t=ht._drawer.viewportToDrawerRectangle(At);bt&&($t=$t.times(bt)),xt&&($t=$t.translate(xt)),ht._drawer.setClip($t,yt),kt=!0}if(ht._croppingPolygons){ht._drawer.saveContext(yt);try{var Lt=ht._croppingPolygons.map(function(Nt){return Nt.map(function(It){var Ft=ht.imageToViewportCoordinates(It.x,It.y,!0).rotate(-ht.getRotation(!0),ht._getRotationPoint(!0)),Ut=ht._drawer.viewportCoordToDrawerCoord(Ft);return bt&&(Ut=Ut.times(bt)),Ut})});ht._drawer.clipWithPolygons(Lt,yt)}catch(Nt){et.console.error(Nt)}kt=!0}if(ht.placeholderFillStyle&&ht._hasOpaqueTile===!1){var Mt=ht._drawer.viewportToDrawerRectangle(ht.getBounds(!0));bt&&(Mt=Mt.times(bt)),xt&&(Mt=Mt.translate(xt));var Bt=null;typeof ht.placeholderFillStyle=="function"?Bt=ht.placeholderFillStyle(ht,ht._drawer.context):Bt=ht.placeholderFillStyle,ht._drawer.drawRectangle(Mt,Bt,yt)}for(var Pt=gt.length-1;Pt>=0;Pt--)vt=gt[Pt],ht._drawer.drawTile(vt,ht._drawingHandler,yt,bt,xt),vt.beingDrawn=!0,ht.viewer&&ht.viewer.raiseEvent("tile-drawn",{tiledImage:ht,tile:vt});kt&&ht._drawer.restoreContext(yt),bt||(ht.getRotation(!0)%360!==0&&ht._drawer._restoreRotationChanges(yt),ht.viewport.degrees!==0&&ht._drawer._restoreRotationChanges(yt)),yt&&(bt&&(ht.viewport.degrees!==0&&ht._drawer._offsetForRotation({degrees:ht.viewport.degrees,useSketch:!1}),ht.getRotation(!0)%360!==0&&ht._drawer._offsetForRotation({degrees:ht.getRotation(!0),point:ht.viewport.pixelFromPointNoRotate(ht._getRotationPoint(!0),!0),useSketch:!1})),ht._drawer.blendSketch({opacity:ht.opacity,scale:bt,translate:xt,compositeOperation:ht.compositeOperation,bounds:Ct}),bt&&(ht.getRotation(!0)%360!==0&&ht._drawer._restoreRotationChanges(!1),ht.viewport.degrees!==0&&ht._drawer._restoreRotationChanges(!1))),bt||ht.viewport.degrees===0&&ht.getRotation(!0)%360===0&&ht._drawer.viewer.viewport.getFlip()&&ht._drawer._flip(),mt(ht,gt)}}function mt(ht,gt){if(ht.debugMode)for(var vt=gt.length-1;vt>=0;vt--){var yt=gt[vt];try{ht._drawer.drawDebugInfo(yt,gt.length,vt,ht)}catch(bt){et.console.error(bt)}}}}(OpenSeadragon),function(et){var _e=function(rt){et.console.assert(rt,"[TileCache.cacheTile] options is required"),et.console.assert(rt.tile,"[TileCache.cacheTile] options.tile is required"),et.console.assert(rt.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=rt.tile,this.tiledImage=rt.tiledImage},tt=function(rt){et.console.assert(rt,"[ImageRecord] options is required"),et.console.assert(rt.image,"[ImageRecord] options.image is required"),this._image=rt.image,this._tiles=[]};tt.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var rt=document.createElement("canvas");rt.width=this._image.width,rt.height=this._image.height,this._renderedContext=rt.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(rt){et.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=rt},addTile:function(rt){et.console.assert(rt,"[ImageRecord.addTile] tile is required"),this._tiles.push(rt)},removeTile:function(rt){for(var nt=0;nt<this._tiles.length;nt++)if(this._tiles[nt]===rt){this._tiles.splice(nt,1);return}et.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",rt)},getTileCount:function(){return this._tiles.length}},et.TileCache=function(rt){rt=rt||{},this._maxImageCacheCount=rt.maxImageCacheCount||et.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},et.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(rt){et.console.assert(rt,"[TileCache.cacheTile] options is required"),et.console.assert(rt.tile,"[TileCache.cacheTile] options.tile is required"),et.console.assert(rt.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),et.console.assert(rt.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var nt=rt.cutoff||0,it=this._tilesLoaded.length,st=this._imagesLoaded[rt.tile.cacheKey];if(st||(et.console.assert(rt.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),st=this._imagesLoaded[rt.tile.cacheKey]=new tt({image:rt.image}),this._imagesLoadedCount++),st.addTile(rt.tile),rt.tile.cacheImageRecord=st,this._imagesLoadedCount>this._maxImageCacheCount){for(var ot=null,at=-1,lt=null,ut,ct,dt,ft,pt,mt,ht=this._tilesLoaded.length-1;ht>=0;ht--)if(mt=this._tilesLoaded[ht],ut=mt.tile,!(ut.level<=nt||ut.beingDrawn)){if(!ot){ot=ut,at=ht,lt=mt;continue}ft=ut.lastTouchTime,ct=ot.lastTouchTime,pt=ut.level,dt=ot.level,(ft<ct||ft==ct&&pt>dt)&&(ot=ut,at=ht,lt=mt)}ot&&at>=0&&(this._unloadTile(lt),it=at)}this._tilesLoaded[it]=new _e({tile:rt.tile,tiledImage:rt.tiledImage})},clearTilesFor:function(rt){et.console.assert(rt,"[TileCache.clearTilesFor] tiledImage is required");for(var nt,it=0;it<this._tilesLoaded.length;++it)nt=this._tilesLoaded[it],nt.tiledImage===rt&&(this._unloadTile(nt),this._tilesLoaded.splice(it,1),it--)},getImageRecord:function(rt){return et.console.assert(rt,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[rt]},_unloadTile:function(rt){et.console.assert(rt,"[TileCache._unloadTile] tileRecord is required");var nt=rt.tile,it=rt.tiledImage;nt.unload(),nt.cacheImageRecord=null;var st=this._imagesLoaded[nt.cacheKey];st.removeTile(nt),st.getTileCount()||(st.destroy(),delete this._imagesLoaded[nt.cacheKey],this._imagesLoadedCount--),it.viewer.raiseEvent("tile-unloaded",{tile:nt,tiledImage:it})}}}(OpenSeadragon),function(et){et.World=function(_e){var tt=this;et.console.assert(_e.viewer,"[World] options.viewer is required"),et.EventSource.call(this),this.viewer=_e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(rt){tt._autoRefigureSizes?tt._figureSizes():tt._needsSizesFigured=!0},this._figureSizes()},et.extend(et.World.prototype,et.EventSource.prototype,{addItem:function(_e,tt){if(et.console.assert(_e,"[World.addItem] item is required"),et.console.assert(_e instanceof et.TiledImage,"[World.addItem] only TiledImages supported at this time"),tt=tt||{},tt.index!==void 0){var rt=Math.max(0,Math.min(this._items.length,tt.index));this._items.splice(rt,0,_e)}else this._items.push(_e);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,_e.addHandler("bounds-change",this._delegatedFigureSizes),_e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:_e})},getItemAt:function(_e){return et.console.assert(_e!==void 0,"[World.getItemAt] index is required"),this._items[_e]},getIndexOfItem:function(_e){return et.console.assert(_e,"[World.getIndexOfItem] item is required"),et.indexOf(this._items,_e)},getItemCount:function(){return this._items.length},setItemIndex:function(_e,tt){et.console.assert(_e,"[World.setItemIndex] item is required"),et.console.assert(tt!==void 0,"[World.setItemIndex] index is required");var rt=this.getIndexOfItem(_e);if(tt>=this._items.length)throw new Error("Index bigger than number of layers.");tt===rt||rt===-1||(this._items.splice(rt,1),this._items.splice(tt,0,_e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:_e,previousIndex:rt,newIndex:tt}))},removeItem:function(_e){et.console.assert(_e,"[World.removeItem] item is required");var tt=et.indexOf(this._items,_e);tt!==-1&&(_e.removeHandler("bounds-change",this._delegatedFigureSizes),_e.removeHandler("clip-change",this._delegatedFigureSizes),_e.destroy(),this._items.splice(tt,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(_e))},removeAll:function(){this.viewer._cancelPendingImages();var _e,tt;for(tt=0;tt<this._items.length;tt++)_e=this._items[tt],_e.removeHandler("bounds-change",this._delegatedFigureSizes),_e.removeHandler("clip-change",this._delegatedFigureSizes),_e.destroy();var rt=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,tt=0;tt<rt.length;tt++)_e=rt[tt],this._raiseRemoveItem(_e)},resetItems:function(){for(var _e=0;_e<this._items.length;_e++)this._items[_e].reset()},update:function(){for(var _e=!1,tt=0;tt<this._items.length;tt++)_e=this._items[tt].update()||_e;return _e},draw:function(){for(var _e=0;_e<this._items.length;_e++)this._items[_e].draw();this._needsDraw=!1},needsDraw:function(){for(var _e=0;_e<this._items.length;_e++)if(this._items[_e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(_e){this._autoRefigureSizes=_e,_e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(_e){_e=_e||{};var tt=_e.immediately||!1,rt=_e.layout||et.DEFAULT_SETTINGS.collectionLayout,nt=_e.rows||et.DEFAULT_SETTINGS.collectionRows,it=_e.columns||et.DEFAULT_SETTINGS.collectionColumns,st=_e.tileSize||et.DEFAULT_SETTINGS.collectionTileSize,ot=_e.tileMargin||et.DEFAULT_SETTINGS.collectionTileMargin,at=st+ot,lt;!_e.rows&&it?lt=it:lt=Math.ceil(this._items.length/nt);var ut=0,ct=0,dt,ft,pt,mt,ht;this.setAutoRefigureSizes(!1);for(var gt=0;gt<this._items.length;gt++)gt&&gt%lt===0&&(rt==="horizontal"?(ct+=at,ut=0):(ut+=at,ct=0)),dt=this._items[gt],ft=dt.getBounds(),ft.width>ft.height?pt=st:pt=st*(ft.width/ft.height),mt=pt*(ft.height/ft.width),ht=new et.Point(ut+(st-pt)/2,ct+(st-mt)/2),dt.setPosition(ht,tt),dt.setWidth(pt,tt),rt==="horizontal"?ut+=at:ct+=at;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var _e=this._homeBounds?this._homeBounds.clone():null,tt=this._contentSize?this._contentSize.clone():null,rt=this._contentFactor||0;if(!this._items.length)this._homeBounds=new et.Rect(0,0,1,1),this._contentSize=new et.Point(1,1),this._contentFactor=1;else{var nt=this._items[0],it=nt.getBounds();this._contentFactor=nt.getContentSize().x/it.width;for(var st=nt.getClippedBounds().getBoundingBox(),ot=st.x,at=st.y,lt=st.x+st.width,ut=st.y+st.height,ct=1;ct<this._items.length;ct++)nt=this._items[ct],it=nt.getBounds(),this._contentFactor=Math.max(this._contentFactor,nt.getContentSize().x/it.width),st=nt.getClippedBounds().getBoundingBox(),ot=Math.min(ot,st.x),at=Math.min(at,st.y),lt=Math.max(lt,st.x+st.width),ut=Math.max(ut,st.y+st.height);this._homeBounds=new et.Rect(ot,at,lt-ot,ut-at),this._contentSize=new et.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==rt||!this._homeBounds.equals(_e)||!this._contentSize.equals(tt))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(_e){this.raiseEvent("remove-item",{item:_e})}})}(OpenSeadragon)})(openseadragon);var openseadragonExports=openseadragon.exports;const OpenSeadragon=getDefaultExportFromCjs$1(openseadragonExports);let $=window.OpenSeadragon;if(!$&&($=OpenSeadragon,!$))throw new Error("OpenSeadragon is missing.");const svgNS="http://www.w3.org/2000/svg";$.Viewer&&($.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo?this._svgOverlayInfo:(this._svgOverlayInfo=new Overlay(this),this._svgOverlayInfo)});const Overlay=function(et){const _e=this;this._viewer=et,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(svgNS,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(svgNS,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){_e.resize()}),this._viewer.addHandler("open",function(){_e.resize()}),this._viewer.addHandler("rotate",function(){_e.resize()}),this._viewer.addHandler("flip",function(){_e.resize()}),this._viewer.addHandler("resize",function(){_e.resize()}),this.resize()};Overlay.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const et=this._viewer.viewport.pixelFromPoint(new $.Point(0,0),!0),_e=this._viewer.viewport.getZoom(!0),tt=this._viewer.viewport.getRotation(),rt=this._viewer.viewport.getFlip(),nt=this._viewer.viewport._containerInnerSize.x;let it=nt*_e;const st=it;rt&&(it=-it,et.x=-et.x+nt),this._node.setAttribute("transform","translate("+et.x+","+et.y+") scale("+it+","+st+") rotate("+tt+")")},onClick:function(et,_e){new $.MouseTracker({element:et,clickHandler:_e}).setTracking(!0)}};const OsdSvgOverlay=et=>new Overlay(et);function addOverlaysToViewer(et,_e,tt,rt){if(!et)return;const nt=1/_e.width;rt.forEach(it=>{if(!it.target)return;const st=parseAnnotationTarget(it.target),{point:ot,rect:at,svg:lt}=st;if(at){const{x:ut,y:ct,w:dt,h:ft}=at;addRectangularOverlay(et,ut*nt,ct*nt,dt*nt,ft*nt,tt)}if(ot){const{x:ut,y:ct}=ot,dt=`
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg">
          <circle cx="${ut}" cy="${ct}" r="20" />
        </svg>
      `;addSvgOverlay(et,dt,tt,nt)}lt&&addSvgOverlay(et,lt,tt,nt)})}function createOpenSeadragonRect(et,_e,tt){let rt,nt,it=40,st=40;_e.rect&&(rt=_e.rect.x,nt=_e.rect.y,it=_e.rect.w,st=_e.rect.h),_e.point&&(rt=_e.point.x,nt=_e.point.y);const ot=1/et.width;return new OpenSeadragon.Rect(rt*ot-it*ot/2*(tt-1),nt*ot-st*ot/2*(tt-1),it*ot*tt,st*ot*tt)}function addRectangularOverlay(et,_e,tt,rt,nt,it){const st=new OpenSeadragon.Rect(_e,tt,rt,nt),ot=document.createElement("div");if(it.annotationOverlays){const{backgroundColor:at,opacity:lt,borderType:ut,borderColor:ct,borderWidth:dt}=it.annotationOverlays;ot.style.backgroundColor=at,ot.style.opacity=lt,ot.style.border=`${ut} ${dt} ${ct}`,ot.className="annotation-overlay"}et.addOverlay(ot,st)}function convertSVGStringToHTML(et){if(!et)return null;const _e=document.createElement("template");return _e.innerHTML=et.trim(),_e.content.children[0]}function addSvgOverlay(et,_e,tt,rt){const nt=convertSVGStringToHTML(_e);if(nt)for(const it of nt.children)svg_processChild(et,it,tt,rt)}function svg_processChild(et,_e,tt,rt){var nt;if(_e.nodeName==="#text")svg_handleTextNode(_e);else{const it=svg_handleElementNode(_e,tt,rt),st=OsdSvgOverlay(et);st.node().append(it),(nt=st._svg)==null||nt.setAttribute("class","annotation-overlay"),_e.childNodes.forEach(ot=>{svg_processChild(et,ot,tt,rt)})}}function svg_handleElementNode(et,_e,tt){var at,lt,ut,ct;let rt=!1,nt=!1,it=!1,st=!1;const ot=document.createElementNS("http://www.w3.org/2000/svg",et.nodeName);if(et.attributes.length>0)for(let dt=0;dt<et.attributes.length;dt++){const ft=et.attributes[dt];switch(ft.name){case"fill":it=!0;break;case"stroke":rt=!0;break;case"stroke-width":nt=!0;break;case"fill-opacity":st=!0;break}ot.setAttribute(ft.name,ft.textContent)}return rt||(ot.style.stroke=(at=_e.annotationOverlays)==null?void 0:at.borderColor),nt||(ot.style.strokeWidth=(lt=_e.annotationOverlays)==null?void 0:lt.borderWidth),it||(ot.style.fill=(ut=_e.annotationOverlays)==null?void 0:ut.backgroundColor),st||(ot.style.fillOpacity=(ct=_e.annotationOverlays)==null?void 0:ct.opacity),ot.setAttribute("transform",`scale(${tt})`),ot}function svg_handleTextNode(et){et.textContent&&(et.textContent.includes(`
`)||console.log("nodeName:",et.nodeName,", textContent:",et.textContent,", childNodes.length",et.childNodes.length))}const AnnotationItemImage=({caption:et,handleClick:_e,imageUri:tt})=>y$3(ButtonStyled,{onClick:_e},y$3("img",{src:tt,alt:`A visual annotation for ${et}`}),y$3("span",null,et)),AnnotationItem=({annotation:et})=>{var ft,pt;const{target:_e}=et,tt=useViewerState(),{openSeadragonViewer:rt,vault:nt,activeCanvas:it,configOptions:st}=tt,ot=et.body.map(mt=>nt.get(mt.id)),at=((ft=ot.find(mt=>mt.format))==null?void 0:ft.format)||"",lt=((pt=ot.find(mt=>mt.value))==null?void 0:pt.value)||"",ut=nt.get({id:it,type:"Canvas"});function ct(){var bt;if(!_e)return;const mt=((bt=st.annotationOverlays)==null?void 0:bt.zoomLevel)||1,ht=parseAnnotationTarget(_e),{point:gt,rect:vt,svg:yt}=ht;if(gt||vt||yt){const xt=createOpenSeadragonRect(ut,ht,mt);rt==null||rt.viewport.fitBounds(xt)}}function dt(){var mt,ht;switch(at){case"text/plain":return y$3(AnnotationItemPlainText,{value:lt,handleClick:ct});case"text/html":return y$3(AnnotationItemHTML,{value:lt,handleClick:ct});case"text/vtt":return y$3(AnnotationItemVTT,{label:ot[0].label,vttUri:ot[0].id||""});case((mt=at.match(/^image\//))==null?void 0:mt.input):const gt=((ht=ot.find(vt=>{var yt;return!((yt=vt.id)!=null&&yt.includes("vault://"))}))==null?void 0:ht.id)||"";return y$3(AnnotationItemImage,{caption:lt,handleClick:ct,imageUri:gt});default:return y$3(AnnotationItemPlainText,{value:lt,handleClick:ct})}}return y$3(Item$3,null,dt())},AnnotationPage=({annotationPage:et})=>{var nt;const _e=useViewerState(),{vault:tt}=_e;if(!et||!et.items||((nt=et.items)==null?void 0:nt.length)===0)return y$3(g$3,null);const rt=et.items.map(it=>tt.get(it.id));return rt?y$3(Group$2,{"data-testid":"annotation-page"},rt==null?void 0:rt.map(it=>y$3(AnnotationItem,{key:it.id,annotation:it}))):y$3(g$3,null)},AboutContent=styled("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),AboutStyled=styled("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),getLabelEntries=(et,_e="none")=>{if(!et)return null;if(typeof et=="string")return[et];if(!et[_e]){const tt=Object.getOwnPropertyNames(et);if(tt.length>0)return et[tt[0]]}return!et[_e]||!Array.isArray(et[_e])?null:et[_e]},getLabelAsString=(et,_e="none",tt=", ")=>{const rt=getLabelEntries(et,_e);return Array.isArray(rt)?rt.join(`${tt}`):rt};var lib$5={},Parser$3={},Tokenizer={},decode={},decodeDataHtml={};Object.defineProperty(decodeDataHtml,"__esModule",{value:!0}),decodeDataHtml.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(et){return et.charCodeAt(0)}));var decodeDataXml={};Object.defineProperty(decodeDataXml,"__esModule",{value:!0}),decodeDataXml.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(et){return et.charCodeAt(0)}));var decode_codepoint={};(function(et){var _e;Object.defineProperty(et,"__esModule",{value:!0}),et.replaceCodePoint=et.fromCodePoint=void 0;var tt=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);et.fromCodePoint=(_e=String.fromCodePoint)!==null&&_e!==void 0?_e:function(it){var st="";return it>65535&&(it-=65536,st+=String.fromCharCode(it>>>10&1023|55296),it=56320|it&1023),st+=String.fromCharCode(it),st};function rt(it){var st;return it>=55296&&it<=57343||it>1114111?65533:(st=tt.get(it))!==null&&st!==void 0?st:it}et.replaceCodePoint=rt;function nt(it){return(0,et.fromCodePoint)(rt(it))}et.default=nt})(decode_codepoint),function(et){var _e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function($t,Lt,Mt,Bt){Bt===void 0&&(Bt=Mt);var Pt=Object.getOwnPropertyDescriptor(Lt,Mt);(!Pt||("get"in Pt?!Lt.__esModule:Pt.writable||Pt.configurable))&&(Pt={enumerable:!0,get:function(){return Lt[Mt]}}),Object.defineProperty($t,Bt,Pt)}:function($t,Lt,Mt,Bt){Bt===void 0&&(Bt=Mt),$t[Bt]=Lt[Mt]}),tt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function($t,Lt){Object.defineProperty($t,"default",{enumerable:!0,value:Lt})}:function($t,Lt){$t.default=Lt}),rt=commonjsGlobal&&commonjsGlobal.__importStar||function($t){if($t&&$t.__esModule)return $t;var Lt={};if($t!=null)for(var Mt in $t)Mt!=="default"&&Object.prototype.hasOwnProperty.call($t,Mt)&&_e(Lt,$t,Mt);return tt(Lt,$t),Lt},nt=commonjsGlobal&&commonjsGlobal.__importDefault||function($t){return $t&&$t.__esModule?$t:{default:$t}};Object.defineProperty(et,"__esModule",{value:!0}),et.decodeXML=et.decodeHTMLStrict=et.decodeHTMLAttribute=et.decodeHTML=et.determineBranch=et.EntityDecoder=et.DecodingMode=et.BinTrieFlags=et.fromCodePoint=et.replaceCodePoint=et.decodeCodePoint=et.xmlDecodeTree=et.htmlDecodeTree=void 0;var it=nt(decodeDataHtml);et.htmlDecodeTree=it.default;var st=nt(decodeDataXml);et.xmlDecodeTree=st.default;var ot=rt(decode_codepoint);et.decodeCodePoint=ot.default;var at=decode_codepoint;Object.defineProperty(et,"replaceCodePoint",{enumerable:!0,get:function(){return at.replaceCodePoint}}),Object.defineProperty(et,"fromCodePoint",{enumerable:!0,get:function(){return at.fromCodePoint}});var lt;(function($t){$t[$t.NUM=35]="NUM",$t[$t.SEMI=59]="SEMI",$t[$t.EQUALS=61]="EQUALS",$t[$t.ZERO=48]="ZERO",$t[$t.NINE=57]="NINE",$t[$t.LOWER_A=97]="LOWER_A",$t[$t.LOWER_F=102]="LOWER_F",$t[$t.LOWER_X=120]="LOWER_X",$t[$t.LOWER_Z=122]="LOWER_Z",$t[$t.UPPER_A=65]="UPPER_A",$t[$t.UPPER_F=70]="UPPER_F",$t[$t.UPPER_Z=90]="UPPER_Z"})(lt||(lt={}));var ut=32,ct;(function($t){$t[$t.VALUE_LENGTH=49152]="VALUE_LENGTH",$t[$t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",$t[$t.JUMP_TABLE=127]="JUMP_TABLE"})(ct=et.BinTrieFlags||(et.BinTrieFlags={}));function dt($t){return $t>=lt.ZERO&&$t<=lt.NINE}function ft($t){return $t>=lt.UPPER_A&&$t<=lt.UPPER_F||$t>=lt.LOWER_A&&$t<=lt.LOWER_F}function pt($t){return $t>=lt.UPPER_A&&$t<=lt.UPPER_Z||$t>=lt.LOWER_A&&$t<=lt.LOWER_Z||dt($t)}function mt($t){return $t===lt.EQUALS||pt($t)}var ht;(function($t){$t[$t.EntityStart=0]="EntityStart",$t[$t.NumericStart=1]="NumericStart",$t[$t.NumericDecimal=2]="NumericDecimal",$t[$t.NumericHex=3]="NumericHex",$t[$t.NamedEntity=4]="NamedEntity"})(ht||(ht={}));var gt;(function($t){$t[$t.Legacy=0]="Legacy",$t[$t.Strict=1]="Strict",$t[$t.Attribute=2]="Attribute"})(gt=et.DecodingMode||(et.DecodingMode={}));var vt=function(){function $t(Lt,Mt,Bt){this.decodeTree=Lt,this.emitCodePoint=Mt,this.errors=Bt,this.state=ht.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=gt.Strict}return $t.prototype.startEntity=function(Lt){this.decodeMode=Lt,this.state=ht.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},$t.prototype.write=function(Lt,Mt){switch(this.state){case ht.EntityStart:return Lt.charCodeAt(Mt)===lt.NUM?(this.state=ht.NumericStart,this.consumed+=1,this.stateNumericStart(Lt,Mt+1)):(this.state=ht.NamedEntity,this.stateNamedEntity(Lt,Mt));case ht.NumericStart:return this.stateNumericStart(Lt,Mt);case ht.NumericDecimal:return this.stateNumericDecimal(Lt,Mt);case ht.NumericHex:return this.stateNumericHex(Lt,Mt);case ht.NamedEntity:return this.stateNamedEntity(Lt,Mt)}},$t.prototype.stateNumericStart=function(Lt,Mt){return Mt>=Lt.length?-1:(Lt.charCodeAt(Mt)|ut)===lt.LOWER_X?(this.state=ht.NumericHex,this.consumed+=1,this.stateNumericHex(Lt,Mt+1)):(this.state=ht.NumericDecimal,this.stateNumericDecimal(Lt,Mt))},$t.prototype.addToNumericResult=function(Lt,Mt,Bt,Pt){if(Mt!==Bt){var Nt=Bt-Mt;this.result=this.result*Math.pow(Pt,Nt)+parseInt(Lt.substr(Mt,Nt),Pt),this.consumed+=Nt}},$t.prototype.stateNumericHex=function(Lt,Mt){for(var Bt=Mt;Mt<Lt.length;){var Pt=Lt.charCodeAt(Mt);if(dt(Pt)||ft(Pt))Mt+=1;else return this.addToNumericResult(Lt,Bt,Mt,16),this.emitNumericEntity(Pt,3)}return this.addToNumericResult(Lt,Bt,Mt,16),-1},$t.prototype.stateNumericDecimal=function(Lt,Mt){for(var Bt=Mt;Mt<Lt.length;){var Pt=Lt.charCodeAt(Mt);if(dt(Pt))Mt+=1;else return this.addToNumericResult(Lt,Bt,Mt,10),this.emitNumericEntity(Pt,2)}return this.addToNumericResult(Lt,Bt,Mt,10),-1},$t.prototype.emitNumericEntity=function(Lt,Mt){var Bt;if(this.consumed<=Mt)return(Bt=this.errors)===null||Bt===void 0||Bt.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(Lt===lt.SEMI)this.consumed+=1;else if(this.decodeMode===gt.Strict)return 0;return this.emitCodePoint((0,ot.replaceCodePoint)(this.result),this.consumed),this.errors&&(Lt!==lt.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},$t.prototype.stateNamedEntity=function(Lt,Mt){for(var Bt=this.decodeTree,Pt=Bt[this.treeIndex],Nt=(Pt&ct.VALUE_LENGTH)>>14;Mt<Lt.length;Mt++,this.excess++){var It=Lt.charCodeAt(Mt);if(this.treeIndex=bt(Bt,Pt,this.treeIndex+Math.max(1,Nt),It),this.treeIndex<0)return this.result===0||this.decodeMode===gt.Attribute&&(Nt===0||mt(It))?0:this.emitNotTerminatedNamedEntity();if(Pt=Bt[this.treeIndex],Nt=(Pt&ct.VALUE_LENGTH)>>14,Nt!==0){if(It===lt.SEMI)return this.emitNamedEntityData(this.treeIndex,Nt,this.consumed+this.excess);this.decodeMode!==gt.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},$t.prototype.emitNotTerminatedNamedEntity=function(){var Lt,Mt=this,Bt=Mt.result,Pt=Mt.decodeTree,Nt=(Pt[Bt]&ct.VALUE_LENGTH)>>14;return this.emitNamedEntityData(Bt,Nt,this.consumed),(Lt=this.errors)===null||Lt===void 0||Lt.missingSemicolonAfterCharacterReference(),this.consumed},$t.prototype.emitNamedEntityData=function(Lt,Mt,Bt){var Pt=this.decodeTree;return this.emitCodePoint(Mt===1?Pt[Lt]&~ct.VALUE_LENGTH:Pt[Lt+1],Bt),Mt===3&&this.emitCodePoint(Pt[Lt+2],Bt),Bt},$t.prototype.end=function(){var Lt;switch(this.state){case ht.NamedEntity:return this.result!==0&&(this.decodeMode!==gt.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case ht.NumericDecimal:return this.emitNumericEntity(0,2);case ht.NumericHex:return this.emitNumericEntity(0,3);case ht.NumericStart:return(Lt=this.errors)===null||Lt===void 0||Lt.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case ht.EntityStart:return 0}},$t}();et.EntityDecoder=vt;function yt($t){var Lt="",Mt=new vt($t,function(Bt){return Lt+=(0,ot.fromCodePoint)(Bt)});return function(Pt,Nt){for(var It=0,Ft=0;(Ft=Pt.indexOf("&",Ft))>=0;){Lt+=Pt.slice(It,Ft),Mt.startEntity(Nt);var Ut=Mt.write(Pt,Ft+1);if(Ut<0){It=Ft+Mt.end();break}It=Ft+Ut,Ft=Ut===0?It+1:It}var Ht=Lt+Pt.slice(It);return Lt="",Ht}}function bt($t,Lt,Mt,Bt){var Pt=(Lt&ct.BRANCH_LENGTH)>>7,Nt=Lt&ct.JUMP_TABLE;if(Pt===0)return Nt!==0&&Bt===Nt?Mt:-1;if(Nt){var It=Bt-Nt;return It<0||It>=Pt?-1:$t[Mt+It]-1}for(var Ft=Mt,Ut=Ft+Pt-1;Ft<=Ut;){var Ht=Ft+Ut>>>1,jt=$t[Ht];if(jt<Bt)Ft=Ht+1;else if(jt>Bt)Ut=Ht-1;else return $t[Ht+Pt]}return-1}et.determineBranch=bt;var xt=yt(it.default),_t=yt(st.default);function wt($t,Lt){return Lt===void 0&&(Lt=gt.Legacy),xt($t,Lt)}et.decodeHTML=wt;function Ct($t){return xt($t,gt.Attribute)}et.decodeHTMLAttribute=Ct;function kt($t){return xt($t,gt.Strict)}et.decodeHTMLStrict=kt;function At($t){return _t($t,gt.Strict)}et.decodeXML=At}(decode),function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.QuoteType=void 0;var _e=decode,tt;(function(dt){dt[dt.Tab=9]="Tab",dt[dt.NewLine=10]="NewLine",dt[dt.FormFeed=12]="FormFeed",dt[dt.CarriageReturn=13]="CarriageReturn",dt[dt.Space=32]="Space",dt[dt.ExclamationMark=33]="ExclamationMark",dt[dt.Number=35]="Number",dt[dt.Amp=38]="Amp",dt[dt.SingleQuote=39]="SingleQuote",dt[dt.DoubleQuote=34]="DoubleQuote",dt[dt.Dash=45]="Dash",dt[dt.Slash=47]="Slash",dt[dt.Zero=48]="Zero",dt[dt.Nine=57]="Nine",dt[dt.Semi=59]="Semi",dt[dt.Lt=60]="Lt",dt[dt.Eq=61]="Eq",dt[dt.Gt=62]="Gt",dt[dt.Questionmark=63]="Questionmark",dt[dt.UpperA=65]="UpperA",dt[dt.LowerA=97]="LowerA",dt[dt.UpperF=70]="UpperF",dt[dt.LowerF=102]="LowerF",dt[dt.UpperZ=90]="UpperZ",dt[dt.LowerZ=122]="LowerZ",dt[dt.LowerX=120]="LowerX",dt[dt.OpeningSquareBracket=91]="OpeningSquareBracket"})(tt||(tt={}));var rt;(function(dt){dt[dt.Text=1]="Text",dt[dt.BeforeTagName=2]="BeforeTagName",dt[dt.InTagName=3]="InTagName",dt[dt.InSelfClosingTag=4]="InSelfClosingTag",dt[dt.BeforeClosingTagName=5]="BeforeClosingTagName",dt[dt.InClosingTagName=6]="InClosingTagName",dt[dt.AfterClosingTagName=7]="AfterClosingTagName",dt[dt.BeforeAttributeName=8]="BeforeAttributeName",dt[dt.InAttributeName=9]="InAttributeName",dt[dt.AfterAttributeName=10]="AfterAttributeName",dt[dt.BeforeAttributeValue=11]="BeforeAttributeValue",dt[dt.InAttributeValueDq=12]="InAttributeValueDq",dt[dt.InAttributeValueSq=13]="InAttributeValueSq",dt[dt.InAttributeValueNq=14]="InAttributeValueNq",dt[dt.BeforeDeclaration=15]="BeforeDeclaration",dt[dt.InDeclaration=16]="InDeclaration",dt[dt.InProcessingInstruction=17]="InProcessingInstruction",dt[dt.BeforeComment=18]="BeforeComment",dt[dt.CDATASequence=19]="CDATASequence",dt[dt.InSpecialComment=20]="InSpecialComment",dt[dt.InCommentLike=21]="InCommentLike",dt[dt.BeforeSpecialS=22]="BeforeSpecialS",dt[dt.SpecialStartSequence=23]="SpecialStartSequence",dt[dt.InSpecialTag=24]="InSpecialTag",dt[dt.BeforeEntity=25]="BeforeEntity",dt[dt.BeforeNumericEntity=26]="BeforeNumericEntity",dt[dt.InNamedEntity=27]="InNamedEntity",dt[dt.InNumericEntity=28]="InNumericEntity",dt[dt.InHexEntity=29]="InHexEntity"})(rt||(rt={}));function nt(dt){return dt===tt.Space||dt===tt.NewLine||dt===tt.Tab||dt===tt.FormFeed||dt===tt.CarriageReturn}function it(dt){return dt===tt.Slash||dt===tt.Gt||nt(dt)}function st(dt){return dt>=tt.Zero&&dt<=tt.Nine}function ot(dt){return dt>=tt.LowerA&&dt<=tt.LowerZ||dt>=tt.UpperA&&dt<=tt.UpperZ}function at(dt){return dt>=tt.UpperA&&dt<=tt.UpperF||dt>=tt.LowerA&&dt<=tt.LowerF}var lt;(function(dt){dt[dt.NoValue=0]="NoValue",dt[dt.Unquoted=1]="Unquoted",dt[dt.Single=2]="Single",dt[dt.Double=3]="Double"})(lt=et.QuoteType||(et.QuoteType={}));var ut={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},ct=function(){function dt(ft,pt){var mt=ft.xmlMode,ht=mt===void 0?!1:mt,gt=ft.decodeEntities,vt=gt===void 0?!0:gt;this.cbs=pt,this.state=rt.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=rt.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=ht,this.decodeEntities=vt,this.entityTrie=ht?_e.xmlDecodeTree:_e.htmlDecodeTree}return dt.prototype.reset=function(){this.state=rt.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=rt.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},dt.prototype.write=function(ft){this.offset+=this.buffer.length,this.buffer=ft,this.parse()},dt.prototype.end=function(){this.running&&this.finish()},dt.prototype.pause=function(){this.running=!1},dt.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},dt.prototype.getIndex=function(){return this.index},dt.prototype.getSectionStart=function(){return this.sectionStart},dt.prototype.stateText=function(ft){ft===tt.Lt||!this.decodeEntities&&this.fastForwardTo(tt.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=rt.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&ft===tt.Amp&&(this.state=rt.BeforeEntity)},dt.prototype.stateSpecialStartSequence=function(ft){var pt=this.sequenceIndex===this.currentSequence.length,mt=pt?it(ft):(ft|32)===this.currentSequence[this.sequenceIndex];if(!mt)this.isSpecial=!1;else if(!pt){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=rt.InTagName,this.stateInTagName(ft)},dt.prototype.stateInSpecialTag=function(ft){if(this.sequenceIndex===this.currentSequence.length){if(ft===tt.Gt||nt(ft)){var pt=this.index-this.currentSequence.length;if(this.sectionStart<pt){var mt=this.index;this.index=pt,this.cbs.ontext(this.sectionStart,pt),this.index=mt}this.isSpecial=!1,this.sectionStart=pt+2,this.stateInClosingTagName(ft);return}this.sequenceIndex=0}(ft|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===ut.TitleEnd?this.decodeEntities&&ft===tt.Amp&&(this.state=rt.BeforeEntity):this.fastForwardTo(tt.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(ft===tt.Lt)},dt.prototype.stateCDATASequence=function(ft){ft===ut.Cdata[this.sequenceIndex]?++this.sequenceIndex===ut.Cdata.length&&(this.state=rt.InCommentLike,this.currentSequence=ut.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=rt.InDeclaration,this.stateInDeclaration(ft))},dt.prototype.fastForwardTo=function(ft){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===ft)return!0;return this.index=this.buffer.length+this.offset-1,!1},dt.prototype.stateInCommentLike=function(ft){ft===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===ut.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=rt.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):ft!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},dt.prototype.isTagStartChar=function(ft){return this.xmlMode?!it(ft):ot(ft)},dt.prototype.startSpecial=function(ft,pt){this.isSpecial=!0,this.currentSequence=ft,this.sequenceIndex=pt,this.state=rt.SpecialStartSequence},dt.prototype.stateBeforeTagName=function(ft){if(ft===tt.ExclamationMark)this.state=rt.BeforeDeclaration,this.sectionStart=this.index+1;else if(ft===tt.Questionmark)this.state=rt.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(ft)){var pt=ft|32;this.sectionStart=this.index,!this.xmlMode&&pt===ut.TitleEnd[2]?this.startSpecial(ut.TitleEnd,3):this.state=!this.xmlMode&&pt===ut.ScriptEnd[2]?rt.BeforeSpecialS:rt.InTagName}else ft===tt.Slash?this.state=rt.BeforeClosingTagName:(this.state=rt.Text,this.stateText(ft))},dt.prototype.stateInTagName=function(ft){it(ft)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=rt.BeforeAttributeName,this.stateBeforeAttributeName(ft))},dt.prototype.stateBeforeClosingTagName=function(ft){nt(ft)||(ft===tt.Gt?this.state=rt.Text:(this.state=this.isTagStartChar(ft)?rt.InClosingTagName:rt.InSpecialComment,this.sectionStart=this.index))},dt.prototype.stateInClosingTagName=function(ft){(ft===tt.Gt||nt(ft))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=rt.AfterClosingTagName,this.stateAfterClosingTagName(ft))},dt.prototype.stateAfterClosingTagName=function(ft){(ft===tt.Gt||this.fastForwardTo(tt.Gt))&&(this.state=rt.Text,this.baseState=rt.Text,this.sectionStart=this.index+1)},dt.prototype.stateBeforeAttributeName=function(ft){ft===tt.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=rt.InSpecialTag,this.sequenceIndex=0):this.state=rt.Text,this.baseState=this.state,this.sectionStart=this.index+1):ft===tt.Slash?this.state=rt.InSelfClosingTag:nt(ft)||(this.state=rt.InAttributeName,this.sectionStart=this.index)},dt.prototype.stateInSelfClosingTag=function(ft){ft===tt.Gt?(this.cbs.onselfclosingtag(this.index),this.state=rt.Text,this.baseState=rt.Text,this.sectionStart=this.index+1,this.isSpecial=!1):nt(ft)||(this.state=rt.BeforeAttributeName,this.stateBeforeAttributeName(ft))},dt.prototype.stateInAttributeName=function(ft){(ft===tt.Eq||it(ft))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=rt.AfterAttributeName,this.stateAfterAttributeName(ft))},dt.prototype.stateAfterAttributeName=function(ft){ft===tt.Eq?this.state=rt.BeforeAttributeValue:ft===tt.Slash||ft===tt.Gt?(this.cbs.onattribend(lt.NoValue,this.index),this.state=rt.BeforeAttributeName,this.stateBeforeAttributeName(ft)):nt(ft)||(this.cbs.onattribend(lt.NoValue,this.index),this.state=rt.InAttributeName,this.sectionStart=this.index)},dt.prototype.stateBeforeAttributeValue=function(ft){ft===tt.DoubleQuote?(this.state=rt.InAttributeValueDq,this.sectionStart=this.index+1):ft===tt.SingleQuote?(this.state=rt.InAttributeValueSq,this.sectionStart=this.index+1):nt(ft)||(this.sectionStart=this.index,this.state=rt.InAttributeValueNq,this.stateInAttributeValueNoQuotes(ft))},dt.prototype.handleInAttributeValue=function(ft,pt){ft===pt||!this.decodeEntities&&this.fastForwardTo(pt)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(pt===tt.DoubleQuote?lt.Double:lt.Single,this.index),this.state=rt.BeforeAttributeName):this.decodeEntities&&ft===tt.Amp&&(this.baseState=this.state,this.state=rt.BeforeEntity)},dt.prototype.stateInAttributeValueDoubleQuotes=function(ft){this.handleInAttributeValue(ft,tt.DoubleQuote)},dt.prototype.stateInAttributeValueSingleQuotes=function(ft){this.handleInAttributeValue(ft,tt.SingleQuote)},dt.prototype.stateInAttributeValueNoQuotes=function(ft){nt(ft)||ft===tt.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(lt.Unquoted,this.index),this.state=rt.BeforeAttributeName,this.stateBeforeAttributeName(ft)):this.decodeEntities&&ft===tt.Amp&&(this.baseState=this.state,this.state=rt.BeforeEntity)},dt.prototype.stateBeforeDeclaration=function(ft){ft===tt.OpeningSquareBracket?(this.state=rt.CDATASequence,this.sequenceIndex=0):this.state=ft===tt.Dash?rt.BeforeComment:rt.InDeclaration},dt.prototype.stateInDeclaration=function(ft){(ft===tt.Gt||this.fastForwardTo(tt.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=rt.Text,this.sectionStart=this.index+1)},dt.prototype.stateInProcessingInstruction=function(ft){(ft===tt.Gt||this.fastForwardTo(tt.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=rt.Text,this.sectionStart=this.index+1)},dt.prototype.stateBeforeComment=function(ft){ft===tt.Dash?(this.state=rt.InCommentLike,this.currentSequence=ut.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=rt.InDeclaration},dt.prototype.stateInSpecialComment=function(ft){(ft===tt.Gt||this.fastForwardTo(tt.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=rt.Text,this.sectionStart=this.index+1)},dt.prototype.stateBeforeSpecialS=function(ft){var pt=ft|32;pt===ut.ScriptEnd[3]?this.startSpecial(ut.ScriptEnd,4):pt===ut.StyleEnd[3]?this.startSpecial(ut.StyleEnd,4):(this.state=rt.InTagName,this.stateInTagName(ft))},dt.prototype.stateBeforeEntity=function(ft){this.entityExcess=1,this.entityResult=0,ft===tt.Number?this.state=rt.BeforeNumericEntity:ft===tt.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=rt.InNamedEntity,this.stateInNamedEntity(ft))},dt.prototype.stateInNamedEntity=function(ft){if(this.entityExcess+=1,this.trieIndex=(0,_e.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,ft),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var pt=this.trieCurrent&_e.BinTrieFlags.VALUE_LENGTH;if(pt){var mt=(pt>>14)-1;if(!this.allowLegacyEntity()&&ft!==tt.Semi)this.trieIndex+=mt;else{var ht=this.index-this.entityExcess+1;ht>this.sectionStart&&this.emitPartial(this.sectionStart,ht),this.entityResult=this.trieIndex,this.trieIndex+=mt,this.entityExcess=0,this.sectionStart=this.index+1,mt===0&&this.emitNamedEntity()}}},dt.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var ft=(this.entityTrie[this.entityResult]&_e.BinTrieFlags.VALUE_LENGTH)>>14;switch(ft){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~_e.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},dt.prototype.stateBeforeNumericEntity=function(ft){(ft|32)===tt.LowerX?(this.entityExcess++,this.state=rt.InHexEntity):(this.state=rt.InNumericEntity,this.stateInNumericEntity(ft))},dt.prototype.emitNumericEntity=function(ft){var pt=this.index-this.entityExcess-1,mt=pt+2+ +(this.state===rt.InHexEntity);mt!==this.index&&(pt>this.sectionStart&&this.emitPartial(this.sectionStart,pt),this.sectionStart=this.index+Number(ft),this.emitCodePoint((0,_e.replaceCodePoint)(this.entityResult))),this.state=this.baseState},dt.prototype.stateInNumericEntity=function(ft){ft===tt.Semi?this.emitNumericEntity(!0):st(ft)?(this.entityResult=this.entityResult*10+(ft-tt.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},dt.prototype.stateInHexEntity=function(ft){ft===tt.Semi?this.emitNumericEntity(!0):st(ft)?(this.entityResult=this.entityResult*16+(ft-tt.Zero),this.entityExcess++):at(ft)?(this.entityResult=this.entityResult*16+((ft|32)-tt.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},dt.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===rt.Text||this.baseState===rt.InSpecialTag)},dt.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===rt.Text||this.state===rt.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===rt.InAttributeValueDq||this.state===rt.InAttributeValueSq||this.state===rt.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},dt.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},dt.prototype.parse=function(){for(;this.shouldContinue();){var ft=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case rt.Text:{this.stateText(ft);break}case rt.SpecialStartSequence:{this.stateSpecialStartSequence(ft);break}case rt.InSpecialTag:{this.stateInSpecialTag(ft);break}case rt.CDATASequence:{this.stateCDATASequence(ft);break}case rt.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(ft);break}case rt.InAttributeName:{this.stateInAttributeName(ft);break}case rt.InCommentLike:{this.stateInCommentLike(ft);break}case rt.InSpecialComment:{this.stateInSpecialComment(ft);break}case rt.BeforeAttributeName:{this.stateBeforeAttributeName(ft);break}case rt.InTagName:{this.stateInTagName(ft);break}case rt.InClosingTagName:{this.stateInClosingTagName(ft);break}case rt.BeforeTagName:{this.stateBeforeTagName(ft);break}case rt.AfterAttributeName:{this.stateAfterAttributeName(ft);break}case rt.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(ft);break}case rt.BeforeAttributeValue:{this.stateBeforeAttributeValue(ft);break}case rt.BeforeClosingTagName:{this.stateBeforeClosingTagName(ft);break}case rt.AfterClosingTagName:{this.stateAfterClosingTagName(ft);break}case rt.BeforeSpecialS:{this.stateBeforeSpecialS(ft);break}case rt.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(ft);break}case rt.InSelfClosingTag:{this.stateInSelfClosingTag(ft);break}case rt.InDeclaration:{this.stateInDeclaration(ft);break}case rt.BeforeDeclaration:{this.stateBeforeDeclaration(ft);break}case rt.BeforeComment:{this.stateBeforeComment(ft);break}case rt.InProcessingInstruction:{this.stateInProcessingInstruction(ft);break}case rt.InNamedEntity:{this.stateInNamedEntity(ft);break}case rt.BeforeEntity:{this.stateBeforeEntity(ft);break}case rt.InHexEntity:{this.stateInHexEntity(ft);break}case rt.InNumericEntity:{this.stateInNumericEntity(ft);break}default:this.stateBeforeNumericEntity(ft)}this.index++}this.cleanup()},dt.prototype.finish=function(){this.state===rt.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},dt.prototype.handleTrailingData=function(){var ft=this.buffer.length+this.offset;this.state===rt.InCommentLike?this.currentSequence===ut.CdataEnd?this.cbs.oncdata(this.sectionStart,ft,0):this.cbs.oncomment(this.sectionStart,ft,0):this.state===rt.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===rt.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===rt.InTagName||this.state===rt.BeforeAttributeName||this.state===rt.BeforeAttributeValue||this.state===rt.AfterAttributeName||this.state===rt.InAttributeName||this.state===rt.InAttributeValueSq||this.state===rt.InAttributeValueDq||this.state===rt.InAttributeValueNq||this.state===rt.InClosingTagName||this.cbs.ontext(this.sectionStart,ft)},dt.prototype.emitPartial=function(ft,pt){this.baseState!==rt.Text&&this.baseState!==rt.InSpecialTag?this.cbs.onattribdata(ft,pt):this.cbs.ontext(ft,pt)},dt.prototype.emitCodePoint=function(ft){this.baseState!==rt.Text&&this.baseState!==rt.InSpecialTag?this.cbs.onattribentity(ft):this.cbs.ontextentity(ft)},dt}();et.default=ct}(Tokenizer);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(et,_e,tt,rt){rt===void 0&&(rt=tt);var nt=Object.getOwnPropertyDescriptor(_e,tt);(!nt||("get"in nt?!_e.__esModule:nt.writable||nt.configurable))&&(nt={enumerable:!0,get:function(){return _e[tt]}}),Object.defineProperty(et,rt,nt)}:function(et,_e,tt,rt){rt===void 0&&(rt=tt),et[rt]=_e[tt]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(et,_e){Object.defineProperty(et,"default",{enumerable:!0,value:_e})}:function(et,_e){et.default=_e}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(et){if(et&&et.__esModule)return et;var _e={};if(et!=null)for(var tt in et)tt!=="default"&&Object.prototype.hasOwnProperty.call(et,tt)&&__createBinding$1(_e,et,tt);return __setModuleDefault$1(_e,et),_e};Object.defineProperty(Parser$3,"__esModule",{value:!0}),Parser$3.Parser=void 0;var Tokenizer_js_1=__importStar$1(Tokenizer),decode_js_1=decode,formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//,Parser$2=function(){function et(_e,tt){tt===void 0&&(tt={});var rt,nt,it,st,ot;this.options=tt,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=_e??{},this.lowerCaseTagNames=(rt=tt.lowerCaseTags)!==null&&rt!==void 0?rt:!tt.xmlMode,this.lowerCaseAttributeNames=(nt=tt.lowerCaseAttributeNames)!==null&&nt!==void 0?nt:!tt.xmlMode,this.tokenizer=new((it=tt.Tokenizer)!==null&&it!==void 0?it:Tokenizer_js_1.default)(this.options,this),(ot=(st=this.cbs).onparserinit)===null||ot===void 0||ot.call(st,this)}return et.prototype.ontext=function(_e,tt){var rt,nt,it=this.getSlice(_e,tt);this.endIndex=tt-1,(nt=(rt=this.cbs).ontext)===null||nt===void 0||nt.call(rt,it),this.startIndex=tt},et.prototype.ontextentity=function(_e){var tt,rt,nt=this.tokenizer.getSectionStart();this.endIndex=nt-1,(rt=(tt=this.cbs).ontext)===null||rt===void 0||rt.call(tt,(0,decode_js_1.fromCodePoint)(_e)),this.startIndex=nt},et.prototype.isVoidElement=function(_e){return!this.options.xmlMode&&voidElements.has(_e)},et.prototype.onopentagname=function(_e,tt){this.endIndex=tt;var rt=this.getSlice(_e,tt);this.lowerCaseTagNames&&(rt=rt.toLowerCase()),this.emitOpenTag(rt)},et.prototype.emitOpenTag=function(_e){var tt,rt,nt,it;this.openTagStart=this.startIndex,this.tagname=_e;var st=!this.options.xmlMode&&openImpliesClose.get(_e);if(st)for(;this.stack.length>0&&st.has(this.stack[this.stack.length-1]);){var ot=this.stack.pop();(rt=(tt=this.cbs).onclosetag)===null||rt===void 0||rt.call(tt,ot,!0)}this.isVoidElement(_e)||(this.stack.push(_e),foreignContextElements.has(_e)?this.foreignContext.push(!0):htmlIntegrationElements.has(_e)&&this.foreignContext.push(!1)),(it=(nt=this.cbs).onopentagname)===null||it===void 0||it.call(nt,_e),this.cbs.onopentag&&(this.attribs={})},et.prototype.endOpenTag=function(_e){var tt,rt;this.startIndex=this.openTagStart,this.attribs&&((rt=(tt=this.cbs).onopentag)===null||rt===void 0||rt.call(tt,this.tagname,this.attribs,_e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},et.prototype.onopentagend=function(_e){this.endIndex=_e,this.endOpenTag(!1),this.startIndex=_e+1},et.prototype.onclosetag=function(_e,tt){var rt,nt,it,st,ot,at;this.endIndex=tt;var lt=this.getSlice(_e,tt);if(this.lowerCaseTagNames&&(lt=lt.toLowerCase()),(foreignContextElements.has(lt)||htmlIntegrationElements.has(lt))&&this.foreignContext.pop(),this.isVoidElement(lt))!this.options.xmlMode&&lt==="br"&&((nt=(rt=this.cbs).onopentagname)===null||nt===void 0||nt.call(rt,"br"),(st=(it=this.cbs).onopentag)===null||st===void 0||st.call(it,"br",{},!0),(at=(ot=this.cbs).onclosetag)===null||at===void 0||at.call(ot,"br",!1));else{var ut=this.stack.lastIndexOf(lt);if(ut!==-1)if(this.cbs.onclosetag)for(var ct=this.stack.length-ut;ct--;)this.cbs.onclosetag(this.stack.pop(),ct!==0);else this.stack.length=ut;else!this.options.xmlMode&&lt==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=tt+1},et.prototype.onselfclosingtag=function(_e){this.endIndex=_e,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=_e+1):this.onopentagend(_e)},et.prototype.closeCurrentTag=function(_e){var tt,rt,nt=this.tagname;this.endOpenTag(_e),this.stack[this.stack.length-1]===nt&&((rt=(tt=this.cbs).onclosetag)===null||rt===void 0||rt.call(tt,nt,!_e),this.stack.pop())},et.prototype.onattribname=function(_e,tt){this.startIndex=_e;var rt=this.getSlice(_e,tt);this.attribname=this.lowerCaseAttributeNames?rt.toLowerCase():rt},et.prototype.onattribdata=function(_e,tt){this.attribvalue+=this.getSlice(_e,tt)},et.prototype.onattribentity=function(_e){this.attribvalue+=(0,decode_js_1.fromCodePoint)(_e)},et.prototype.onattribend=function(_e,tt){var rt,nt;this.endIndex=tt,(nt=(rt=this.cbs).onattribute)===null||nt===void 0||nt.call(rt,this.attribname,this.attribvalue,_e===Tokenizer_js_1.QuoteType.Double?'"':_e===Tokenizer_js_1.QuoteType.Single?"'":_e===Tokenizer_js_1.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},et.prototype.getInstructionName=function(_e){var tt=_e.search(reNameEnd),rt=tt<0?_e:_e.substr(0,tt);return this.lowerCaseTagNames&&(rt=rt.toLowerCase()),rt},et.prototype.ondeclaration=function(_e,tt){this.endIndex=tt;var rt=this.getSlice(_e,tt);if(this.cbs.onprocessinginstruction){var nt=this.getInstructionName(rt);this.cbs.onprocessinginstruction("!".concat(nt),"!".concat(rt))}this.startIndex=tt+1},et.prototype.onprocessinginstruction=function(_e,tt){this.endIndex=tt;var rt=this.getSlice(_e,tt);if(this.cbs.onprocessinginstruction){var nt=this.getInstructionName(rt);this.cbs.onprocessinginstruction("?".concat(nt),"?".concat(rt))}this.startIndex=tt+1},et.prototype.oncomment=function(_e,tt,rt){var nt,it,st,ot;this.endIndex=tt,(it=(nt=this.cbs).oncomment)===null||it===void 0||it.call(nt,this.getSlice(_e,tt-rt)),(ot=(st=this.cbs).oncommentend)===null||ot===void 0||ot.call(st),this.startIndex=tt+1},et.prototype.oncdata=function(_e,tt,rt){var nt,it,st,ot,at,lt,ut,ct,dt,ft;this.endIndex=tt;var pt=this.getSlice(_e,tt-rt);this.options.xmlMode||this.options.recognizeCDATA?((it=(nt=this.cbs).oncdatastart)===null||it===void 0||it.call(nt),(ot=(st=this.cbs).ontext)===null||ot===void 0||ot.call(st,pt),(lt=(at=this.cbs).oncdataend)===null||lt===void 0||lt.call(at)):((ct=(ut=this.cbs).oncomment)===null||ct===void 0||ct.call(ut,"[CDATA[".concat(pt,"]]")),(ft=(dt=this.cbs).oncommentend)===null||ft===void 0||ft.call(dt)),this.startIndex=tt+1},et.prototype.onend=function(){var _e,tt;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var rt=this.stack.length;rt>0;this.cbs.onclosetag(this.stack[--rt],!0));}(tt=(_e=this.cbs).onend)===null||tt===void 0||tt.call(_e)},et.prototype.reset=function(){var _e,tt,rt,nt;(tt=(_e=this.cbs).onreset)===null||tt===void 0||tt.call(_e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(nt=(rt=this.cbs).onparserinit)===null||nt===void 0||nt.call(rt,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},et.prototype.parseComplete=function(_e){this.reset(),this.end(_e)},et.prototype.getSlice=function(_e,tt){for(;_e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var rt=this.buffers[0].slice(_e-this.bufferOffset,tt-this.bufferOffset);tt-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),rt+=this.buffers[0].slice(0,tt-this.bufferOffset);return rt},et.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},et.prototype.write=function(_e){var tt,rt;if(this.ended){(rt=(tt=this.cbs).onerror)===null||rt===void 0||rt.call(tt,new Error(".write() after done!"));return}this.buffers.push(_e),this.tokenizer.running&&(this.tokenizer.write(_e),this.writeIndex++)},et.prototype.end=function(_e){var tt,rt;if(this.ended){(rt=(tt=this.cbs).onerror)===null||rt===void 0||rt.call(tt,new Error(".end() after done!"));return}_e&&this.write(_e),this.ended=!0,this.tokenizer.end()},et.prototype.pause=function(){this.tokenizer.pause()},et.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},et.prototype.parseChunk=function(_e){this.write(_e)},et.prototype.done=function(_e){this.end(_e)},et}();Parser$3.Parser=Parser$2;var lib$4={},lib$3={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.Doctype=et.CDATA=et.Tag=et.Style=et.Script=et.Comment=et.Directive=et.Text=et.Root=et.isTag=et.ElementType=void 0;var _e;(function(rt){rt.Root="root",rt.Text="text",rt.Directive="directive",rt.Comment="comment",rt.Script="script",rt.Style="style",rt.Tag="tag",rt.CDATA="cdata",rt.Doctype="doctype"})(_e=et.ElementType||(et.ElementType={}));function tt(rt){return rt.type===_e.Tag||rt.type===_e.Script||rt.type===_e.Style}et.isTag=tt,et.Root=_e.Root,et.Text=_e.Text,et.Directive=_e.Directive,et.Comment=_e.Comment,et.Script=_e.Script,et.Style=_e.Style,et.Tag=_e.Tag,et.CDATA=_e.CDATA,et.Doctype=_e.Doctype})(lib$3);var node$1={},__extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var et=function(_e,tt){return et=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(rt,nt){rt.__proto__=nt}||function(rt,nt){for(var it in nt)Object.prototype.hasOwnProperty.call(nt,it)&&(rt[it]=nt[it])},et(_e,tt)};return function(_e,tt){if(typeof tt!="function"&&tt!==null)throw new TypeError("Class extends value "+String(tt)+" is not a constructor or null");et(_e,tt);function rt(){this.constructor=_e}_e.prototype=tt===null?Object.create(tt):(rt.prototype=tt.prototype,new rt)}}(),__assign$2=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$2=Object.assign||function(et){for(var _e,tt=1,rt=arguments.length;tt<rt;tt++){_e=arguments[tt];for(var nt in _e)Object.prototype.hasOwnProperty.call(_e,nt)&&(et[nt]=_e[nt])}return et},__assign$2.apply(this,arguments)};Object.defineProperty(node$1,"__esModule",{value:!0}),node$1.cloneNode=node$1.hasChildren=node$1.isDocument=node$1.isDirective=node$1.isComment=node$1.isText=node$1.isCDATA=node$1.isTag=node$1.Element=node$1.Document=node$1.CDATA=node$1.NodeWithChildren=node$1.ProcessingInstruction=node$1.Comment=node$1.Text=node$1.DataNode=node$1.Node=void 0;var domelementtype_1$1=lib$3,Node$6=function(){function et(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(et.prototype,"parentNode",{get:function(){return this.parent},set:function(_e){this.parent=_e},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"previousSibling",{get:function(){return this.prev},set:function(_e){this.prev=_e},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"nextSibling",{get:function(){return this.next},set:function(_e){this.next=_e},enumerable:!1,configurable:!0}),et.prototype.cloneNode=function(_e){return _e===void 0&&(_e=!1),cloneNode$1(this,_e)},et}();node$1.Node=Node$6;var DataNode=function(et){__extends(_e,et);function _e(tt){var rt=et.call(this)||this;return rt.data=tt,rt}return Object.defineProperty(_e.prototype,"nodeValue",{get:function(){return this.data},set:function(tt){this.data=tt},enumerable:!1,configurable:!0}),_e}(Node$6);node$1.DataNode=DataNode;var Text=function(et){__extends(_e,et);function _e(){var tt=et!==null&&et.apply(this,arguments)||this;return tt.type=domelementtype_1$1.ElementType.Text,tt}return Object.defineProperty(_e.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),_e}(DataNode);node$1.Text=Text;var Comment$5=function(et){__extends(_e,et);function _e(){var tt=et!==null&&et.apply(this,arguments)||this;return tt.type=domelementtype_1$1.ElementType.Comment,tt}return Object.defineProperty(_e.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),_e}(DataNode);node$1.Comment=Comment$5;var ProcessingInstruction=function(et){__extends(_e,et);function _e(tt,rt){var nt=et.call(this,rt)||this;return nt.name=tt,nt.type=domelementtype_1$1.ElementType.Directive,nt}return Object.defineProperty(_e.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),_e}(DataNode);node$1.ProcessingInstruction=ProcessingInstruction;var NodeWithChildren=function(et){__extends(_e,et);function _e(tt){var rt=et.call(this)||this;return rt.children=tt,rt}return Object.defineProperty(_e.prototype,"firstChild",{get:function(){var tt;return(tt=this.children[0])!==null&&tt!==void 0?tt:null},enumerable:!1,configurable:!0}),Object.defineProperty(_e.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(_e.prototype,"childNodes",{get:function(){return this.children},set:function(tt){this.children=tt},enumerable:!1,configurable:!0}),_e}(Node$6);node$1.NodeWithChildren=NodeWithChildren;var CDATA=function(et){__extends(_e,et);function _e(){var tt=et!==null&&et.apply(this,arguments)||this;return tt.type=domelementtype_1$1.ElementType.CDATA,tt}return Object.defineProperty(_e.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),_e}(NodeWithChildren);node$1.CDATA=CDATA;var Document$4=function(et){__extends(_e,et);function _e(){var tt=et!==null&&et.apply(this,arguments)||this;return tt.type=domelementtype_1$1.ElementType.Root,tt}return Object.defineProperty(_e.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),_e}(NodeWithChildren);node$1.Document=Document$4;var Element$1=function(et){__extends(_e,et);function _e(tt,rt,nt,it){nt===void 0&&(nt=[]),it===void 0&&(it=tt==="script"?domelementtype_1$1.ElementType.Script:tt==="style"?domelementtype_1$1.ElementType.Style:domelementtype_1$1.ElementType.Tag);var st=et.call(this,nt)||this;return st.name=tt,st.attribs=rt,st.type=it,st}return Object.defineProperty(_e.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(_e.prototype,"tagName",{get:function(){return this.name},set:function(tt){this.name=tt},enumerable:!1,configurable:!0}),Object.defineProperty(_e.prototype,"attributes",{get:function(){var tt=this;return Object.keys(this.attribs).map(function(rt){var nt,it;return{name:rt,value:tt.attribs[rt],namespace:(nt=tt["x-attribsNamespace"])===null||nt===void 0?void 0:nt[rt],prefix:(it=tt["x-attribsPrefix"])===null||it===void 0?void 0:it[rt]}})},enumerable:!1,configurable:!0}),_e}(NodeWithChildren);node$1.Element=Element$1;function isTag(et){return(0,domelementtype_1$1.isTag)(et)}node$1.isTag=isTag;function isCDATA(et){return et.type===domelementtype_1$1.ElementType.CDATA}node$1.isCDATA=isCDATA;function isText(et){return et.type===domelementtype_1$1.ElementType.Text}node$1.isText=isText;function isComment(et){return et.type===domelementtype_1$1.ElementType.Comment}node$1.isComment=isComment;function isDirective(et){return et.type===domelementtype_1$1.ElementType.Directive}node$1.isDirective=isDirective;function isDocument(et){return et.type===domelementtype_1$1.ElementType.Root}node$1.isDocument=isDocument;function hasChildren(et){return Object.prototype.hasOwnProperty.call(et,"children")}node$1.hasChildren=hasChildren;function cloneNode$1(et,_e){_e===void 0&&(_e=!1);var tt;if(isText(et))tt=new Text(et.data);else if(isComment(et))tt=new Comment$5(et.data);else if(isTag(et)){var rt=_e?cloneChildren(et.children):[],nt=new Element$1(et.name,__assign$2({},et.attribs),rt);rt.forEach(function(at){return at.parent=nt}),et.namespace!=null&&(nt.namespace=et.namespace),et["x-attribsNamespace"]&&(nt["x-attribsNamespace"]=__assign$2({},et["x-attribsNamespace"])),et["x-attribsPrefix"]&&(nt["x-attribsPrefix"]=__assign$2({},et["x-attribsPrefix"])),tt=nt}else if(isCDATA(et)){var rt=_e?cloneChildren(et.children):[],it=new CDATA(rt);rt.forEach(function(lt){return lt.parent=it}),tt=it}else if(isDocument(et)){var rt=_e?cloneChildren(et.children):[],st=new Document$4(rt);rt.forEach(function(lt){return lt.parent=st}),et["x-mode"]&&(st["x-mode"]=et["x-mode"]),tt=st}else if(isDirective(et)){var ot=new ProcessingInstruction(et.name,et.data);et["x-name"]!=null&&(ot["x-name"]=et["x-name"],ot["x-publicId"]=et["x-publicId"],ot["x-systemId"]=et["x-systemId"]),tt=ot}else throw new Error("Not implemented yet: ".concat(et.type));return tt.startIndex=et.startIndex,tt.endIndex=et.endIndex,et.sourceCodeLocation!=null&&(tt.sourceCodeLocation=et.sourceCodeLocation),tt}node$1.cloneNode=cloneNode$1;function cloneChildren(et){for(var _e=et.map(function(rt){return cloneNode$1(rt,!0)}),tt=1;tt<_e.length;tt++)_e[tt].prev=_e[tt-1],_e[tt-1].next=_e[tt];return _e}(function(et){var _e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ot,at,lt,ut){ut===void 0&&(ut=lt);var ct=Object.getOwnPropertyDescriptor(at,lt);(!ct||("get"in ct?!at.__esModule:ct.writable||ct.configurable))&&(ct={enumerable:!0,get:function(){return at[lt]}}),Object.defineProperty(ot,ut,ct)}:function(ot,at,lt,ut){ut===void 0&&(ut=lt),ot[ut]=at[lt]}),tt=commonjsGlobal&&commonjsGlobal.__exportStar||function(ot,at){for(var lt in ot)lt!=="default"&&!Object.prototype.hasOwnProperty.call(at,lt)&&_e(at,ot,lt)};Object.defineProperty(et,"__esModule",{value:!0}),et.DomHandler=void 0;var rt=lib$3,nt=node$1;tt(node$1,et);var it={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},st=function(){function ot(at,lt,ut){this.dom=[],this.root=new nt.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof lt=="function"&&(ut=lt,lt=it),typeof at=="object"&&(lt=at,at=void 0),this.callback=at??null,this.options=lt??it,this.elementCB=ut??null}return ot.prototype.onparserinit=function(at){this.parser=at},ot.prototype.onreset=function(){this.dom=[],this.root=new nt.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},ot.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},ot.prototype.onerror=function(at){this.handleCallback(at)},ot.prototype.onclosetag=function(){this.lastNode=null;var at=this.tagStack.pop();this.options.withEndIndices&&(at.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(at)},ot.prototype.onopentag=function(at,lt){var ut=this.options.xmlMode?rt.ElementType.Tag:void 0,ct=new nt.Element(at,lt,void 0,ut);this.addNode(ct),this.tagStack.push(ct)},ot.prototype.ontext=function(at){var lt=this.lastNode;if(lt&&lt.type===rt.ElementType.Text)lt.data+=at,this.options.withEndIndices&&(lt.endIndex=this.parser.endIndex);else{var ut=new nt.Text(at);this.addNode(ut),this.lastNode=ut}},ot.prototype.oncomment=function(at){if(this.lastNode&&this.lastNode.type===rt.ElementType.Comment){this.lastNode.data+=at;return}var lt=new nt.Comment(at);this.addNode(lt),this.lastNode=lt},ot.prototype.oncommentend=function(){this.lastNode=null},ot.prototype.oncdatastart=function(){var at=new nt.Text(""),lt=new nt.CDATA([at]);this.addNode(lt),at.parent=lt,this.lastNode=at},ot.prototype.oncdataend=function(){this.lastNode=null},ot.prototype.onprocessinginstruction=function(at,lt){var ut=new nt.ProcessingInstruction(at,lt);this.addNode(ut)},ot.prototype.handleCallback=function(at){if(typeof this.callback=="function")this.callback(at,this.dom);else if(at)throw at},ot.prototype.addNode=function(at){var lt=this.tagStack[this.tagStack.length-1],ut=lt.children[lt.children.length-1];this.options.withStartIndices&&(at.startIndex=this.parser.startIndex),this.options.withEndIndices&&(at.endIndex=this.parser.endIndex),lt.children.push(at),ut&&(at.prev=ut,ut.next=at),at.parent=lt,this.lastNode=null},ot}();et.DomHandler=st,et.default=st})(lib$4);var lib$2={},stringify$5={},lib$1={},lib={},encode={},encodeHtml={};Object.defineProperty(encodeHtml,"__esModule",{value:!0});function restoreDiff(et){for(var _e=1;_e<et.length;_e++)et[_e][0]+=et[_e-1][0]+1;return et}encodeHtml.default=new Map(restoreDiff([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(restoreDiff([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(restoreDiff([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(restoreDiff([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var _escape={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.escapeText=et.escapeAttribute=et.escapeUTF8=et.escape=et.encodeXML=et.getCodePoint=et.xmlReplacer=void 0,et.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var _e=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);et.getCodePoint=String.prototype.codePointAt!=null?function(nt,it){return nt.codePointAt(it)}:function(nt,it){return(nt.charCodeAt(it)&64512)===55296?(nt.charCodeAt(it)-55296)*1024+nt.charCodeAt(it+1)-56320+65536:nt.charCodeAt(it)};function tt(nt){for(var it="",st=0,ot;(ot=et.xmlReplacer.exec(nt))!==null;){var at=ot.index,lt=nt.charCodeAt(at),ut=_e.get(lt);ut!==void 0?(it+=nt.substring(st,at)+ut,st=at+1):(it+="".concat(nt.substring(st,at),"&#x").concat((0,et.getCodePoint)(nt,at).toString(16),";"),st=et.xmlReplacer.lastIndex+=+((lt&64512)===55296))}return it+nt.substr(st)}et.encodeXML=tt,et.escape=tt;function rt(nt,it){return function(ot){for(var at,lt=0,ut="";at=nt.exec(ot);)lt!==at.index&&(ut+=ot.substring(lt,at.index)),ut+=it.get(at[0].charCodeAt(0)),lt=at.index+1;return ut+ot.substring(lt)}}et.escapeUTF8=rt(/[&<>'"]/g,_e),et.escapeAttribute=rt(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),et.escapeText=rt(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(_escape);var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(encode,"__esModule",{value:!0}),encode.encodeNonAsciiHTML=encode.encodeHTML=void 0;var encode_html_js_1=__importDefault$1(encodeHtml),escape_js_1=_escape,htmlReplacer=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function encodeHTML(et){return encodeHTMLTrieRe(htmlReplacer,et)}encode.encodeHTML=encodeHTML;function encodeNonAsciiHTML(et){return encodeHTMLTrieRe(escape_js_1.xmlReplacer,et)}encode.encodeNonAsciiHTML=encodeNonAsciiHTML;function encodeHTMLTrieRe(et,_e){for(var tt="",rt=0,nt;(nt=et.exec(_e))!==null;){var it=nt.index;tt+=_e.substring(rt,it);var st=_e.charCodeAt(it),ot=encode_html_js_1.default.get(st);if(typeof ot=="object"){if(it+1<_e.length){var at=_e.charCodeAt(it+1),lt=typeof ot.n=="number"?ot.n===at?ot.o:void 0:ot.n.get(at);if(lt!==void 0){tt+=lt,rt=et.lastIndex+=1;continue}}ot=ot.v}if(ot!==void 0)tt+=ot,rt=it+1;else{var ut=(0,escape_js_1.getCodePoint)(_e,it);tt+="&#x".concat(ut.toString(16),";"),rt=et.lastIndex+=+(ut!==st)}}return tt+_e.substr(rt)}(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.decodeXMLStrict=et.decodeHTML5Strict=et.decodeHTML4Strict=et.decodeHTML5=et.decodeHTML4=et.decodeHTMLAttribute=et.decodeHTMLStrict=et.decodeHTML=et.decodeXML=et.DecodingMode=et.EntityDecoder=et.encodeHTML5=et.encodeHTML4=et.encodeNonAsciiHTML=et.encodeHTML=et.escapeText=et.escapeAttribute=et.escapeUTF8=et.escape=et.encodeXML=et.encode=et.decodeStrict=et.decode=et.EncodingMode=et.EntityLevel=void 0;var _e=decode,tt=encode,rt=_escape,nt;(function(dt){dt[dt.XML=0]="XML",dt[dt.HTML=1]="HTML"})(nt=et.EntityLevel||(et.EntityLevel={}));var it;(function(dt){dt[dt.UTF8=0]="UTF8",dt[dt.ASCII=1]="ASCII",dt[dt.Extensive=2]="Extensive",dt[dt.Attribute=3]="Attribute",dt[dt.Text=4]="Text"})(it=et.EncodingMode||(et.EncodingMode={}));function st(dt,ft){ft===void 0&&(ft=nt.XML);var pt=typeof ft=="number"?ft:ft.level;if(pt===nt.HTML){var mt=typeof ft=="object"?ft.mode:void 0;return(0,_e.decodeHTML)(dt,mt)}return(0,_e.decodeXML)(dt)}et.decode=st;function ot(dt,ft){var pt;ft===void 0&&(ft=nt.XML);var mt=typeof ft=="number"?{level:ft}:ft;return(pt=mt.mode)!==null&&pt!==void 0||(mt.mode=_e.DecodingMode.Strict),st(dt,mt)}et.decodeStrict=ot;function at(dt,ft){ft===void 0&&(ft=nt.XML);var pt=typeof ft=="number"?{level:ft}:ft;return pt.mode===it.UTF8?(0,rt.escapeUTF8)(dt):pt.mode===it.Attribute?(0,rt.escapeAttribute)(dt):pt.mode===it.Text?(0,rt.escapeText)(dt):pt.level===nt.HTML?pt.mode===it.ASCII?(0,tt.encodeNonAsciiHTML)(dt):(0,tt.encodeHTML)(dt):(0,rt.encodeXML)(dt)}et.encode=at;var lt=_escape;Object.defineProperty(et,"encodeXML",{enumerable:!0,get:function(){return lt.encodeXML}}),Object.defineProperty(et,"escape",{enumerable:!0,get:function(){return lt.escape}}),Object.defineProperty(et,"escapeUTF8",{enumerable:!0,get:function(){return lt.escapeUTF8}}),Object.defineProperty(et,"escapeAttribute",{enumerable:!0,get:function(){return lt.escapeAttribute}}),Object.defineProperty(et,"escapeText",{enumerable:!0,get:function(){return lt.escapeText}});var ut=encode;Object.defineProperty(et,"encodeHTML",{enumerable:!0,get:function(){return ut.encodeHTML}}),Object.defineProperty(et,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return ut.encodeNonAsciiHTML}}),Object.defineProperty(et,"encodeHTML4",{enumerable:!0,get:function(){return ut.encodeHTML}}),Object.defineProperty(et,"encodeHTML5",{enumerable:!0,get:function(){return ut.encodeHTML}});var ct=decode;Object.defineProperty(et,"EntityDecoder",{enumerable:!0,get:function(){return ct.EntityDecoder}}),Object.defineProperty(et,"DecodingMode",{enumerable:!0,get:function(){return ct.DecodingMode}}),Object.defineProperty(et,"decodeXML",{enumerable:!0,get:function(){return ct.decodeXML}}),Object.defineProperty(et,"decodeHTML",{enumerable:!0,get:function(){return ct.decodeHTML}}),Object.defineProperty(et,"decodeHTMLStrict",{enumerable:!0,get:function(){return ct.decodeHTMLStrict}}),Object.defineProperty(et,"decodeHTMLAttribute",{enumerable:!0,get:function(){return ct.decodeHTMLAttribute}}),Object.defineProperty(et,"decodeHTML4",{enumerable:!0,get:function(){return ct.decodeHTML}}),Object.defineProperty(et,"decodeHTML5",{enumerable:!0,get:function(){return ct.decodeHTML}}),Object.defineProperty(et,"decodeHTML4Strict",{enumerable:!0,get:function(){return ct.decodeHTMLStrict}}),Object.defineProperty(et,"decodeHTML5Strict",{enumerable:!0,get:function(){return ct.decodeHTMLStrict}}),Object.defineProperty(et,"decodeXMLStrict",{enumerable:!0,get:function(){return ct.decodeXML}})})(lib);var foreignNames={};Object.defineProperty(foreignNames,"__esModule",{value:!0}),foreignNames.attributeNames=foreignNames.elementNames=void 0,foreignNames.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(et){return[et.toLowerCase(),et]})),foreignNames.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(et){return[et.toLowerCase(),et]}));var __assign$1=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$1=Object.assign||function(et){for(var _e,tt=1,rt=arguments.length;tt<rt;tt++){_e=arguments[tt];for(var nt in _e)Object.prototype.hasOwnProperty.call(_e,nt)&&(et[nt]=_e[nt])}return et},__assign$1.apply(this,arguments)},__createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(et,_e,tt,rt){rt===void 0&&(rt=tt);var nt=Object.getOwnPropertyDescriptor(_e,tt);(!nt||("get"in nt?!_e.__esModule:nt.writable||nt.configurable))&&(nt={enumerable:!0,get:function(){return _e[tt]}}),Object.defineProperty(et,rt,nt)}:function(et,_e,tt,rt){rt===void 0&&(rt=tt),et[rt]=_e[tt]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(et,_e){Object.defineProperty(et,"default",{enumerable:!0,value:_e})}:function(et,_e){et.default=_e}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(et){if(et&&et.__esModule)return et;var _e={};if(et!=null)for(var tt in et)tt!=="default"&&Object.prototype.hasOwnProperty.call(et,tt)&&__createBinding(_e,et,tt);return __setModuleDefault(_e,et),_e};Object.defineProperty(lib$1,"__esModule",{value:!0}),lib$1.render=void 0;var ElementType=__importStar(lib$3),entities_1=lib,foreignNames_js_1=foreignNames,unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(et){return et.replace(/"/g,"&quot;")}function formatAttributes(et,_e){var tt;if(et){var rt=((tt=_e.encodeEntities)!==null&&tt!==void 0?tt:_e.decodeEntities)===!1?replaceQuotes:_e.xmlMode||_e.encodeEntities!=="utf8"?entities_1.encodeXML:entities_1.escapeAttribute;return Object.keys(et).map(function(nt){var it,st,ot=(it=et[nt])!==null&&it!==void 0?it:"";return _e.xmlMode==="foreign"&&(nt=(st=foreignNames_js_1.attributeNames.get(nt))!==null&&st!==void 0?st:nt),!_e.emptyAttrs&&!_e.xmlMode&&ot===""?nt:"".concat(nt,'="').concat(rt(ot),'"')}).join(" ")}}var singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render(et,_e){_e===void 0&&(_e={});for(var tt=("length"in et)?et:[et],rt="",nt=0;nt<tt.length;nt++)rt+=renderNode(tt[nt],_e);return rt}lib$1.render=render,lib$1.default=render;function renderNode(et,_e){switch(et.type){case ElementType.Root:return render(et.children,_e);case ElementType.Doctype:case ElementType.Directive:return renderDirective(et);case ElementType.Comment:return renderComment(et);case ElementType.CDATA:return renderCdata(et);case ElementType.Script:case ElementType.Style:case ElementType.Tag:return renderTag(et,_e);case ElementType.Text:return renderText(et,_e)}}var foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(et,_e){var tt;_e.xmlMode==="foreign"&&(et.name=(tt=foreignNames_js_1.elementNames.get(et.name))!==null&&tt!==void 0?tt:et.name,et.parent&&foreignModeIntegrationPoints.has(et.parent.name)&&(_e=__assign$1(__assign$1({},_e),{xmlMode:!1}))),!_e.xmlMode&&foreignElements.has(et.name)&&(_e=__assign$1(__assign$1({},_e),{xmlMode:"foreign"}));var rt="<".concat(et.name),nt=formatAttributes(et.attribs,_e);return nt&&(rt+=" ".concat(nt)),et.children.length===0&&(_e.xmlMode?_e.selfClosingTags!==!1:_e.selfClosingTags&&singleTag.has(et.name))?(_e.xmlMode||(rt+=" "),rt+="/>"):(rt+=">",et.children.length>0&&(rt+=render(et.children,_e)),(_e.xmlMode||!singleTag.has(et.name))&&(rt+="</".concat(et.name,">"))),rt}function renderDirective(et){return"<".concat(et.data,">")}function renderText(et,_e){var tt,rt=et.data||"";return((tt=_e.encodeEntities)!==null&&tt!==void 0?tt:_e.decodeEntities)!==!1&&!(!_e.xmlMode&&et.parent&&unencodedElements.has(et.parent.name))&&(rt=_e.xmlMode||_e.encodeEntities!=="utf8"?(0,entities_1.encodeXML)(rt):(0,entities_1.escapeText)(rt)),rt}function renderCdata(et){return"<![CDATA[".concat(et.children[0].data,"]]>")}function renderComment(et){return"<!--".concat(et.data,"-->")}var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(stringify$5,"__esModule",{value:!0}),stringify$5.innerText=stringify$5.textContent=stringify$5.getText=stringify$5.getInnerHTML=stringify$5.getOuterHTML=void 0;var domhandler_1$3=lib$4,dom_serializer_1=__importDefault(lib$1),domelementtype_1=lib$3;function getOuterHTML(et,_e){return(0,dom_serializer_1.default)(et,_e)}stringify$5.getOuterHTML=getOuterHTML;function getInnerHTML(et,_e){return(0,domhandler_1$3.hasChildren)(et)?et.children.map(function(tt){return getOuterHTML(tt,_e)}).join(""):""}stringify$5.getInnerHTML=getInnerHTML;function getText(et){return Array.isArray(et)?et.map(getText).join(""):(0,domhandler_1$3.isTag)(et)?et.name==="br"?`
`:getText(et.children):(0,domhandler_1$3.isCDATA)(et)?getText(et.children):(0,domhandler_1$3.isText)(et)?et.data:""}stringify$5.getText=getText;function textContent(et){return Array.isArray(et)?et.map(textContent).join(""):(0,domhandler_1$3.hasChildren)(et)&&!(0,domhandler_1$3.isComment)(et)?textContent(et.children):(0,domhandler_1$3.isText)(et)?et.data:""}stringify$5.textContent=textContent;function innerText(et){return Array.isArray(et)?et.map(innerText).join(""):(0,domhandler_1$3.hasChildren)(et)&&(et.type===domelementtype_1.ElementType.Tag||(0,domhandler_1$3.isCDATA)(et))?innerText(et.children):(0,domhandler_1$3.isText)(et)?et.data:""}stringify$5.innerText=innerText;var traversal={};Object.defineProperty(traversal,"__esModule",{value:!0}),traversal.prevElementSibling=traversal.nextElementSibling=traversal.getName=traversal.hasAttrib=traversal.getAttributeValue=traversal.getSiblings=traversal.getParent=traversal.getChildren=void 0;var domhandler_1$2=lib$4;function getChildren(et){return(0,domhandler_1$2.hasChildren)(et)?et.children:[]}traversal.getChildren=getChildren;function getParent(et){return et.parent||null}traversal.getParent=getParent;function getSiblings(et){var _e,tt,rt=getParent(et);if(rt!=null)return getChildren(rt);for(var nt=[et],it=et.prev,st=et.next;it!=null;)nt.unshift(it),_e=it,it=_e.prev;for(;st!=null;)nt.push(st),tt=st,st=tt.next;return nt}traversal.getSiblings=getSiblings;function getAttributeValue(et,_e){var tt;return(tt=et.attribs)===null||tt===void 0?void 0:tt[_e]}traversal.getAttributeValue=getAttributeValue;function hasAttrib(et,_e){return et.attribs!=null&&Object.prototype.hasOwnProperty.call(et.attribs,_e)&&et.attribs[_e]!=null}traversal.hasAttrib=hasAttrib;function getName(et){return et.name}traversal.getName=getName;function nextElementSibling(et){for(var _e,tt=et.next;tt!==null&&!(0,domhandler_1$2.isTag)(tt);)_e=tt,tt=_e.next;return tt}traversal.nextElementSibling=nextElementSibling;function prevElementSibling(et){for(var _e,tt=et.prev;tt!==null&&!(0,domhandler_1$2.isTag)(tt);)_e=tt,tt=_e.prev;return tt}traversal.prevElementSibling=prevElementSibling;var manipulation={};Object.defineProperty(manipulation,"__esModule",{value:!0}),manipulation.prepend=manipulation.prependChild=manipulation.append=manipulation.appendChild=manipulation.replaceElement=manipulation.removeElement=void 0;function removeElement(et){if(et.prev&&(et.prev.next=et.next),et.next&&(et.next.prev=et.prev),et.parent){var _e=et.parent.children,tt=_e.lastIndexOf(et);tt>=0&&_e.splice(tt,1)}et.next=null,et.prev=null,et.parent=null}manipulation.removeElement=removeElement;function replaceElement(et,_e){var tt=_e.prev=et.prev;tt&&(tt.next=_e);var rt=_e.next=et.next;rt&&(rt.prev=_e);var nt=_e.parent=et.parent;if(nt){var it=nt.children;it[it.lastIndexOf(et)]=_e,et.parent=null}}manipulation.replaceElement=replaceElement;function appendChild(et,_e){if(removeElement(_e),_e.next=null,_e.parent=et,et.children.push(_e)>1){var tt=et.children[et.children.length-2];tt.next=_e,_e.prev=tt}else _e.prev=null}manipulation.appendChild=appendChild;function append(et,_e){removeElement(_e);var tt=et.parent,rt=et.next;if(_e.next=rt,_e.prev=et,et.next=_e,_e.parent=tt,rt){if(rt.prev=_e,tt){var nt=tt.children;nt.splice(nt.lastIndexOf(rt),0,_e)}}else tt&&tt.children.push(_e)}manipulation.append=append;function prependChild(et,_e){if(removeElement(_e),_e.parent=et,_e.prev=null,et.children.unshift(_e)!==1){var tt=et.children[1];tt.prev=_e,_e.next=tt}else _e.next=null}manipulation.prependChild=prependChild;function prepend(et,_e){removeElement(_e);var tt=et.parent;if(tt){var rt=tt.children;rt.splice(rt.indexOf(et),0,_e)}et.prev&&(et.prev.next=_e),_e.parent=tt,_e.prev=et.prev,_e.next=et,et.prev=_e}manipulation.prepend=prepend;var querying={};Object.defineProperty(querying,"__esModule",{value:!0}),querying.findAll=querying.existsOne=querying.findOne=querying.findOneChild=querying.find=querying.filter=void 0;var domhandler_1$1=lib$4;function filter$1(et,_e,tt,rt){return tt===void 0&&(tt=!0),rt===void 0&&(rt=1/0),find(et,Array.isArray(_e)?_e:[_e],tt,rt)}querying.filter=filter$1;function find(et,_e,tt,rt){for(var nt=[],it=[_e],st=[0];;){if(st[0]>=it[0].length){if(st.length===1)return nt;it.shift(),st.shift();continue}var ot=it[0][st[0]++];if(et(ot)&&(nt.push(ot),--rt<=0))return nt;tt&&(0,domhandler_1$1.hasChildren)(ot)&&ot.children.length>0&&(st.unshift(0),it.unshift(ot.children))}}querying.find=find;function findOneChild(et,_e){return _e.find(et)}querying.findOneChild=findOneChild;function findOne(et,_e,tt){tt===void 0&&(tt=!0);for(var rt=null,nt=0;nt<_e.length&&!rt;nt++){var it=_e[nt];if((0,domhandler_1$1.isTag)(it))et(it)?rt=it:tt&&it.children.length>0&&(rt=findOne(et,it.children,!0));else continue}return rt}querying.findOne=findOne;function existsOne(et,_e){return _e.some(function(tt){return(0,domhandler_1$1.isTag)(tt)&&(et(tt)||existsOne(et,tt.children))})}querying.existsOne=existsOne;function findAll(et,_e){for(var tt=[],rt=[_e],nt=[0];;){if(nt[0]>=rt[0].length){if(rt.length===1)return tt;rt.shift(),nt.shift();continue}var it=rt[0][nt[0]++];(0,domhandler_1$1.isTag)(it)&&(et(it)&&tt.push(it),it.children.length>0&&(nt.unshift(0),rt.unshift(it.children)))}}querying.findAll=findAll;var legacy={};Object.defineProperty(legacy,"__esModule",{value:!0}),legacy.getElementsByTagType=legacy.getElementsByTagName=legacy.getElementById=legacy.getElements=legacy.testElement=void 0;var domhandler_1=lib$4,querying_js_1=querying,Checks={tag_name:function(et){return typeof et=="function"?function(_e){return(0,domhandler_1.isTag)(_e)&&et(_e.name)}:et==="*"?domhandler_1.isTag:function(_e){return(0,domhandler_1.isTag)(_e)&&_e.name===et}},tag_type:function(et){return typeof et=="function"?function(_e){return et(_e.type)}:function(_e){return _e.type===et}},tag_contains:function(et){return typeof et=="function"?function(_e){return(0,domhandler_1.isText)(_e)&&et(_e.data)}:function(_e){return(0,domhandler_1.isText)(_e)&&_e.data===et}}};function getAttribCheck(et,_e){return typeof _e=="function"?function(tt){return(0,domhandler_1.isTag)(tt)&&_e(tt.attribs[et])}:function(tt){return(0,domhandler_1.isTag)(tt)&&tt.attribs[et]===_e}}function combineFuncs(et,_e){return function(tt){return et(tt)||_e(tt)}}function compileTest(et){var _e=Object.keys(et).map(function(tt){var rt=et[tt];return Object.prototype.hasOwnProperty.call(Checks,tt)?Checks[tt](rt):getAttribCheck(tt,rt)});return _e.length===0?null:_e.reduce(combineFuncs)}function testElement(et,_e){var tt=compileTest(et);return tt?tt(_e):!0}legacy.testElement=testElement;function getElements(et,_e,tt,rt){rt===void 0&&(rt=1/0);var nt=compileTest(et);return nt?(0,querying_js_1.filter)(nt,_e,tt,rt):[]}legacy.getElements=getElements;function getElementById(et,_e,tt){return tt===void 0&&(tt=!0),Array.isArray(_e)||(_e=[_e]),(0,querying_js_1.findOne)(getAttribCheck("id",et),_e,tt)}legacy.getElementById=getElementById;function getElementsByTagName(et,_e,tt,rt){return tt===void 0&&(tt=!0),rt===void 0&&(rt=1/0),(0,querying_js_1.filter)(Checks.tag_name(et),_e,tt,rt)}legacy.getElementsByTagName=getElementsByTagName;function getElementsByTagType(et,_e,tt,rt){return tt===void 0&&(tt=!0),rt===void 0&&(rt=1/0),(0,querying_js_1.filter)(Checks.tag_type(et),_e,tt,rt)}legacy.getElementsByTagType=getElementsByTagType;var helpers={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.uniqueSort=et.compareDocumentPosition=et.DocumentPosition=et.removeSubsets=void 0;var _e=lib$4;function tt(st){for(var ot=st.length;--ot>=0;){var at=st[ot];if(ot>0&&st.lastIndexOf(at,ot-1)>=0){st.splice(ot,1);continue}for(var lt=at.parent;lt;lt=lt.parent)if(st.includes(lt)){st.splice(ot,1);break}}return st}et.removeSubsets=tt;var rt;(function(st){st[st.DISCONNECTED=1]="DISCONNECTED",st[st.PRECEDING=2]="PRECEDING",st[st.FOLLOWING=4]="FOLLOWING",st[st.CONTAINS=8]="CONTAINS",st[st.CONTAINED_BY=16]="CONTAINED_BY"})(rt=et.DocumentPosition||(et.DocumentPosition={}));function nt(st,ot){var at=[],lt=[];if(st===ot)return 0;for(var ut=(0,_e.hasChildren)(st)?st:st.parent;ut;)at.unshift(ut),ut=ut.parent;for(ut=(0,_e.hasChildren)(ot)?ot:ot.parent;ut;)lt.unshift(ut),ut=ut.parent;for(var ct=Math.min(at.length,lt.length),dt=0;dt<ct&&at[dt]===lt[dt];)dt++;if(dt===0)return rt.DISCONNECTED;var ft=at[dt-1],pt=ft.children,mt=at[dt],ht=lt[dt];return pt.indexOf(mt)>pt.indexOf(ht)?ft===ot?rt.FOLLOWING|rt.CONTAINED_BY:rt.FOLLOWING:ft===st?rt.PRECEDING|rt.CONTAINS:rt.PRECEDING}et.compareDocumentPosition=nt;function it(st){return st=st.filter(function(ot,at,lt){return!lt.includes(ot,at+1)}),st.sort(function(ot,at){var lt=nt(ot,at);return lt&rt.PRECEDING?-1:lt&rt.FOLLOWING?1:0}),st}et.uniqueSort=it})(helpers);var feeds={};Object.defineProperty(feeds,"__esModule",{value:!0}),feeds.getFeed=void 0;var stringify_js_1=stringify$5,legacy_js_1=legacy;function getFeed(et){var _e=getOneElement(isValidFeed,et);return _e?_e.name==="feed"?getAtomFeed(_e):getRssFeed(_e):null}feeds.getFeed=getFeed;function getAtomFeed(et){var _e,tt=et.children,rt={type:"atom",items:(0,legacy_js_1.getElementsByTagName)("entry",tt).map(function(st){var ot,at=st.children,lt={media:getMediaElements(at)};addConditionally(lt,"id","id",at),addConditionally(lt,"title","title",at);var ut=(ot=getOneElement("link",at))===null||ot===void 0?void 0:ot.attribs.href;ut&&(lt.link=ut);var ct=fetch$1("summary",at)||fetch$1("content",at);ct&&(lt.description=ct);var dt=fetch$1("updated",at);return dt&&(lt.pubDate=new Date(dt)),lt})};addConditionally(rt,"id","id",tt),addConditionally(rt,"title","title",tt);var nt=(_e=getOneElement("link",tt))===null||_e===void 0?void 0:_e.attribs.href;nt&&(rt.link=nt),addConditionally(rt,"description","subtitle",tt);var it=fetch$1("updated",tt);return it&&(rt.updated=new Date(it)),addConditionally(rt,"author","email",tt,!0),rt}function getRssFeed(et){var _e,tt,rt=(tt=(_e=getOneElement("channel",et.children))===null||_e===void 0?void 0:_e.children)!==null&&tt!==void 0?tt:[],nt={type:et.name.substr(0,3),id:"",items:(0,legacy_js_1.getElementsByTagName)("item",et.children).map(function(st){var ot=st.children,at={media:getMediaElements(ot)};addConditionally(at,"id","guid",ot),addConditionally(at,"title","title",ot),addConditionally(at,"link","link",ot),addConditionally(at,"description","description",ot);var lt=fetch$1("pubDate",ot)||fetch$1("dc:date",ot);return lt&&(at.pubDate=new Date(lt)),at})};addConditionally(nt,"title","title",rt),addConditionally(nt,"link","link",rt),addConditionally(nt,"description","description",rt);var it=fetch$1("lastBuildDate",rt);return it&&(nt.updated=new Date(it)),addConditionally(nt,"author","managingEditor",rt,!0),nt}var MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(et){return(0,legacy_js_1.getElementsByTagName)("media:content",et).map(function(_e){for(var tt=_e.attribs,rt={medium:tt.medium,isDefault:!!tt.isDefault},nt=0,it=MEDIA_KEYS_STRING;nt<it.length;nt++){var st=it[nt];tt[st]&&(rt[st]=tt[st])}for(var ot=0,at=MEDIA_KEYS_INT;ot<at.length;ot++){var st=at[ot];tt[st]&&(rt[st]=parseInt(tt[st],10))}return tt.expression&&(rt.expression=tt.expression),rt})}function getOneElement(et,_e){return(0,legacy_js_1.getElementsByTagName)(et,_e,!0,1)[0]}function fetch$1(et,_e,tt){return tt===void 0&&(tt=!1),(0,stringify_js_1.textContent)((0,legacy_js_1.getElementsByTagName)(et,_e,tt,1)).trim()}function addConditionally(et,_e,tt,rt,nt){nt===void 0&&(nt=!1);var it=fetch$1(tt,rt,nt);it&&(et[_e]=it)}function isValidFeed(et){return et==="rss"||et==="feed"||et==="rdf:RDF"}(function(et){var _e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(nt,it,st,ot){ot===void 0&&(ot=st);var at=Object.getOwnPropertyDescriptor(it,st);(!at||("get"in at?!it.__esModule:at.writable||at.configurable))&&(at={enumerable:!0,get:function(){return it[st]}}),Object.defineProperty(nt,ot,at)}:function(nt,it,st,ot){ot===void 0&&(ot=st),nt[ot]=it[st]}),tt=commonjsGlobal&&commonjsGlobal.__exportStar||function(nt,it){for(var st in nt)st!=="default"&&!Object.prototype.hasOwnProperty.call(it,st)&&_e(it,nt,st)};Object.defineProperty(et,"__esModule",{value:!0}),et.hasChildren=et.isDocument=et.isComment=et.isText=et.isCDATA=et.isTag=void 0,tt(stringify$5,et),tt(traversal,et),tt(manipulation,et),tt(querying,et),tt(legacy,et),tt(helpers,et),tt(feeds,et);var rt=lib$4;Object.defineProperty(et,"isTag",{enumerable:!0,get:function(){return rt.isTag}}),Object.defineProperty(et,"isCDATA",{enumerable:!0,get:function(){return rt.isCDATA}}),Object.defineProperty(et,"isText",{enumerable:!0,get:function(){return rt.isText}}),Object.defineProperty(et,"isComment",{enumerable:!0,get:function(){return rt.isComment}}),Object.defineProperty(et,"isDocument",{enumerable:!0,get:function(){return rt.isDocument}}),Object.defineProperty(et,"hasChildren",{enumerable:!0,get:function(){return rt.hasChildren}})})(lib$2),function(et){var _e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(gt,vt,yt,bt){bt===void 0&&(bt=yt);var xt=Object.getOwnPropertyDescriptor(vt,yt);(!xt||("get"in xt?!vt.__esModule:xt.writable||xt.configurable))&&(xt={enumerable:!0,get:function(){return vt[yt]}}),Object.defineProperty(gt,bt,xt)}:function(gt,vt,yt,bt){bt===void 0&&(bt=yt),gt[bt]=vt[yt]}),tt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(gt,vt){Object.defineProperty(gt,"default",{enumerable:!0,value:vt})}:function(gt,vt){gt.default=vt}),rt=commonjsGlobal&&commonjsGlobal.__importStar||function(gt){if(gt&&gt.__esModule)return gt;var vt={};if(gt!=null)for(var yt in gt)yt!=="default"&&Object.prototype.hasOwnProperty.call(gt,yt)&&_e(vt,gt,yt);return tt(vt,gt),vt},nt=commonjsGlobal&&commonjsGlobal.__importDefault||function(gt){return gt&&gt.__esModule?gt:{default:gt}};Object.defineProperty(et,"__esModule",{value:!0}),et.DomUtils=et.parseFeed=et.getFeed=et.ElementType=et.Tokenizer=et.createDomStream=et.parseDOM=et.parseDocument=et.DefaultHandler=et.DomHandler=et.Parser=void 0;var it=Parser$3,st=Parser$3;Object.defineProperty(et,"Parser",{enumerable:!0,get:function(){return st.Parser}});var ot=lib$4,at=lib$4;Object.defineProperty(et,"DomHandler",{enumerable:!0,get:function(){return at.DomHandler}}),Object.defineProperty(et,"DefaultHandler",{enumerable:!0,get:function(){return at.DomHandler}});function lt(gt,vt){var yt=new ot.DomHandler(void 0,vt);return new it.Parser(yt,vt).end(gt),yt.root}et.parseDocument=lt;function ut(gt,vt){return lt(gt,vt).children}et.parseDOM=ut;function ct(gt,vt,yt){var bt=new ot.DomHandler(gt,vt,yt);return new it.Parser(bt,vt)}et.createDomStream=ct;var dt=Tokenizer;Object.defineProperty(et,"Tokenizer",{enumerable:!0,get:function(){return nt(dt).default}}),et.ElementType=rt(lib$3);var ft=lib$2,pt=lib$2;Object.defineProperty(et,"getFeed",{enumerable:!0,get:function(){return pt.getFeed}});var mt={xmlMode:!0};function ht(gt,vt){return vt===void 0&&(vt=mt),(0,ft.getFeed)(ut(gt,vt))}et.parseFeed=ht,et.DomUtils=rt(lib$2)}(lib$5);var escapeStringRegexp$1=et=>{if(typeof et!="string")throw new TypeError("Expected a string");return et.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},isPlainObject$2={};Object.defineProperty(isPlainObject$2,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function isObject(et){return Object.prototype.toString.call(et)==="[object Object]"}function isPlainObject$1(et){var _e,tt;return isObject(et)===!1?!1:(_e=et.constructor,_e===void 0?!0:(tt=_e.prototype,!(isObject(tt)===!1||tt.hasOwnProperty("isPrototypeOf")===!1)))}isPlainObject$2.isPlainObject=isPlainObject$1;var isMergeableObject=function et(_e){return isNonNullObject(_e)&&!isSpecial(_e)};function isNonNullObject(et){return!!et&&typeof et=="object"}function isSpecial(et){var _e=Object.prototype.toString.call(et);return _e==="[object RegExp]"||_e==="[object Date]"||isReactElement(et)}var canUseSymbol=typeof Symbol=="function"&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(et){return et.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(et){return Array.isArray(et)?[]:{}}function cloneUnlessOtherwiseSpecified(et,_e){return _e.clone!==!1&&_e.isMergeableObject(et)?deepmerge$1(emptyTarget(et),et,_e):et}function defaultArrayMerge(et,_e,tt){return et.concat(_e).map(function(rt){return cloneUnlessOtherwiseSpecified(rt,tt)})}function getMergeFunction(et,_e){if(!_e.customMerge)return deepmerge$1;var tt=_e.customMerge(et);return typeof tt=="function"?tt:deepmerge$1}function getEnumerableOwnPropertySymbols(et){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(et).filter(function(_e){return Object.propertyIsEnumerable.call(et,_e)}):[]}function getKeys(et){return Object.keys(et).concat(getEnumerableOwnPropertySymbols(et))}function propertyIsOnObject(et,_e){try{return _e in et}catch{return!1}}function propertyIsUnsafe(et,_e){return propertyIsOnObject(et,_e)&&!(Object.hasOwnProperty.call(et,_e)&&Object.propertyIsEnumerable.call(et,_e))}function mergeObject(et,_e,tt){var rt={};return tt.isMergeableObject(et)&&getKeys(et).forEach(function(nt){rt[nt]=cloneUnlessOtherwiseSpecified(et[nt],tt)}),getKeys(_e).forEach(function(nt){propertyIsUnsafe(et,nt)||(propertyIsOnObject(et,nt)&&tt.isMergeableObject(_e[nt])?rt[nt]=getMergeFunction(nt,tt)(et[nt],_e[nt],tt):rt[nt]=cloneUnlessOtherwiseSpecified(_e[nt],tt))}),rt}function deepmerge$1(et,_e,tt){tt=tt||{},tt.arrayMerge=tt.arrayMerge||defaultArrayMerge,tt.isMergeableObject=tt.isMergeableObject||isMergeableObject,tt.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var rt=Array.isArray(_e),nt=Array.isArray(et),it=rt===nt;return it?rt?tt.arrayMerge(et,_e,tt):mergeObject(et,_e,tt):cloneUnlessOtherwiseSpecified(_e,tt)}deepmerge$1.all=function et(_e,tt){if(!Array.isArray(_e))throw new Error("first argument should be an array");return _e.reduce(function(rt,nt){return deepmerge$1(rt,nt,tt)},{})};var deepmerge_1=deepmerge$1,cjs=deepmerge_1,parseSrcset$1={exports:{}};(function(et){(function(_e,tt){et.exports?et.exports=tt():_e.parseSrcset=tt()})(commonjsGlobal,function(){return function(_e){function tt(bt){return bt===" "||bt==="	"||bt===`
`||bt==="\f"||bt==="\r"}function rt(bt){var xt,_t=bt.exec(_e.substring(ht));if(_t)return xt=_t[0],ht+=xt.length,xt}for(var nt=_e.length,it=/^[ \t\n\r\u000c]+/,st=/^[, \t\n\r\u000c]+/,ot=/^[^ \t\n\r\u000c]+/,at=/[,]+$/,lt=/^\d+$/,ut=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,ct,dt,ft,pt,mt,ht=0,gt=[];;){if(rt(st),ht>=nt)return gt;ct=rt(ot),dt=[],ct.slice(-1)===","?(ct=ct.replace(at,""),yt()):vt()}function vt(){for(rt(it),ft="",pt="in descriptor";;){if(mt=_e.charAt(ht),pt==="in descriptor")if(tt(mt))ft&&(dt.push(ft),ft="",pt="after descriptor");else if(mt===","){ht+=1,ft&&dt.push(ft),yt();return}else if(mt==="(")ft=ft+mt,pt="in parens";else if(mt===""){ft&&dt.push(ft),yt();return}else ft=ft+mt;else if(pt==="in parens")if(mt===")")ft=ft+mt,pt="in descriptor";else if(mt===""){dt.push(ft),yt();return}else ft=ft+mt;else if(pt==="after descriptor"&&!tt(mt))if(mt===""){yt();return}else pt="in descriptor",ht-=1;ht+=1}}function yt(){var bt=!1,xt,_t,wt,Ct,kt={},At,$t,Lt,Mt,Bt;for(Ct=0;Ct<dt.length;Ct++)At=dt[Ct],$t=At[At.length-1],Lt=At.substring(0,At.length-1),Mt=parseInt(Lt,10),Bt=parseFloat(Lt),lt.test(Lt)&&$t==="w"?((xt||_t)&&(bt=!0),Mt===0?bt=!0:xt=Mt):ut.test(Lt)&&$t==="x"?((xt||_t||wt)&&(bt=!0),Bt<0?bt=!0:_t=Bt):lt.test(Lt)&&$t==="h"?((wt||_t)&&(bt=!0),Mt===0?bt=!0:wt=Mt):bt=!0;bt?console&&console.log&&console.log("Invalid srcset descriptor found in '"+_e+"' at '"+At+"'."):(kt.url=ct,xt&&(kt.w=xt),_t&&(kt.d=_t),wt&&(kt.h=wt),gt.push(kt))}}})})(parseSrcset$1);var parseSrcsetExports=parseSrcset$1.exports,picocolors_browser={exports:{}},x=String,create=function(){return{isColorSupported:!1,reset:x,bold:x,dim:x,italic:x,underline:x,inverse:x,hidden:x,strikethrough:x,black:x,red:x,green:x,yellow:x,blue:x,magenta:x,cyan:x,white:x,gray:x,bgBlack:x,bgRed:x,bgGreen:x,bgYellow:x,bgBlue:x,bgMagenta:x,bgCyan:x,bgWhite:x}};picocolors_browser.exports=create(),picocolors_browser.exports.createColors=create;var picocolors_browserExports=picocolors_browser.exports;const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$2=getAugmentedNamespace(__viteBrowserExternal$1);let pico=picocolors_browserExports,terminalHighlight$1=require$$2,CssSyntaxError$3=class Lr extends Error{constructor(_e,tt,rt,nt,it,st){super(_e),this.name="CssSyntaxError",this.reason=_e,it&&(this.file=it),nt&&(this.source=nt),st&&(this.plugin=st),typeof tt<"u"&&typeof rt<"u"&&(typeof tt=="number"?(this.line=tt,this.column=rt):(this.line=tt.line,this.column=tt.column,this.endLine=rt.line,this.endColumn=rt.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,Lr)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(_e){if(!this.source)return"";let tt=this.source;_e==null&&(_e=pico.isColorSupported),terminalHighlight$1&&_e&&(tt=terminalHighlight$1(tt));let rt=tt.split(/\r?\n/),nt=Math.max(this.line-3,0),it=Math.min(this.line+2,rt.length),st=String(it).length,ot,at;if(_e){let{bold:lt,gray:ut,red:ct}=pico.createColors(!0);ot=dt=>lt(ct(dt)),at=dt=>ut(dt)}else ot=at=lt=>lt;return rt.slice(nt,it).map((lt,ut)=>{let ct=nt+1+ut,dt=" "+(" "+ct).slice(-st)+" | ";if(ct===this.line){let ft=at(dt.replace(/\d/g," "))+lt.slice(0,this.column-1).replace(/[^\t]/g," ");return ot(">")+at(dt)+lt+`
 `+ft+ot("^")}return" "+at(dt)+lt}).join(`
`)}toString(){let _e=this.showSourceCode();return _e&&(_e=`

`+_e+`
`),this.name+": "+this.message+_e}};var cssSyntaxError=CssSyntaxError$3;CssSyntaxError$3.default=CssSyntaxError$3;var symbols={};symbols.isClean=Symbol("isClean"),symbols.my=Symbol("my");const DEFAULT_RAW={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function capitalize(et){return et[0].toUpperCase()+et.slice(1)}let Stringifier$2=class{constructor(_e){this.builder=_e}atrule(_e,tt){let rt="@"+_e.name,nt=_e.params?this.rawValue(_e,"params"):"";if(typeof _e.raws.afterName<"u"?rt+=_e.raws.afterName:nt&&(rt+=" "),_e.nodes)this.block(_e,rt+nt);else{let it=(_e.raws.between||"")+(tt?";":"");this.builder(rt+nt+it,_e)}}beforeAfter(_e,tt){let rt;_e.type==="decl"?rt=this.raw(_e,null,"beforeDecl"):_e.type==="comment"?rt=this.raw(_e,null,"beforeComment"):tt==="before"?rt=this.raw(_e,null,"beforeRule"):rt=this.raw(_e,null,"beforeClose");let nt=_e.parent,it=0;for(;nt&&nt.type!=="root";)it+=1,nt=nt.parent;if(rt.includes(`
`)){let st=this.raw(_e,null,"indent");if(st.length)for(let ot=0;ot<it;ot++)rt+=st}return rt}block(_e,tt){let rt=this.raw(_e,"between","beforeOpen");this.builder(tt+rt+"{",_e,"start");let nt;_e.nodes&&_e.nodes.length?(this.body(_e),nt=this.raw(_e,"after")):nt=this.raw(_e,"after","emptyBody"),nt&&this.builder(nt),this.builder("}",_e,"end")}body(_e){let tt=_e.nodes.length-1;for(;tt>0&&_e.nodes[tt].type==="comment";)tt-=1;let rt=this.raw(_e,"semicolon");for(let nt=0;nt<_e.nodes.length;nt++){let it=_e.nodes[nt],st=this.raw(it,"before");st&&this.builder(st),this.stringify(it,tt!==nt||rt)}}comment(_e){let tt=this.raw(_e,"left","commentLeft"),rt=this.raw(_e,"right","commentRight");this.builder("/*"+tt+_e.text+rt+"*/",_e)}decl(_e,tt){let rt=this.raw(_e,"between","colon"),nt=_e.prop+rt+this.rawValue(_e,"value");_e.important&&(nt+=_e.raws.important||" !important"),tt&&(nt+=";"),this.builder(nt,_e)}document(_e){this.body(_e)}raw(_e,tt,rt){let nt;if(rt||(rt=tt),tt&&(nt=_e.raws[tt],typeof nt<"u"))return nt;let it=_e.parent;if(rt==="before"&&(!it||it.type==="root"&&it.first===_e||it&&it.type==="document"))return"";if(!it)return DEFAULT_RAW[rt];let st=_e.root();if(st.rawCache||(st.rawCache={}),typeof st.rawCache[rt]<"u")return st.rawCache[rt];if(rt==="before"||rt==="after")return this.beforeAfter(_e,rt);{let ot="raw"+capitalize(rt);this[ot]?nt=this[ot](st,_e):st.walk(at=>{if(nt=at.raws[tt],typeof nt<"u")return!1})}return typeof nt>"u"&&(nt=DEFAULT_RAW[rt]),st.rawCache[rt]=nt,nt}rawBeforeClose(_e){let tt;return _e.walk(rt=>{if(rt.nodes&&rt.nodes.length>0&&typeof rt.raws.after<"u")return tt=rt.raws.after,tt.includes(`
`)&&(tt=tt.replace(/[^\n]+$/,"")),!1}),tt&&(tt=tt.replace(/\S/g,"")),tt}rawBeforeComment(_e,tt){let rt;return _e.walkComments(nt=>{if(typeof nt.raws.before<"u")return rt=nt.raws.before,rt.includes(`
`)&&(rt=rt.replace(/[^\n]+$/,"")),!1}),typeof rt>"u"?rt=this.raw(tt,null,"beforeDecl"):rt&&(rt=rt.replace(/\S/g,"")),rt}rawBeforeDecl(_e,tt){let rt;return _e.walkDecls(nt=>{if(typeof nt.raws.before<"u")return rt=nt.raws.before,rt.includes(`
`)&&(rt=rt.replace(/[^\n]+$/,"")),!1}),typeof rt>"u"?rt=this.raw(tt,null,"beforeRule"):rt&&(rt=rt.replace(/\S/g,"")),rt}rawBeforeOpen(_e){let tt;return _e.walk(rt=>{if(rt.type!=="decl"&&(tt=rt.raws.between,typeof tt<"u"))return!1}),tt}rawBeforeRule(_e){let tt;return _e.walk(rt=>{if(rt.nodes&&(rt.parent!==_e||_e.first!==rt)&&typeof rt.raws.before<"u")return tt=rt.raws.before,tt.includes(`
`)&&(tt=tt.replace(/[^\n]+$/,"")),!1}),tt&&(tt=tt.replace(/\S/g,"")),tt}rawColon(_e){let tt;return _e.walkDecls(rt=>{if(typeof rt.raws.between<"u")return tt=rt.raws.between.replace(/[^\s:]/g,""),!1}),tt}rawEmptyBody(_e){let tt;return _e.walk(rt=>{if(rt.nodes&&rt.nodes.length===0&&(tt=rt.raws.after,typeof tt<"u"))return!1}),tt}rawIndent(_e){if(_e.raws.indent)return _e.raws.indent;let tt;return _e.walk(rt=>{let nt=rt.parent;if(nt&&nt!==_e&&nt.parent&&nt.parent===_e&&typeof rt.raws.before<"u"){let it=rt.raws.before.split(`
`);return tt=it[it.length-1],tt=tt.replace(/\S/g,""),!1}}),tt}rawSemicolon(_e){let tt;return _e.walk(rt=>{if(rt.nodes&&rt.nodes.length&&rt.last.type==="decl"&&(tt=rt.raws.semicolon,typeof tt<"u"))return!1}),tt}rawValue(_e,tt){let rt=_e[tt],nt=_e.raws[tt];return nt&&nt.value===rt?nt.raw:rt}root(_e){this.body(_e),_e.raws.after&&this.builder(_e.raws.after)}rule(_e){this.block(_e,this.rawValue(_e,"selector")),_e.raws.ownSemicolon&&this.builder(_e.raws.ownSemicolon,_e,"end")}stringify(_e,tt){if(!this[_e.type])throw new Error("Unknown AST node type "+_e.type+". Maybe you need to change PostCSS stringifier.");this[_e.type](_e,tt)}};var stringifier=Stringifier$2;Stringifier$2.default=Stringifier$2;let Stringifier$1=stringifier;function stringify$4(et,_e){new Stringifier$1(_e).stringify(et)}var stringify_1=stringify$4;stringify$4.default=stringify$4;let{isClean:isClean$2,my:my$2}=symbols,CssSyntaxError$2=cssSyntaxError,Stringifier=stringifier,stringify$3=stringify_1;function cloneNode(et,_e){let tt=new et.constructor;for(let rt in et){if(!Object.prototype.hasOwnProperty.call(et,rt)||rt==="proxyCache")continue;let nt=et[rt],it=typeof nt;rt==="parent"&&it==="object"?_e&&(tt[rt]=_e):rt==="source"?tt[rt]=nt:Array.isArray(nt)?tt[rt]=nt.map(st=>cloneNode(st,tt)):(it==="object"&&nt!==null&&(nt=cloneNode(nt)),tt[rt]=nt)}return tt}let Node$5=class{constructor(_e={}){this.raws={},this[isClean$2]=!1,this[my$2]=!0;for(let tt in _e)if(tt==="nodes"){this.nodes=[];for(let rt of _e[tt])typeof rt.clone=="function"?this.append(rt.clone()):this.append(rt)}else this[tt]=_e[tt]}addToError(_e){if(_e.postcssNode=this,_e.stack&&this.source&&/\n\s{4}at /.test(_e.stack)){let tt=this.source;_e.stack=_e.stack.replace(/\n\s{4}at /,`$&${tt.input.from}:${tt.start.line}:${tt.start.column}$&`)}return _e}after(_e){return this.parent.insertAfter(this,_e),this}assign(_e={}){for(let tt in _e)this[tt]=_e[tt];return this}before(_e){return this.parent.insertBefore(this,_e),this}cleanRaws(_e){delete this.raws.before,delete this.raws.after,_e||delete this.raws.between}clone(_e={}){let tt=cloneNode(this);for(let rt in _e)tt[rt]=_e[rt];return tt}cloneAfter(_e={}){let tt=this.clone(_e);return this.parent.insertAfter(this,tt),tt}cloneBefore(_e={}){let tt=this.clone(_e);return this.parent.insertBefore(this,tt),tt}error(_e,tt={}){if(this.source){let{end:rt,start:nt}=this.rangeBy(tt);return this.source.input.error(_e,{column:nt.column,line:nt.line},{column:rt.column,line:rt.line},tt)}return new CssSyntaxError$2(_e)}getProxyProcessor(){return{get(_e,tt){return tt==="proxyOf"?_e:tt==="root"?()=>_e.root().toProxy():_e[tt]},set(_e,tt,rt){return _e[tt]===rt||(_e[tt]=rt,(tt==="prop"||tt==="value"||tt==="name"||tt==="params"||tt==="important"||tt==="text")&&_e.markDirty()),!0}}}markDirty(){if(this[isClean$2]){this[isClean$2]=!1;let _e=this;for(;_e=_e.parent;)_e[isClean$2]=!1}}next(){if(!this.parent)return;let _e=this.parent.index(this);return this.parent.nodes[_e+1]}positionBy(_e,tt){let rt=this.source.start;if(_e.index)rt=this.positionInside(_e.index,tt);else if(_e.word){tt=this.toString();let nt=tt.indexOf(_e.word);nt!==-1&&(rt=this.positionInside(nt,tt))}return rt}positionInside(_e,tt){let rt=tt||this.toString(),nt=this.source.start.column,it=this.source.start.line;for(let st=0;st<_e;st++)rt[st]===`
`?(nt=1,it+=1):nt+=1;return{column:nt,line:it}}prev(){if(!this.parent)return;let _e=this.parent.index(this);return this.parent.nodes[_e-1]}rangeBy(_e){let tt={column:this.source.start.column,line:this.source.start.line},rt=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:tt.column+1,line:tt.line};if(_e.word){let nt=this.toString(),it=nt.indexOf(_e.word);it!==-1&&(tt=this.positionInside(it,nt),rt=this.positionInside(it+_e.word.length,nt))}else _e.start?tt={column:_e.start.column,line:_e.start.line}:_e.index&&(tt=this.positionInside(_e.index)),_e.end?rt={column:_e.end.column,line:_e.end.line}:_e.endIndex?rt=this.positionInside(_e.endIndex):_e.index&&(rt=this.positionInside(_e.index+1));return(rt.line<tt.line||rt.line===tt.line&&rt.column<=tt.column)&&(rt={column:tt.column+1,line:tt.line}),{end:rt,start:tt}}raw(_e,tt){return new Stringifier().raw(this,_e,tt)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(..._e){if(this.parent){let tt=this,rt=!1;for(let nt of _e)nt===this?rt=!0:rt?(this.parent.insertAfter(tt,nt),tt=nt):this.parent.insertBefore(tt,nt);rt||this.remove()}return this}root(){let _e=this;for(;_e.parent&&_e.parent.type!=="document";)_e=_e.parent;return _e}toJSON(_e,tt){let rt={},nt=tt==null;tt=tt||new Map;let it=0;for(let st in this){if(!Object.prototype.hasOwnProperty.call(this,st)||st==="parent"||st==="proxyCache")continue;let ot=this[st];if(Array.isArray(ot))rt[st]=ot.map(at=>typeof at=="object"&&at.toJSON?at.toJSON(null,tt):at);else if(typeof ot=="object"&&ot.toJSON)rt[st]=ot.toJSON(null,tt);else if(st==="source"){let at=tt.get(ot.input);at==null&&(at=it,tt.set(ot.input,it),it++),rt[st]={end:ot.end,inputId:at,start:ot.start}}else rt[st]=ot}return nt&&(rt.inputs=[...tt.keys()].map(st=>st.toJSON())),rt}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(_e=stringify$3){_e.stringify&&(_e=_e.stringify);let tt="";return _e(this,rt=>{tt+=rt}),tt}warn(_e,tt,rt){let nt={node:this};for(let it in rt)nt[it]=rt[it];return _e.warn(tt,nt)}get proxyOf(){return this}};var node=Node$5;Node$5.default=Node$5;let Node$4=node,Declaration$4=class extends Node$4{constructor(_e){_e&&typeof _e.value<"u"&&typeof _e.value!="string"&&(_e={..._e,value:String(_e.value)}),super(_e),this.type="decl"}get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}};var declaration=Declaration$4;Declaration$4.default=Declaration$4;let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",customAlphabet=(et,_e=21)=>(tt=_e)=>{let rt="",nt=tt;for(;nt--;)rt+=et[Math.random()*et.length|0];return rt},nanoid$1=(et=21)=>{let _e="",tt=et;for(;tt--;)_e+=urlAlphabet[Math.random()*64|0];return _e};var nonSecure={nanoid:nanoid$1,customAlphabet};let{SourceMapConsumer:SourceMapConsumer$2,SourceMapGenerator:SourceMapGenerator$2}=require$$2,{existsSync,readFileSync}=require$$2,{dirname:dirname$1,join}=require$$2;function fromBase64(et){return Buffer?Buffer.from(et,"base64").toString():window.atob(et)}let PreviousMap$2=class{constructor(_e,tt){if(tt.map===!1)return;this.loadAnnotation(_e),this.inline=this.startWith(this.annotation,"data:");let rt=tt.map?tt.map.prev:void 0,nt=this.loadMap(tt.from,rt);!this.mapFile&&tt.from&&(this.mapFile=tt.from),this.mapFile&&(this.root=dirname$1(this.mapFile)),nt&&(this.text=nt)}consumer(){return this.consumerCache||(this.consumerCache=new SourceMapConsumer$2(this.text)),this.consumerCache}decodeInline(_e){let tt=/^data:application\/json;charset=utf-?8;base64,/,rt=/^data:application\/json;base64,/,nt=/^data:application\/json;charset=utf-?8,/,it=/^data:application\/json,/;if(nt.test(_e)||it.test(_e))return decodeURIComponent(_e.substr(RegExp.lastMatch.length));if(tt.test(_e)||rt.test(_e))return fromBase64(_e.substr(RegExp.lastMatch.length));let st=_e.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+st)}getAnnotationURL(_e){return _e.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(_e){return typeof _e!="object"?!1:typeof _e.mappings=="string"||typeof _e._mappings=="string"||Array.isArray(_e.sections)}loadAnnotation(_e){let tt=_e.match(/\/\*\s*# sourceMappingURL=/gm);if(!tt)return;let rt=_e.lastIndexOf(tt.pop()),nt=_e.indexOf("*/",rt);rt>-1&&nt>-1&&(this.annotation=this.getAnnotationURL(_e.substring(rt,nt)))}loadFile(_e){if(this.root=dirname$1(_e),existsSync(_e))return this.mapFile=_e,readFileSync(_e,"utf-8").toString().trim()}loadMap(_e,tt){if(tt===!1)return!1;if(tt){if(typeof tt=="string")return tt;if(typeof tt=="function"){let rt=tt(_e);if(rt){let nt=this.loadFile(rt);if(!nt)throw new Error("Unable to load previous source map: "+rt.toString());return nt}}else{if(tt instanceof SourceMapConsumer$2)return SourceMapGenerator$2.fromSourceMap(tt).toString();if(tt instanceof SourceMapGenerator$2)return tt.toString();if(this.isMap(tt))return JSON.stringify(tt);throw new Error("Unsupported previous source map format: "+tt.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let rt=this.annotation;return _e&&(rt=join(dirname$1(_e),rt)),this.loadFile(rt)}}}startWith(_e,tt){return _e?_e.substr(0,tt.length)===tt:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}};var previousMap=PreviousMap$2;PreviousMap$2.default=PreviousMap$2;let{SourceMapConsumer:SourceMapConsumer$1,SourceMapGenerator:SourceMapGenerator$1}=require$$2,{fileURLToPath,pathToFileURL:pathToFileURL$1}=require$$2,{isAbsolute,resolve:resolve$1}=require$$2,{nanoid}=nonSecure,terminalHighlight=require$$2,CssSyntaxError$1=cssSyntaxError,PreviousMap$1=previousMap,fromOffsetCache=Symbol("fromOffsetCache"),sourceMapAvailable$1=!!(SourceMapConsumer$1&&SourceMapGenerator$1),pathAvailable$1=!!(resolve$1&&isAbsolute),Input$5=class{constructor(_e,tt={}){if(_e===null||typeof _e>"u"||typeof _e=="object"&&!_e.toString)throw new Error(`PostCSS received ${_e} instead of CSS string`);if(this.css=_e.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,tt.from&&(!pathAvailable$1||/^\w+:\/\//.test(tt.from)||isAbsolute(tt.from)?this.file=tt.from:this.file=resolve$1(tt.from)),pathAvailable$1&&sourceMapAvailable$1){let rt=new PreviousMap$1(this.css,tt);if(rt.text){this.map=rt;let nt=rt.consumer().file;!this.file&&nt&&(this.file=this.mapResolve(nt))}}this.file||(this.id="<input css "+nanoid(6)+">"),this.map&&(this.map.file=this.from)}error(_e,tt,rt,nt={}){let it,st,ot;if(tt&&typeof tt=="object"){let lt=tt,ut=rt;if(typeof lt.offset=="number"){let ct=this.fromOffset(lt.offset);tt=ct.line,rt=ct.col}else tt=lt.line,rt=lt.column;if(typeof ut.offset=="number"){let ct=this.fromOffset(ut.offset);st=ct.line,ot=ct.col}else st=ut.line,ot=ut.column}else if(!rt){let lt=this.fromOffset(tt);tt=lt.line,rt=lt.col}let at=this.origin(tt,rt,st,ot);return at?it=new CssSyntaxError$1(_e,at.endLine===void 0?at.line:{column:at.column,line:at.line},at.endLine===void 0?at.column:{column:at.endColumn,line:at.endLine},at.source,at.file,nt.plugin):it=new CssSyntaxError$1(_e,st===void 0?tt:{column:rt,line:tt},st===void 0?rt:{column:ot,line:st},this.css,this.file,nt.plugin),it.input={column:rt,endColumn:ot,endLine:st,line:tt,source:this.css},this.file&&(pathToFileURL$1&&(it.input.url=pathToFileURL$1(this.file).toString()),it.input.file=this.file),it}fromOffset(_e){let tt,rt;if(this[fromOffsetCache])rt=this[fromOffsetCache];else{let it=this.css.split(`
`);rt=new Array(it.length);let st=0;for(let ot=0,at=it.length;ot<at;ot++)rt[ot]=st,st+=it[ot].length+1;this[fromOffsetCache]=rt}tt=rt[rt.length-1];let nt=0;if(_e>=tt)nt=rt.length-1;else{let it=rt.length-2,st;for(;nt<it;)if(st=nt+(it-nt>>1),_e<rt[st])it=st-1;else if(_e>=rt[st+1])nt=st+1;else{nt=st;break}}return{col:_e-rt[nt]+1,line:nt+1}}mapResolve(_e){return/^\w+:\/\//.test(_e)?_e:resolve$1(this.map.consumer().sourceRoot||this.map.root||".",_e)}origin(_e,tt,rt,nt){if(!this.map)return!1;let it=this.map.consumer(),st=it.originalPositionFor({column:tt,line:_e});if(!st.source)return!1;let ot;typeof rt=="number"&&(ot=it.originalPositionFor({column:nt,line:rt}));let at;isAbsolute(st.source)?at=pathToFileURL$1(st.source):at=new URL(st.source,this.map.consumer().sourceRoot||pathToFileURL$1(this.map.mapFile));let lt={column:st.column,endColumn:ot&&ot.column,endLine:ot&&ot.line,line:st.line,url:at.toString()};if(at.protocol==="file:")if(fileURLToPath)lt.file=fileURLToPath(at);else throw new Error("file: protocol is not available in this PostCSS build");let ut=it.sourceContentFor(st.source);return ut&&(lt.source=ut),lt}toJSON(){let _e={};for(let tt of["hasBOM","css","file","id"])this[tt]!=null&&(_e[tt]=this[tt]);return this.map&&(_e.map={...this.map},_e.map.consumerCache&&(_e.map.consumerCache=void 0)),_e}get from(){return this.file||this.id}};var input=Input$5;Input$5.default=Input$5,terminalHighlight&&terminalHighlight.registerInput&&terminalHighlight.registerInput(Input$5);let{SourceMapConsumer,SourceMapGenerator}=require$$2,{dirname,relative,resolve,sep}=require$$2,{pathToFileURL}=require$$2,Input$4=input,sourceMapAvailable=!!(SourceMapConsumer&&SourceMapGenerator),pathAvailable=!!(dirname&&resolve&&relative&&sep),MapGenerator$2=class{constructor(_e,tt,rt,nt){this.stringify=_e,this.mapOpts=rt.map||{},this.root=tt,this.opts=rt,this.css=nt,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let _e;this.isInline()?_e="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?_e=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?_e=this.mapOpts.annotation(this.opts.to,this.root):_e=this.outputFile()+".map";let tt=`
`;this.css.includes(`\r
`)&&(tt=`\r
`),this.css+=tt+"/*# sourceMappingURL="+_e+" */"}applyPrevMaps(){for(let _e of this.previous()){let tt=this.toUrl(this.path(_e.file)),rt=_e.root||dirname(_e.file),nt;this.mapOpts.sourcesContent===!1?(nt=new SourceMapConsumer(_e.text),nt.sourcesContent&&(nt.sourcesContent=nt.sourcesContent.map(()=>null))):nt=_e.consumer(),this.map.applySourceMap(nt,tt,this.toUrl(this.path(rt)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let _e;for(let tt=this.root.nodes.length-1;tt>=0;tt--)_e=this.root.nodes[tt],_e.type==="comment"&&_e.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(tt)}else this.css&&(this.css=this.css.replace(/(\n)?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),pathAvailable&&sourceMapAvailable&&this.isMap())return this.generateMap();{let _e="";return this.stringify(this.root,tt=>{_e+=tt}),[_e]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let _e=this.previous()[0].consumer();_e.file=this.outputFile(),this.map=SourceMapGenerator.fromSourceMap(_e)}else this.map=new SourceMapGenerator({file:this.outputFile()}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new SourceMapGenerator({file:this.outputFile()});let _e=1,tt=1,rt="<no source>",nt={generated:{column:0,line:0},original:{column:0,line:0},source:""},it,st;this.stringify(this.root,(ot,at,lt)=>{if(this.css+=ot,at&&lt!=="end"&&(nt.generated.line=_e,nt.generated.column=tt-1,at.source&&at.source.start?(nt.source=this.sourcePath(at),nt.original.line=at.source.start.line,nt.original.column=at.source.start.column-1,this.map.addMapping(nt)):(nt.source=rt,nt.original.line=1,nt.original.column=0,this.map.addMapping(nt))),it=ot.match(/\n/g),it?(_e+=it.length,st=ot.lastIndexOf(`
`),tt=ot.length-st):tt+=ot.length,at&&lt!=="start"){let ut=at.parent||{raws:{}};(!(at.type==="decl"||at.type==="atrule"&&!at.nodes)||at!==ut.last||ut.raws.semicolon)&&(at.source&&at.source.end?(nt.source=this.sourcePath(at),nt.original.line=at.source.end.line,nt.original.column=at.source.end.column-1,nt.generated.line=_e,nt.generated.column=tt-2,this.map.addMapping(nt)):(nt.source=rt,nt.original.line=1,nt.original.column=0,nt.generated.line=_e,nt.generated.column=tt-1,this.map.addMapping(nt)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(_e=>_e.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let _e=this.mapOpts.annotation;return typeof _e<"u"&&_e!==!0?!1:this.previous().length?this.previous().some(tt=>tt.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(_e=>_e.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(_e){if(this.mapOpts.absolute||_e.charCodeAt(0)===60||/^\w+:\/\//.test(_e))return _e;let tt=this.memoizedPaths.get(_e);if(tt)return tt;let rt=this.opts.to?dirname(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(rt=dirname(resolve(rt,this.mapOpts.annotation)));let nt=relative(rt,_e);return this.memoizedPaths.set(_e,nt),nt}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(_e=>{if(_e.source&&_e.source.input.map){let tt=_e.source.input.map;this.previousMaps.includes(tt)||this.previousMaps.push(tt)}});else{let _e=new Input$4(this.css,this.opts);_e.map&&this.previousMaps.push(_e.map)}return this.previousMaps}setSourcesContent(){let _e={};if(this.root)this.root.walk(tt=>{if(tt.source){let rt=tt.source.input.from;if(rt&&!_e[rt]){_e[rt]=!0;let nt=this.usesFileUrls?this.toFileUrl(rt):this.toUrl(this.path(rt));this.map.setSourceContent(nt,tt.source.input.css)}}});else if(this.css){let tt=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(tt,this.css)}}sourcePath(_e){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(_e.source.input.from):this.toUrl(this.path(_e.source.input.from))}toBase64(_e){return Buffer?Buffer.from(_e).toString("base64"):window.btoa(unescape(encodeURIComponent(_e)))}toFileUrl(_e){let tt=this.memoizedFileURLs.get(_e);if(tt)return tt;if(pathToFileURL){let rt=pathToFileURL(_e).toString();return this.memoizedFileURLs.set(_e,rt),rt}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(_e){let tt=this.memoizedURLs.get(_e);if(tt)return tt;sep==="\\"&&(_e=_e.replace(/\\/g,"/"));let rt=encodeURI(_e).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(_e,rt),rt}};var mapGenerator=MapGenerator$2;let Node$3=node,Comment$4=class extends Node$3{constructor(_e){super(_e),this.type="comment"}};var comment=Comment$4;Comment$4.default=Comment$4;let{isClean:isClean$1,my:my$1}=symbols,Declaration$3=declaration,Comment$3=comment,Node$2=node,parse$5,Rule$4,AtRule$4,Root$6;function cleanSource(et){return et.map(_e=>(_e.nodes&&(_e.nodes=cleanSource(_e.nodes)),delete _e.source,_e))}function markDirtyUp(et){if(et[isClean$1]=!1,et.proxyOf.nodes)for(let _e of et.proxyOf.nodes)markDirtyUp(_e)}let Container$7=class Dr extends Node$2{append(..._e){for(let tt of _e){let rt=this.normalize(tt,this.last);for(let nt of rt)this.proxyOf.nodes.push(nt)}return this.markDirty(),this}cleanRaws(_e){if(super.cleanRaws(_e),this.nodes)for(let tt of this.nodes)tt.cleanRaws(_e)}each(_e){if(!this.proxyOf.nodes)return;let tt=this.getIterator(),rt,nt;for(;this.indexes[tt]<this.proxyOf.nodes.length&&(rt=this.indexes[tt],nt=_e(this.proxyOf.nodes[rt],rt),nt!==!1);)this.indexes[tt]+=1;return delete this.indexes[tt],nt}every(_e){return this.nodes.every(_e)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let _e=this.lastEach;return this.indexes[_e]=0,_e}getProxyProcessor(){return{get(_e,tt){return tt==="proxyOf"?_e:_e[tt]?tt==="each"||typeof tt=="string"&&tt.startsWith("walk")?(...rt)=>_e[tt](...rt.map(nt=>typeof nt=="function"?(it,st)=>nt(it.toProxy(),st):nt)):tt==="every"||tt==="some"?rt=>_e[tt]((nt,...it)=>rt(nt.toProxy(),...it)):tt==="root"?()=>_e.root().toProxy():tt==="nodes"?_e.nodes.map(rt=>rt.toProxy()):tt==="first"||tt==="last"?_e[tt].toProxy():_e[tt]:_e[tt]},set(_e,tt,rt){return _e[tt]===rt||(_e[tt]=rt,(tt==="name"||tt==="params"||tt==="selector")&&_e.markDirty()),!0}}}index(_e){return typeof _e=="number"?_e:(_e.proxyOf&&(_e=_e.proxyOf),this.proxyOf.nodes.indexOf(_e))}insertAfter(_e,tt){let rt=this.index(_e),nt=this.normalize(tt,this.proxyOf.nodes[rt]).reverse();rt=this.index(_e);for(let st of nt)this.proxyOf.nodes.splice(rt+1,0,st);let it;for(let st in this.indexes)it=this.indexes[st],rt<it&&(this.indexes[st]=it+nt.length);return this.markDirty(),this}insertBefore(_e,tt){let rt=this.index(_e),nt=rt===0?"prepend":!1,it=this.normalize(tt,this.proxyOf.nodes[rt],nt).reverse();rt=this.index(_e);for(let ot of it)this.proxyOf.nodes.splice(rt,0,ot);let st;for(let ot in this.indexes)st=this.indexes[ot],rt<=st&&(this.indexes[ot]=st+it.length);return this.markDirty(),this}normalize(_e,tt){if(typeof _e=="string")_e=cleanSource(parse$5(_e).nodes);else if(Array.isArray(_e)){_e=_e.slice(0);for(let nt of _e)nt.parent&&nt.parent.removeChild(nt,"ignore")}else if(_e.type==="root"&&this.type!=="document"){_e=_e.nodes.slice(0);for(let nt of _e)nt.parent&&nt.parent.removeChild(nt,"ignore")}else if(_e.type)_e=[_e];else if(_e.prop){if(typeof _e.value>"u")throw new Error("Value field is missed in node creation");typeof _e.value!="string"&&(_e.value=String(_e.value)),_e=[new Declaration$3(_e)]}else if(_e.selector)_e=[new Rule$4(_e)];else if(_e.name)_e=[new AtRule$4(_e)];else if(_e.text)_e=[new Comment$3(_e)];else throw new Error("Unknown node type in node creation");return _e.map(nt=>(nt[my$1]||Dr.rebuild(nt),nt=nt.proxyOf,nt.parent&&nt.parent.removeChild(nt),nt[isClean$1]&&markDirtyUp(nt),typeof nt.raws.before>"u"&&tt&&typeof tt.raws.before<"u"&&(nt.raws.before=tt.raws.before.replace(/\S/g,"")),nt.parent=this.proxyOf,nt))}prepend(..._e){_e=_e.reverse();for(let tt of _e){let rt=this.normalize(tt,this.first,"prepend").reverse();for(let nt of rt)this.proxyOf.nodes.unshift(nt);for(let nt in this.indexes)this.indexes[nt]=this.indexes[nt]+rt.length}return this.markDirty(),this}push(_e){return _e.parent=this,this.proxyOf.nodes.push(_e),this}removeAll(){for(let _e of this.proxyOf.nodes)_e.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(_e){_e=this.index(_e),this.proxyOf.nodes[_e].parent=void 0,this.proxyOf.nodes.splice(_e,1);let tt;for(let rt in this.indexes)tt=this.indexes[rt],tt>=_e&&(this.indexes[rt]=tt-1);return this.markDirty(),this}replaceValues(_e,tt,rt){return rt||(rt=tt,tt={}),this.walkDecls(nt=>{tt.props&&!tt.props.includes(nt.prop)||tt.fast&&!nt.value.includes(tt.fast)||(nt.value=nt.value.replace(_e,rt))}),this.markDirty(),this}some(_e){return this.nodes.some(_e)}walk(_e){return this.each((tt,rt)=>{let nt;try{nt=_e(tt,rt)}catch(it){throw tt.addToError(it)}return nt!==!1&&tt.walk&&(nt=tt.walk(_e)),nt})}walkAtRules(_e,tt){return tt?_e instanceof RegExp?this.walk((rt,nt)=>{if(rt.type==="atrule"&&_e.test(rt.name))return tt(rt,nt)}):this.walk((rt,nt)=>{if(rt.type==="atrule"&&rt.name===_e)return tt(rt,nt)}):(tt=_e,this.walk((rt,nt)=>{if(rt.type==="atrule")return tt(rt,nt)}))}walkComments(_e){return this.walk((tt,rt)=>{if(tt.type==="comment")return _e(tt,rt)})}walkDecls(_e,tt){return tt?_e instanceof RegExp?this.walk((rt,nt)=>{if(rt.type==="decl"&&_e.test(rt.prop))return tt(rt,nt)}):this.walk((rt,nt)=>{if(rt.type==="decl"&&rt.prop===_e)return tt(rt,nt)}):(tt=_e,this.walk((rt,nt)=>{if(rt.type==="decl")return tt(rt,nt)}))}walkRules(_e,tt){return tt?_e instanceof RegExp?this.walk((rt,nt)=>{if(rt.type==="rule"&&_e.test(rt.selector))return tt(rt,nt)}):this.walk((rt,nt)=>{if(rt.type==="rule"&&rt.selector===_e)return tt(rt,nt)}):(tt=_e,this.walk((rt,nt)=>{if(rt.type==="rule")return tt(rt,nt)}))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}};Container$7.registerParse=et=>{parse$5=et},Container$7.registerRule=et=>{Rule$4=et},Container$7.registerAtRule=et=>{AtRule$4=et},Container$7.registerRoot=et=>{Root$6=et};var container=Container$7;Container$7.default=Container$7,Container$7.rebuild=et=>{et.type==="atrule"?Object.setPrototypeOf(et,AtRule$4.prototype):et.type==="rule"?Object.setPrototypeOf(et,Rule$4.prototype):et.type==="decl"?Object.setPrototypeOf(et,Declaration$3.prototype):et.type==="comment"?Object.setPrototypeOf(et,Comment$3.prototype):et.type==="root"&&Object.setPrototypeOf(et,Root$6.prototype),et[my$1]=!0,et.nodes&&et.nodes.forEach(_e=>{Container$7.rebuild(_e)})};let Container$6=container,LazyResult$4,Processor$3,Document$3=class extends Container$6{constructor(_e){super({type:"document",..._e}),this.nodes||(this.nodes=[])}toResult(_e={}){return new LazyResult$4(new Processor$3,this,_e).stringify()}};Document$3.registerLazyResult=et=>{LazyResult$4=et},Document$3.registerProcessor=et=>{Processor$3=et};var document$1=Document$3;Document$3.default=Document$3;let Warning$2=class{constructor(_e,tt={}){if(this.type="warning",this.text=_e,tt.node&&tt.node.source){let rt=tt.node.rangeBy(tt);this.line=rt.start.line,this.column=rt.start.column,this.endLine=rt.end.line,this.endColumn=rt.end.column}for(let rt in tt)this[rt]=tt[rt]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}};var warning=Warning$2;Warning$2.default=Warning$2;let Warning$1=warning,Result$3=class{constructor(_e,tt,rt){this.processor=_e,this.messages=[],this.root=tt,this.opts=rt,this.css=void 0,this.map=void 0}toString(){return this.css}warn(_e,tt={}){tt.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(tt.plugin=this.lastPlugin.postcssPlugin);let rt=new Warning$1(_e,tt);return this.messages.push(rt),rt}warnings(){return this.messages.filter(_e=>_e.type==="warning")}get content(){return this.css}};var result=Result$3;Result$3.default=Result$3;const SINGLE_QUOTE=39,DOUBLE_QUOTE=34,BACKSLASH=92,SLASH=47,NEWLINE=10,SPACE=32,FEED=12,TAB=9,CR=13,OPEN_SQUARE=91,CLOSE_SQUARE=93,OPEN_PARENTHESES=40,CLOSE_PARENTHESES=41,OPEN_CURLY=123,CLOSE_CURLY=125,SEMICOLON=59,ASTERISK=42,COLON=58,AT=64,RE_AT_END=/[\t\n\f\r "#'()/;[\\\]{}]/g,RE_WORD_END=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,RE_BAD_BRACKET=/.[\r\n"'(/\\]/,RE_HEX_ESCAPE=/[\da-f]/i;var tokenize=function et(_e,tt={}){let rt=_e.css.valueOf(),nt=tt.ignoreErrors,it,st,ot,at,lt,ut,ct,dt,ft,pt,mt=rt.length,ht=0,gt=[],vt=[];function yt(){return ht}function bt(Ct){throw _e.error("Unclosed "+Ct,ht)}function xt(){return vt.length===0&&ht>=mt}function _t(Ct){if(vt.length)return vt.pop();if(ht>=mt)return;let kt=Ct?Ct.ignoreUnclosed:!1;switch(it=rt.charCodeAt(ht),it){case NEWLINE:case SPACE:case TAB:case CR:case FEED:{st=ht;do st+=1,it=rt.charCodeAt(st);while(it===SPACE||it===NEWLINE||it===TAB||it===CR||it===FEED);pt=["space",rt.slice(ht,st)],ht=st-1;break}case OPEN_SQUARE:case CLOSE_SQUARE:case OPEN_CURLY:case CLOSE_CURLY:case COLON:case SEMICOLON:case CLOSE_PARENTHESES:{let At=String.fromCharCode(it);pt=[At,At,ht];break}case OPEN_PARENTHESES:{if(dt=gt.length?gt.pop()[1]:"",ft=rt.charCodeAt(ht+1),dt==="url"&&ft!==SINGLE_QUOTE&&ft!==DOUBLE_QUOTE&&ft!==SPACE&&ft!==NEWLINE&&ft!==TAB&&ft!==FEED&&ft!==CR){st=ht;do{if(ut=!1,st=rt.indexOf(")",st+1),st===-1)if(nt||kt){st=ht;break}else bt("bracket");for(ct=st;rt.charCodeAt(ct-1)===BACKSLASH;)ct-=1,ut=!ut}while(ut);pt=["brackets",rt.slice(ht,st+1),ht,st],ht=st}else st=rt.indexOf(")",ht+1),at=rt.slice(ht,st+1),st===-1||RE_BAD_BRACKET.test(at)?pt=["(","(",ht]:(pt=["brackets",at,ht,st],ht=st);break}case SINGLE_QUOTE:case DOUBLE_QUOTE:{ot=it===SINGLE_QUOTE?"'":'"',st=ht;do{if(ut=!1,st=rt.indexOf(ot,st+1),st===-1)if(nt||kt){st=ht+1;break}else bt("string");for(ct=st;rt.charCodeAt(ct-1)===BACKSLASH;)ct-=1,ut=!ut}while(ut);pt=["string",rt.slice(ht,st+1),ht,st],ht=st;break}case AT:{RE_AT_END.lastIndex=ht+1,RE_AT_END.test(rt),RE_AT_END.lastIndex===0?st=rt.length-1:st=RE_AT_END.lastIndex-2,pt=["at-word",rt.slice(ht,st+1),ht,st],ht=st;break}case BACKSLASH:{for(st=ht,lt=!0;rt.charCodeAt(st+1)===BACKSLASH;)st+=1,lt=!lt;if(it=rt.charCodeAt(st+1),lt&&it!==SLASH&&it!==SPACE&&it!==NEWLINE&&it!==TAB&&it!==CR&&it!==FEED&&(st+=1,RE_HEX_ESCAPE.test(rt.charAt(st)))){for(;RE_HEX_ESCAPE.test(rt.charAt(st+1));)st+=1;rt.charCodeAt(st+1)===SPACE&&(st+=1)}pt=["word",rt.slice(ht,st+1),ht,st],ht=st;break}default:{it===SLASH&&rt.charCodeAt(ht+1)===ASTERISK?(st=rt.indexOf("*/",ht+2)+1,st===0&&(nt||kt?st=rt.length:bt("comment")),pt=["comment",rt.slice(ht,st+1),ht,st],ht=st):(RE_WORD_END.lastIndex=ht+1,RE_WORD_END.test(rt),RE_WORD_END.lastIndex===0?st=rt.length-1:st=RE_WORD_END.lastIndex-2,pt=["word",rt.slice(ht,st+1),ht,st],gt.push(pt),ht=st);break}}return ht++,pt}function wt(Ct){vt.push(Ct)}return{back:wt,endOfFile:xt,nextToken:_t,position:yt}};let Container$5=container,AtRule$3=class extends Container$5{constructor(_e){super(_e),this.type="atrule"}append(..._e){return this.proxyOf.nodes||(this.nodes=[]),super.append(..._e)}prepend(..._e){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(..._e)}};var atRule=AtRule$3;AtRule$3.default=AtRule$3,Container$5.registerAtRule(AtRule$3);let Container$4=container,LazyResult$3,Processor$2,Root$5=class extends Container$4{constructor(_e){super(_e),this.type="root",this.nodes||(this.nodes=[])}normalize(_e,tt,rt){let nt=super.normalize(_e);if(tt){if(rt==="prepend")this.nodes.length>1?tt.raws.before=this.nodes[1].raws.before:delete tt.raws.before;else if(this.first!==tt)for(let it of nt)it.raws.before=tt.raws.before}return nt}removeChild(_e,tt){let rt=this.index(_e);return!tt&&rt===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[rt].raws.before),super.removeChild(_e)}toResult(_e={}){return new LazyResult$3(new Processor$2,this,_e).stringify()}};Root$5.registerLazyResult=et=>{LazyResult$3=et},Root$5.registerProcessor=et=>{Processor$2=et};var root=Root$5;Root$5.default=Root$5,Container$4.registerRoot(Root$5);let list$2={comma(et){return list$2.split(et,[","],!0)},space(et){let _e=[" ",`
`,"	"];return list$2.split(et,_e)},split(et,_e,tt){let rt=[],nt="",it=!1,st=0,ot=!1,at="",lt=!1;for(let ut of et)lt?lt=!1:ut==="\\"?lt=!0:ot?ut===at&&(ot=!1):ut==='"'||ut==="'"?(ot=!0,at=ut):ut==="("?st+=1:ut===")"?st>0&&(st-=1):st===0&&_e.includes(ut)&&(it=!0),it?(nt!==""&&rt.push(nt.trim()),nt="",it=!1):nt+=ut;return(tt||nt!=="")&&rt.push(nt.trim()),rt}};var list_1=list$2;list$2.default=list$2;let Container$3=container,list$1=list_1,Rule$3=class extends Container$3{constructor(_e){super(_e),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return list$1.comma(this.selector)}set selectors(_e){let tt=this.selector?this.selector.match(/,\s*/):null,rt=tt?tt[0]:","+this.raw("between","beforeOpen");this.selector=_e.join(rt)}};var rule=Rule$3;Rule$3.default=Rule$3,Container$3.registerRule(Rule$3);let Declaration$2=declaration,tokenizer=tokenize,Comment$2=comment,AtRule$2=atRule,Root$4=root,Rule$2=rule;const SAFE_COMMENT_NEIGHBOR={empty:!0,space:!0};function findLastWithPosition(et){for(let _e=et.length-1;_e>=0;_e--){let tt=et[_e],rt=tt[3]||tt[2];if(rt)return rt}}let Parser$1=class{constructor(_e){this.input=_e,this.root=new Root$4,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:_e,start:{column:1,line:1,offset:0}}}atrule(_e){let tt=new AtRule$2;tt.name=_e[1].slice(1),tt.name===""&&this.unnamedAtrule(tt,_e),this.init(tt,_e[2]);let rt,nt,it,st=!1,ot=!1,at=[],lt=[];for(;!this.tokenizer.endOfFile();){if(_e=this.tokenizer.nextToken(),rt=_e[0],rt==="("||rt==="["?lt.push(rt==="("?")":"]"):rt==="{"&&lt.length>0?lt.push("}"):rt===lt[lt.length-1]&&lt.pop(),lt.length===0)if(rt===";"){tt.source.end=this.getPosition(_e[2]),tt.source.end.offset++,this.semicolon=!0;break}else if(rt==="{"){ot=!0;break}else if(rt==="}"){if(at.length>0){for(it=at.length-1,nt=at[it];nt&&nt[0]==="space";)nt=at[--it];nt&&(tt.source.end=this.getPosition(nt[3]||nt[2]),tt.source.end.offset++)}this.end(_e);break}else at.push(_e);else at.push(_e);if(this.tokenizer.endOfFile()){st=!0;break}}tt.raws.between=this.spacesAndCommentsFromEnd(at),at.length?(tt.raws.afterName=this.spacesAndCommentsFromStart(at),this.raw(tt,"params",at),st&&(_e=at[at.length-1],tt.source.end=this.getPosition(_e[3]||_e[2]),tt.source.end.offset++,this.spaces=tt.raws.between,tt.raws.between="")):(tt.raws.afterName="",tt.params=""),ot&&(tt.nodes=[],this.current=tt)}checkMissedSemicolon(_e){let tt=this.colon(_e);if(tt===!1)return;let rt=0,nt;for(let it=tt-1;it>=0&&(nt=_e[it],!(nt[0]!=="space"&&(rt+=1,rt===2)));it--);throw this.input.error("Missed semicolon",nt[0]==="word"?nt[3]+1:nt[2])}colon(_e){let tt=0,rt,nt,it;for(let[st,ot]of _e.entries()){if(rt=ot,nt=rt[0],nt==="("&&(tt+=1),nt===")"&&(tt-=1),tt===0&&nt===":")if(!it)this.doubleColon(rt);else{if(it[0]==="word"&&it[1]==="progid")continue;return st}it=rt}return!1}comment(_e){let tt=new Comment$2;this.init(tt,_e[2]),tt.source.end=this.getPosition(_e[3]||_e[2]),tt.source.end.offset++;let rt=_e[1].slice(2,-2);if(/^\s*$/.test(rt))tt.text="",tt.raws.left=rt,tt.raws.right="";else{let nt=rt.match(/^(\s*)([^]*\S)(\s*)$/);tt.text=nt[2],tt.raws.left=nt[1],tt.raws.right=nt[3]}}createTokenizer(){this.tokenizer=tokenizer(this.input)}decl(_e,tt){let rt=new Declaration$2;this.init(rt,_e[0][2]);let nt=_e[_e.length-1];for(nt[0]===";"&&(this.semicolon=!0,_e.pop()),rt.source.end=this.getPosition(nt[3]||nt[2]||findLastWithPosition(_e)),rt.source.end.offset++;_e[0][0]!=="word";)_e.length===1&&this.unknownWord(_e),rt.raws.before+=_e.shift()[1];for(rt.source.start=this.getPosition(_e[0][2]),rt.prop="";_e.length;){let lt=_e[0][0];if(lt===":"||lt==="space"||lt==="comment")break;rt.prop+=_e.shift()[1]}rt.raws.between="";let it;for(;_e.length;)if(it=_e.shift(),it[0]===":"){rt.raws.between+=it[1];break}else it[0]==="word"&&/\w/.test(it[1])&&this.unknownWord([it]),rt.raws.between+=it[1];(rt.prop[0]==="_"||rt.prop[0]==="*")&&(rt.raws.before+=rt.prop[0],rt.prop=rt.prop.slice(1));let st=[],ot;for(;_e.length&&(ot=_e[0][0],!(ot!=="space"&&ot!=="comment"));)st.push(_e.shift());this.precheckMissedSemicolon(_e);for(let lt=_e.length-1;lt>=0;lt--){if(it=_e[lt],it[1].toLowerCase()==="!important"){rt.important=!0;let ut=this.stringFrom(_e,lt);ut=this.spacesFromEnd(_e)+ut,ut!==" !important"&&(rt.raws.important=ut);break}else if(it[1].toLowerCase()==="important"){let ut=_e.slice(0),ct="";for(let dt=lt;dt>0;dt--){let ft=ut[dt][0];if(ct.trim().indexOf("!")===0&&ft!=="space")break;ct=ut.pop()[1]+ct}ct.trim().indexOf("!")===0&&(rt.important=!0,rt.raws.important=ct,_e=ut)}if(it[0]!=="space"&&it[0]!=="comment")break}_e.some(lt=>lt[0]!=="space"&&lt[0]!=="comment")&&(rt.raws.between+=st.map(lt=>lt[1]).join(""),st=[]),this.raw(rt,"value",st.concat(_e),tt),rt.value.includes(":")&&!tt&&this.checkMissedSemicolon(_e)}doubleColon(_e){throw this.input.error("Double colon",{offset:_e[2]},{offset:_e[2]+_e[1].length})}emptyRule(_e){let tt=new Rule$2;this.init(tt,_e[2]),tt.selector="",tt.raws.between="",this.current=tt}end(_e){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(_e[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(_e)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(_e){if(this.spaces+=_e[1],this.current.nodes){let tt=this.current.nodes[this.current.nodes.length-1];tt&&tt.type==="rule"&&!tt.raws.ownSemicolon&&(tt.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(_e){let tt=this.input.fromOffset(_e);return{column:tt.col,line:tt.line,offset:_e}}init(_e,tt){this.current.push(_e),_e.source={input:this.input,start:this.getPosition(tt)},_e.raws.before=this.spaces,this.spaces="",_e.type!=="comment"&&(this.semicolon=!1)}other(_e){let tt=!1,rt=null,nt=!1,it=null,st=[],ot=_e[1].startsWith("--"),at=[],lt=_e;for(;lt;){if(rt=lt[0],at.push(lt),rt==="("||rt==="[")it||(it=lt),st.push(rt==="("?")":"]");else if(ot&&nt&&rt==="{")it||(it=lt),st.push("}");else if(st.length===0)if(rt===";")if(nt){this.decl(at,ot);return}else break;else if(rt==="{"){this.rule(at);return}else if(rt==="}"){this.tokenizer.back(at.pop()),tt=!0;break}else rt===":"&&(nt=!0);else rt===st[st.length-1]&&(st.pop(),st.length===0&&(it=null));lt=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(tt=!0),st.length>0&&this.unclosedBracket(it),tt&&nt){if(!ot)for(;at.length&&(lt=at[at.length-1][0],!(lt!=="space"&&lt!=="comment"));)this.tokenizer.back(at.pop());this.decl(at,ot)}else this.unknownWord(at)}parse(){let _e;for(;!this.tokenizer.endOfFile();)switch(_e=this.tokenizer.nextToken(),_e[0]){case"space":this.spaces+=_e[1];break;case";":this.freeSemicolon(_e);break;case"}":this.end(_e);break;case"comment":this.comment(_e);break;case"at-word":this.atrule(_e);break;case"{":this.emptyRule(_e);break;default:this.other(_e);break}this.endFile()}precheckMissedSemicolon(){}raw(_e,tt,rt,nt){let it,st,ot=rt.length,at="",lt=!0,ut,ct;for(let dt=0;dt<ot;dt+=1)it=rt[dt],st=it[0],st==="space"&&dt===ot-1&&!nt?lt=!1:st==="comment"?(ct=rt[dt-1]?rt[dt-1][0]:"empty",ut=rt[dt+1]?rt[dt+1][0]:"empty",!SAFE_COMMENT_NEIGHBOR[ct]&&!SAFE_COMMENT_NEIGHBOR[ut]?at.slice(-1)===","?lt=!1:at+=it[1]:lt=!1):at+=it[1];if(!lt){let dt=rt.reduce((ft,pt)=>ft+pt[1],"");_e.raws[tt]={raw:dt,value:at}}_e[tt]=at}rule(_e){_e.pop();let tt=new Rule$2;this.init(tt,_e[0][2]),tt.raws.between=this.spacesAndCommentsFromEnd(_e),this.raw(tt,"selector",_e),this.current=tt}spacesAndCommentsFromEnd(_e){let tt,rt="";for(;_e.length&&(tt=_e[_e.length-1][0],!(tt!=="space"&&tt!=="comment"));)rt=_e.pop()[1]+rt;return rt}spacesAndCommentsFromStart(_e){let tt,rt="";for(;_e.length&&(tt=_e[0][0],!(tt!=="space"&&tt!=="comment"));)rt+=_e.shift()[1];return rt}spacesFromEnd(_e){let tt,rt="";for(;_e.length&&(tt=_e[_e.length-1][0],tt==="space");)rt=_e.pop()[1]+rt;return rt}stringFrom(_e,tt){let rt="";for(let nt=tt;nt<_e.length;nt++)rt+=_e[nt][1];return _e.splice(tt,_e.length-tt),rt}unclosedBlock(){let _e=this.current.source.start;throw this.input.error("Unclosed block",_e.line,_e.column)}unclosedBracket(_e){throw this.input.error("Unclosed bracket",{offset:_e[2]},{offset:_e[2]+1})}unexpectedClose(_e){throw this.input.error("Unexpected }",{offset:_e[2]},{offset:_e[2]+1})}unknownWord(_e){throw this.input.error("Unknown word",{offset:_e[0][2]},{offset:_e[0][2]+_e[0][1].length})}unnamedAtrule(_e,tt){throw this.input.error("At-rule without name",{offset:tt[2]},{offset:tt[2]+tt[1].length})}};var parser=Parser$1;let Container$2=container,Parser=parser,Input$3=input;function parse$4(et,_e){let tt=new Input$3(et,_e),rt=new Parser(tt);try{rt.parse()}catch(nt){throw nt}return rt.root}var parse_1=parse$4;parse$4.default=parse$4,Container$2.registerParse(parse$4);let{isClean,my}=symbols,MapGenerator$1=mapGenerator,stringify$2=stringify_1,Container$1=container,Document$2=document$1,Result$2=result,parse$3=parse_1,Root$3=root;const TYPE_TO_CLASS_NAME={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},PLUGIN_PROPS={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},NOT_VISITORS={Once:!0,postcssPlugin:!0,prepare:!0},CHILDREN=0;function isPromise$1(et){return typeof et=="object"&&typeof et.then=="function"}function getEvents(et){let _e=!1,tt=TYPE_TO_CLASS_NAME[et.type];return et.type==="decl"?_e=et.prop.toLowerCase():et.type==="atrule"&&(_e=et.name.toLowerCase()),_e&&et.append?[tt,tt+"-"+_e,CHILDREN,tt+"Exit",tt+"Exit-"+_e]:_e?[tt,tt+"-"+_e,tt+"Exit",tt+"Exit-"+_e]:et.append?[tt,CHILDREN,tt+"Exit"]:[tt,tt+"Exit"]}function toStack(et){let _e;return et.type==="document"?_e=["Document",CHILDREN,"DocumentExit"]:et.type==="root"?_e=["Root",CHILDREN,"RootExit"]:_e=getEvents(et),{eventIndex:0,events:_e,iterator:0,node:et,visitorIndex:0,visitors:[]}}function cleanMarks(et){return et[isClean]=!1,et.nodes&&et.nodes.forEach(_e=>cleanMarks(_e)),et}let postcss$1={},LazyResult$2=class kr{constructor(_e,tt,rt){this.stringified=!1,this.processed=!1;let nt;if(typeof tt=="object"&&tt!==null&&(tt.type==="root"||tt.type==="document"))nt=cleanMarks(tt);else if(tt instanceof kr||tt instanceof Result$2)nt=cleanMarks(tt.root),tt.map&&(typeof rt.map>"u"&&(rt.map={}),rt.map.inline||(rt.map.inline=!1),rt.map.prev=tt.map);else{let it=parse$3;rt.syntax&&(it=rt.syntax.parse),rt.parser&&(it=rt.parser),it.parse&&(it=it.parse);try{nt=it(tt,rt)}catch(st){this.processed=!0,this.error=st}nt&&!nt[my]&&Container$1.rebuild(nt)}this.result=new Result$2(_e,nt,rt),this.helpers={...postcss$1,postcss:postcss$1,result:this.result},this.plugins=this.processor.plugins.map(it=>typeof it=="object"&&it.prepare?{...it,...it.prepare(this.result)}:it)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(_e){return this.async().catch(_e)}finally(_e){return this.async().then(_e,_e)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(_e,tt){let rt=this.result.lastPlugin;try{tt&&tt.addToError(_e),this.error=_e,_e.name==="CssSyntaxError"&&!_e.plugin?(_e.plugin=rt.postcssPlugin,_e.setMessage()):rt.postcssVersion}catch(nt){console&&console.error&&console.error(nt)}return _e}prepareVisitors(){this.listeners={};let _e=(tt,rt,nt)=>{this.listeners[rt]||(this.listeners[rt]=[]),this.listeners[rt].push([tt,nt])};for(let tt of this.plugins)if(typeof tt=="object")for(let rt in tt){if(!PLUGIN_PROPS[rt]&&/^[A-Z]/.test(rt))throw new Error(`Unknown event ${rt} in ${tt.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!NOT_VISITORS[rt])if(typeof tt[rt]=="object")for(let nt in tt[rt])nt==="*"?_e(tt,rt,tt[rt][nt]):_e(tt,rt+"-"+nt.toLowerCase(),tt[rt][nt]);else typeof tt[rt]=="function"&&_e(tt,rt,tt[rt])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let _e=0;_e<this.plugins.length;_e++){let tt=this.plugins[_e],rt=this.runOnRoot(tt);if(isPromise$1(rt))try{await rt}catch(nt){throw this.handleError(nt)}}if(this.prepareVisitors(),this.hasListener){let _e=this.result.root;for(;!_e[isClean];){_e[isClean]=!0;let tt=[toStack(_e)];for(;tt.length>0;){let rt=this.visitTick(tt);if(isPromise$1(rt))try{await rt}catch(nt){let it=tt[tt.length-1].node;throw this.handleError(nt,it)}}}if(this.listeners.OnceExit)for(let[tt,rt]of this.listeners.OnceExit){this.result.lastPlugin=tt;try{if(_e.type==="document"){let nt=_e.nodes.map(it=>rt(it,this.helpers));await Promise.all(nt)}else await rt(_e,this.helpers)}catch(nt){throw this.handleError(nt)}}}return this.processed=!0,this.stringify()}runOnRoot(_e){this.result.lastPlugin=_e;try{if(typeof _e=="object"&&_e.Once){if(this.result.root.type==="document"){let tt=this.result.root.nodes.map(rt=>_e.Once(rt,this.helpers));return isPromise$1(tt[0])?Promise.all(tt):tt}return _e.Once(this.result.root,this.helpers)}else if(typeof _e=="function")return _e(this.result.root,this.result)}catch(tt){throw this.handleError(tt)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let _e=this.result.opts,tt=stringify$2;_e.syntax&&(tt=_e.syntax.stringify),_e.stringifier&&(tt=_e.stringifier),tt.stringify&&(tt=tt.stringify);let nt=new MapGenerator$1(tt,this.result.root,this.result.opts).generate();return this.result.css=nt[0],this.result.map=nt[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let _e of this.plugins){let tt=this.runOnRoot(_e);if(isPromise$1(tt))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let _e=this.result.root;for(;!_e[isClean];)_e[isClean]=!0,this.walkSync(_e);if(this.listeners.OnceExit)if(_e.type==="document")for(let tt of _e.nodes)this.visitSync(this.listeners.OnceExit,tt);else this.visitSync(this.listeners.OnceExit,_e)}return this.result}then(_e,tt){return this.async().then(_e,tt)}toString(){return this.css}visitSync(_e,tt){for(let[rt,nt]of _e){this.result.lastPlugin=rt;let it;try{it=nt(tt,this.helpers)}catch(st){throw this.handleError(st,tt.proxyOf)}if(tt.type!=="root"&&tt.type!=="document"&&!tt.parent)return!0;if(isPromise$1(it))throw this.getAsyncError()}}visitTick(_e){let tt=_e[_e.length-1],{node:rt,visitors:nt}=tt;if(rt.type!=="root"&&rt.type!=="document"&&!rt.parent){_e.pop();return}if(nt.length>0&&tt.visitorIndex<nt.length){let[st,ot]=nt[tt.visitorIndex];tt.visitorIndex+=1,tt.visitorIndex===nt.length&&(tt.visitors=[],tt.visitorIndex=0),this.result.lastPlugin=st;try{return ot(rt.toProxy(),this.helpers)}catch(at){throw this.handleError(at,rt)}}if(tt.iterator!==0){let st=tt.iterator,ot;for(;ot=rt.nodes[rt.indexes[st]];)if(rt.indexes[st]+=1,!ot[isClean]){ot[isClean]=!0,_e.push(toStack(ot));return}tt.iterator=0,delete rt.indexes[st]}let it=tt.events;for(;tt.eventIndex<it.length;){let st=it[tt.eventIndex];if(tt.eventIndex+=1,st===CHILDREN){rt.nodes&&rt.nodes.length&&(rt[isClean]=!0,tt.iterator=rt.getIterator());return}else if(this.listeners[st]){tt.visitors=this.listeners[st];return}}_e.pop()}walkSync(_e){_e[isClean]=!0;let tt=getEvents(_e);for(let rt of tt)if(rt===CHILDREN)_e.nodes&&_e.each(nt=>{nt[isClean]||this.walkSync(nt)});else{let nt=this.listeners[rt];if(nt&&this.visitSync(nt,_e.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}};LazyResult$2.registerPostcss=et=>{postcss$1=et};var lazyResult=LazyResult$2;LazyResult$2.default=LazyResult$2,Root$3.registerLazyResult(LazyResult$2),Document$2.registerLazyResult(LazyResult$2);let MapGenerator=mapGenerator,stringify$1=stringify_1,parse$2=parse_1;const Result$1=result;let NoWorkResult$1=class{constructor(_e,tt,rt){tt=tt.toString(),this.stringified=!1,this._processor=_e,this._css=tt,this._opts=rt,this._map=void 0;let nt,it=stringify$1;this.result=new Result$1(this._processor,nt,this._opts),this.result.css=tt;let st=this;Object.defineProperty(this.result,"root",{get(){return st.root}});let ot=new MapGenerator(it,nt,this._opts,tt);if(ot.isMap()){let[at,lt]=ot.generate();at&&(this.result.css=at),lt&&(this.result.map=lt)}}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(_e){return this.async().catch(_e)}finally(_e){return this.async().then(_e,_e)}sync(){if(this.error)throw this.error;return this.result}then(_e,tt){return this.async().then(_e,tt)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let _e,tt=parse$2;try{_e=tt(this._css,this._opts)}catch(rt){this.error=rt}if(this.error)throw this.error;return this._root=_e,_e}get[Symbol.toStringTag](){return"NoWorkResult"}};var noWorkResult=NoWorkResult$1;NoWorkResult$1.default=NoWorkResult$1;let NoWorkResult=noWorkResult,LazyResult$1=lazyResult,Document$1=document$1,Root$2=root,Processor$1=class{constructor(_e=[]){this.version="8.4.31",this.plugins=this.normalize(_e)}normalize(_e){let tt=[];for(let rt of _e)if(rt.postcss===!0?rt=rt():rt.postcss&&(rt=rt.postcss),typeof rt=="object"&&Array.isArray(rt.plugins))tt=tt.concat(rt.plugins);else if(typeof rt=="object"&&rt.postcssPlugin)tt.push(rt);else if(typeof rt=="function")tt.push(rt);else if(!(typeof rt=="object"&&(rt.parse||rt.stringify)))throw new Error(rt+" is not a PostCSS plugin");return tt}process(_e,tt={}){return this.plugins.length===0&&typeof tt.parser>"u"&&typeof tt.stringifier>"u"&&typeof tt.syntax>"u"?new NoWorkResult(this,_e,tt):new LazyResult$1(this,_e,tt)}use(_e){return this.plugins=this.plugins.concat(this.normalize([_e])),this}};var processor=Processor$1;Processor$1.default=Processor$1,Root$2.registerProcessor(Processor$1),Document$1.registerProcessor(Processor$1);let Declaration$1=declaration,PreviousMap=previousMap,Comment$1=comment,AtRule$1=atRule,Input$2=input,Root$1=root,Rule$1=rule;function fromJSON$1(et,_e){if(Array.isArray(et))return et.map(nt=>fromJSON$1(nt));let{inputs:tt,...rt}=et;if(tt){_e=[];for(let nt of tt){let it={...nt,__proto__:Input$2.prototype};it.map&&(it.map={...it.map,__proto__:PreviousMap.prototype}),_e.push(it)}}if(rt.nodes&&(rt.nodes=et.nodes.map(nt=>fromJSON$1(nt,_e))),rt.source){let{inputId:nt,...it}=rt.source;rt.source=it,nt!=null&&(rt.source.input=_e[nt])}if(rt.type==="root")return new Root$1(rt);if(rt.type==="decl")return new Declaration$1(rt);if(rt.type==="rule")return new Rule$1(rt);if(rt.type==="comment")return new Comment$1(rt);if(rt.type==="atrule")return new AtRule$1(rt);throw new Error("Unknown node type: "+et.type)}var fromJSON_1=fromJSON$1;fromJSON$1.default=fromJSON$1;let CssSyntaxError=cssSyntaxError,Declaration=declaration,LazyResult=lazyResult,Container=container,Processor=processor,stringify=stringify_1,fromJSON=fromJSON_1,Document=document$1,Warning=warning,Comment=comment,AtRule=atRule,Result=result,Input$1=input,parse$1=parse_1,list=list_1,Rule=rule,Root=root,Node$1=node;function postcss(...et){return et.length===1&&Array.isArray(et[0])&&(et=et[0]),new Processor(et)}postcss.plugin=function et(_e,tt){let rt=!1;function nt(...st){console&&console.warn&&!rt&&(rt=!0,console.warn(_e+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),process.env.LANG&&process.env.LANG.startsWith("cn")&&console.warn(_e+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));let ot=tt(...st);return ot.postcssPlugin=_e,ot.postcssVersion=new Processor().version,ot}let it;return Object.defineProperty(nt,"postcss",{get(){return it||(it=nt()),it}}),nt.process=function(st,ot,at){return postcss([nt(at)]).process(st,ot)},nt},postcss.stringify=stringify,postcss.parse=parse$1,postcss.fromJSON=fromJSON,postcss.list=list,postcss.comment=et=>new Comment(et),postcss.atRule=et=>new AtRule(et),postcss.decl=et=>new Declaration(et),postcss.rule=et=>new Rule(et),postcss.root=et=>new Root(et),postcss.document=et=>new Document(et),postcss.CssSyntaxError=CssSyntaxError,postcss.Declaration=Declaration,postcss.Container=Container,postcss.Processor=Processor,postcss.Document=Document,postcss.Comment=Comment,postcss.Warning=Warning,postcss.AtRule=AtRule,postcss.Result=Result,postcss.Input=Input$1,postcss.Rule=Rule,postcss.Root=Root,postcss.Node=Node$1,LazyResult.registerPostcss(postcss);var postcss_1=postcss;postcss.default=postcss;const htmlparser=lib$5,escapeStringRegexp=escapeStringRegexp$1,{isPlainObject}=isPlainObject$2,deepmerge=cjs,parseSrcset=parseSrcsetExports,{parse:postcssParse}=postcss_1,mediaTags=["img","audio","video","picture","svg","object","map","iframe","embed"],vulnerableTags=["script","style"];function each(et,_e){et&&Object.keys(et).forEach(function(tt){_e(et[tt],tt)})}function has(et,_e){return{}.hasOwnProperty.call(et,_e)}function filter(et,_e){const tt=[];return each(et,function(rt){_e(rt)&&tt.push(rt)}),tt}function isEmptyObject(et){for(const _e in et)if(has(et,_e))return!1;return!0}function stringifySrcset(et){return et.map(function(_e){if(!_e.url)throw new Error("URL missing");return _e.url+(_e.w?` ${_e.w}w`:"")+(_e.h?` ${_e.h}h`:"")+(_e.d?` ${_e.d}x`:"")}).join(", ")}var sanitizeHtml_1=sanitizeHtml;const VALID_HTML_ATTRIBUTE_NAME=/^[^\0\t\n\f\r /<=>]+$/;function sanitizeHtml(et,_e,tt){if(et==null)return"";typeof et=="number"&&(et=et.toString());let rt="",nt="";function it(Pt,Nt){const It=this;this.tag=Pt,this.attribs=Nt||{},this.tagPosition=rt.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(ht.length){const Ft=ht[ht.length-1];Ft.text+=It.text}},this.updateParentNodeMediaChildren=function(){ht.length&&mediaTags.includes(this.tag)&&ht[ht.length-1].mediaChildren.push(this.tag)}}_e=Object.assign({},sanitizeHtml.defaults,_e),_e.parser=Object.assign({},htmlParserDefaults,_e.parser);const st=function(Pt){return _e.allowedTags===!1||(_e.allowedTags||[]).indexOf(Pt)>-1};vulnerableTags.forEach(function(Pt){st(Pt)&&!_e.allowVulnerableTags&&console.warn(`

 Your \`allowedTags\` option includes, \`${Pt}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const ot=_e.nonTextTags||["script","style","textarea","option"];let at,lt;_e.allowedAttributes&&(at={},lt={},each(_e.allowedAttributes,function(Pt,Nt){at[Nt]=[];const It=[];Pt.forEach(function(Ft){typeof Ft=="string"&&Ft.indexOf("*")>=0?It.push(escapeStringRegexp(Ft).replace(/\\\*/g,".*")):at[Nt].push(Ft)}),It.length&&(lt[Nt]=new RegExp("^("+It.join("|")+")$"))}));const ut={},ct={},dt={};each(_e.allowedClasses,function(Pt,Nt){if(at&&(has(at,Nt)||(at[Nt]=[]),at[Nt].push("class")),ut[Nt]=Pt,Array.isArray(Pt)){const It=[];ut[Nt]=[],dt[Nt]=[],Pt.forEach(function(Ft){typeof Ft=="string"&&Ft.indexOf("*")>=0?It.push(escapeStringRegexp(Ft).replace(/\\\*/g,".*")):Ft instanceof RegExp?dt[Nt].push(Ft):ut[Nt].push(Ft)}),It.length&&(ct[Nt]=new RegExp("^("+It.join("|")+")$"))}});const ft={};let pt;each(_e.transformTags,function(Pt,Nt){let It;typeof Pt=="function"?It=Pt:typeof Pt=="string"&&(It=sanitizeHtml.simpleTransform(Pt)),Nt==="*"?pt=It:ft[Nt]=It});let mt,ht,gt,vt,yt,bt,xt=!1;wt();const _t=new htmlparser.Parser({onopentag:function(Pt,Nt){if(_e.enforceHtmlBoundary&&Pt==="html"&&wt(),yt){bt++;return}const It=new it(Pt,Nt);ht.push(It);let Ft=!1;const Ut=!!It.text;let Ht;if(has(ft,Pt)&&(Ht=ft[Pt](Pt,Nt),It.attribs=Nt=Ht.attribs,Ht.text!==void 0&&(It.innerText=Ht.text),Pt!==Ht.tagName&&(It.name=Pt=Ht.tagName,vt[mt]=Ht.tagName)),pt&&(Ht=pt(Pt,Nt),It.attribs=Nt=Ht.attribs,Pt!==Ht.tagName&&(It.name=Pt=Ht.tagName,vt[mt]=Ht.tagName)),(!st(Pt)||_e.disallowedTagsMode==="recursiveEscape"&&!isEmptyObject(gt)||_e.nestingLimit!=null&&mt>=_e.nestingLimit)&&(Ft=!0,gt[mt]=!0,_e.disallowedTagsMode==="discard"&&ot.indexOf(Pt)!==-1&&(yt=!0,bt=1),gt[mt]=!0),mt++,Ft){if(_e.disallowedTagsMode==="discard")return;nt=rt,rt=""}rt+="<"+Pt,Pt==="script"&&(_e.allowedScriptHostnames||_e.allowedScriptDomains)&&(It.innerText=""),(!at||has(at,Pt)||at["*"])&&each(Nt,function(jt,Gt){if(!VALID_HTML_ATTRIBUTE_NAME.test(Gt)){delete It.attribs[Gt];return}if(jt===""&&!_e.allowedEmptyAttributes.includes(Gt)&&(_e.nonBooleanAttributes.includes(Gt)||_e.nonBooleanAttributes.includes("*"))){delete It.attribs[Gt];return}let tr=!1;if(!at||has(at,Pt)&&at[Pt].indexOf(Gt)!==-1||at["*"]&&at["*"].indexOf(Gt)!==-1||has(lt,Pt)&&lt[Pt].test(Gt)||lt["*"]&&lt["*"].test(Gt))tr=!0;else if(at&&at[Pt]){for(const Yt of at[Pt])if(isPlainObject(Yt)&&Yt.name&&Yt.name===Gt){tr=!0;let Jt="";if(Yt.multiple===!0){const rr=jt.split(" ");for(const qt of rr)Yt.values.indexOf(qt)!==-1&&(Jt===""?Jt=qt:Jt+=" "+qt)}else Yt.values.indexOf(jt)>=0&&(Jt=jt);jt=Jt}}if(tr){if(_e.allowedSchemesAppliedToAttributes.indexOf(Gt)!==-1&&kt(Pt,jt)){delete It.attribs[Gt];return}if(Pt==="script"&&Gt==="src"){let Yt=!0;try{const Jt=At(jt);if(_e.allowedScriptHostnames||_e.allowedScriptDomains){const rr=(_e.allowedScriptHostnames||[]).find(function(nr){return nr===Jt.url.hostname}),qt=(_e.allowedScriptDomains||[]).find(function(nr){return Jt.url.hostname===nr||Jt.url.hostname.endsWith(`.${nr}`)});Yt=rr||qt}}catch{Yt=!1}if(!Yt){delete It.attribs[Gt];return}}if(Pt==="iframe"&&Gt==="src"){let Yt=!0;try{const Jt=At(jt);if(Jt.isRelativeUrl)Yt=has(_e,"allowIframeRelativeUrls")?_e.allowIframeRelativeUrls:!_e.allowedIframeHostnames&&!_e.allowedIframeDomains;else if(_e.allowedIframeHostnames||_e.allowedIframeDomains){const rr=(_e.allowedIframeHostnames||[]).find(function(nr){return nr===Jt.url.hostname}),qt=(_e.allowedIframeDomains||[]).find(function(nr){return Jt.url.hostname===nr||Jt.url.hostname.endsWith(`.${nr}`)});Yt=rr||qt}}catch{Yt=!1}if(!Yt){delete It.attribs[Gt];return}}if(Gt==="srcset")try{let Yt=parseSrcset(jt);if(Yt.forEach(function(Jt){kt("srcset",Jt.url)&&(Jt.evil=!0)}),Yt=filter(Yt,function(Jt){return!Jt.evil}),Yt.length)jt=stringifySrcset(filter(Yt,function(Jt){return!Jt.evil})),It.attribs[Gt]=jt;else{delete It.attribs[Gt];return}}catch{delete It.attribs[Gt];return}if(Gt==="class"){const Yt=ut[Pt],Jt=ut["*"],rr=ct[Pt],qt=dt[Pt],nr=ct["*"],vr=[rr,nr].concat(qt).filter(function(fr){return fr});if(Yt&&Jt?jt=Bt(jt,deepmerge(Yt,Jt),vr):jt=Bt(jt,Yt||Jt,vr),!jt.length){delete It.attribs[Gt];return}}if(Gt==="style"){if(_e.parseStyleAttributes)try{const Yt=postcssParse(Pt+" {"+jt+"}",{map:!1}),Jt=$t(Yt,_e.allowedStyles);if(jt=Lt(Jt),jt.length===0){delete It.attribs[Gt];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+Pt+" {"+jt+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete It.attribs[Gt];return}else if(_e.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}rt+=" "+Gt,jt&&jt.length?rt+='="'+Ct(jt,!0)+'"':_e.allowedEmptyAttributes.includes(Gt)&&(rt+='=""')}else delete It.attribs[Gt]}),_e.selfClosing.indexOf(Pt)!==-1?rt+=" />":(rt+=">",It.innerText&&!Ut&&!_e.textFilter&&(rt+=Ct(It.innerText),xt=!0)),Ft&&(rt=nt+Ct(rt),nt="")},ontext:function(Pt){if(yt)return;const Nt=ht[ht.length-1];let It;if(Nt&&(It=Nt.tag,Pt=Nt.innerText!==void 0?Nt.innerText:Pt),_e.disallowedTagsMode==="discard"&&(It==="script"||It==="style"))rt+=Pt;else{const Ft=Ct(Pt,!1);_e.textFilter&&!xt?rt+=_e.textFilter(Ft,It):xt||(rt+=Ft)}if(ht.length){const Ft=ht[ht.length-1];Ft.text+=Pt}},onclosetag:function(Pt,Nt){if(yt)if(bt--,!bt)yt=!1;else return;const It=ht.pop();if(!It)return;if(It.tag!==Pt){ht.push(It);return}yt=_e.enforceHtmlBoundary?Pt==="html":!1,mt--;const Ft=gt[mt];if(Ft){if(delete gt[mt],_e.disallowedTagsMode==="discard"){It.updateParentNodeText();return}nt=rt,rt=""}if(vt[mt]&&(Pt=vt[mt],delete vt[mt]),_e.exclusiveFilter&&_e.exclusiveFilter(It)){rt=rt.substr(0,It.tagPosition);return}if(It.updateParentNodeMediaChildren(),It.updateParentNodeText(),_e.selfClosing.indexOf(Pt)!==-1||Nt&&!st(Pt)&&["escape","recursiveEscape"].indexOf(_e.disallowedTagsMode)>=0){Ft&&(rt=nt,nt="");return}rt+="</"+Pt+">",Ft&&(rt=nt+Ct(rt),nt=""),xt=!1}},_e.parser);return _t.write(et),_t.end(),rt;function wt(){rt="",mt=0,ht=[],gt={},vt={},yt=!1,bt=0}function Ct(Pt,Nt){return typeof Pt!="string"&&(Pt=Pt+""),_e.parser.decodeEntities&&(Pt=Pt.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Nt&&(Pt=Pt.replace(/"/g,"&quot;"))),Pt=Pt.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Nt&&(Pt=Pt.replace(/"/g,"&quot;")),Pt}function kt(Pt,Nt){for(Nt=Nt.replace(/[\x00-\x20]+/g,"");;){const Ut=Nt.indexOf("<!--");if(Ut===-1)break;const Ht=Nt.indexOf("-->",Ut+4);if(Ht===-1)break;Nt=Nt.substring(0,Ut)+Nt.substring(Ht+3)}const It=Nt.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!It)return Nt.match(/^[/\\]{2}/)?!_e.allowProtocolRelative:!1;const Ft=It[1].toLowerCase();return has(_e.allowedSchemesByTag,Pt)?_e.allowedSchemesByTag[Pt].indexOf(Ft)===-1:!_e.allowedSchemes||_e.allowedSchemes.indexOf(Ft)===-1}function At(Pt){if(Pt=Pt.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),Pt.startsWith("relative:"))throw new Error("relative: exploit attempt");let Nt="relative://relative-site";for(let Ut=0;Ut<100;Ut++)Nt+=`/${Ut}`;const It=new URL(Pt,Nt);return{isRelativeUrl:It&&It.hostname==="relative-site"&&It.protocol==="relative:",url:It}}function $t(Pt,Nt){if(!Nt)return Pt;const It=Pt.nodes[0];let Ft;return Nt[It.selector]&&Nt["*"]?Ft=deepmerge(Nt[It.selector],Nt["*"]):Ft=Nt[It.selector]||Nt["*"],Ft&&(Pt.nodes[0].nodes=It.nodes.reduce(Mt(Ft),[])),Pt}function Lt(Pt){return Pt.nodes[0].nodes.reduce(function(Nt,It){return Nt.push(`${It.prop}:${It.value}${It.important?" !important":""}`),Nt},[]).join(";")}function Mt(Pt){return function(Nt,It){return has(Pt,It.prop)&&Pt[It.prop].some(function(Ut){return Ut.test(It.value)})&&Nt.push(It),Nt}}function Bt(Pt,Nt,It){return Nt?(Pt=Pt.split(/\s+/),Pt.filter(function(Ft){return Nt.indexOf(Ft)!==-1||It.some(function(Ut){return Ut.test(Ft)})}).join(" ")):Pt}}const htmlParserDefaults={decodeEntities:!0};sanitizeHtml.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},allowedEmptyAttributes:["alt"],selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0},sanitizeHtml.simpleTransform=function(et,_e,tt){return tt=tt===void 0?!0:tt,_e=_e||{},function(rt,nt){let it;if(tt)for(it in _e)nt[it]=_e[it];else nt=_e;return{tagName:et,attribs:nt}}};const sanitizeHtml$1=getDefaultExportFromCjs$1(sanitizeHtml_1);function createMarkup(et){return{__html:sanitizeHTML(et)}}function sanitizeAttributes(et,_e){const tt=Object.keys(et).filter(nt=>_e.includes(nt)?null:nt),rt=new Object;return tt.forEach(nt=>{rt[nt]=et[nt]}),rt}function sanitizeHTML(et){return sanitizeHtml$1(et,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const StyledLabel=styled("span",{}),Label$1=et=>{const{as:_e,label:tt}=et,nt=sanitizeAttributes(et,["as","label"]);return y$3(StyledLabel,{as:_e,...nt},getLabelAsString(tt,nt.lang))};function getDefaultExportFromCjs(et){return et&&et.__esModule&&Object.prototype.hasOwnProperty.call(et,"default")?et.default:et}var urlToolkit={exports:{}};(function(et,_e){(function(tt){var rt=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,nt=/^(?=([^\/?#]*))\1([^]*)$/,it=/(?:\/|^)\.(?=\/)/g,st=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,ot={buildAbsoluteURL:function(at,lt,ut){if(ut=ut||{},at=at.trim(),lt=lt.trim(),!lt){if(!ut.alwaysNormalize)return at;var ct=ot.parseURL(at);if(!ct)throw new Error("Error trying to parse base URL.");return ct.path=ot.normalizePath(ct.path),ot.buildURLFromParts(ct)}var dt=ot.parseURL(lt);if(!dt)throw new Error("Error trying to parse relative URL.");if(dt.scheme)return ut.alwaysNormalize?(dt.path=ot.normalizePath(dt.path),ot.buildURLFromParts(dt)):lt;var ft=ot.parseURL(at);if(!ft)throw new Error("Error trying to parse base URL.");if(!ft.netLoc&&ft.path&&ft.path[0]!=="/"){var pt=nt.exec(ft.path);ft.netLoc=pt[1],ft.path=pt[2]}ft.netLoc&&!ft.path&&(ft.path="/");var mt={scheme:ft.scheme,netLoc:dt.netLoc,path:null,params:dt.params,query:dt.query,fragment:dt.fragment};if(!dt.netLoc&&(mt.netLoc=ft.netLoc,dt.path[0]!=="/"))if(!dt.path)mt.path=ft.path,dt.params||(mt.params=ft.params,dt.query||(mt.query=ft.query));else{var ht=ft.path,gt=ht.substring(0,ht.lastIndexOf("/")+1)+dt.path;mt.path=ot.normalizePath(gt)}return mt.path===null&&(mt.path=ut.alwaysNormalize?ot.normalizePath(dt.path):dt.path),ot.buildURLFromParts(mt)},parseURL:function(at){var lt=rt.exec(at);return lt?{scheme:lt[1]||"",netLoc:lt[2]||"",path:lt[3]||"",params:lt[4]||"",query:lt[5]||"",fragment:lt[6]||""}:null},normalizePath:function(at){for(at=at.split("").reverse().join("").replace(it,"");at.length!==(at=at.replace(st,"")).length;);return at.split("").reverse().join("")},buildURLFromParts:function(at){return at.scheme+at.netLoc+at.path+at.params+at.query+at.fragment}};et.exports=ot})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(et,_e){var tt=Object.keys(et);if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(et);_e&&(rt=rt.filter(function(nt){return Object.getOwnPropertyDescriptor(et,nt).enumerable})),tt.push.apply(tt,rt)}return tt}function _objectSpread2(et){for(var _e=1;_e<arguments.length;_e++){var tt=arguments[_e]!=null?arguments[_e]:{};_e%2?ownKeys(Object(tt),!0).forEach(function(rt){_defineProperty(et,rt,tt[rt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(et,Object.getOwnPropertyDescriptors(tt)):ownKeys(Object(tt)).forEach(function(rt){Object.defineProperty(et,rt,Object.getOwnPropertyDescriptor(tt,rt))})}return et}function _toPrimitive(et,_e){if(typeof et!="object"||!et)return et;var tt=et[Symbol.toPrimitive];if(tt!==void 0){var rt=tt.call(et,_e||"default");if(typeof rt!="object")return rt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_e==="string"?String:Number)(et)}function _toPropertyKey(et){var _e=_toPrimitive(et,"string");return typeof _e=="symbol"?_e:String(_e)}function _defineProperty(et,_e,tt){return _e=_toPropertyKey(_e),_e in et?Object.defineProperty(et,_e,{value:tt,enumerable:!0,configurable:!0,writable:!0}):et[_e]=tt,et}function _extends(){return _extends=Object.assign?Object.assign.bind():function(et){for(var _e=1;_e<arguments.length;_e++){var tt=arguments[_e];for(var rt in tt)Object.prototype.hasOwnProperty.call(tt,rt)&&(et[rt]=tt[rt])}return et},_extends.apply(this,arguments)}const isFiniteNumber=Number.isFinite||function(et){return typeof et=="number"&&isFinite(et)},isSafeInteger=Number.isSafeInteger||function(et){return typeof et=="number"&&Math.abs(et)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let Events=function(et){return et.MEDIA_ATTACHING="hlsMediaAttaching",et.MEDIA_ATTACHED="hlsMediaAttached",et.MEDIA_DETACHING="hlsMediaDetaching",et.MEDIA_DETACHED="hlsMediaDetached",et.BUFFER_RESET="hlsBufferReset",et.BUFFER_CODECS="hlsBufferCodecs",et.BUFFER_CREATED="hlsBufferCreated",et.BUFFER_APPENDING="hlsBufferAppending",et.BUFFER_APPENDED="hlsBufferAppended",et.BUFFER_EOS="hlsBufferEos",et.BUFFER_FLUSHING="hlsBufferFlushing",et.BUFFER_FLUSHED="hlsBufferFlushed",et.MANIFEST_LOADING="hlsManifestLoading",et.MANIFEST_LOADED="hlsManifestLoaded",et.MANIFEST_PARSED="hlsManifestParsed",et.LEVEL_SWITCHING="hlsLevelSwitching",et.LEVEL_SWITCHED="hlsLevelSwitched",et.LEVEL_LOADING="hlsLevelLoading",et.LEVEL_LOADED="hlsLevelLoaded",et.LEVEL_UPDATED="hlsLevelUpdated",et.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",et.LEVELS_UPDATED="hlsLevelsUpdated",et.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",et.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",et.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",et.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",et.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",et.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",et.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",et.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",et.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",et.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",et.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",et.CUES_PARSED="hlsCuesParsed",et.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",et.INIT_PTS_FOUND="hlsInitPtsFound",et.FRAG_LOADING="hlsFragLoading",et.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",et.FRAG_LOADED="hlsFragLoaded",et.FRAG_DECRYPTED="hlsFragDecrypted",et.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",et.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",et.FRAG_PARSING_METADATA="hlsFragParsingMetadata",et.FRAG_PARSED="hlsFragParsed",et.FRAG_BUFFERED="hlsFragBuffered",et.FRAG_CHANGED="hlsFragChanged",et.FPS_DROP="hlsFpsDrop",et.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",et.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",et.ERROR="hlsError",et.DESTROYING="hlsDestroying",et.KEY_LOADING="hlsKeyLoading",et.KEY_LOADED="hlsKeyLoaded",et.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",et.BACK_BUFFER_REACHED="hlsBackBufferReached",et.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",et}({}),ErrorTypes=function(et){return et.NETWORK_ERROR="networkError",et.MEDIA_ERROR="mediaError",et.KEY_SYSTEM_ERROR="keySystemError",et.MUX_ERROR="muxError",et.OTHER_ERROR="otherError",et}({}),ErrorDetails=function(et){return et.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",et.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",et.KEY_SYSTEM_NO_SESSION="keySystemNoSession",et.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",et.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",et.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",et.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",et.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",et.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",et.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",et.MANIFEST_LOAD_ERROR="manifestLoadError",et.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",et.MANIFEST_PARSING_ERROR="manifestParsingError",et.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",et.LEVEL_EMPTY_ERROR="levelEmptyError",et.LEVEL_LOAD_ERROR="levelLoadError",et.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",et.LEVEL_PARSING_ERROR="levelParsingError",et.LEVEL_SWITCH_ERROR="levelSwitchError",et.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",et.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",et.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",et.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",et.FRAG_LOAD_ERROR="fragLoadError",et.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",et.FRAG_DECRYPT_ERROR="fragDecryptError",et.FRAG_PARSING_ERROR="fragParsingError",et.FRAG_GAP="fragGap",et.REMUX_ALLOC_ERROR="remuxAllocError",et.KEY_LOAD_ERROR="keyLoadError",et.KEY_LOAD_TIMEOUT="keyLoadTimeOut",et.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",et.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",et.BUFFER_APPEND_ERROR="bufferAppendError",et.BUFFER_APPENDING_ERROR="bufferAppendingError",et.BUFFER_STALLED_ERROR="bufferStalledError",et.BUFFER_FULL_ERROR="bufferFullError",et.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",et.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",et.INTERNAL_EXCEPTION="internalException",et.INTERNAL_ABORTED="aborted",et.UNKNOWN="unknown",et}({});const noop=function et(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(et){const _e=self.console[et];return _e?_e.bind(self.console,`[${et}] >`):noop}function exportLoggerFunctions(et,..._e){_e.forEach(function(tt){exportedLogger[tt]=et[tt]?et[tt].bind(et):consolePrintFn(tt)})}function enableLogs(et,_e){if(typeof console=="object"&&et===!0||typeof et=="object"){exportLoggerFunctions(et,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${_e}" in hls.js version 1.5.7`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(_e){typeof _e=="string"&&(_e=AttrList.parseAttrList(_e)),_extends(this,_e)}get clientAttrs(){return Object.keys(this).filter(_e=>_e.substring(0,2)==="X-")}decimalInteger(_e){const tt=parseInt(this[_e],10);return tt>Number.MAX_SAFE_INTEGER?1/0:tt}hexadecimalInteger(_e){if(this[_e]){let tt=(this[_e]||"0x").slice(2);tt=(tt.length&1?"0":"")+tt;const rt=new Uint8Array(tt.length/2);for(let nt=0;nt<tt.length/2;nt++)rt[nt]=parseInt(tt.slice(nt*2,nt*2+2),16);return rt}else return null}hexadecimalIntegerAsNumber(_e){const tt=parseInt(this[_e],16);return tt>Number.MAX_SAFE_INTEGER?1/0:tt}decimalFloatingPoint(_e){return parseFloat(this[_e])}optionalFloat(_e,tt){const rt=this[_e];return rt?parseFloat(rt):tt}enumeratedString(_e){return this[_e]}bool(_e){return this[_e]==="YES"}decimalResolution(_e){const tt=DECIMAL_RESOLUTION_REGEX.exec(this[_e]);if(tt!==null)return{width:parseInt(tt[1],10),height:parseInt(tt[2],10)}}static parseAttrList(_e){let tt;const rt={},nt='"';for(ATTR_LIST_REGEX.lastIndex=0;(tt=ATTR_LIST_REGEX.exec(_e))!==null;){let it=tt[2];it.indexOf(nt)===0&&it.lastIndexOf(nt)===it.length-1&&(it=it.slice(1,-1));const st=tt[1].trim();rt[st]=it}return rt}}function isDateRangeCueAttribute(et){return et!=="ID"&&et!=="CLASS"&&et!=="START-DATE"&&et!=="DURATION"&&et!=="END-DATE"&&et!=="END-ON-NEXT"}function isSCTE35Attribute(et){return et==="SCTE35-OUT"||et==="SCTE35-IN"}class DateRange{constructor(_e,tt){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,tt){const rt=tt.attr;for(const nt in rt)if(Object.prototype.hasOwnProperty.call(_e,nt)&&_e[nt]!==rt[nt]){logger.warn(`DATERANGE tag attribute: "${nt}" does not match for tags with ID: "${_e.ID}"`),this._badValueForSameId=nt;break}_e=_extends(new AttrList({}),rt,_e)}if(this.attr=_e,this._startDate=new Date(_e["START-DATE"]),"END-DATE"in this.attr){const rt=new Date(this.attr["END-DATE"]);isFiniteNumber(rt.getTime())&&(this._endDate=rt)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const _e=this.duration;return _e!==null?new Date(this._startDate.getTime()+_e*1e3):null}get duration(){if("DURATION"in this.attr){const _e=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(_e))return _e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(_e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=_e}setByteRange(_e,tt){const rt=_e.split("@",2);let nt;rt.length===1?nt=(tt==null?void 0:tt.byteRangeEndOffset)||0:nt=parseInt(rt[1]),this._byteRange=[nt,parseInt(rt[0])+nt]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(_e){this._url=_e}}class Fragment extends BaseSegment{constructor(_e,tt){super(tt),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=_e}get decryptdata(){const{levelkeys:_e}=this;if(!_e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const tt=this.levelkeys.identity;if(tt)this._decryptdata=tt.getDecryptData(this.sn);else{const rt=Object.keys(this.levelkeys);if(rt.length===1)return this._decryptdata=this.levelkeys[rt[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const _e=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+_e*1e3}get encrypted(){var _e;if((_e=this._decryptdata)!=null&&_e.encrypted)return!0;if(this.levelkeys){const tt=Object.keys(this.levelkeys),rt=tt.length;if(rt>1||rt===1&&this.levelkeys[tt[0]].encrypted)return!0}return!1}setKeyFormat(_e){if(this.levelkeys){const tt=this.levelkeys[_e];tt&&!this._decryptdata&&(this._decryptdata=tt.getDecryptData(this.sn))}}abortRequests(){var _e,tt;(_e=this.loader)==null||_e.abort(),(tt=this.keyLoader)==null||tt.abort()}setElementaryStreamInfo(_e,tt,rt,nt,it,st=!1){const{elementaryStreams:ot}=this,at=ot[_e];if(!at){ot[_e]={startPTS:tt,endPTS:rt,startDTS:nt,endDTS:it,partial:st};return}at.startPTS=Math.min(at.startPTS,tt),at.endPTS=Math.max(at.endPTS,rt),at.startDTS=Math.min(at.startDTS,nt),at.endDTS=Math.max(at.endDTS,it)}clearElementaryStreamInfo(){const{elementaryStreams:_e}=this;_e[ElementaryStreamTypes.AUDIO]=null,_e[ElementaryStreamTypes.VIDEO]=null,_e[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(_e,tt,rt,nt,it){super(rt),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=_e.decimalFloatingPoint("DURATION"),this.gap=_e.bool("GAP"),this.independent=_e.bool("INDEPENDENT"),this.relurl=_e.enumeratedString("URI"),this.fragment=tt,this.index=nt;const st=_e.enumeratedString("BYTERANGE");st&&this.setByteRange(st,it),it&&(this.fragOffset=it.fragOffset+it.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:_e}=this;return!!(_e.audio||_e.video||_e.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(_e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=_e}reloaded(_e){if(!_e){this.advanced=!0,this.updated=!0;return}const tt=this.lastPartSn-_e.lastPartSn,rt=this.lastPartIndex-_e.lastPartIndex;this.updated=this.endSN!==_e.endSN||!!rt||!!tt||!this.live,this.advanced=this.endSN>_e.endSN||tt>0||tt===0&&rt>0,this.updated||this.advanced?this.misses=Math.floor(_e.misses*.6):this.misses=_e.misses+1,this.availabilityDelay=_e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const _e=this.driftEndTime-this.driftStartTime;return _e>0?(this.driftEnd-this.driftStart)*1e3/_e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var _e;return(_e=this.partList)!=null&&_e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var _e;return(_e=this.fragments)!=null&&_e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var _e;return(_e=this.partList)!=null&&_e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var _e;return(_e=this.partList)!=null&&_e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(et){return Uint8Array.from(atob(et),_e=>_e.charCodeAt(0))}function getKeyIdBytes(et){const _e=strToUtf8array(et).subarray(0,16),tt=new Uint8Array(16);return tt.set(_e,16-_e.length),tt}function changeEndianness(et){const _e=function(rt,nt,it){const st=rt[nt];rt[nt]=rt[it],rt[it]=st};_e(et,0,3),_e(et,1,2),_e(et,4,5),_e(et,6,7)}function convertDataUriToArrayBytes(et){const _e=et.split(":");let tt=null;if(_e[0]==="data"&&_e.length===2){const rt=_e[1].split(";"),nt=rt[rt.length-1].split(",");if(nt.length===2){const it=nt[0]==="base64",st=nt[1];it?(rt.splice(-1,1),tt=base64Decode(st)):tt=getKeyIdBytes(st)}}return tt}function strToUtf8array(et){return Uint8Array.from(unescape(encodeURIComponent(et)),_e=>_e.charCodeAt(0))}const optionalSelf=typeof self<"u"?self:void 0;var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(et){switch(et){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(et){if(et===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(et){switch(et){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(et){const{drmSystems:_e,widevineLicenseUrl:tt}=et,rt=_e?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(nt=>!!_e[nt]):[];return!rt[KeySystems.WIDEVINE]&&tt&&rt.push(KeySystems.WIDEVINE),rt}const requestMediaKeySystemAccess=function(et){return optionalSelf!=null&&(et=optionalSelf.navigator)!=null&&et.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(et,_e,tt,rt){let nt;switch(et){case KeySystems.FAIRPLAY:nt=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:nt=["cenc"];break;case KeySystems.CLEARKEY:nt=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${et}`)}return createMediaKeySystemConfigurations(nt,_e,tt,rt)}function createMediaKeySystemConfigurations(et,_e,tt,rt){return[{initDataTypes:et,persistentState:rt.persistentState||"optional",distinctiveIdentifier:rt.distinctiveIdentifier||"optional",sessionTypes:rt.sessionTypes||[rt.sessionType||"temporary"],audioCapabilities:_e.map(it=>({contentType:`audio/mp4; codecs="${it}"`,robustness:rt.audioRobustness||"",encryptionScheme:rt.audioEncryptionScheme||null})),videoCapabilities:tt.map(it=>({contentType:`video/mp4; codecs="${it}"`,robustness:rt.videoRobustness||"",encryptionScheme:rt.videoEncryptionScheme||null}))}]}function sliceUint8(et,_e,tt){return Uint8Array.prototype.slice?et.slice(_e,tt):new Uint8Array(Array.prototype.slice.call(et,_e,tt))}const isHeader$2=(et,_e)=>_e+10<=et.length&&et[_e]===73&&et[_e+1]===68&&et[_e+2]===51&&et[_e+3]<255&&et[_e+4]<255&&et[_e+6]<128&&et[_e+7]<128&&et[_e+8]<128&&et[_e+9]<128,isFooter=(et,_e)=>_e+10<=et.length&&et[_e]===51&&et[_e+1]===68&&et[_e+2]===73&&et[_e+3]<255&&et[_e+4]<255&&et[_e+6]<128&&et[_e+7]<128&&et[_e+8]<128&&et[_e+9]<128,getID3Data=(et,_e)=>{const tt=_e;let rt=0;for(;isHeader$2(et,_e);){rt+=10;const nt=readSize(et,_e+6);rt+=nt,isFooter(et,_e+10)&&(rt+=10),_e+=rt}if(rt>0)return et.subarray(tt,tt+rt)},readSize=(et,_e)=>{let tt=0;return tt=(et[_e]&127)<<21,tt|=(et[_e+1]&127)<<14,tt|=(et[_e+2]&127)<<7,tt|=et[_e+3]&127,tt},canParse$2=(et,_e)=>isHeader$2(et,_e)&&readSize(et,_e+6)+10<=et.length-_e,getTimeStamp=et=>{const _e=getID3Frames(et);for(let tt=0;tt<_e.length;tt++){const rt=_e[tt];if(isTimeStampFrame(rt))return readTimeStamp(rt)}},isTimeStampFrame=et=>et&&et.key==="PRIV"&&et.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=et=>{const _e=String.fromCharCode(et[0],et[1],et[2],et[3]),tt=readSize(et,4),rt=10;return{type:_e,size:tt,data:et.subarray(rt,rt+tt)}},getID3Frames=et=>{let _e=0;const tt=[];for(;isHeader$2(et,_e);){const rt=readSize(et,_e+6);_e+=10;const nt=_e+rt;for(;_e+8<nt;){const it=getFrameData(et.subarray(_e)),st=decodeFrame(it);st&&tt.push(st),_e+=it.size+10}isFooter(et,_e)&&(_e+=10)}return tt},decodeFrame=et=>et.type==="PRIV"?decodePrivFrame(et):et.type[0]==="W"?decodeURLFrame(et):decodeTextFrame(et),decodePrivFrame=et=>{if(et.size<2)return;const _e=utf8ArrayToStr(et.data,!0),tt=new Uint8Array(et.data.subarray(_e.length+1));return{key:et.type,info:_e,data:tt.buffer}},decodeTextFrame=et=>{if(et.size<2)return;if(et.type==="TXXX"){let tt=1;const rt=utf8ArrayToStr(et.data.subarray(tt),!0);tt+=rt.length+1;const nt=utf8ArrayToStr(et.data.subarray(tt));return{key:et.type,info:rt,data:nt}}const _e=utf8ArrayToStr(et.data.subarray(1));return{key:et.type,data:_e}},decodeURLFrame=et=>{if(et.type==="WXXX"){if(et.size<2)return;let tt=1;const rt=utf8ArrayToStr(et.data.subarray(tt),!0);tt+=rt.length+1;const nt=utf8ArrayToStr(et.data.subarray(tt));return{key:et.type,info:rt,data:nt}}const _e=utf8ArrayToStr(et.data);return{key:et.type,data:_e}},readTimeStamp=et=>{if(et.data.byteLength===8){const _e=new Uint8Array(et.data),tt=_e[3]&1;let rt=(_e[4]<<23)+(_e[5]<<15)+(_e[6]<<7)+_e[7];return rt/=45,tt&&(rt+=4772185884e-2),Math.round(rt)}},utf8ArrayToStr=(et,_e=!1)=>{const tt=getTextDecoder();if(tt){const lt=tt.decode(et);if(_e){const ut=lt.indexOf("\0");return ut!==-1?lt.substring(0,ut):lt}return lt.replace(/\0/g,"")}const rt=et.length;let nt,it,st,ot="",at=0;for(;at<rt;){if(nt=et[at++],nt===0&&_e)return ot;if(nt===0||nt===3)continue;switch(nt>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ot+=String.fromCharCode(nt);break;case 12:case 13:it=et[at++],ot+=String.fromCharCode((nt&31)<<6|it&63);break;case 14:it=et[at++],st=et[at++],ot+=String.fromCharCode((nt&15)<<12|(it&63)<<6|(st&63)<<0);break}}return ot};let decoder;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(et){let _e="";for(let tt=0;tt<et.length;tt++){let rt=et[tt].toString(16);rt.length<2&&(rt="0"+rt),_e+=rt}return _e}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(et){return String.fromCharCode.apply(null,et)}function readUint16(et,_e){const tt=et[_e]<<8|et[_e+1];return tt<0?65536+tt:tt}function readUint32(et,_e){const tt=readSint32(et,_e);return tt<0?4294967296+tt:tt}function readUint64(et,_e){let tt=readUint32(et,_e);return tt*=Math.pow(2,32),tt+=readUint32(et,_e+4),tt}function readSint32(et,_e){return et[_e]<<24|et[_e+1]<<16|et[_e+2]<<8|et[_e+3]}function writeUint32(et,_e,tt){et[_e]=tt>>24,et[_e+1]=tt>>16&255,et[_e+2]=tt>>8&255,et[_e+3]=tt&255}function hasMoofData(et){const _e=et.byteLength;for(let tt=0;tt<_e;){const rt=readUint32(et,tt);if(rt>8&&et[tt+4]===109&&et[tt+5]===111&&et[tt+6]===111&&et[tt+7]===102)return!0;tt=rt>1?tt+rt:_e}return!1}function findBox(et,_e){const tt=[];if(!_e.length)return tt;const rt=et.byteLength;for(let nt=0;nt<rt;){const it=readUint32(et,nt),st=bin2str(et.subarray(nt+4,nt+8)),ot=it>1?nt+it:rt;if(st===_e[0])if(_e.length===1)tt.push(et.subarray(nt+8,ot));else{const at=findBox(et.subarray(nt+8,ot),_e.slice(1));at.length&&push.apply(tt,at)}nt=ot}return tt}function parseSegmentIndex(et){const _e=[],tt=et[0];let rt=8;const nt=readUint32(et,rt);rt+=4;let it=0,st=0;tt===0?(it=readUint32(et,rt),st=readUint32(et,rt+4),rt+=8):(it=readUint64(et,rt),st=readUint64(et,rt+8),rt+=16),rt+=2;let ot=et.length+st;const at=readUint16(et,rt);rt+=2;for(let lt=0;lt<at;lt++){let ut=rt;const ct=readUint32(et,ut);ut+=4;const dt=ct&2147483647;if((ct&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const pt=readUint32(et,ut);ut+=4,_e.push({referenceSize:dt,subsegmentDuration:pt,info:{duration:pt/nt,start:ot,end:ot+dt-1}}),ot+=dt,ut+=4,rt=ut}return{earliestPresentationTime:it,timescale:nt,version:tt,referencesCount:at,references:_e}}function parseInitSegment(et){const _e=[],tt=findBox(et,["moov","trak"]);for(let nt=0;nt<tt.length;nt++){const it=tt[nt],st=findBox(it,["tkhd"])[0];if(st){let ot=st[0];const at=readUint32(st,ot===0?12:20),lt=findBox(it,["mdia","mdhd"])[0];if(lt){ot=lt[0];const ut=readUint32(lt,ot===0?12:20),ct=findBox(it,["mdia","hdlr"])[0];if(ct){const dt=bin2str(ct.subarray(8,12)),ft={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[dt];if(ft){const pt=findBox(it,["mdia","minf","stbl","stsd"])[0],mt=parseStsd(pt);_e[at]={timescale:ut,type:ft},_e[ft]=_objectSpread2({timescale:ut,id:at},mt)}}}}}return findBox(et,["moov","mvex","trex"]).forEach(nt=>{const it=readUint32(nt,4),st=_e[it];st&&(st.default={duration:readUint32(nt,12),flags:readUint32(nt,20)})}),_e}function parseStsd(et){const _e=et.subarray(8),tt=_e.subarray(86),rt=bin2str(_e.subarray(4,8));let nt=rt;const it=rt==="enca"||rt==="encv";if(it){const ot=findBox(_e,[rt])[0].subarray(rt==="enca"?28:78);findBox(ot,["sinf"]).forEach(lt=>{const ut=findBox(lt,["schm"])[0];if(ut){const ct=bin2str(ut.subarray(4,8));if(ct==="cbcs"||ct==="cenc"){const dt=findBox(lt,["frma"])[0];dt&&(nt=bin2str(dt))}}})}switch(nt){case"avc1":case"avc2":case"avc3":case"avc4":{const st=findBox(tt,["avcC"])[0];nt+="."+toHex(st[1])+toHex(st[2])+toHex(st[3]);break}case"mp4a":{const st=findBox(_e,[rt])[0],ot=findBox(st.subarray(28),["esds"])[0];if(ot&&ot.length>12){let at=4;if(ot[at++]!==3)break;at=skipBERInteger(ot,at),at+=2;const lt=ot[at++];if(lt&128&&(at+=2),lt&64&&(at+=ot[at++]),ot[at++]!==4)break;at=skipBERInteger(ot,at);const ut=ot[at++];if(ut===64)nt+="."+toHex(ut);else break;if(at+=12,ot[at++]!==5)break;at=skipBERInteger(ot,at);const ct=ot[at++];let dt=(ct&248)>>3;dt===31&&(dt+=1+((ct&7)<<3)+((ot[at]&224)>>5)),nt+="."+dt}break}case"hvc1":case"hev1":{const st=findBox(tt,["hvcC"])[0],ot=st[1],at=["","A","B","C"][ot>>6],lt=ot&31,ut=readUint32(st,2),ct=(ot&32)>>5?"H":"L",dt=st[12],ft=st.subarray(6,12);nt+="."+at+lt,nt+="."+ut.toString(16).toUpperCase(),nt+="."+ct+dt;let pt="";for(let mt=ft.length;mt--;){const ht=ft[mt];(ht||pt)&&(pt="."+ht.toString(16).toUpperCase()+pt)}nt+=pt;break}case"dvh1":case"dvhe":{const st=findBox(tt,["dvcC"])[0],ot=st[2]>>1&127,at=st[2]<<5&32|st[3]>>3&31;nt+="."+addLeadingZero(ot)+"."+addLeadingZero(at);break}case"vp09":{const st=findBox(tt,["vpcC"])[0],ot=st[4],at=st[5],lt=st[6]>>4&15;nt+="."+addLeadingZero(ot)+"."+addLeadingZero(at)+"."+addLeadingZero(lt);break}case"av01":{const st=findBox(tt,["av1C"])[0],ot=st[1]>>>5,at=st[1]&31,lt=st[2]>>>7?"H":"M",ut=(st[2]&64)>>6,ct=(st[2]&32)>>5,dt=ot===2&&ut?ct?12:10:ut?10:8,ft=(st[2]&16)>>4,pt=(st[2]&8)>>3,mt=(st[2]&4)>>2,ht=st[2]&3;nt+="."+ot+"."+addLeadingZero(at)+lt+"."+addLeadingZero(dt)+"."+ft+"."+pt+mt+ht+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+0;break}}return{codec:nt,encrypted:it}}function skipBERInteger(et,_e){const tt=_e+5;for(;et[_e++]&128&&_e<tt;);return _e}function toHex(et){return("0"+et.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(et){return(et<10?"0":"")+et}function patchEncyptionData(et,_e){if(!et||!_e)return et;const tt=_e.keyId;return tt&&_e.isCommonEncryption&&findBox(et,["moov","trak"]).forEach(nt=>{const st=findBox(nt,["mdia","minf","stbl","stsd"])[0].subarray(8);let ot=findBox(st,["enca"]);const at=ot.length>0;at||(ot=findBox(st,["encv"])),ot.forEach(lt=>{const ut=at?lt.subarray(28):lt.subarray(78);findBox(ut,["sinf"]).forEach(dt=>{const ft=parseSinf(dt);if(ft){const pt=ft.subarray(8,24);pt.some(mt=>mt!==0)||(logger.log(`[eme] Patching keyId in 'enc${at?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(pt)} -> ${Hex.hexDump(tt)}`),ft.set(tt,8))}})})}),et}function parseSinf(et){const _e=findBox(et,["schm"])[0];if(_e){const tt=bin2str(_e.subarray(4,8));if(tt==="cbcs"||tt==="cenc")return findBox(et,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(et,_e){return findBox(_e,["moof","traf"]).reduce((tt,rt)=>{const nt=findBox(rt,["tfdt"])[0],it=nt[0],st=findBox(rt,["tfhd"]).reduce((ot,at)=>{const lt=readUint32(at,4),ut=et[lt];if(ut){let ct=readUint32(nt,4);if(it===1){if(ct===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),ot;ct*=UINT32_MAX$1+1,ct+=readUint32(nt,8)}const dt=ut.timescale||9e4,ft=ct/dt;if(isFiniteNumber(ft)&&(ot===null||ft<ot))return ft}return ot},null);return st!==null&&isFiniteNumber(st)&&(tt===null||st<tt)?st:tt},null)}function getDuration(et,_e){let tt=0,rt=0,nt=0;const it=findBox(et,["moof","traf"]);for(let st=0;st<it.length;st++){const ot=it[st],at=findBox(ot,["tfhd"])[0],lt=readUint32(at,4),ut=_e[lt];if(!ut)continue;const ct=ut.default,dt=readUint32(at,0)|(ct==null?void 0:ct.flags);let ft=ct==null?void 0:ct.duration;dt&8&&(dt&2?ft=readUint32(at,12):ft=readUint32(at,8));const pt=ut.timescale||9e4,mt=findBox(ot,["trun"]);for(let ht=0;ht<mt.length;ht++){if(tt=computeRawDurationFromSamples(mt[ht]),!tt&&ft){const gt=readUint32(mt[ht],4);tt=ft*gt}ut.type===ElementaryStreamTypes.VIDEO?rt+=tt/pt:ut.type===ElementaryStreamTypes.AUDIO&&(nt+=tt/pt)}}if(rt===0&&nt===0){let st=1/0,ot=0,at=0;const lt=findBox(et,["sidx"]);for(let ut=0;ut<lt.length;ut++){const ct=parseSegmentIndex(lt[ut]);if(ct!=null&&ct.references){st=Math.min(st,ct.earliestPresentationTime/ct.timescale);const dt=ct.references.reduce((ft,pt)=>ft+pt.info.duration||0,0);ot=Math.max(ot,dt+ct.earliestPresentationTime/ct.timescale),at=ot-st}}if(at&&isFiniteNumber(at))return at}return rt||nt}function computeRawDurationFromSamples(et){const _e=readUint32(et,0);let tt=8;_e&1&&(tt+=4),_e&4&&(tt+=4);let rt=0;const nt=readUint32(et,4);for(let it=0;it<nt;it++){if(_e&256){const st=readUint32(et,tt);rt+=st,tt+=4}_e&512&&(tt+=4),_e&1024&&(tt+=4),_e&2048&&(tt+=4)}return rt}function offsetStartDTS(et,_e,tt){findBox(_e,["moof","traf"]).forEach(rt=>{findBox(rt,["tfhd"]).forEach(nt=>{const it=readUint32(nt,4),st=et[it];if(!st)return;const ot=st.timescale||9e4;findBox(rt,["tfdt"]).forEach(at=>{const lt=at[0],ut=tt*ot;if(ut){let ct=readUint32(at,4);if(lt===0)ct-=ut,ct=Math.max(ct,0),writeUint32(at,4,ct);else{ct*=Math.pow(2,32),ct+=readUint32(at,8),ct-=ut,ct=Math.max(ct,0);const dt=Math.floor(ct/(UINT32_MAX$1+1)),ft=Math.floor(ct%(UINT32_MAX$1+1));writeUint32(at,4,dt),writeUint32(at,8,ft)}}})})})}function segmentValidRange(et){const _e={valid:null,remainder:null},tt=findBox(et,["moof"]);if(tt.length<2)return _e.remainder=et,_e;const rt=tt[tt.length-1];return _e.valid=sliceUint8(et,0,rt.byteOffset-8),_e.remainder=sliceUint8(et,rt.byteOffset-8),_e}function appendUint8Array(et,_e){const tt=new Uint8Array(et.length+_e.length);return tt.set(et),tt.set(_e,et.length),tt}function parseSamples(et,_e){const tt=[],rt=_e.samples,nt=_e.timescale,it=_e.id;let st=!1;return findBox(rt,["moof"]).map(at=>{const lt=at.byteOffset-8;findBox(at,["traf"]).map(ct=>{const dt=findBox(ct,["tfdt"]).map(ft=>{const pt=ft[0];let mt=readUint32(ft,4);return pt===1&&(mt*=Math.pow(2,32),mt+=readUint32(ft,8)),mt/nt})[0];return dt!==void 0&&(et=dt),findBox(ct,["tfhd"]).map(ft=>{const pt=readUint32(ft,4),mt=readUint32(ft,0)&16777215,ht=(mt&1)!==0,gt=(mt&2)!==0,vt=(mt&8)!==0;let yt=0;const bt=(mt&16)!==0;let xt=0;const _t=(mt&32)!==0;let wt=8;pt===it&&(ht&&(wt+=8),gt&&(wt+=4),vt&&(yt=readUint32(ft,wt),wt+=4),bt&&(xt=readUint32(ft,wt),wt+=4),_t&&(wt+=4),_e.type==="video"&&(st=isHEVC(_e.codec)),findBox(ct,["trun"]).map(Ct=>{const kt=Ct[0],At=readUint32(Ct,0)&16777215,$t=(At&1)!==0;let Lt=0;const Mt=(At&4)!==0,Bt=(At&256)!==0;let Pt=0;const Nt=(At&512)!==0;let It=0;const Ft=(At&1024)!==0,Ut=(At&2048)!==0;let Ht=0;const jt=readUint32(Ct,4);let Gt=8;$t&&(Lt=readUint32(Ct,Gt),Gt+=4),Mt&&(Gt+=4);let tr=Lt+lt;for(let Yt=0;Yt<jt;Yt++){if(Bt?(Pt=readUint32(Ct,Gt),Gt+=4):Pt=yt,Nt?(It=readUint32(Ct,Gt),Gt+=4):It=xt,Ft&&(Gt+=4),Ut&&(kt===0?Ht=readUint32(Ct,Gt):Ht=readSint32(Ct,Gt),Gt+=4),_e.type===ElementaryStreamTypes.VIDEO){let Jt=0;for(;Jt<It;){const rr=readUint32(rt,tr);if(tr+=4,isSEIMessage(st,rt[tr])){const qt=rt.subarray(tr,tr+rr);parseSEIMessageFromNALu(qt,st?2:1,et+Ht/nt,tt)}tr+=rr,Jt+=rr+4}}et+=Pt/nt}}))})})}),tt}function isHEVC(et){if(!et)return!1;const _e=et.indexOf("."),tt=_e<0?et:et.substring(0,_e);return tt==="hvc1"||tt==="hev1"||tt==="dvh1"||tt==="dvhe"}function isSEIMessage(et,_e){if(et){const tt=_e>>1&63;return tt===39||tt===40}else return(_e&31)===6}function parseSEIMessageFromNALu(et,_e,tt,rt){const nt=discardEPB(et);let it=0;it+=_e;let st=0,ot=0,at=0;for(;it<nt.length;){st=0;do{if(it>=nt.length)break;at=nt[it++],st+=at}while(at===255);ot=0;do{if(it>=nt.length)break;at=nt[it++],ot+=at}while(at===255);const lt=nt.length-it;let ut=it;if(ot<lt)it+=ot;else if(ot>lt){logger.error(`Malformed SEI payload. ${ot} is too small, only ${lt} bytes left to parse.`);break}if(st===4){if(nt[ut++]===181){const dt=readUint16(nt,ut);if(ut+=2,dt===49){const ft=readUint32(nt,ut);if(ut+=4,ft===1195456820){const pt=nt[ut++];if(pt===3){const mt=nt[ut++],ht=31&mt,gt=64&mt,vt=gt?2+ht*3:0,yt=new Uint8Array(vt);if(gt){yt[0]=mt;for(let bt=1;bt<vt;bt++)yt[bt]=nt[ut++]}rt.push({type:pt,payloadType:st,pts:tt,bytes:yt})}}}}}else if(st===5&&ot>16){const ct=[];for(let pt=0;pt<16;pt++){const mt=nt[ut++].toString(16);ct.push(mt.length==1?"0"+mt:mt),(pt===3||pt===5||pt===7||pt===9)&&ct.push("-")}const dt=ot-16,ft=new Uint8Array(dt);for(let pt=0;pt<dt;pt++)ft[pt]=nt[ut++];rt.push({payloadType:st,pts:tt,uuid:ct.join(""),userData:utf8ArrayToStr(ft),userDataBytes:ft})}}}function discardEPB(et){const _e=et.byteLength,tt=[];let rt=1;for(;rt<_e-2;)et[rt]===0&&et[rt+1]===0&&et[rt+2]===3?(tt.push(rt+2),rt+=2):rt++;if(tt.length===0)return et;const nt=_e-tt.length,it=new Uint8Array(nt);let st=0;for(rt=0;rt<nt;st++,rt++)st===tt[0]&&(st++,tt.shift()),it[rt]=et[st];return it}function parseEmsg(et){const _e=et[0];let tt="",rt="",nt=0,it=0,st=0,ot=0,at=0,lt=0;if(_e===0){for(;bin2str(et.subarray(lt,lt+1))!=="\0";)tt+=bin2str(et.subarray(lt,lt+1)),lt+=1;for(tt+=bin2str(et.subarray(lt,lt+1)),lt+=1;bin2str(et.subarray(lt,lt+1))!=="\0";)rt+=bin2str(et.subarray(lt,lt+1)),lt+=1;rt+=bin2str(et.subarray(lt,lt+1)),lt+=1,nt=readUint32(et,12),it=readUint32(et,16),ot=readUint32(et,20),at=readUint32(et,24),lt=28}else if(_e===1){lt+=4,nt=readUint32(et,lt),lt+=4;const ct=readUint32(et,lt);lt+=4;const dt=readUint32(et,lt);for(lt+=4,st=2**32*ct+dt,isSafeInteger(st)||(st=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),ot=readUint32(et,lt),lt+=4,at=readUint32(et,lt),lt+=4;bin2str(et.subarray(lt,lt+1))!=="\0";)tt+=bin2str(et.subarray(lt,lt+1)),lt+=1;for(tt+=bin2str(et.subarray(lt,lt+1)),lt+=1;bin2str(et.subarray(lt,lt+1))!=="\0";)rt+=bin2str(et.subarray(lt,lt+1)),lt+=1;rt+=bin2str(et.subarray(lt,lt+1)),lt+=1}const ut=et.subarray(lt,et.byteLength);return{schemeIdUri:tt,value:rt,timeScale:nt,presentationTime:st,presentationTimeDelta:it,eventDuration:ot,id:at,payload:ut}}function mp4Box(et,..._e){const tt=_e.length;let rt=8,nt=tt;for(;nt--;)rt+=_e[nt].byteLength;const it=new Uint8Array(rt);for(it[0]=rt>>24&255,it[1]=rt>>16&255,it[2]=rt>>8&255,it[3]=rt&255,it.set(et,4),nt=0,rt=8;nt<tt;nt++)it.set(_e[nt],rt),rt+=_e[nt].byteLength;return it}function mp4pssh(et,_e,tt){if(et.byteLength!==16)throw new RangeError("Invalid system id");let rt,nt;if(_e){rt=1,nt=new Uint8Array(_e.length*16);for(let ot=0;ot<_e.length;ot++){const at=_e[ot];if(at.byteLength!==16)throw new RangeError("Invalid key");nt.set(at,ot*16)}}else rt=0,nt=new Uint8Array;let it;rt>0?(it=new Uint8Array(4),_e.length>0&&new DataView(it.buffer).setUint32(0,_e.length,!1)):it=new Uint8Array;const st=new Uint8Array(4);return tt&&tt.byteLength>0&&new DataView(st.buffer).setUint32(0,tt.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([rt,0,0,0]),et,it,nt,st,tt||new Uint8Array)}function parsePssh(et){if(!(et instanceof ArrayBuffer)||et.byteLength<32)return null;const _e={version:0,systemId:"",kids:null,data:null},tt=new DataView(et),rt=tt.getUint32(0);if(et.byteLength!==rt&&rt>44||tt.getUint32(4)!==1886614376||(_e.version=tt.getUint32(8)>>>24,_e.version>1))return null;_e.systemId=Hex.hexDump(new Uint8Array(et,12,16));const it=tt.getUint32(28);if(_e.version===0){if(rt-32<it)return null;_e.data=new Uint8Array(et,32,it)}else if(_e.version===1){_e.kids=[];for(let st=0;st<it;st++)_e.kids.push(new Uint8Array(et,32+st*16,16))}return _e}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(_e,tt,rt,nt=[1],it=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=_e,this.uri=tt,this.keyFormat=rt,this.keyFormatVersions=nt,this.iv=it,this.encrypted=_e?_e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&_e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(_e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof _e!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),_e=0);const rt=createInitializationVector(_e);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,rt)}const tt=convertDataUriToArrayBytes(this.uri);if(tt)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=tt,tt.length>=22&&(this.keyId=tt.subarray(tt.length-22,tt.length-6));break;case KeySystemFormats.PLAYREADY:{const rt=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(rt,null,tt);const nt=new Uint16Array(tt.buffer,tt.byteOffset,tt.byteLength/2),it=String.fromCharCode.apply(null,Array.from(nt)),st=it.substring(it.indexOf("<"),it.length),lt=new DOMParser().parseFromString(st,"text/xml").getElementsByTagName("KID")[0];if(lt){const ut=lt.childNodes[0]?lt.childNodes[0].nodeValue:lt.getAttribute("VALUE");if(ut){const ct=base64Decode(ut).subarray(0,16);changeEndianness(ct),this.keyId=ct}}break}default:{let rt=tt.subarray(0,16);if(rt.length!==16){const nt=new Uint8Array(16);nt.set(rt,16-rt.length),rt=nt}this.keyId=rt;break}}if(!this.keyId||this.keyId.byteLength!==16){let rt=keyUriToKeyIdMap[this.uri];if(!rt){const nt=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;rt=new Uint8Array(16),new DataView(rt.buffer,12,4).setUint32(0,nt),keyUriToKeyIdMap[this.uri]=rt}this.keyId=rt}return this}}function createInitializationVector(et){const _e=new Uint8Array(16);for(let tt=12;tt<16;tt++)_e[tt]=et>>8*(15-tt)&255;return _e}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(et){return VARIABLE_REPLACEMENT_REGEX.test(et)}function substituteVariablesInAttributes(et,_e,tt){if(et.variableList!==null||et.hasVariableRefs)for(let rt=tt.length;rt--;){const nt=tt[rt],it=_e[nt];it&&(_e[nt]=substituteVariables(et,it))}}function substituteVariables(et,_e){if(et.variableList!==null||et.hasVariableRefs){const tt=et.variableList;return _e.replace(VARIABLE_REPLACEMENT_REGEX,rt=>{const nt=rt.substring(2,rt.length-1),it=tt==null?void 0:tt[nt];return it===void 0?(et.playlistParsingError||(et.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${nt}"`)),rt):it})}return _e}function addVariableDefinition(et,_e,tt){let rt=et.variableList;rt||(et.variableList=rt={});let nt,it;if("QUERYPARAM"in _e){nt=_e.QUERYPARAM;try{const st=new self.URL(tt).searchParams;if(st.has(nt))it=st.get(nt);else throw new Error(`"${nt}" does not match any query parameter in URI: "${tt}"`)}catch(st){et.playlistParsingError||(et.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${st.message}`))}}else nt=_e.NAME,it=_e.VALUE;nt in rt?et.playlistParsingError||(et.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${nt}"`)):rt[nt]=it||""}function importVariableDefinition(et,_e,tt){const rt=_e.IMPORT;if(tt&&rt in tt){let nt=et.variableList;nt||(et.variableList=nt={}),nt[rt]=tt[rt]}else et.playlistParsingError||(et.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${rt}"`))}function getMediaSource(et=!0){return typeof self>"u"?void 0:(et||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(et,_e){const tt=sampleEntryCodesISO[_e];return!!tt&&!!tt[et.slice(0,4)]}function areCodecsMediaSourceSupported(et,_e,tt=!0){return!et.split(",").some(rt=>!isCodecMediaSourceSupported(rt,_e,tt))}function isCodecMediaSourceSupported(et,_e,tt=!0){var rt;const nt=getMediaSource(tt);return(rt=nt==null?void 0:nt.isTypeSupported(mimeTypeForCodec(et,_e)))!=null?rt:!1}function mimeTypeForCodec(et,_e){return`${_e}/mp4;codecs="${et}"`}function videoCodecPreferenceValue(et){if(et){const _e=et.substring(0,4);return sampleEntryCodesISO.video[_e]}return 2}function codecsSetSelectionPreferenceValue(et){return et.split(",").reduce((_e,tt)=>{const rt=sampleEntryCodesISO.video[tt];return rt?(rt*2+_e)/(_e?3:2):(sampleEntryCodesISO.audio[tt]+_e)/(_e?2:1)},0)}const CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(et,_e=!0){if(CODEC_COMPATIBLE_NAMES[et])return CODEC_COMPATIBLE_NAMES[et];const tt={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[et];for(let rt=0;rt<tt.length;rt++)if(isCodecMediaSourceSupported(tt[rt],"audio",_e))return CODEC_COMPATIBLE_NAMES[et]=tt[rt],tt[rt];return et}const AUDIO_CODEC_REGEXP=/flac|opus/i;function getCodecCompatibleName(et,_e=!0){return et.replace(AUDIO_CODEC_REGEXP,tt=>getCodecCompatibleNameLower(tt.toLowerCase(),_e))}function pickMostCompleteCodecName(et,_e){return et&&et!=="mp4a"?et:_e}function convertAVC1ToAVCOTI(et){const _e=et.split(".");if(_e.length>2){let tt=_e.shift()+".";return tt+=parseInt(_e.shift()).toString(16),tt+=("000"+parseInt(_e.shift()).toString(16)).slice(-4),tt}return et}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(_e,tt){for(let rt=0;rt<_e.length;rt++){const nt=_e[rt];if(nt.id===tt)return nt}}static resolve(_e,tt){return urlToolkitExports.buildAbsoluteURL(tt,_e,{alwaysNormalize:!0})}static isMediaPlaylist(_e){return IS_MEDIA_PLAYLIST.test(_e)}static parseMasterPlaylist(_e,tt){const rt=hasVariableReferences(_e),nt={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:rt},it=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let st;for(;(st=MASTER_PLAYLIST_REGEX.exec(_e))!=null;)if(st[1]){var ot;const lt=new AttrList(st[1]);substituteVariablesInAttributes(nt,lt,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const ut=substituteVariables(nt,st[2]),ct={attrs:lt,bitrate:lt.decimalInteger("BANDWIDTH")||lt.decimalInteger("AVERAGE-BANDWIDTH"),name:lt.NAME,url:M3U8Parser.resolve(ut,tt)},dt=lt.decimalResolution("RESOLUTION");dt&&(ct.width=dt.width,ct.height=dt.height),setCodecs(lt.CODECS,ct),(ot=ct.unknownCodecs)!=null&&ot.length||it.push(ct),nt.levels.push(ct)}else if(st[3]){const lt=st[3],ut=st[4];switch(lt){case"SESSION-DATA":{const ct=new AttrList(ut);substituteVariablesInAttributes(nt,ct,["DATA-ID","LANGUAGE","VALUE","URI"]);const dt=ct["DATA-ID"];dt&&(nt.sessionData===null&&(nt.sessionData={}),nt.sessionData[dt]=ct);break}case"SESSION-KEY":{const ct=parseKey(ut,tt,nt);ct.encrypted&&ct.isSupported()?(nt.sessionKeys===null&&(nt.sessionKeys=[]),nt.sessionKeys.push(ct)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${ut}"`);break}case"DEFINE":{{const ct=new AttrList(ut);substituteVariablesInAttributes(nt,ct,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(nt,ct,tt)}break}case"CONTENT-STEERING":{const ct=new AttrList(ut);substituteVariablesInAttributes(nt,ct,["SERVER-URI","PATHWAY-ID"]),nt.contentSteering={uri:M3U8Parser.resolve(ct["SERVER-URI"],tt),pathwayId:ct["PATHWAY-ID"]||"."};break}case"START":{nt.startTimeOffset=parseStartTimeOffset(ut);break}}}const at=it.length>0&&it.length<nt.levels.length;return nt.levels=at?it:nt.levels,nt.levels.length===0&&(nt.playlistParsingError=new Error("no levels found in manifest")),nt}static parseMasterPlaylistMedia(_e,tt,rt){let nt;const it={},st=rt.levels,ot={AUDIO:st.map(lt=>({id:lt.attrs.AUDIO,audioCodec:lt.audioCodec})),SUBTITLES:st.map(lt=>({id:lt.attrs.SUBTITLES,textCodec:lt.textCodec})),"CLOSED-CAPTIONS":[]};let at=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(nt=MASTER_PLAYLIST_MEDIA_REGEX.exec(_e))!==null;){const lt=new AttrList(nt[1]),ut=lt.TYPE;if(ut){const ct=ot[ut],dt=it[ut]||[];it[ut]=dt,substituteVariablesInAttributes(rt,lt,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const ft=lt.LANGUAGE,pt=lt["ASSOC-LANGUAGE"],mt=lt.CHANNELS,ht=lt.CHARACTERISTICS,gt=lt["INSTREAM-ID"],vt={attrs:lt,bitrate:0,id:at++,groupId:lt["GROUP-ID"]||"",name:lt.NAME||ft||"",type:ut,default:lt.bool("DEFAULT"),autoselect:lt.bool("AUTOSELECT"),forced:lt.bool("FORCED"),lang:ft,url:lt.URI?M3U8Parser.resolve(lt.URI,tt):""};if(pt&&(vt.assocLang=pt),mt&&(vt.channels=mt),ht&&(vt.characteristics=ht),gt&&(vt.instreamId=gt),ct!=null&&ct.length){const yt=M3U8Parser.findGroup(ct,vt.groupId)||ct[0];assignCodec(vt,yt,"audioCodec"),assignCodec(vt,yt,"textCodec")}dt.push(vt)}}return it}static parseLevelPlaylist(_e,tt,rt,nt,it,st){const ot=new LevelDetails(tt),at=ot.fragments;let lt=null,ut=0,ct=0,dt=0,ft=0,pt=null,mt=new Fragment(nt,tt),ht,gt,vt,yt=-1,bt=!1,xt=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,ot.m3u8=_e,ot.hasVariableRefs=hasVariableReferences(_e);(ht=LEVEL_PLAYLIST_REGEX_FAST.exec(_e))!==null;){bt&&(bt=!1,mt=new Fragment(nt,tt),mt.start=dt,mt.sn=ut,mt.cc=ft,mt.level=rt,lt&&(mt.initSegment=lt,mt.rawProgramDateTime=lt.rawProgramDateTime,lt.rawProgramDateTime=null,xt&&(mt.setByteRange(xt),xt=null)));const kt=ht[1];if(kt){mt.duration=parseFloat(kt);const At=(" "+ht[2]).slice(1);mt.title=At||null,mt.tagList.push(At?["INF",kt,At]:["INF",kt])}else if(ht[3]){if(isFiniteNumber(mt.duration)){mt.start=dt,vt&&setFragLevelKeys(mt,vt,ot),mt.sn=ut,mt.level=rt,mt.cc=ft,at.push(mt);const At=(" "+ht[3]).slice(1);mt.relurl=substituteVariables(ot,At),assignProgramDateTime(mt,pt),pt=mt,dt+=mt.duration,ut++,ct=0,bt=!0}}else if(ht[4]){const At=(" "+ht[4]).slice(1);pt?mt.setByteRange(At,pt):mt.setByteRange(At)}else if(ht[5])mt.rawProgramDateTime=(" "+ht[5]).slice(1),mt.tagList.push(["PROGRAM-DATE-TIME",mt.rawProgramDateTime]),yt===-1&&(yt=at.length);else{if(ht=ht[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!ht){logger.warn("No matches on slow regex match for level playlist!");continue}for(gt=1;gt<ht.length&&!(typeof ht[gt]<"u");gt++);const At=(" "+ht[gt]).slice(1),$t=(" "+ht[gt+1]).slice(1),Lt=ht[gt+2]?(" "+ht[gt+2]).slice(1):"";switch(At){case"PLAYLIST-TYPE":ot.type=$t.toUpperCase();break;case"MEDIA-SEQUENCE":ut=ot.startSN=parseInt($t);break;case"SKIP":{const Mt=new AttrList($t);substituteVariablesInAttributes(ot,Mt,["RECENTLY-REMOVED-DATERANGES"]);const Bt=Mt.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(Bt)){ot.skippedSegments=Bt;for(let Nt=Bt;Nt--;)at.unshift(null);ut+=Bt}const Pt=Mt.enumeratedString("RECENTLY-REMOVED-DATERANGES");Pt&&(ot.recentlyRemovedDateranges=Pt.split("	"));break}case"TARGETDURATION":ot.targetduration=Math.max(parseInt($t),1);break;case"VERSION":ot.version=parseInt($t);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":ot.live=!1;break;case"#":($t||Lt)&&mt.tagList.push(Lt?[$t,Lt]:[$t]);break;case"DISCONTINUITY":ft++,mt.tagList.push(["DIS"]);break;case"GAP":mt.gap=!0,mt.tagList.push([At]);break;case"BITRATE":mt.tagList.push([At,$t]);break;case"DATERANGE":{const Mt=new AttrList($t);substituteVariablesInAttributes(ot,Mt,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(ot,Mt,Mt.clientAttrs);const Bt=new DateRange(Mt,ot.dateRanges[Mt.ID]);Bt.isValid||ot.skippedSegments?ot.dateRanges[Bt.id]=Bt:logger.warn(`Ignoring invalid DATERANGE tag: "${$t}"`),mt.tagList.push(["EXT-X-DATERANGE",$t]);break}case"DEFINE":{{const Mt=new AttrList($t);substituteVariablesInAttributes(ot,Mt,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in Mt?importVariableDefinition(ot,Mt,st):addVariableDefinition(ot,Mt,tt)}break}case"DISCONTINUITY-SEQUENCE":ft=parseInt($t);break;case"KEY":{const Mt=parseKey($t,tt,ot);if(Mt.isSupported()){if(Mt.method==="NONE"){vt=void 0;break}vt||(vt={}),vt[Mt.keyFormat]&&(vt=_extends({},vt)),vt[Mt.keyFormat]=Mt}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${$t}"`);break}case"START":ot.startTimeOffset=parseStartTimeOffset($t);break;case"MAP":{const Mt=new AttrList($t);if(substituteVariablesInAttributes(ot,Mt,["BYTERANGE","URI"]),mt.duration){const Bt=new Fragment(nt,tt);setInitSegment(Bt,Mt,rt,vt),lt=Bt,mt.initSegment=lt,lt.rawProgramDateTime&&!mt.rawProgramDateTime&&(mt.rawProgramDateTime=lt.rawProgramDateTime)}else{const Bt=mt.byteRangeEndOffset;if(Bt){const Pt=mt.byteRangeStartOffset;xt=`${Bt-Pt}@${Pt}`}else xt=null;setInitSegment(mt,Mt,rt,vt),lt=mt,bt=!0}break}case"SERVER-CONTROL":{const Mt=new AttrList($t);ot.canBlockReload=Mt.bool("CAN-BLOCK-RELOAD"),ot.canSkipUntil=Mt.optionalFloat("CAN-SKIP-UNTIL",0),ot.canSkipDateRanges=ot.canSkipUntil>0&&Mt.bool("CAN-SKIP-DATERANGES"),ot.partHoldBack=Mt.optionalFloat("PART-HOLD-BACK",0),ot.holdBack=Mt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const Mt=new AttrList($t);ot.partTarget=Mt.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Mt=ot.partList;Mt||(Mt=ot.partList=[]);const Bt=ct>0?Mt[Mt.length-1]:void 0,Pt=ct++,Nt=new AttrList($t);substituteVariablesInAttributes(ot,Nt,["BYTERANGE","URI"]);const It=new Part(Nt,mt,tt,Pt,Bt);Mt.push(It),mt.duration+=It.duration;break}case"PRELOAD-HINT":{const Mt=new AttrList($t);substituteVariablesInAttributes(ot,Mt,["URI"]),ot.preloadHint=Mt;break}case"RENDITION-REPORT":{const Mt=new AttrList($t);substituteVariablesInAttributes(ot,Mt,["URI"]),ot.renditionReports=ot.renditionReports||[],ot.renditionReports.push(Mt);break}default:logger.warn(`line parsed but not handled: ${ht}`);break}}}pt&&!pt.relurl?(at.pop(),dt-=pt.duration,ot.partList&&(ot.fragmentHint=pt)):ot.partList&&(assignProgramDateTime(mt,pt),mt.cc=ft,ot.fragmentHint=mt,vt&&setFragLevelKeys(mt,vt,ot));const _t=at.length,wt=at[0],Ct=at[_t-1];if(dt+=ot.skippedSegments*ot.targetduration,dt>0&&_t&&Ct){ot.averagetargetduration=dt/_t;const kt=Ct.sn;ot.endSN=kt!=="initSegment"?kt:0,ot.live||(Ct.endList=!0),wt&&(ot.startCC=wt.cc)}else ot.endSN=0,ot.startCC=0;return ot.fragmentHint&&(dt+=ot.fragmentHint.duration),ot.totalduration=dt,ot.endCC=ft,yt>0&&backfillProgramDateTimes(at,yt),ot}}function parseKey(et,_e,tt){var rt,nt;const it=new AttrList(et);substituteVariablesInAttributes(tt,it,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const st=(rt=it.METHOD)!=null?rt:"",ot=it.URI,at=it.hexadecimalInteger("IV"),lt=it.KEYFORMATVERSIONS,ut=(nt=it.KEYFORMAT)!=null?nt:"identity";ot&&it.IV&&!at&&logger.error(`Invalid IV: ${it.IV}`);const ct=ot?M3U8Parser.resolve(ot,_e):"",dt=(lt||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(st,ct,ut,dt,at)}function parseStartTimeOffset(et){const tt=new AttrList(et).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(tt)?tt:null}function setCodecs(et,_e){let tt=(et||"").split(/[ ,]+/).filter(rt=>rt);["video","audio","text"].forEach(rt=>{const nt=tt.filter(it=>isCodecType(it,rt));nt.length&&(_e[`${rt}Codec`]=nt.join(","),tt=tt.filter(it=>nt.indexOf(it)===-1))}),_e.unknownCodecs=tt}function assignCodec(et,_e,tt){const rt=_e[tt];rt&&(et[tt]=rt)}function backfillProgramDateTimes(et,_e){let tt=et[_e];for(let rt=_e;rt--;){const nt=et[rt];if(!nt)return;nt.programDateTime=tt.programDateTime-nt.duration*1e3,tt=nt}}function assignProgramDateTime(et,_e){et.rawProgramDateTime?et.programDateTime=Date.parse(et.rawProgramDateTime):_e!=null&&_e.programDateTime&&(et.programDateTime=_e.endProgramDateTime),isFiniteNumber(et.programDateTime)||(et.programDateTime=null,et.rawProgramDateTime=null)}function setInitSegment(et,_e,tt,rt){et.relurl=_e.URI,_e.BYTERANGE&&et.setByteRange(_e.BYTERANGE),et.level=tt,et.sn="initSegment",rt&&(et.levelkeys=rt),et.initSegment=null}function setFragLevelKeys(et,_e,tt){et.levelkeys=_e;const{encryptedFragments:rt}=tt;(!rt.length||rt[rt.length-1].levelkeys!==_e)&&Object.keys(_e).some(nt=>_e[nt].isCommonEncryption)&&rt.push(et)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(et){const{type:_e}=et;switch(_e){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(et,_e){let tt=et.url;return(tt===void 0||tt.indexOf("data:")===0)&&(tt=_e.url),tt}class PlaylistLoader{constructor(_e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=_e,this.registerListeners()}startLoad(_e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:_e}=this;_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),_e.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),_e.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:_e}=this;_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),_e.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),_e.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(_e){const tt=this.hls.config,rt=tt.pLoader,nt=tt.loader,it=rt||nt,st=new it(tt);return this.loaders[_e.type]=st,st}getInternalLoader(_e){return this.loaders[_e.type]}resetInternalLoader(_e){this.loaders[_e]&&delete this.loaders[_e]}destroyInternalLoaders(){for(const _e in this.loaders){const tt=this.loaders[_e];tt&&tt.destroy(),this.resetInternalLoader(_e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(_e,tt){const{url:rt}=tt;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:rt,deliveryDirectives:null})}onLevelLoading(_e,tt){const{id:rt,level:nt,pathwayId:it,url:st,deliveryDirectives:ot}=tt;this.load({id:rt,level:nt,pathwayId:it,responseType:"text",type:PlaylistContextType.LEVEL,url:st,deliveryDirectives:ot})}onAudioTrackLoading(_e,tt){const{id:rt,groupId:nt,url:it,deliveryDirectives:st}=tt;this.load({id:rt,groupId:nt,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:it,deliveryDirectives:st})}onSubtitleTrackLoading(_e,tt){const{id:rt,groupId:nt,url:it,deliveryDirectives:st}=tt;this.load({id:rt,groupId:nt,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:it,deliveryDirectives:st})}load(_e){var tt;const rt=this.hls.config;let nt=this.getInternalLoader(_e);if(nt){const lt=nt.context;if(lt&&lt.url===_e.url&&lt.level===_e.level){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${_e.type}`),nt.abort()}let it;if(_e.type===PlaylistContextType.MANIFEST?it=rt.manifestLoadPolicy.default:it=_extends({},rt.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),nt=this.createInternalLoader(_e),isFiniteNumber((tt=_e.deliveryDirectives)==null?void 0:tt.part)){let lt;if(_e.type===PlaylistContextType.LEVEL&&_e.level!==null?lt=this.hls.levels[_e.level].details:_e.type===PlaylistContextType.AUDIO_TRACK&&_e.id!==null?lt=this.hls.audioTracks[_e.id].details:_e.type===PlaylistContextType.SUBTITLE_TRACK&&_e.id!==null&&(lt=this.hls.subtitleTracks[_e.id].details),lt){const ut=lt.partTarget,ct=lt.targetduration;if(ut&&ct){const dt=Math.max(ut*3,ct*.8)*1e3;it=_extends({},it,{maxTimeToFirstByteMs:Math.min(dt,it.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(dt,it.maxTimeToFirstByteMs)})}}}const st=it.errorRetry||it.timeoutRetry||{},ot={loadPolicy:it,timeout:it.maxLoadTimeMs,maxRetry:st.maxNumRetry||0,retryDelay:st.retryDelayMs||0,maxRetryDelay:st.maxRetryDelayMs||0},at={onSuccess:(lt,ut,ct,dt)=>{const ft=this.getInternalLoader(ct);this.resetInternalLoader(ct.type);const pt=lt.data;if(pt.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(lt,ct,new Error("no EXTM3U delimiter"),dt||null,ut);return}ut.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(pt)?this.handleTrackOrLevelPlaylist(lt,ut,ct,dt||null,ft):this.handleMasterPlaylist(lt,ut,ct,dt)},onError:(lt,ut,ct,dt)=>{this.handleNetworkError(ut,ct,!1,lt,dt)},onTimeout:(lt,ut,ct)=>{this.handleNetworkError(ut,ct,!0,void 0,lt)}};nt.load(_e,ot,at)}handleMasterPlaylist(_e,tt,rt,nt){const it=this.hls,st=_e.data,ot=getResponseUrl(_e,rt),at=M3U8Parser.parseMasterPlaylist(st,ot);if(at.playlistParsingError){this.handleManifestParsingError(_e,rt,at.playlistParsingError,nt,tt);return}const{contentSteering:lt,levels:ut,sessionData:ct,sessionKeys:dt,startTimeOffset:ft,variableList:pt}=at;this.variableList=pt;const{AUDIO:mt=[],SUBTITLES:ht,"CLOSED-CAPTIONS":gt}=M3U8Parser.parseMasterPlaylistMedia(st,ot,at);mt.length&&!mt.some(yt=>!yt.url)&&ut[0].audioCodec&&!ut[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),mt.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),it.trigger(Events.MANIFEST_LOADED,{levels:ut,audioTracks:mt,subtitles:ht,captions:gt,contentSteering:lt,url:ot,stats:tt,networkDetails:nt,sessionData:ct,sessionKeys:dt,startTimeOffset:ft,variableList:pt})}handleTrackOrLevelPlaylist(_e,tt,rt,nt,it){const st=this.hls,{id:ot,level:at,type:lt}=rt,ut=getResponseUrl(_e,rt),ct=0,dt=isFiniteNumber(at)?at:isFiniteNumber(ot)?ot:0,ft=mapContextToLevelType(rt),pt=M3U8Parser.parseLevelPlaylist(_e.data,ut,dt,ft,ct,this.variableList);if(lt===PlaylistContextType.MANIFEST){const mt={attrs:new AttrList({}),bitrate:0,details:pt,name:"",url:ut};st.trigger(Events.MANIFEST_LOADED,{levels:[mt],audioTracks:[],url:ut,stats:tt,networkDetails:nt,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}tt.parsing.end=performance.now(),rt.levelDetails=pt,this.handlePlaylistLoaded(pt,_e,tt,rt,nt,it)}handleManifestParsingError(_e,tt,rt,nt,it){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:tt.type===PlaylistContextType.MANIFEST,url:_e.url,err:rt,error:rt,reason:rt.message,response:_e,context:tt,networkDetails:nt,stats:it})}handleNetworkError(_e,tt,rt=!1,nt,it){let st=`A network ${rt?"timeout":"error"+(nt?" (status "+nt.code+")":"")} occurred while loading ${_e.type}`;_e.type===PlaylistContextType.LEVEL?st+=`: ${_e.level} id: ${_e.id}`:(_e.type===PlaylistContextType.AUDIO_TRACK||_e.type===PlaylistContextType.SUBTITLE_TRACK)&&(st+=` id: ${_e.id} group-id: "${_e.groupId}"`);const ot=new Error(st);logger.warn(`[playlist-loader]: ${st}`);let at=ErrorDetails.UNKNOWN,lt=!1;const ut=this.getInternalLoader(_e);switch(_e.type){case PlaylistContextType.MANIFEST:at=rt?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,lt=!0;break;case PlaylistContextType.LEVEL:at=rt?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,lt=!1;break;case PlaylistContextType.AUDIO_TRACK:at=rt?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,lt=!1;break;case PlaylistContextType.SUBTITLE_TRACK:at=rt?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,lt=!1;break}ut&&this.resetInternalLoader(_e.type);const ct={type:ErrorTypes.NETWORK_ERROR,details:at,fatal:lt,url:_e.url,loader:ut,context:_e,error:ot,networkDetails:tt,stats:it};if(nt){const dt=(tt==null?void 0:tt.url)||_e.url;ct.response=_objectSpread2({url:dt,data:void 0},nt)}this.hls.trigger(Events.ERROR,ct)}handlePlaylistLoaded(_e,tt,rt,nt,it,st){const ot=this.hls,{type:at,level:lt,id:ut,groupId:ct,deliveryDirectives:dt}=nt,ft=getResponseUrl(tt,nt),pt=mapContextToLevelType(nt),mt=typeof nt.level=="number"&&pt===PlaylistLevelType.MAIN?lt:void 0;if(!_e.fragments.length){const gt=new Error("No Segments found in Playlist");ot.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:ft,error:gt,reason:gt.message,response:tt,context:nt,level:mt,parent:pt,networkDetails:it,stats:rt});return}_e.targetduration||(_e.playlistParsingError=new Error("Missing Target Duration"));const ht=_e.playlistParsingError;if(ht){ot.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:ft,error:ht,reason:ht.message,response:tt,context:nt,level:mt,parent:pt,networkDetails:it,stats:rt});return}switch(_e.live&&st&&(st.getCacheAge&&(_e.ageHeader=st.getCacheAge()||0),(!st.getCacheAge||isNaN(_e.ageHeader))&&(_e.ageHeader=0)),at){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:ot.trigger(Events.LEVEL_LOADED,{details:_e,level:mt||0,id:ut||0,stats:rt,networkDetails:it,deliveryDirectives:dt});break;case PlaylistContextType.AUDIO_TRACK:ot.trigger(Events.AUDIO_TRACK_LOADED,{details:_e,id:ut||0,groupId:ct||"",stats:rt,networkDetails:it,deliveryDirectives:dt});break;case PlaylistContextType.SUBTITLE_TRACK:ot.trigger(Events.SUBTITLE_TRACK_LOADED,{details:_e,id:ut||0,groupId:ct||"",stats:rt,networkDetails:it,deliveryDirectives:dt});break}}}function sendAddTrackEvent(et,_e){let tt;try{tt=new Event("addtrack")}catch{tt=document.createEvent("Event"),tt.initEvent("addtrack",!1,!1)}tt.track=et,_e.dispatchEvent(tt)}function addCueToTrack(et,_e){const tt=et.mode;if(tt==="disabled"&&(et.mode="hidden"),et.cues&&!et.cues.getCueById(_e.id))try{if(et.addCue(_e),!et.cues.getCueById(_e.id))throw new Error(`addCue is failed for: ${_e}`)}catch(rt){logger.debug(`[texttrack-utils]: ${rt}`);try{const nt=new self.TextTrackCue(_e.startTime,_e.endTime,_e.text);nt.id=_e.id,et.addCue(nt)}catch(nt){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${nt}`)}}tt==="disabled"&&(et.mode=tt)}function clearCurrentCues(et){const _e=et.mode;if(_e==="disabled"&&(et.mode="hidden"),et.cues)for(let tt=et.cues.length;tt--;)et.removeCue(et.cues[tt]);_e==="disabled"&&(et.mode=_e)}function removeCuesInRange(et,_e,tt,rt){const nt=et.mode;if(nt==="disabled"&&(et.mode="hidden"),et.cues&&et.cues.length>0){const it=getCuesInRange(et.cues,_e,tt);for(let st=0;st<it.length;st++)(!rt||rt(it[st]))&&et.removeCue(it[st])}nt==="disabled"&&(et.mode=nt)}function getFirstCueIndexAfterTime(et,_e){if(_e<et[0].startTime)return 0;const tt=et.length-1;if(_e>et[tt].endTime)return-1;let rt=0,nt=tt;for(;rt<=nt;){const it=Math.floor((nt+rt)/2);if(_e<et[it].startTime)nt=it-1;else if(_e>et[it].startTime&&rt<tt)rt=it+1;else return it}return et[rt].startTime-_e<_e-et[nt].startTime?rt:nt}function getCuesInRange(et,_e,tt){const rt=[],nt=getFirstCueIndexAfterTime(et,_e);if(nt>-1)for(let it=nt,st=et.length;it<st;it++){const ot=et[it];if(ot.startTime>=_e&&ot.endTime<=tt)rt.push(ot);else if(ot.startTime>tt)return rt}return rt}function filterSubtitleTracks(et){const _e=[];for(let tt=0;tt<et.length;tt++){const rt=et[tt];(rt.kind==="subtitles"||rt.kind==="captions")&&rt.label&&_e.push(et[tt])}return _e}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(et,_e,tt,rt,nt){let it=new et(_e,tt,"");try{it.value=rt,nt&&(it.type=nt)}catch{it=new et(_e,tt,JSON.stringify(nt?_objectSpread2({type:nt},rt):rt))}return it}const MAX_CUE_ENDTIME=(()=>{const et=getCueClass();try{et&&new et(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(et,_e){return et.getTime()/1e3-_e}function hexToArrayBuffer(et){return Uint8Array.from(et.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(_e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=_e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:_e}=this;_e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),_e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),_e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:_e}=this;_e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),_e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),_e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(_e,tt){this.media=tt.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(_e){const tt=this.getID3Track(_e.textTracks);return tt.mode="hidden",tt}getID3Track(_e){if(this.media){for(let tt=0;tt<_e.length;tt++){const rt=_e[tt];if(rt.kind==="metadata"&&rt.label==="id3")return sendAddTrackEvent(rt,this.media),rt}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(_e,tt){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:rt,enableID3MetadataCues:nt}}}=this;if(!rt&&!nt)return;const{samples:it}=tt;this.id3Track||(this.id3Track=this.createTrack(this.media));const st=getCueClass();if(st)for(let ot=0;ot<it.length;ot++){const at=it[ot].type;if(at===MetadataSchema.emsg&&!rt||!nt)continue;const lt=getID3Frames(it[ot].data);if(lt){const ut=it[ot].pts;let ct=ut+it[ot].duration;ct>MAX_CUE_ENDTIME&&(ct=MAX_CUE_ENDTIME),ct-ut<=0&&(ct=ut+MIN_CUE_DURATION);for(let ft=0;ft<lt.length;ft++){const pt=lt[ft];if(!isTimeStampFrame(pt)){this.updateId3CueEnds(ut,at);const mt=createCueWithDataFields(st,ut,ct,pt,at);mt&&this.id3Track.addCue(mt)}}}}}updateId3CueEnds(_e,tt){var rt;const nt=(rt=this.id3Track)==null?void 0:rt.cues;if(nt)for(let it=nt.length;it--;){const st=nt[it];st.type===tt&&st.startTime<_e&&st.endTime===MAX_CUE_ENDTIME&&(st.endTime=_e)}}onBufferFlushing(_e,{startOffset:tt,endOffset:rt,type:nt}){const{id3Track:it,hls:st}=this;if(!st)return;const{config:{enableEmsgMetadataCues:ot,enableID3MetadataCues:at}}=st;if(it&&(ot||at)){let lt;nt==="audio"?lt=ut=>ut.type===MetadataSchema.audioId3&&at:nt==="video"?lt=ut=>ut.type===MetadataSchema.emsg&&ot:lt=ut=>ut.type===MetadataSchema.audioId3&&at||ut.type===MetadataSchema.emsg&&ot,removeCuesInRange(it,tt,rt,lt)}}onLevelUpdated(_e,{details:tt}){if(!this.media||!tt.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:rt,id3Track:nt}=this,{dateRanges:it}=tt,st=Object.keys(it);if(nt){const ut=Object.keys(rt).filter(ct=>!st.includes(ct));for(let ct=ut.length;ct--;){const dt=ut[ct];Object.keys(rt[dt].cues).forEach(ft=>{nt.removeCue(rt[dt].cues[ft])}),delete rt[dt]}}const ot=tt.fragments[tt.fragments.length-1];if(st.length===0||!isFiniteNumber(ot==null?void 0:ot.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const at=ot.programDateTime/1e3-ot.start,lt=getCueClass();for(let ut=0;ut<st.length;ut++){const ct=st[ut],dt=it[ct],ft=dateRangeDateToTimelineSeconds(dt.startDate,at),pt=rt[ct],mt=(pt==null?void 0:pt.cues)||{};let ht=(pt==null?void 0:pt.durationKnown)||!1,gt=MAX_CUE_ENDTIME;const vt=dt.endDate;if(vt)gt=dateRangeDateToTimelineSeconds(vt,at),ht=!0;else if(dt.endOnNext&&!ht){const bt=st.reduce((xt,_t)=>{if(_t!==dt.id){const wt=it[_t];if(wt.class===dt.class&&wt.startDate>dt.startDate&&(!xt||dt.startDate<xt.startDate))return wt}return xt},null);bt&&(gt=dateRangeDateToTimelineSeconds(bt.startDate,at),ht=!0)}const yt=Object.keys(dt.attr);for(let bt=0;bt<yt.length;bt++){const xt=yt[bt];if(!isDateRangeCueAttribute(xt))continue;const _t=mt[xt];if(_t)ht&&!pt.durationKnown&&(_t.endTime=gt);else if(lt){let wt=dt.attr[xt];isSCTE35Attribute(xt)&&(wt=hexToArrayBuffer(wt));const Ct=createCueWithDataFields(lt,ft,gt,{key:xt,data:wt},MetadataSchema.dateRange);Ct&&(Ct.id=ct,this.id3Track.addCue(Ct),mt[xt]=Ct)}}rt[ct]={cues:mt,dateRange:dt,durationKnown:ht}}}}class LatencyController{constructor(_e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=_e,this.config=_e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:_e,levelDetails:tt}=this;return _e.liveMaxLatencyDuration!==void 0?_e.liveMaxLatencyDuration:tt?_e.liveMaxLatencyDurationCount*tt.targetduration:0}get targetLatency(){const{levelDetails:_e}=this;if(_e===null)return null;const{holdBack:tt,partHoldBack:rt,targetduration:nt}=_e,{liveSyncDuration:it,liveSyncDurationCount:st,lowLatencyMode:ot}=this.config,at=this.hls.userConfig;let lt=ot&&rt||tt;(at.liveSyncDuration||at.liveSyncDurationCount||lt===0)&&(lt=it!==void 0?it:st*nt);const ut=nt;return lt+Math.min(this.stallCount*1,ut)}get liveSyncPosition(){const _e=this.estimateLiveEdge(),tt=this.targetLatency,rt=this.levelDetails;if(_e===null||tt===null||rt===null)return null;const nt=rt.edge,it=_e-tt-this.edgeStalled,st=nt-rt.totalduration,ot=nt-(this.config.lowLatencyMode&&rt.partTarget||rt.targetduration);return Math.min(Math.max(st,it),ot)}get drift(){const{levelDetails:_e}=this;return _e===null?1:_e.drift}get edgeStalled(){const{levelDetails:_e}=this;if(_e===null)return 0;const tt=(this.config.lowLatencyMode&&_e.partTarget||_e.targetduration)*3;return Math.max(_e.age-tt,0)}get forwardBufferLength(){const{media:_e,levelDetails:tt}=this;if(!_e||!tt)return 0;const rt=_e.buffered.length;return(rt?_e.buffered.end(rt-1):tt.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(_e,tt){this.media=tt.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(_e,{details:tt}){this.levelDetails=tt,tt.advanced&&this.timeupdate(),!tt.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(_e,tt){var rt;tt.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(rt=this.levelDetails)!=null&&rt.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:_e,levelDetails:tt}=this;if(!_e||!tt)return;this.currentTime=_e.currentTime;const rt=this.computeLatency();if(rt===null)return;this._latency=rt;const{lowLatencyMode:nt,maxLiveSyncPlaybackRate:it}=this.config;if(!nt||it===1||!tt.live)return;const st=this.targetLatency;if(st===null)return;const ot=rt-st,at=Math.min(this.maxLatency,st+tt.targetduration);if(ot<at&&ot>.05&&this.forwardBufferLength>1){const ut=Math.min(2,Math.max(1,it)),ct=Math.round(2/(1+Math.exp(-.75*ot-this.edgeStalled))*20)/20;_e.playbackRate=Math.min(ut,Math.max(1,ct))}else _e.playbackRate!==1&&_e.playbackRate!==0&&(_e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:_e}=this;return _e===null?null:_e.edge+_e.age}computeLatency(){const _e=this.estimateLiveEdge();return _e===null?null:_e-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(et){return HdcpLevels.indexOf(et)>-1}const VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(et){return!!et&&VideoRangeValues.indexOf(et)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(et,_e){const{canSkipUntil:tt,canSkipDateRanges:rt,endSN:nt}=et,it=_e!==void 0?_e-nt:0;return tt&&it<tt?rt?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(_e,tt,rt){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=_e,this.part=tt,this.skip=rt}addDirectives(_e){const tt=new self.URL(_e);return this.msn!==void 0&&tt.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&tt.searchParams.set("_HLS_part",this.part.toString()),this.skip&&tt.searchParams.set("_HLS_skip",this.skip),tt.href}}class Level{constructor(_e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[_e.url],this._attrs=[_e.attrs],this.bitrate=_e.bitrate,_e.details&&(this.details=_e.details),this.id=_e.id||0,this.name=_e.name,this.width=_e.width||0,this.height=_e.height||0,this.frameRate=_e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=_e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=_e.audioCodec,this.videoCodec=_e.videoCodec,this.codecSet=[_e.videoCodec,_e.audioCodec].filter(tt=>!!tt).map(tt=>tt.substring(0,4)).join(","),this.addGroupId("audio",_e.attrs.AUDIO),this.addGroupId("text",_e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(_e){return hasGroup(this._audioGroups,_e)}hasSubtitleGroup(_e){return hasGroup(this._subtitleGroups,_e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(_e,tt){if(tt){if(_e==="audio"){let rt=this._audioGroups;rt||(rt=this._audioGroups=[]),rt.indexOf(tt)===-1&&rt.push(tt)}else if(_e==="text"){let rt=this._subtitleGroups;rt||(rt=this._subtitleGroups=[]),rt.indexOf(tt)===-1&&rt.push(tt)}}}get urlId(){return 0}set urlId(_e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var _e;return(_e=this.audioGroups)==null?void 0:_e[0]}get textGroupId(){var _e;return(_e=this.subtitleGroups)==null?void 0:_e[0]}addFallback(){}}function hasGroup(et,_e){return!_e||!et?!1:et.indexOf(_e)!==-1}function updateFromToPTS(et,_e){const tt=_e.startPTS;if(isFiniteNumber(tt)){let rt=0,nt;_e.sn>et.sn?(rt=tt-et.start,nt=et):(rt=et.start-tt,nt=_e),nt.duration!==rt&&(nt.duration=rt)}else _e.sn>et.sn?et.cc===_e.cc&&et.minEndPTS?_e.start=et.start+(et.minEndPTS-et.start):_e.start=et.start+et.duration:_e.start=Math.max(et.start-_e.duration,0)}function updateFragPTSDTS(et,_e,tt,rt,nt,it){rt-tt<=0&&(logger.warn("Fragment should have a positive duration",_e),rt=tt+_e.duration,it=nt+_e.duration);let ot=tt,at=rt;const lt=_e.startPTS,ut=_e.endPTS;if(isFiniteNumber(lt)){const ht=Math.abs(lt-tt);isFiniteNumber(_e.deltaPTS)?_e.deltaPTS=Math.max(ht,_e.deltaPTS):_e.deltaPTS=ht,ot=Math.max(tt,lt),tt=Math.min(tt,lt),nt=Math.min(nt,_e.startDTS),at=Math.min(rt,ut),rt=Math.max(rt,ut),it=Math.max(it,_e.endDTS)}const ct=tt-_e.start;_e.start!==0&&(_e.start=tt),_e.duration=rt-_e.start,_e.startPTS=tt,_e.maxStartPTS=ot,_e.startDTS=nt,_e.endPTS=rt,_e.minEndPTS=at,_e.endDTS=it;const dt=_e.sn;if(!et||dt<et.startSN||dt>et.endSN)return 0;let ft;const pt=dt-et.startSN,mt=et.fragments;for(mt[pt]=_e,ft=pt;ft>0;ft--)updateFromToPTS(mt[ft],mt[ft-1]);for(ft=pt;ft<mt.length-1;ft++)updateFromToPTS(mt[ft],mt[ft+1]);return et.fragmentHint&&updateFromToPTS(mt[mt.length-1],et.fragmentHint),et.PTSKnown=et.alignedSliding=!0,ct}function mergeDetails(et,_e){let tt=null;const rt=et.fragments;for(let at=rt.length-1;at>=0;at--){const lt=rt[at].initSegment;if(lt){tt=lt;break}}et.fragmentHint&&delete et.fragmentHint.endPTS;let nt=0,it;if(mapFragmentIntersection(et,_e,(at,lt)=>{at.relurl&&(nt=at.cc-lt.cc),isFiniteNumber(at.startPTS)&&isFiniteNumber(at.endPTS)&&(lt.start=lt.startPTS=at.startPTS,lt.startDTS=at.startDTS,lt.maxStartPTS=at.maxStartPTS,lt.endPTS=at.endPTS,lt.endDTS=at.endDTS,lt.minEndPTS=at.minEndPTS,lt.duration=at.endPTS-at.startPTS,lt.duration&&(it=lt),_e.PTSKnown=_e.alignedSliding=!0),lt.elementaryStreams=at.elementaryStreams,lt.loader=at.loader,lt.stats=at.stats,at.initSegment&&(lt.initSegment=at.initSegment,tt=at.initSegment)}),tt&&(_e.fragmentHint?_e.fragments.concat(_e.fragmentHint):_e.fragments).forEach(lt=>{var ut;lt&&(!lt.initSegment||lt.initSegment.relurl===((ut=tt)==null?void 0:ut.relurl))&&(lt.initSegment=tt)}),_e.skippedSegments)if(_e.deltaUpdateFailed=_e.fragments.some(at=>!at),_e.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let at=_e.skippedSegments;at--;)_e.fragments.shift();_e.startSN=_e.fragments[0].sn,_e.startCC=_e.fragments[0].cc}else _e.canSkipDateRanges&&(_e.dateRanges=mergeDateRanges(et.dateRanges,_e.dateRanges,_e.recentlyRemovedDateranges));const st=_e.fragments;if(nt){logger.warn("discontinuity sliding from playlist, take drift into account");for(let at=0;at<st.length;at++)st[at].cc+=nt}_e.skippedSegments&&(_e.startCC=_e.fragments[0].cc),mapPartIntersection(et.partList,_e.partList,(at,lt)=>{lt.elementaryStreams=at.elementaryStreams,lt.stats=at.stats}),it?updateFragPTSDTS(_e,it,it.startPTS,it.endPTS,it.startDTS,it.endDTS):adjustSliding(et,_e),st.length&&(_e.totalduration=_e.edge-st[0].start),_e.driftStartTime=et.driftStartTime,_e.driftStart=et.driftStart;const ot=_e.advancedDateTime;if(_e.advanced&&ot){const at=_e.edge;_e.driftStart||(_e.driftStartTime=ot,_e.driftStart=at),_e.driftEndTime=ot,_e.driftEnd=at}else _e.driftEndTime=et.driftEndTime,_e.driftEnd=et.driftEnd,_e.advancedDateTime=et.advancedDateTime}function mergeDateRanges(et,_e,tt){const rt=_extends({},et);return tt&&tt.forEach(nt=>{delete rt[nt]}),Object.keys(_e).forEach(nt=>{const it=new DateRange(_e[nt].attr,rt[nt]);it.isValid?rt[nt]=it:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(_e[nt].attr)}"`)}),rt}function mapPartIntersection(et,_e,tt){if(et&&_e){let rt=0;for(let nt=0,it=et.length;nt<=it;nt++){const st=et[nt],ot=_e[nt+rt];st&&ot&&st.index===ot.index&&st.fragment.sn===ot.fragment.sn?tt(st,ot):rt--}}}function mapFragmentIntersection(et,_e,tt){const rt=_e.skippedSegments,nt=Math.max(et.startSN,_e.startSN)-_e.startSN,it=(et.fragmentHint?1:0)+(rt?_e.endSN:Math.min(et.endSN,_e.endSN))-_e.startSN,st=_e.startSN-et.startSN,ot=_e.fragmentHint?_e.fragments.concat(_e.fragmentHint):_e.fragments,at=et.fragmentHint?et.fragments.concat(et.fragmentHint):et.fragments;for(let lt=nt;lt<=it;lt++){const ut=at[st+lt];let ct=ot[lt];rt&&!ct&&lt<rt&&(ct=_e.fragments[lt]=ut),ut&&ct&&tt(ut,ct)}}function adjustSliding(et,_e){const tt=_e.startSN+_e.skippedSegments-et.startSN,rt=et.fragments;tt<0||tt>=rt.length||addSliding(_e,rt[tt].start)}function addSliding(et,_e){if(_e){const tt=et.fragments;for(let rt=et.skippedSegments;rt<tt.length;rt++)tt[rt].start+=_e;et.fragmentHint&&(et.fragmentHint.start+=_e)}}function computeReloadInterval(et,_e=1/0){let tt=1e3*et.targetduration;if(et.updated){const rt=et.fragments;if(rt.length&&tt*4>_e){const it=rt[rt.length-1].duration*1e3;it<tt&&(tt=it)}}else tt/=2;return Math.round(tt)}function getFragmentWithSN(et,_e,tt){if(!(et!=null&&et.details))return null;const rt=et.details;let nt=rt.fragments[_e-rt.startSN];return nt||(nt=rt.fragmentHint,nt&&nt.sn===_e)?nt:_e<rt.startSN&&tt&&tt.sn===_e?tt:null}function getPartWith(et,_e,tt){var rt;return et!=null&&et.details?findPart((rt=et.details)==null?void 0:rt.partList,_e,tt):null}function findPart(et,_e,tt){if(et)for(let rt=et.length;rt--;){const nt=et[rt];if(nt.index===tt&&nt.fragment.sn===_e)return nt}return null}function reassignFragmentLevelIndexes(et){et.forEach((_e,tt)=>{const{details:rt}=_e;rt!=null&&rt.fragments&&rt.fragments.forEach(nt=>{nt.level=tt})})}function isTimeoutError(et){switch(et.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(et,_e){const tt=isTimeoutError(_e);return et.default[`${tt?"timeout":"error"}Retry`]}function getRetryDelay(et,_e){const tt=et.backoff==="linear"?1:Math.pow(2,_e);return Math.min(tt*et.retryDelayMs,et.maxRetryDelayMs)}function getLoaderConfigWithoutReties(et){return _objectSpread2(_objectSpread2({},et),{errorRetry:null,timeoutRetry:null})}function shouldRetry(et,_e,tt,rt){if(!et)return!1;const nt=rt==null?void 0:rt.code,it=_e<et.maxNumRetry&&(retryForHttpStatus(nt)||!!tt);return et.shouldRetry?et.shouldRetry(et,_e,tt,rt,it):it}function retryForHttpStatus(et){return et===0&&navigator.onLine===!1||!!et&&(et<400||et>499)}const BinarySearch={search:function(et,_e){let tt=0,rt=et.length-1,nt=null,it=null;for(;tt<=rt;){nt=(tt+rt)/2|0,it=et[nt];const st=_e(it);if(st>0)tt=nt+1;else if(st<0)rt=nt-1;else return it}return null}};function findFragmentByPDT(et,_e,tt){if(_e===null||!Array.isArray(et)||!et.length||!isFiniteNumber(_e))return null;const rt=et[0].programDateTime;if(_e<(rt||0))return null;const nt=et[et.length-1].endProgramDateTime;if(_e>=(nt||0))return null;tt=tt||0;for(let it=0;it<et.length;++it){const st=et[it];if(pdtWithinToleranceTest(_e,tt,st))return st}return null}function findFragmentByPTS(et,_e,tt=0,rt=0){let nt=null;if(et){nt=_e[et.sn-_e[0].sn+1]||null;const st=et.endDTS-tt;st>0&&st<15e-7&&(tt+=15e-7)}else tt===0&&_e[0].start===0&&(nt=_e[0]);if(nt&&(!et||et.level===nt.level)&&fragmentWithinToleranceTest(tt,rt,nt)===0)return nt;const it=BinarySearch.search(_e,fragmentWithinToleranceTest.bind(null,tt,rt));return it&&(it!==et||!nt)?it:nt}function fragmentWithinToleranceTest(et=0,_e=0,tt){if(tt.start<=et&&tt.start+tt.duration>et)return 0;const rt=Math.min(_e,tt.duration+(tt.deltaPTS?tt.deltaPTS:0));return tt.start+tt.duration-rt<=et?1:tt.start-rt>et&&tt.start?-1:0}function pdtWithinToleranceTest(et,_e,tt){const rt=Math.min(_e,tt.duration+(tt.deltaPTS?tt.deltaPTS:0))*1e3;return(tt.endProgramDateTime||0)-rt>et}function findFragWithCC(et,_e){return BinarySearch.search(et,tt=>tt.cc<_e?1:tt.cc>_e?-1:0)}var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(_e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=_e,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const _e=this.hls;_e.on(Events.ERROR,this.onError,this),_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const _e=this.hls;_e&&(_e.off(Events.ERROR,this.onError,this),_e.off(Events.ERROR,this.onErrorOut,this),_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(_e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(_e){return(_e==null?void 0:_e.type)===PlaylistLevelType.MAIN?_e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(_e,tt){var rt,nt;if(tt.fatal)return;const it=this.hls,st=tt.context;switch(tt.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:tt.errorAction=this.getFragRetryOrSwitchAction(tt);return;case ErrorDetails.FRAG_PARSING_ERROR:if((rt=tt.frag)!=null&&rt.gap){tt.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{tt.errorAction=this.getFragRetryOrSwitchAction(tt),tt.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var ot,at;const lt=tt.parent===PlaylistLevelType.MAIN?tt.level:it.loadLevel;tt.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((ot=tt.context)!=null&&(at=ot.levelDetails)!=null&&at.live)?tt.errorAction=this.getPlaylistRetryOrSwitchAction(tt,lt):(tt.levelRetry=!1,tt.errorAction=this.getLevelSwitchAction(tt,lt))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(st==null?void 0:st.level)=="number"&&(tt.errorAction=this.getPlaylistRetryOrSwitchAction(tt,st.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(st){const lt=it.levels[it.loadLevel];if(lt&&(st.type===PlaylistContextType.AUDIO_TRACK&&lt.hasAudioGroup(st.groupId)||st.type===PlaylistContextType.SUBTITLE_TRACK&&lt.hasSubtitleGroup(st.groupId))){tt.errorAction=this.getPlaylistRetryOrSwitchAction(tt,it.loadLevel),tt.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,tt.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const lt=it.levels[it.loadLevel],ut=lt==null?void 0:lt.attrs["HDCP-LEVEL"];ut?tt.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:ut}:this.keySystemError(tt)}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:tt.errorAction=this.getLevelSwitchAction(tt,(nt=tt.level)!=null?nt:it.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:tt.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}tt.type===ErrorTypes.KEY_SYSTEM_ERROR&&this.keySystemError(tt)}keySystemError(_e){const tt=this.getVariantLevelIndex(_e.frag);_e.levelRetry=!1,_e.errorAction=this.getLevelSwitchAction(_e,tt)}getPlaylistRetryOrSwitchAction(_e,tt){const rt=this.hls,nt=getRetryConfig(rt.config.playlistLoadPolicy,_e),it=this.playlistError++;if(shouldRetry(nt,it,isTimeoutError(_e),_e.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:nt,retryCount:it};const ot=this.getLevelSwitchAction(_e,tt);return nt&&(ot.retryConfig=nt,ot.retryCount=it),ot}getFragRetryOrSwitchAction(_e){const tt=this.hls,rt=this.getVariantLevelIndex(_e.frag),nt=tt.levels[rt],{fragLoadPolicy:it,keyLoadPolicy:st}=tt.config,ot=getRetryConfig(_e.details.startsWith("key")?st:it,_e),at=tt.levels.reduce((ut,ct)=>ut+ct.fragmentError,0);if(nt&&(_e.details!==ErrorDetails.FRAG_GAP&&nt.fragmentError++,shouldRetry(ot,at,isTimeoutError(_e),_e.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:ot,retryCount:at};const lt=this.getLevelSwitchAction(_e,rt);return ot&&(lt.retryConfig=ot,lt.retryCount=at),lt}getLevelSwitchAction(_e,tt){const rt=this.hls;tt==null&&(tt=rt.loadLevel);const nt=this.hls.levels[tt];if(nt){var it,st;const lt=_e.details;nt.loadError++,lt===ErrorDetails.BUFFER_APPEND_ERROR&&nt.fragmentError++;let ut=-1;const{levels:ct,loadLevel:dt,minAutoLevel:ft,maxAutoLevel:pt}=rt;rt.autoLevelEnabled||(rt.loadLevel=-1);const mt=(it=_e.frag)==null?void 0:it.type,gt=(mt===PlaylistLevelType.AUDIO&&lt===ErrorDetails.FRAG_PARSING_ERROR||_e.sourceBufferName==="audio"&&(lt===ErrorDetails.BUFFER_ADD_CODEC_ERROR||lt===ErrorDetails.BUFFER_APPEND_ERROR))&&ct.some(({audioCodec:_t})=>nt.audioCodec!==_t),yt=_e.sourceBufferName==="video"&&(lt===ErrorDetails.BUFFER_ADD_CODEC_ERROR||lt===ErrorDetails.BUFFER_APPEND_ERROR)&&ct.some(({codecSet:_t,audioCodec:wt})=>nt.codecSet!==_t&&nt.audioCodec===wt),{type:bt,groupId:xt}=(st=_e.context)!=null?st:{};for(let _t=ct.length;_t--;){const wt=(_t+dt)%ct.length;if(wt!==dt&&wt>=ft&&wt<=pt&&ct[wt].loadError===0){var ot,at;const Ct=ct[wt];if(lt===ErrorDetails.FRAG_GAP&&_e.frag){const kt=ct[wt].details;if(kt){const At=findFragmentByPTS(_e.frag,kt.fragments,_e.frag.start);if(At!=null&&At.gap)continue}}else{if(bt===PlaylistContextType.AUDIO_TRACK&&Ct.hasAudioGroup(xt)||bt===PlaylistContextType.SUBTITLE_TRACK&&Ct.hasSubtitleGroup(xt))continue;if(mt===PlaylistLevelType.AUDIO&&(ot=nt.audioGroups)!=null&&ot.some(kt=>Ct.hasAudioGroup(kt))||mt===PlaylistLevelType.SUBTITLE&&(at=nt.subtitleGroups)!=null&&at.some(kt=>Ct.hasSubtitleGroup(kt))||gt&&nt.audioCodec===Ct.audioCodec||!gt&&nt.audioCodec!==Ct.audioCodec||yt&&nt.codecSet===Ct.codecSet)continue}ut=wt;break}}if(ut>-1&&rt.loadLevel!==ut)return _e.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:ut}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(_e,tt){var rt;switch((rt=tt.errorAction)==null?void 0:rt.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(tt),!tt.errorAction.resolved&&tt.details!==ErrorDetails.FRAG_GAP?tt.fatal=!0:/MediaSource readyState: ended/.test(tt.error.message)&&(this.warn(`MediaSource ended after "${tt.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(tt.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(_e){const tt=this.hls,rt=_e.errorAction;if(!rt)return;const{flags:nt,hdcpLevel:it,nextAutoLevel:st}=rt;switch(nt){case ErrorActionFlags.None:this.switchLevel(_e,st);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:it&&(tt.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(it)-1],rt.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${tt.maxHdcpLevel}" or lower`);break}rt.resolved||this.switchLevel(_e,st)}switchLevel(_e,tt){tt!==void 0&&_e.errorAction&&(this.warn(`switching to level ${tt} after ${_e.details}`),this.hls.nextAutoLevel=tt,_e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class BasePlaylistController{constructor(_e,tt){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${tt}:`),this.warn=logger.warn.bind(logger,`${tt}:`),this.hls=_e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(_e,tt){const rt=tt==null?void 0:tt.renditionReports;if(rt){let nt=-1;for(let it=0;it<rt.length;it++){const st=rt[it];let ot;try{ot=new self.URL(st.URI,tt.url).href}catch(at){logger.warn(`Could not construct new URL for Rendition Report: ${at}`),ot=st.URI||""}if(ot===_e){nt=it;break}else ot===_e.substring(0,ot.length)&&(nt=it)}if(nt!==-1){const it=rt[nt],st=parseInt(it["LAST-MSN"])||(tt==null?void 0:tt.lastPartSn);let ot=parseInt(it["LAST-PART"])||(tt==null?void 0:tt.lastPartIndex);if(this.hls.config.lowLatencyMode){const at=Math.min(tt.age-tt.partTarget,tt.targetduration);ot>=0&&at>tt.partTarget&&(ot+=1)}return new HlsUrlParameters(st,ot>=0?ot:void 0,HlsSkip.No)}}}loadPlaylist(_e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(_e){return this.canLoad&&!!_e&&!!_e.url&&(!_e.details||_e.details.live)}shouldReloadPlaylist(_e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(_e)}playlistLoaded(_e,tt,rt){const{details:nt,stats:it}=tt,st=self.performance.now(),ot=it.loading.first?Math.max(0,st-it.loading.first):0;if(nt.advancedDateTime=Date.now()-ot,nt.live||rt!=null&&rt.live){if(nt.reloaded(rt),rt&&this.log(`live playlist ${_e} ${nt.advanced?"REFRESHED "+nt.lastPartSn+"-"+nt.lastPartIndex:nt.updated?"UPDATED":"MISSED"}`),rt&&nt.fragments.length>0&&mergeDetails(rt,nt),!this.canLoad||!nt.live)return;let at,lt,ut;if(nt.canBlockReload&&nt.endSN&&nt.advanced){const ht=this.hls.config.lowLatencyMode,gt=nt.lastPartSn,vt=nt.endSN,yt=nt.lastPartIndex,bt=yt!==-1,xt=gt===vt,_t=ht?0:yt;bt?(lt=xt?vt+1:gt,ut=xt?_t:yt+1):lt=vt+1;const wt=nt.age,Ct=wt+nt.ageHeader;let kt=Math.min(Ct-nt.partTarget,nt.targetduration*1.5);if(kt>0){if(rt&&kt>rt.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${rt.tuneInGoal} to: ${kt} with playlist age: ${nt.age}`),kt=0;else{const At=Math.floor(kt/nt.targetduration);if(lt+=At,ut!==void 0){const $t=Math.round(kt%nt.targetduration/nt.partTarget);ut+=$t}this.log(`CDN Tune-in age: ${nt.ageHeader}s last advanced ${wt.toFixed(2)}s goal: ${kt} skip sn ${At} to part ${ut}`)}nt.tuneInGoal=kt}if(at=this.getDeliveryDirectives(nt,tt.deliveryDirectives,lt,ut),ht||!xt){this.loadPlaylist(at);return}}else(nt.canBlockReload||nt.canSkipUntil)&&(at=this.getDeliveryDirectives(nt,tt.deliveryDirectives,lt,ut));const ct=this.hls.mainForwardBufferInfo,dt=ct?ct.end-ct.len:0,ft=(nt.edge-dt)*1e3,pt=computeReloadInterval(nt,ft);nt.updated&&st>this.requestScheduled+pt&&(this.requestScheduled=it.loading.start),lt!==void 0&&nt.canBlockReload?this.requestScheduled=it.loading.first+pt-(nt.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+pt<st?this.requestScheduled=st:this.requestScheduled-st<=0&&(this.requestScheduled+=pt);let mt=this.requestScheduled-st;mt=Math.max(0,mt),this.log(`reload live playlist ${_e} in ${Math.round(mt)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(at),mt)}else this.clearTimer()}getDeliveryDirectives(_e,tt,rt,nt){let it=getSkipValue(_e,rt);return tt!=null&&tt.skip&&_e.deltaUpdateFailed&&(rt=tt.msn,nt=tt.part,it=HlsSkip.No),new HlsUrlParameters(rt,nt,it)}checkRetry(_e){const tt=_e.details,rt=isTimeoutError(_e),nt=_e.errorAction,{action:it,retryCount:st=0,retryConfig:ot}=nt||{},at=!!nt&&!!ot&&(it===NetworkErrorAction.RetryRequest||!nt.resolved&&it===NetworkErrorAction.SendAlternateToPenaltyBox);if(at){var lt;if(this.requestScheduled=-1,st>=ot.maxNumRetry)return!1;if(rt&&(lt=_e.context)!=null&&lt.deliveryDirectives)this.warn(`Retrying playlist loading ${st+1}/${ot.maxNumRetry} after "${tt}" without delivery-directives`),this.loadPlaylist();else{const ut=getRetryDelay(ot,st);this.timer=self.setTimeout(()=>this.loadPlaylist(),ut),this.warn(`Retrying playlist loading ${st+1}/${ot.maxNumRetry} after "${tt}" in ${ut}ms`)}_e.levelRetry=!0,nt.resolved=!0}return at}}class EWMA{constructor(_e,tt=0,rt=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=_e,this.alpha_=_e?Math.exp(Math.log(.5)/_e):0,this.estimate_=tt,this.totalWeight_=rt}sample(_e,tt){const rt=Math.pow(this.alpha_,_e);this.estimate_=tt*(1-rt)+rt*this.estimate_,this.totalWeight_+=_e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const _e=1-Math.pow(this.alpha_,this.totalWeight_);if(_e)return this.estimate_/_e}return this.estimate_}}class EwmaBandWidthEstimator{constructor(_e,tt,rt,nt=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=rt,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(_e),this.fast_=new EWMA(tt),this.defaultTTFB_=nt,this.ttfb_=new EWMA(_e)}update(_e,tt){const{slow_:rt,fast_:nt,ttfb_:it}=this;rt.halfLife!==_e&&(this.slow_=new EWMA(_e,rt.getEstimate(),rt.getTotalWeight())),nt.halfLife!==tt&&(this.fast_=new EWMA(tt,nt.getEstimate(),nt.getTotalWeight())),it.halfLife!==_e&&(this.ttfb_=new EWMA(_e,it.getEstimate(),it.getTotalWeight()))}sample(_e,tt){_e=Math.max(_e,this.minDelayMs_);const rt=8*tt,nt=_e/1e3,it=rt/nt;this.fast_.sample(nt,it),this.slow_.sample(nt,it)}sampleTTFB(_e){const tt=_e/1e3,rt=Math.sqrt(2)*Math.exp(-Math.pow(tt,2)/2);this.ttfb_.sample(rt,Math.max(_e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},SUPPORTED_INFO_CACHE={};function requiresMediaCapabilitiesDecodingInfo(et,_e,tt,rt,nt,it){const st=et.audioCodec?et.audioGroups:null,ot=it==null?void 0:it.audioCodec,at=it==null?void 0:it.channels,lt=at?parseInt(at):ot?1/0:2;let ut=null;if(st!=null&&st.length)try{st.length===1&&st[0]?ut=_e.groups[st[0]].channels:ut=st.reduce((ct,dt)=>{if(dt){const ft=_e.groups[dt];if(!ft)throw new Error(`Audio track group ${dt} not found`);Object.keys(ft.channels).forEach(pt=>{ct[pt]=(ct[pt]||0)+ft.channels[pt]})}return ct},{2:0})}catch{return!0}return et.videoCodec!==void 0&&(et.width>1920&&et.height>1088||et.height>1920&&et.width>1088||et.frameRate>Math.max(rt,30)||et.videoRange!=="SDR"&&et.videoRange!==tt||et.bitrate>Math.max(nt,8e6))||!!ut&&isFiniteNumber(lt)&&Object.keys(ut).some(ct=>parseInt(ct)>lt)}function getMediaDecodingInfoPromise(et,_e,tt){const rt=et.videoCodec,nt=et.audioCodec;if(!rt||!nt||!tt)return Promise.resolve(SUPPORTED_INFO_DEFAULT);const it={width:et.width,height:et.height,bitrate:Math.ceil(Math.max(et.bitrate*.9,et.averageBitrate)),framerate:et.frameRate||30},st=et.videoRange;st!=="SDR"&&(it.transferFunction=st.toLowerCase());const ot=rt.split(",").map(at=>({type:"media-source",video:_objectSpread2(_objectSpread2({},it),{},{contentType:mimeTypeForCodec(at,"video")})}));return nt&&et.audioGroups&&et.audioGroups.forEach(at=>{var lt;at&&((lt=_e.groups[at])==null||lt.tracks.forEach(ut=>{if(ut.groupId===at){const ct=ut.channels||"",dt=parseFloat(ct);isFiniteNumber(dt)&&dt>2&&ot.push.apply(ot,nt.split(",").map(ft=>({type:"media-source",audio:{contentType:mimeTypeForCodec(ft,"audio"),channels:""+dt}})))}}))}),Promise.all(ot.map(at=>{const lt=getMediaDecodingInfoKey(at);return SUPPORTED_INFO_CACHE[lt]||(SUPPORTED_INFO_CACHE[lt]=tt.decodingInfo(at))})).then(at=>({supported:!at.some(lt=>!lt.supported),configurations:ot,decodingInfoResults:at})).catch(at=>({supported:!1,configurations:ot,decodingInfoResults:[],error:at}))}function getMediaDecodingInfoKey(et){const{audio:_e,video:tt}=et,rt=tt||_e;if(rt){const nt=rt.contentType.split('"')[1];if(tt)return`r${tt.height}x${tt.width}f${Math.ceil(tt.framerate)}${tt.transferFunction||"sd"}_${nt}_${Math.ceil(tt.bitrate/1e5)}`;if(_e)return`c${_e.channels}${_e.spatialRendering?"s":"n"}_${nt}`}return""}function isHdrSupported(){if(typeof matchMedia=="function"){const et=matchMedia("(dynamic-range: high)"),_e=matchMedia("bad query");if(et.media!==_e.media)return et.matches===!0}return!1}function getVideoSelectionOptions(et,_e){let tt=!1,rt=[];return et&&(tt=et!=="SDR",rt=[et]),_e&&(rt=_e.allowedVideoRanges||VideoRangeValues.slice(0),tt=_e.preferHDR!==void 0?_e.preferHDR:isHdrSupported(),tt?rt=rt.filter(nt=>nt!=="SDR"):rt=["SDR"]),{preferHDR:tt,allowedVideoRanges:rt}}function getStartCodecTier(et,_e,tt,rt,nt){const it=Object.keys(et),st=rt==null?void 0:rt.channels,ot=rt==null?void 0:rt.audioCodec,at=st&&parseInt(st)===2;let lt=!0,ut=!1,ct=1/0,dt=1/0,ft=1/0,pt=0,mt=[];const{preferHDR:ht,allowedVideoRanges:gt}=getVideoSelectionOptions(_e,nt);for(let xt=it.length;xt--;){const _t=et[it[xt]];lt=_t.channels[2]>0,ct=Math.min(ct,_t.minHeight),dt=Math.min(dt,_t.minFramerate),ft=Math.min(ft,_t.minBitrate);const wt=gt.filter(Ct=>_t.videoRanges[Ct]>0);wt.length>0&&(ut=!0,mt=wt)}ct=isFiniteNumber(ct)?ct:0,dt=isFiniteNumber(dt)?dt:0;const vt=Math.max(1080,ct),yt=Math.max(30,dt);return ft=isFiniteNumber(ft)?ft:tt,tt=Math.max(ft,tt),ut||(_e=void 0,mt=[]),{codecSet:it.reduce((xt,_t)=>{const wt=et[_t];if(_t===xt)return xt;if(wt.minBitrate>tt)return logStartCodecCandidateIgnored(_t,`min bitrate of ${wt.minBitrate} > current estimate of ${tt}`),xt;if(!wt.hasDefaultAudio)return logStartCodecCandidateIgnored(_t,"no renditions with default or auto-select sound found"),xt;if(ot&&_t.indexOf(ot.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(_t,`audio codec preference "${ot}" not found`),xt;if(st&&!at){if(!wt.channels[st])return logStartCodecCandidateIgnored(_t,`no renditions with ${st} channel sound found (channels options: ${Object.keys(wt.channels)})`),xt}else if((!ot||at)&&lt&&wt.channels[2]===0)return logStartCodecCandidateIgnored(_t,"no renditions with stereo sound found"),xt;return wt.minHeight>vt?(logStartCodecCandidateIgnored(_t,`min resolution of ${wt.minHeight} > maximum of ${vt}`),xt):wt.minFramerate>yt?(logStartCodecCandidateIgnored(_t,`min framerate of ${wt.minFramerate} > maximum of ${yt}`),xt):mt.some(Ct=>wt.videoRanges[Ct]>0)?wt.maxScore<pt?(logStartCodecCandidateIgnored(_t,`max score of ${wt.maxScore} < selected max of ${pt}`),xt):xt&&(codecsSetSelectionPreferenceValue(_t)>=codecsSetSelectionPreferenceValue(xt)||wt.fragmentError>et[xt].fragmentError)?xt:(pt=wt.maxScore,_t):(logStartCodecCandidateIgnored(_t,`no variants with VIDEO-RANGE of ${JSON.stringify(mt)} found`),xt)},void 0),videoRanges:mt,preferHDR:ht,minFramerate:dt,minBitrate:ft}}function logStartCodecCandidateIgnored(et,_e){logger.log(`[abr] start candidates with "${et}" ignored because ${_e}`)}function getAudioTracksByGroup(et){return et.reduce((_e,tt)=>{let rt=_e.groups[tt.groupId];rt||(rt=_e.groups[tt.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),rt.tracks.push(tt);const nt=tt.channels||"2";return rt.channels[nt]=(rt.channels[nt]||0)+1,rt.hasDefault=rt.hasDefault||tt.default,rt.hasAutoSelect=rt.hasAutoSelect||tt.autoselect,rt.hasDefault&&(_e.hasDefaultAudio=!0),rt.hasAutoSelect&&(_e.hasAutoSelectAudio=!0),_e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(et,_e,tt,rt){return et.slice(tt,rt+1).reduce((nt,it)=>{if(!it.codecSet)return nt;const st=it.audioGroups;let ot=nt[it.codecSet];ot||(nt[it.codecSet]=ot={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!st,fragmentError:0}),ot.minBitrate=Math.min(ot.minBitrate,it.bitrate);const at=Math.min(it.height,it.width);return ot.minHeight=Math.min(ot.minHeight,at),ot.minFramerate=Math.min(ot.minFramerate,it.frameRate),ot.maxScore=Math.max(ot.maxScore,it.score),ot.fragmentError+=it.fragmentError,ot.videoRanges[it.videoRange]=(ot.videoRanges[it.videoRange]||0)+1,st&&st.forEach(lt=>{if(!lt)return;const ut=_e.groups[lt];ot.hasDefaultAudio=ot.hasDefaultAudio||_e.hasDefaultAudio?ut.hasDefault:ut.hasAutoSelect||!_e.hasDefaultAudio&&!_e.hasAutoSelectAudio,Object.keys(ut.channels).forEach(ct=>{ot.channels[ct]=(ot.channels[ct]||0)+ut.channels[ct]})}),nt},{})}function findMatchingOption(et,_e,tt){if("attrs"in et){const rt=_e.indexOf(et);if(rt!==-1)return rt}for(let rt=0;rt<_e.length;rt++){const nt=_e[rt];if(matchesOption(et,nt,tt))return rt}return-1}function matchesOption(et,_e,tt){const{groupId:rt,name:nt,lang:it,assocLang:st,characteristics:ot,default:at}=et,lt=et.forced;return(rt===void 0||_e.groupId===rt)&&(nt===void 0||_e.name===nt)&&(it===void 0||_e.lang===it)&&(it===void 0||_e.assocLang===st)&&(at===void 0||_e.default===at)&&(lt===void 0||_e.forced===lt)&&(ot===void 0||characteristicsMatch(ot,_e.characteristics))&&(tt===void 0||tt(et,_e))}function characteristicsMatch(et,_e=""){const tt=et.split(","),rt=_e.split(",");return tt.length===rt.length&&!tt.some(nt=>rt.indexOf(nt)===-1)}function audioMatchPredicate(et,_e){const{audioCodec:tt,channels:rt}=et;return(tt===void 0||(_e.audioCodec||"").substring(0,4)===tt.substring(0,4))&&(rt===void 0||rt===(_e.channels||"2"))}function findClosestLevelWithAudioGroup(et,_e,tt,rt,nt){const it=_e[rt],ot=_e.reduce((dt,ft,pt)=>{const mt=ft.uri;return(dt[mt]||(dt[mt]=[])).push(pt),dt},{})[it.uri];ot.length>1&&(rt=Math.max.apply(Math,ot));const at=it.videoRange,lt=it.frameRate,ut=it.codecSet.substring(0,4),ct=searchDownAndUpList(_e,rt,dt=>{if(dt.videoRange!==at||dt.frameRate!==lt||dt.codecSet.substring(0,4)!==ut)return!1;const ft=dt.audioGroups,pt=tt.filter(mt=>!ft||ft.indexOf(mt.groupId)!==-1);return findMatchingOption(et,pt,nt)>-1});return ct>-1?ct:searchDownAndUpList(_e,rt,dt=>{const ft=dt.audioGroups,pt=tt.filter(mt=>!ft||ft.indexOf(mt.groupId)!==-1);return findMatchingOption(et,pt,nt)>-1})}function searchDownAndUpList(et,_e,tt){for(let rt=_e;rt;rt--)if(tt(et[rt]))return rt;for(let rt=_e+1;rt<et.length;rt++)if(tt(et[rt]))return rt;return-1}class AbrController{constructor(_e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:tt,partCurrent:rt,hls:nt}=this,{autoLevelEnabled:it,media:st}=nt;if(!tt||!st)return;const ot=performance.now(),at=rt?rt.stats:tt.stats,lt=rt?rt.duration:tt.duration,ut=ot-at.loading.start,ct=nt.minAutoLevel;if(at.aborted||at.loaded&&at.loaded===at.total||tt.level<=ct){this.clearTimer(),this._nextAutoLevel=-1;return}if(!it||st.paused||!st.playbackRate||!st.readyState)return;const dt=nt.mainForwardBufferInfo;if(dt===null)return;const ft=this.bwEstimator.getEstimateTTFB(),pt=Math.abs(st.playbackRate);if(ut<=Math.max(ft,1e3*(lt/(pt*2))))return;const mt=dt.len/pt,ht=at.loading.first?at.loading.first-at.loading.start:-1,gt=at.loaded&&ht>-1,vt=this.getBwEstimate(),yt=nt.levels,bt=yt[tt.level],xt=at.total||Math.max(at.loaded,Math.round(lt*bt.averageBitrate/8));let _t=gt?ut-ht:ut;_t<1&&gt&&(_t=Math.min(ut,at.loaded*8/vt));const wt=gt?at.loaded*1e3/_t:0,Ct=wt?(xt-at.loaded)/wt:xt*8/vt+ft/1e3;if(Ct<=mt)return;const kt=wt?wt*8:vt;let At=Number.POSITIVE_INFINITY,$t;for($t=tt.level-1;$t>ct;$t--){const Mt=yt[$t].maxBitrate;if(At=this.getTimeToLoadFrag(ft/1e3,kt,lt*Mt,!yt[$t].details),At<mt)break}if(At>=Ct||At>lt*10)return;nt.nextLoadLevel=nt.nextAutoLevel=$t,gt?this.bwEstimator.sample(ut-Math.min(ft,ht),at.loaded):this.bwEstimator.sampleTTFB(ut);const Lt=yt[$t].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>Lt&&this.resetEstimator(Lt),this.clearTimer(),logger.warn(`[abr] Fragment ${tt.sn}${rt?" part "+rt.index:""} of level ${tt.level} is loading too slowly;
      Time to underbuffer: ${mt.toFixed(3)} s
      Estimated load time for current fragment: ${Ct.toFixed(3)} s
      Estimated load time for down switch fragment: ${At.toFixed(3)} s
      TTFB estimate: ${ht|0} ms
      Current BW estimate: ${isFiniteNumber(vt)?vt|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${$t} @ ${Lt|0} bps`),nt.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:tt,part:rt,stats:at})},this.hls=_e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(_e){_e&&(logger.log(`setting initial bwe to ${_e}`),this.hls.config.abrEwmaDefaultEstimate=_e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const _e=this.hls.config;return new EwmaBandWidthEstimator(_e.abrEwmaSlowVoD,_e.abrEwmaFastVoD,_e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:_e}=this;_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.FRAG_LOADING,this.onFragLoading,this),_e.on(Events.FRAG_LOADED,this.onFragLoaded,this),_e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),_e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),_e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_e.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),_e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:_e}=this;_e&&(_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.FRAG_LOADING,this.onFragLoading,this),_e.off(Events.FRAG_LOADED,this.onFragLoaded,this),_e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),_e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),_e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_e.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),_e.off(Events.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(_e,tt){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(_e,tt){const rt=tt.frag;if(!this.ignoreFragment(rt)){if(!rt.bitrateTest){var nt;this.fragCurrent=rt,this.partCurrent=(nt=tt.part)!=null?nt:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(_e,tt){this.clearTimer()}onError(_e,tt){if(!tt.fatal)switch(tt.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:{const rt=tt.frag,{fragCurrent:nt,partCurrent:it}=this;if(rt&&nt&&rt.sn===nt.sn&&rt.level===nt.level){const st=performance.now(),ot=it?it.stats:rt.stats,at=st-ot.loading.start,lt=ot.loading.first?ot.loading.first-ot.loading.start:-1;if(ot.loaded&&lt>-1){const ct=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(at-Math.min(ct,lt),ot.loaded)}else this.bwEstimator.sampleTTFB(at)}break}}}getTimeToLoadFrag(_e,tt,rt,nt){const it=_e+rt/tt,st=nt?this.lastLevelLoadSec:0;return it+st}onLevelLoaded(_e,tt){const rt=this.hls.config,{loading:nt}=tt.stats,it=nt.end-nt.start;isFiniteNumber(it)&&(this.lastLevelLoadSec=it/1e3),tt.details.live?this.bwEstimator.update(rt.abrEwmaSlowLive,rt.abrEwmaFastLive):this.bwEstimator.update(rt.abrEwmaSlowVoD,rt.abrEwmaFastVoD)}onFragLoaded(_e,{frag:tt,part:rt}){const nt=rt?rt.stats:tt.stats;if(tt.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(nt.loading.first-nt.loading.start),!this.ignoreFragment(tt)){if(this.clearTimer(),tt.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const it=rt?rt.duration:tt.duration,st=this.hls.levels[tt.level],ot=(st.loaded?st.loaded.bytes:0)+nt.loaded,at=(st.loaded?st.loaded.duration:0)+it;st.loaded={bytes:ot,duration:at},st.realBitrate=Math.round(8*ot/at)}if(tt.bitrateTest){const it={stats:nt,frag:tt,part:rt,id:tt.type};this.onFragBuffered(Events.FRAG_BUFFERED,it),tt.bitrateTest=!1}else this.lastLoadedFragLevel=tt.level}}onFragBuffered(_e,tt){const{frag:rt,part:nt}=tt,it=nt!=null&&nt.stats.loaded?nt.stats:rt.stats;if(it.aborted||this.ignoreFragment(rt))return;const st=it.parsing.end-it.loading.start-Math.min(it.loading.first-it.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(st,it.loaded),it.bwEstimate=this.getBwEstimate(),rt.bitrateTest?this.bitrateTestDelay=st/1e3:this.bitrateTestDelay=0}ignoreFragment(_e){return _e.type!==PlaylistLevelType.MAIN||_e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:_e,minAutoLevel:tt}=this.hls,rt=this.getBwEstimate(),nt=this.hls.config.maxStarvationDelay,it=this.findBestLevel(rt,tt,_e,0,nt,1,1);if(it>-1)return it;const st=this.hls.firstLevel,ot=Math.min(Math.max(st,tt),_e);return logger.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${st} clamped to ${ot}`),ot}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const _e=this.forcedAutoLevel,rt=this.bwEstimator.canEstimate(),nt=this.lastLoadedFragLevel>-1;if(_e!==-1&&(!rt||!nt||this.nextAutoLevelKey===this.getAutoLevelKey()))return _e;const it=rt&&nt?this.getNextABRAutoLevel():this.firstAutoLevel;if(_e!==-1){const st=this.hls.levels;if(st.length>Math.max(_e,it)&&st[_e].loadError<=st[it].loadError)return _e}return this._nextAutoLevel=it,this.nextAutoLevelKey=this.getAutoLevelKey(),it}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:_e,partCurrent:tt,hls:rt}=this,{maxAutoLevel:nt,config:it,minAutoLevel:st}=rt,ot=tt?tt.duration:_e?_e.duration:0,at=this.getBwEstimate(),lt=this.getStarvationDelay();let ut=it.abrBandWidthFactor,ct=it.abrBandWidthUpFactor;if(lt){const ht=this.findBestLevel(at,st,nt,lt,0,ut,ct);if(ht>=0)return ht}let dt=ot?Math.min(ot,it.maxStarvationDelay):it.maxStarvationDelay;if(!lt){const ht=this.bitrateTestDelay;ht&&(dt=(ot?Math.min(ot,it.maxLoadingDelay):it.maxLoadingDelay)-ht,logger.info(`[abr] bitrate test took ${Math.round(1e3*ht)}ms, set first fragment max fetchDuration to ${Math.round(1e3*dt)} ms`),ut=ct=1)}const ft=this.findBestLevel(at,st,nt,lt,dt,ut,ct);if(logger.info(`[abr] ${lt?"rebuffering expected":"buffer is empty"}, optimal quality level ${ft}`),ft>-1)return ft;const pt=rt.levels[st],mt=rt.levels[rt.loadLevel];return(pt==null?void 0:pt.bitrate)<(mt==null?void 0:mt.bitrate)?st:rt.loadLevel}getStarvationDelay(){const _e=this.hls,tt=_e.media;if(!tt)return 1/0;const rt=tt&&tt.playbackRate!==0?Math.abs(tt.playbackRate):1,nt=_e.mainForwardBufferInfo;return(nt?nt.len:0)/rt}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(_e,tt,rt,nt,it,st,ot){var at;const lt=nt+it,ut=this.lastLoadedFragLevel,ct=ut===-1?this.hls.firstLevel:ut,{fragCurrent:dt,partCurrent:ft}=this,{levels:pt,allAudioTracks:mt,loadLevel:ht,config:gt}=this.hls;if(pt.length===1)return 0;const vt=pt[ct],yt=!!(vt!=null&&(at=vt.details)!=null&&at.live),bt=ht===-1||ut===-1;let xt,_t="SDR",wt=(vt==null?void 0:vt.frameRate)||0;const{audioPreference:Ct,videoPreference:kt}=gt,At=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(mt));if(bt){if(this.firstSelection!==-1)return this.firstSelection;const Pt=this.codecTiers||(this.codecTiers=getCodecTiers(pt,At,tt,rt)),Nt=getStartCodecTier(Pt,_t,_e,Ct,kt),{codecSet:It,videoRanges:Ft,minFramerate:Ut,minBitrate:Ht,preferHDR:jt}=Nt;xt=It,_t=jt?Ft[Ft.length-1]:Ft[0],wt=Ut,_e=Math.max(_e,Ht),logger.log(`[abr] picked start tier ${JSON.stringify(Nt)}`)}else xt=vt==null?void 0:vt.codecSet,_t=vt==null?void 0:vt.videoRange;const $t=ft?ft.duration:dt?dt.duration:0,Lt=this.bwEstimator.getEstimateTTFB()/1e3,Mt=[];for(let Pt=rt;Pt>=tt;Pt--){var Bt;const Nt=pt[Pt],It=Pt>ct;if(!Nt)continue;if(gt.useMediaCapabilities&&!Nt.supportedResult&&!Nt.supportedPromise){const Yt=navigator.mediaCapabilities;typeof(Yt==null?void 0:Yt.decodingInfo)=="function"&&requiresMediaCapabilitiesDecodingInfo(Nt,At,_t,wt,_e,Ct)?(Nt.supportedPromise=getMediaDecodingInfoPromise(Nt,At,Yt),Nt.supportedPromise.then(Jt=>{if(!this.hls)return;Nt.supportedResult=Jt;const rr=this.hls.levels,qt=rr.indexOf(Nt);Jt.error?logger.warn(`[abr] MediaCapabilities decodingInfo error: "${Jt.error}" for level ${qt} ${JSON.stringify(Jt)}`):Jt.supported||(logger.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${qt} ${JSON.stringify(Jt)}`),qt>-1&&rr.length>1&&(logger.log(`[abr] Removing unsupported level ${qt}`),this.hls.removeLevel(qt)))})):Nt.supportedResult=SUPPORTED_INFO_DEFAULT}if(xt&&Nt.codecSet!==xt||_t&&Nt.videoRange!==_t||It&&wt>Nt.frameRate||!It&&wt>0&&wt<Nt.frameRate||Nt.supportedResult&&!((Bt=Nt.supportedResult.decodingInfoResults)!=null&&Bt[0].smooth)){Mt.push(Pt);continue}const Ft=Nt.details,Ut=(ft?Ft==null?void 0:Ft.partTarget:Ft==null?void 0:Ft.averagetargetduration)||$t;let Ht;It?Ht=ot*_e:Ht=st*_e;const jt=$t&&nt>=$t*2&&it===0?pt[Pt].averageBitrate:pt[Pt].maxBitrate,Gt=this.getTimeToLoadFrag(Lt,Ht,jt*Ut,Ft===void 0);if(Ht>=jt&&(Pt===ut||Nt.loadError===0&&Nt.fragmentError===0)&&(Gt<=Lt||!isFiniteNumber(Gt)||yt&&!this.bitrateTestDelay||Gt<lt)){const Yt=this.forcedAutoLevel;return Pt!==ht&&(Yt===-1||Yt!==ht)&&(Mt.length&&logger.trace(`[abr] Skipped level(s) ${Mt.join(",")} of ${rt} max with CODECS and VIDEO-RANGE:"${pt[Mt[0]].codecs}" ${pt[Mt[0]].videoRange}; not compatible with "${vt.codecs}" ${_t}`),logger.info(`[abr] switch candidate:${ct}->${Pt} adjustedbw(${Math.round(Ht)})-bitrate=${Math.round(Ht-jt)} ttfb:${Lt.toFixed(1)} avgDuration:${Ut.toFixed(1)} maxFetchDuration:${lt.toFixed(1)} fetchDuration:${Gt.toFixed(1)} firstSelection:${bt} codecSet:${xt} videoRange:${_t} hls.loadLevel:${ht}`)),bt&&(this.firstSelection=Pt),Pt}}return-1}set nextAutoLevel(_e){const{maxAutoLevel:tt,minAutoLevel:rt}=this.hls,nt=Math.min(Math.max(_e,rt),tt);this._nextAutoLevel!==nt&&(this.nextAutoLevelKey="",this._nextAutoLevel=nt)}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(_e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,_e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(_e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=_e,this._registerListeners()}_registerListeners(){const{hls:_e}=this;_e.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),_e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),_e.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:_e}=this;_e.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),_e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),_e.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(_e,tt){const rt=this.activePartLists[tt];if(rt)for(let nt=rt.length;nt--;){const it=rt[nt];if(!it)break;const st=it.end;if(it.start<=_e&&st!==null&&_e<=st)return it}return this.getBufferedFrag(_e,tt)}getBufferedFrag(_e,tt){const{fragments:rt}=this,nt=Object.keys(rt);for(let it=nt.length;it--;){const st=rt[nt[it]];if((st==null?void 0:st.body.type)===tt&&st.buffered){const ot=st.body;if(ot.start<=_e&&_e<=ot.end)return ot}}return null}detectEvictedFragments(_e,tt,rt,nt){this.timeRanges&&(this.timeRanges[_e]=tt);const it=(nt==null?void 0:nt.fragment.sn)||-1;Object.keys(this.fragments).forEach(st=>{const ot=this.fragments[st];if(!ot||it>=ot.body.sn)return;if(!ot.buffered&&!ot.loaded){ot.body.type===rt&&this.removeFragment(ot.body);return}const at=ot.range[_e];at&&at.time.some(lt=>{const ut=!this.isTimeBuffered(lt.startPTS,lt.endPTS,tt);return ut&&this.removeFragment(ot.body),ut})})}detectPartialFragments(_e){const tt=this.timeRanges,{frag:rt,part:nt}=_e;if(!tt||rt.sn==="initSegment")return;const it=getFragmentKey(rt),st=this.fragments[it];if(!st||st.buffered&&rt.gap)return;const ot=!rt.relurl;Object.keys(tt).forEach(at=>{const lt=rt.elementaryStreams[at];if(!lt)return;const ut=tt[at],ct=ot||lt.partial===!0;st.range[at]=this.getBufferedTimes(rt,nt,ct,ut)}),st.loaded=null,Object.keys(st.range).length?(st.buffered=!0,(st.body.endList=rt.endList||st.body.endList)&&(this.endListFragments[st.body.type]=st),isPartial(st)||this.removeParts(rt.sn-1,rt.type)):this.removeFragment(st.body)}removeParts(_e,tt){const rt=this.activePartLists[tt];rt&&(this.activePartLists[tt]=rt.filter(nt=>nt.fragment.sn>=_e))}fragBuffered(_e,tt){const rt=getFragmentKey(_e);let nt=this.fragments[rt];!nt&&tt&&(nt=this.fragments[rt]={body:_e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},_e.gap&&(this.hasGaps=!0)),nt&&(nt.loaded=null,nt.buffered=!0)}getBufferedTimes(_e,tt,rt,nt){const it={time:[],partial:rt},st=_e.start,ot=_e.end,at=_e.minEndPTS||ot,lt=_e.maxStartPTS||st;for(let ut=0;ut<nt.length;ut++){const ct=nt.start(ut)-this.bufferPadding,dt=nt.end(ut)+this.bufferPadding;if(lt>=ct&&at<=dt){it.time.push({startPTS:Math.max(st,nt.start(ut)),endPTS:Math.min(ot,nt.end(ut))});break}else if(st<dt&&ot>ct){const ft=Math.max(st,nt.start(ut)),pt=Math.min(ot,nt.end(ut));pt>ft&&(it.partial=!0,it.time.push({startPTS:ft,endPTS:pt}))}else if(ot<=ct)break}return it}getPartialFragment(_e){let tt=null,rt,nt,it,st=0;const{bufferPadding:ot,fragments:at}=this;return Object.keys(at).forEach(lt=>{const ut=at[lt];ut&&isPartial(ut)&&(nt=ut.body.start-ot,it=ut.body.end+ot,_e>=nt&&_e<=it&&(rt=Math.min(_e-nt,it-_e),st<=rt&&(tt=ut.body,st=rt)))}),tt}isEndListAppended(_e){const tt=this.endListFragments[_e];return tt!==void 0&&(tt.buffered||isPartial(tt))}getState(_e){const tt=getFragmentKey(_e),rt=this.fragments[tt];return rt?rt.buffered?isPartial(rt)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(_e,tt,rt){let nt,it;for(let st=0;st<rt.length;st++){if(nt=rt.start(st)-this.bufferPadding,it=rt.end(st)+this.bufferPadding,_e>=nt&&tt<=it)return!0;if(tt<=nt)return!1}return!1}onFragLoaded(_e,tt){const{frag:rt,part:nt}=tt;if(rt.sn==="initSegment"||rt.bitrateTest)return;const it=nt?null:tt,st=getFragmentKey(rt);this.fragments[st]={body:rt,appendedPTS:null,loaded:it,buffered:!1,range:Object.create(null)}}onBufferAppended(_e,tt){const{frag:rt,part:nt,timeRanges:it}=tt;if(rt.sn==="initSegment")return;const st=rt.type;if(nt){let ot=this.activePartLists[st];ot||(this.activePartLists[st]=ot=[]),ot.push(nt)}this.timeRanges=it,Object.keys(it).forEach(ot=>{const at=it[ot];this.detectEvictedFragments(ot,at,st,nt)})}onFragBuffered(_e,tt){this.detectPartialFragments(tt)}hasFragment(_e){const tt=getFragmentKey(_e);return!!this.fragments[tt]}hasParts(_e){var tt;return!!((tt=this.activePartLists[_e])!=null&&tt.length)}removeFragmentsInRange(_e,tt,rt,nt,it){nt&&!this.hasGaps||Object.keys(this.fragments).forEach(st=>{const ot=this.fragments[st];if(!ot)return;const at=ot.body;at.type!==rt||nt&&!at.gap||at.start<tt&&at.end>_e&&(ot.buffered||it)&&this.removeFragment(at)})}removeFragment(_e){const tt=getFragmentKey(_e);_e.stats.loaded=0,_e.clearElementaryStreamInfo();const rt=this.activePartLists[_e.type];if(rt){const nt=_e.sn;this.activePartLists[_e.type]=rt.filter(it=>it.fragment.sn!==nt)}delete this.fragments[tt],_e.endList&&delete this.endListFragments[_e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(et){var _e,tt,rt;return et.buffered&&(et.body.gap||((_e=et.range.video)==null?void 0:_e.partial)||((tt=et.range.audio)==null?void 0:tt.partial)||((rt=et.range.audiovideo)==null?void 0:rt.partial))}function getFragmentKey(et){return`${et.type}_${et.level}_${et.sn}`}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(_e,tt){try{if(_e){const rt=BufferHelper.getBuffered(_e);for(let nt=0;nt<rt.length;nt++)if(tt>=rt.start(nt)&&tt<=rt.end(nt))return!0}}catch{}return!1}static bufferInfo(_e,tt,rt){try{if(_e){const nt=BufferHelper.getBuffered(_e),it=[];let st;for(st=0;st<nt.length;st++)it.push({start:nt.start(st),end:nt.end(st)});return this.bufferedInfo(it,tt,rt)}}catch{}return{len:0,start:tt,end:tt,nextStart:void 0}}static bufferedInfo(_e,tt,rt){tt=Math.max(0,tt),_e.sort(function(lt,ut){const ct=lt.start-ut.start;return ct||ut.end-lt.end});let nt=[];if(rt)for(let lt=0;lt<_e.length;lt++){const ut=nt.length;if(ut){const ct=nt[ut-1].end;_e[lt].start-ct<rt?_e[lt].end>ct&&(nt[ut-1].end=_e[lt].end):nt.push(_e[lt])}else nt.push(_e[lt])}else nt=_e;let it=0,st,ot=tt,at=tt;for(let lt=0;lt<nt.length;lt++){const ut=nt[lt].start,ct=nt[lt].end;if(tt+rt>=ut&&tt<ct)ot=ut,at=ct,it=at-tt;else if(tt+rt<ut){st=ut;break}}return{len:it,start:ot||0,end:at||0,nextStart:st}}static getBuffered(_e){try{return _e.buffered}catch(tt){return logger.log("failed to get media.buffered",tt),noopBuffered}}}class ChunkMetadata{constructor(_e,tt,rt,nt=0,it=-1,st=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=_e,this.sn=tt,this.id=rt,this.size=nt,this.part=it,this.partial=st}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(et,_e){for(let rt=0,nt=et.length;rt<nt;rt++){var tt;if(((tt=et[rt])==null?void 0:tt.cc)===_e)return et[rt]}return null}function shouldAlignOnDiscontinuities(et,_e,tt){return!!(_e&&(tt.endCC>tt.startCC||et&&et.cc<tt.startCC))}function findDiscontinuousReferenceFrag(et,_e){const tt=et.fragments,rt=_e.fragments;if(!rt.length||!tt.length){logger.log("No fragments to align");return}const nt=findFirstFragWithCC(tt,rt[0].cc);if(!nt||nt&&!nt.startPTS){logger.log("No frag in previous level to align on");return}return nt}function adjustFragmentStart(et,_e){if(et){const tt=et.start+_e;et.start=et.startPTS=tt,et.endPTS=tt+et.duration}}function adjustSlidingStart(et,_e){const tt=_e.fragments;for(let rt=0,nt=tt.length;rt<nt;rt++)adjustFragmentStart(tt[rt],et);_e.fragmentHint&&adjustFragmentStart(_e.fragmentHint,et),_e.alignedSliding=!0}function alignStream(et,_e,tt){_e&&(alignDiscontinuities(et,tt,_e),!tt.alignedSliding&&_e&&alignMediaPlaylistByPDT(tt,_e),!tt.alignedSliding&&_e&&!tt.skippedSegments&&adjustSliding(_e,tt))}function alignDiscontinuities(et,_e,tt){if(shouldAlignOnDiscontinuities(et,tt,_e)){const rt=findDiscontinuousReferenceFrag(tt,_e);rt&&isFiniteNumber(rt.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${_e.url}`),adjustSlidingStart(rt.start,_e))}}function alignMediaPlaylistByPDT(et,_e){if(!et.hasProgramDateTime||!_e.hasProgramDateTime)return;const tt=et.fragments,rt=_e.fragments;if(!tt.length||!rt.length)return;let nt,it;const st=Math.min(_e.endCC,et.endCC);_e.startCC<st&&et.startCC<st&&(nt=findFirstFragWithCC(rt,st),it=findFirstFragWithCC(tt,st)),(!nt||!it)&&(nt=rt[Math.floor(rt.length/2)],it=findFirstFragWithCC(tt,nt.cc)||tt[Math.floor(tt.length/2)]);const ot=nt.programDateTime,at=it.programDateTime;if(!ot||!at)return;const lt=(at-ot)/1e3-(it.start-nt.start);adjustSlidingStart(lt,et)}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(_e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=_e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(_e,tt){const rt=_e.url;if(!rt)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:_e,error:new Error(`Fragment does not have a ${rt?"part list":"url"}`),networkDetails:null}));this.abort();const nt=this.config,it=nt.fLoader,st=nt.loader;return new Promise((ot,at)=>{if(this.loader&&this.loader.destroy(),_e.gap)if(_e.tagList.some(ft=>ft[0]==="GAP")){at(createGapLoadError(_e));return}else _e.gap=!1;const lt=this.loader=_e.loader=it?new it(nt):new st(nt),ut=createLoaderContext(_e),ct=getLoaderConfigWithoutReties(nt.fragLoadPolicy.default),dt={loadPolicy:ct,timeout:ct.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:_e.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};_e.stats=lt.stats,lt.load(ut,dt,{onSuccess:(ft,pt,mt,ht)=>{this.resetLoader(_e,lt);let gt=ft.data;mt.resetIV&&_e.decryptdata&&(_e.decryptdata.iv=new Uint8Array(gt.slice(0,16)),gt=gt.slice(16)),ot({frag:_e,part:null,payload:gt,networkDetails:ht})},onError:(ft,pt,mt,ht)=>{this.resetLoader(_e,lt),at(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:_e,response:_objectSpread2({url:rt,data:void 0},ft),error:new Error(`HTTP Error ${ft.code} ${ft.text}`),networkDetails:mt,stats:ht}))},onAbort:(ft,pt,mt)=>{this.resetLoader(_e,lt),at(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:_e,error:new Error("Aborted"),networkDetails:mt,stats:ft}))},onTimeout:(ft,pt,mt)=>{this.resetLoader(_e,lt),at(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:_e,error:new Error(`Timeout after ${dt.timeout}ms`),networkDetails:mt,stats:ft}))},onProgress:(ft,pt,mt,ht)=>{tt&&tt({frag:_e,part:null,payload:mt,networkDetails:ht})}})})}loadPart(_e,tt,rt){this.abort();const nt=this.config,it=nt.fLoader,st=nt.loader;return new Promise((ot,at)=>{if(this.loader&&this.loader.destroy(),_e.gap||tt.gap){at(createGapLoadError(_e,tt));return}const lt=this.loader=_e.loader=it?new it(nt):new st(nt),ut=createLoaderContext(_e,tt),ct=getLoaderConfigWithoutReties(nt.fragLoadPolicy.default),dt={loadPolicy:ct,timeout:ct.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};tt.stats=lt.stats,lt.load(ut,dt,{onSuccess:(ft,pt,mt,ht)=>{this.resetLoader(_e,lt),this.updateStatsFromPart(_e,tt);const gt={frag:_e,part:tt,payload:ft.data,networkDetails:ht};rt(gt),ot(gt)},onError:(ft,pt,mt,ht)=>{this.resetLoader(_e,lt),at(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:_e,part:tt,response:_objectSpread2({url:ut.url,data:void 0},ft),error:new Error(`HTTP Error ${ft.code} ${ft.text}`),networkDetails:mt,stats:ht}))},onAbort:(ft,pt,mt)=>{_e.stats.aborted=tt.stats.aborted,this.resetLoader(_e,lt),at(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:_e,part:tt,error:new Error("Aborted"),networkDetails:mt,stats:ft}))},onTimeout:(ft,pt,mt)=>{this.resetLoader(_e,lt),at(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:_e,part:tt,error:new Error(`Timeout after ${dt.timeout}ms`),networkDetails:mt,stats:ft}))}})})}updateStatsFromPart(_e,tt){const rt=_e.stats,nt=tt.stats,it=nt.total;if(rt.loaded+=nt.loaded,it){const at=Math.round(_e.duration/tt.duration),lt=Math.min(Math.round(rt.loaded/it),at),ct=(at-lt)*Math.round(rt.loaded/lt);rt.total=rt.loaded+ct}else rt.total=Math.max(rt.loaded,rt.total);const st=rt.loading,ot=nt.loading;st.start?st.first+=ot.first-ot.start:(st.start=ot.start,st.first=ot.first),st.end=ot.end}resetLoader(_e,tt){_e.loader=null,this.loader===tt&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),tt.destroy()}}function createLoaderContext(et,_e=null){const tt=_e||et,rt={frag:et,part:_e,responseType:"arraybuffer",url:tt.url,headers:{},rangeStart:0,rangeEnd:0},nt=tt.byteRangeStartOffset,it=tt.byteRangeEndOffset;if(isFiniteNumber(nt)&&isFiniteNumber(it)){var st;let ot=nt,at=it;if(et.sn==="initSegment"&&((st=et.decryptdata)==null?void 0:st.method)==="AES-128"){const lt=it-nt;lt%16&&(at=it+(16-lt%16)),nt!==0&&(rt.resetIV=!0,ot=nt-16)}rt.rangeStart=ot,rt.rangeEnd=at}return rt}function createGapLoadError(et,_e){const tt=new Error(`GAP ${et.gap?"tag":"attribute"} found`),rt={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:et,error:tt,networkDetails:null};return _e&&(rt.part=_e),(_e||et).stats.aborted=!0,new LoadError(rt)}class LoadError extends Error{constructor(_e){super(_e.error.message),this.data=void 0,this.data=_e}}class AESCrypto{constructor(_e,tt){this.subtle=void 0,this.aesIV=void 0,this.subtle=_e,this.aesIV=tt}decrypt(_e,tt){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},tt,_e)}}class FastAESKey{constructor(_e,tt){this.subtle=void 0,this.key=void 0,this.subtle=_e,this.key=tt}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(et){const _e=et.byteLength,tt=_e&&new DataView(et.buffer).getUint8(_e-1);return tt?sliceUint8(et,0,_e-tt):et}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(_e){const tt=new DataView(_e),rt=new Uint32Array(4);for(let nt=0;nt<4;nt++)rt[nt]=tt.getUint32(nt*4);return rt}initTable(){const _e=this.sBox,tt=this.invSBox,rt=this.subMix,nt=rt[0],it=rt[1],st=rt[2],ot=rt[3],at=this.invSubMix,lt=at[0],ut=at[1],ct=at[2],dt=at[3],ft=new Uint32Array(256);let pt=0,mt=0,ht=0;for(ht=0;ht<256;ht++)ht<128?ft[ht]=ht<<1:ft[ht]=ht<<1^283;for(ht=0;ht<256;ht++){let gt=mt^mt<<1^mt<<2^mt<<3^mt<<4;gt=gt>>>8^gt&255^99,_e[pt]=gt,tt[gt]=pt;const vt=ft[pt],yt=ft[vt],bt=ft[yt];let xt=ft[gt]*257^gt*16843008;nt[pt]=xt<<24|xt>>>8,it[pt]=xt<<16|xt>>>16,st[pt]=xt<<8|xt>>>24,ot[pt]=xt,xt=bt*16843009^yt*65537^vt*257^pt*16843008,lt[gt]=xt<<24|xt>>>8,ut[gt]=xt<<16|xt>>>16,ct[gt]=xt<<8|xt>>>24,dt[gt]=xt,pt?(pt=vt^ft[ft[ft[bt^vt]]],mt^=ft[ft[mt]]):pt=mt=1}}expandKey(_e){const tt=this.uint8ArrayToUint32Array_(_e);let rt=!0,nt=0;for(;nt<tt.length&&rt;)rt=tt[nt]===this.key[nt],nt++;if(rt)return;this.key=tt;const it=this.keySize=tt.length;if(it!==4&&it!==6&&it!==8)throw new Error("Invalid aes key size="+it);const st=this.ksRows=(it+6+1)*4;let ot,at;const lt=this.keySchedule=new Uint32Array(st),ut=this.invKeySchedule=new Uint32Array(st),ct=this.sBox,dt=this.rcon,ft=this.invSubMix,pt=ft[0],mt=ft[1],ht=ft[2],gt=ft[3];let vt,yt;for(ot=0;ot<st;ot++){if(ot<it){vt=lt[ot]=tt[ot];continue}yt=vt,ot%it===0?(yt=yt<<8|yt>>>24,yt=ct[yt>>>24]<<24|ct[yt>>>16&255]<<16|ct[yt>>>8&255]<<8|ct[yt&255],yt^=dt[ot/it|0]<<24):it>6&&ot%it===4&&(yt=ct[yt>>>24]<<24|ct[yt>>>16&255]<<16|ct[yt>>>8&255]<<8|ct[yt&255]),lt[ot]=vt=(lt[ot-it]^yt)>>>0}for(at=0;at<st;at++)ot=st-at,at&3?yt=lt[ot]:yt=lt[ot-4],at<4||ot<=4?ut[at]=yt:ut[at]=pt[ct[yt>>>24]]^mt[ct[yt>>>16&255]]^ht[ct[yt>>>8&255]]^gt[ct[yt&255]],ut[at]=ut[at]>>>0}networkToHostOrderSwap(_e){return _e<<24|(_e&65280)<<8|(_e&16711680)>>8|_e>>>24}decrypt(_e,tt,rt){const nt=this.keySize+6,it=this.invKeySchedule,st=this.invSBox,ot=this.invSubMix,at=ot[0],lt=ot[1],ut=ot[2],ct=ot[3],dt=this.uint8ArrayToUint32Array_(rt);let ft=dt[0],pt=dt[1],mt=dt[2],ht=dt[3];const gt=new Int32Array(_e),vt=new Int32Array(gt.length);let yt,bt,xt,_t,wt,Ct,kt,At,$t,Lt,Mt,Bt,Pt,Nt;const It=this.networkToHostOrderSwap;for(;tt<gt.length;){for($t=It(gt[tt]),Lt=It(gt[tt+1]),Mt=It(gt[tt+2]),Bt=It(gt[tt+3]),wt=$t^it[0],Ct=Bt^it[1],kt=Mt^it[2],At=Lt^it[3],Pt=4,Nt=1;Nt<nt;Nt++)yt=at[wt>>>24]^lt[Ct>>16&255]^ut[kt>>8&255]^ct[At&255]^it[Pt],bt=at[Ct>>>24]^lt[kt>>16&255]^ut[At>>8&255]^ct[wt&255]^it[Pt+1],xt=at[kt>>>24]^lt[At>>16&255]^ut[wt>>8&255]^ct[Ct&255]^it[Pt+2],_t=at[At>>>24]^lt[wt>>16&255]^ut[Ct>>8&255]^ct[kt&255]^it[Pt+3],wt=yt,Ct=bt,kt=xt,At=_t,Pt=Pt+4;yt=st[wt>>>24]<<24^st[Ct>>16&255]<<16^st[kt>>8&255]<<8^st[At&255]^it[Pt],bt=st[Ct>>>24]<<24^st[kt>>16&255]<<16^st[At>>8&255]<<8^st[wt&255]^it[Pt+1],xt=st[kt>>>24]<<24^st[At>>16&255]<<16^st[wt>>8&255]<<8^st[Ct&255]^it[Pt+2],_t=st[At>>>24]<<24^st[wt>>16&255]<<16^st[Ct>>8&255]<<8^st[kt&255]^it[Pt+3],vt[tt]=It(yt^ft),vt[tt+1]=It(_t^pt),vt[tt+2]=It(xt^mt),vt[tt+3]=It(bt^ht),ft=$t,pt=Lt,mt=Mt,ht=Bt,tt=tt+4}return vt.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(_e,{removePKCS7Padding:tt=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=_e.enableSoftwareAES,this.removePKCS7Padding=tt,tt)try{const rt=self.crypto;rt&&(this.subtle=rt.subtle||rt.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:_e,remainderData:tt}=this;if(!_e||tt)return this.reset(),null;const rt=new Uint8Array(_e);return this.reset(),this.removePKCS7Padding?removePadding(rt):rt}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(_e,tt,rt){return this.useSoftware?new Promise((nt,it)=>{this.softwareDecrypt(new Uint8Array(_e),tt,rt);const st=this.flush();st?nt(st.buffer):it(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(_e),tt,rt)}softwareDecrypt(_e,tt,rt){const{currentIV:nt,currentResult:it,remainderData:st}=this;this.logOnce("JS AES decrypt"),st&&(_e=appendUint8Array(st,_e),this.remainderData=null);const ot=this.getValidChunk(_e);if(!ot.length)return null;nt&&(rt=nt);let at=this.softwareDecrypter;at||(at=this.softwareDecrypter=new AESDecryptor),at.expandKey(tt);const lt=it;return this.currentResult=at.decrypt(ot.buffer,0,rt),this.currentIV=sliceUint8(ot,-16).buffer,lt||null}webCryptoDecrypt(_e,tt,rt){const nt=this.subtle;return(this.key!==tt||!this.fastAesKey)&&(this.key=tt,this.fastAesKey=new FastAESKey(nt,tt)),this.fastAesKey.expandKey().then(it=>nt?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(nt,new Uint8Array(rt)).decrypt(_e.buffer,it)):Promise.reject(new Error("web crypto not initialized"))).catch(it=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${it.name}: ${it.message}`),this.onWebCryptoError(_e,tt,rt)))}onWebCryptoError(_e,tt,rt){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(_e,tt,rt);const nt=this.flush();if(nt)return nt.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(_e){let tt=_e;const rt=_e.length-_e.length%CHUNK_SIZE;return rt!==_e.length&&(tt=sliceUint8(_e,0,rt),this.remainderData=sliceUint8(_e,rt)),tt}logOnce(_e){this.logEnabled&&(logger.log(`[decrypter]: ${_e}`),this.logEnabled=!1)}}const TimeRanges={toString:function(et){let _e="";const tt=et.length;for(let rt=0;rt<tt;rt++)_e+=`[${et.start(rt).toFixed(3)}-${et.end(rt).toFixed(3)}]`;return _e}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(_e,tt,rt,nt,it){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=it,this.logPrefix=nt,this.log=logger.log.bind(logger,`${nt}:`),this.warn=logger.warn.bind(logger,`${nt}:`),this.hls=_e,this.fragmentLoader=new FragmentLoader(_e.config),this.keyLoader=rt,this.fragmentTracker=tt,this.config=_e.config,this.decrypter=new Decrypter(_e.config),_e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(_e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const _e=this.fragCurrent;_e!=null&&_e.loader&&(_e.abortRequests(),this.fragmentTracker.removeFragment(_e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(_e,tt){if(tt.live||_e.nextStart||!_e.end||!this.media)return!1;const rt=tt.partList;if(rt!=null&&rt.length){const it=rt[rt.length-1];return BufferHelper.isBuffered(this.media,it.start+it.duration/2)}const nt=tt.fragments[tt.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(nt)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var _e;return(_e=this.levelLastLoaded)==null?void 0:_e.details}}onMediaAttached(_e,tt){const rt=this.media=this.mediaBuffer=tt.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),rt.addEventListener("seeking",this.onvseeking),rt.addEventListener("ended",this.onvended);const nt=this.config;this.levels&&nt.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(nt.startPosition)}onMediaDetaching(){const _e=this.media;_e!=null&&_e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),_e&&this.onvseeking&&this.onvended&&(_e.removeEventListener("seeking",this.onvseeking),_e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:_e,fragCurrent:tt,media:rt,mediaBuffer:nt,state:it}=this,st=rt?rt.currentTime:0,ot=BufferHelper.bufferInfo(nt||rt,st,_e.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(st)?st.toFixed(3):st}, state: ${it}`),this.state===State.ENDED)this.resetLoadingState();else if(tt){const at=_e.maxFragLookUpTolerance,lt=tt.start-at,ut=tt.start+tt.duration+at;if(!ot.len||ut<ot.start||lt>ot.end){const ct=st>ut;(st<lt||ct)&&(ct&&tt.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),tt.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}rt&&(this.fragmentTracker.removeFragmentsInRange(st,1/0,this.playlistType,!0),this.lastCurrentTime=st),!this.loadedmetadata&&!ot.len&&(this.nextLoadPosition=this.startPosition=st),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(_e,tt){this.startTimeOffset=tt.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(_e,tt,rt){this._loadFragForPlayback(_e,tt,rt)}_loadFragForPlayback(_e,tt,rt){const nt=it=>{if(this.fragContextChanged(_e)){this.warn(`Fragment ${_e.sn}${it.part?" p: "+it.part.index:""} of level ${_e.level} was dropped during download.`),this.fragmentTracker.removeFragment(_e);return}_e.stats.chunkCount++,this._handleFragmentLoadProgress(it)};this._doFragLoad(_e,tt,rt,nt).then(it=>{if(!it)return;const st=this.state;if(this.fragContextChanged(_e)){(st===State.FRAG_LOADING||!this.fragCurrent&&st===State.PARSING)&&(this.fragmentTracker.removeFragment(_e),this.state=State.IDLE);return}"payload"in it&&(this.log(`Loaded fragment ${_e.sn} of level ${_e.level}`),this.hls.trigger(Events.FRAG_LOADED,it)),this._handleFragmentLoadComplete(it)}).catch(it=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(it),this.resetFragmentLoading(_e))})}clearTrackerIfNeeded(_e){var tt;const{fragmentTracker:rt}=this;if(rt.getState(_e)===FragmentState.APPENDING){const it=_e.type,st=this.getFwdBufferInfo(this.mediaBuffer,it),ot=Math.max(_e.duration,st?st.len:this.config.maxBufferLength);this.reduceMaxBufferLength(ot)&&rt.removeFragment(_e)}else((tt=this.mediaBuffer)==null?void 0:tt.buffered.length)===0?rt.removeAllFragments():rt.hasParts(_e.type)&&(rt.detectPartialFragments({frag:_e,part:null,stats:_e.stats,id:_e.type}),rt.getState(_e)===FragmentState.PARTIAL&&rt.removeFragment(_e))}checkLiveUpdate(_e){if(_e.updated&&!_e.live){const tt=_e.fragments[_e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:tt,part:null,stats:tt.stats,id:tt.type})}_e.fragments[0]||(_e.deltaUpdateFailed=!0)}flushMainBuffer(_e,tt,rt=null){if(!(_e-tt))return;const nt={startOffset:_e,endOffset:tt,type:rt};this.hls.trigger(Events.BUFFER_FLUSHING,nt)}_loadInitSegment(_e,tt){this._doFragLoad(_e,tt).then(rt=>{if(!rt||this.fragContextChanged(_e)||!this.levels)throw new Error("init load aborted");return rt}).then(rt=>{const{hls:nt}=this,{payload:it}=rt,st=_e.decryptdata;if(it&&it.byteLength>0&&st!=null&&st.key&&st.iv&&st.method==="AES-128"){const ot=self.performance.now();return this.decrypter.decrypt(new Uint8Array(it),st.key.buffer,st.iv.buffer).catch(at=>{throw nt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:at,reason:at.message,frag:_e}),at}).then(at=>{const lt=self.performance.now();return nt.trigger(Events.FRAG_DECRYPTED,{frag:_e,payload:at,stats:{tstart:ot,tdecrypt:lt}}),rt.payload=at,this.completeInitSegmentLoad(rt)})}return this.completeInitSegmentLoad(rt)}).catch(rt=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(rt),this.resetFragmentLoading(_e))})}completeInitSegmentLoad(_e){const{levels:tt}=this;if(!tt)throw new Error("init load aborted, missing levels");const rt=_e.frag.stats;this.state=State.IDLE,_e.frag.data=new Uint8Array(_e.payload),rt.parsing.start=rt.buffering.start=self.performance.now(),rt.parsing.end=rt.buffering.end=self.performance.now(),this.tick()}fragContextChanged(_e){const{fragCurrent:tt}=this;return!_e||!tt||_e.sn!==tt.sn||_e.level!==tt.level}fragBufferedComplete(_e,tt){var rt,nt,it,st;const ot=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${_e.type} sn: ${_e.sn}${tt?" part: "+tt.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${_e.level} (frag:[${((rt=_e.startPTS)!=null?rt:NaN).toFixed(3)}-${((nt=_e.endPTS)!=null?nt:NaN).toFixed(3)}] > buffer:${ot?TimeRanges.toString(BufferHelper.getBuffered(ot)):"(detached)"})`),_e.sn!=="initSegment"){var at;if(_e.type!==PlaylistLevelType.SUBTITLE){const ut=_e.elementaryStreams;if(!Object.keys(ut).some(ct=>!!ut[ct])){this.state=State.IDLE;return}}const lt=(at=this.levels)==null?void 0:at[_e.level];lt!=null&&lt.fragmentError&&(this.log(`Resetting level fragment error count of ${lt.fragmentError} on frag buffered`),lt.fragmentError=0)}this.state=State.IDLE,ot&&(!this.loadedmetadata&&_e.type==PlaylistLevelType.MAIN&&ot.buffered.length&&((it=this.fragCurrent)==null?void 0:it.sn)===((st=this.fragPrevious)==null?void 0:st.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(_e){const{transmuxer:tt}=this;if(!tt)return;const{frag:rt,part:nt,partsLoaded:it}=_e,st=!it||it.length===0||it.some(at=>!at),ot=new ChunkMetadata(rt.level,rt.sn,rt.stats.chunkCount+1,0,nt?nt.index:-1,!st);tt.flush(ot)}_handleFragmentLoadProgress(_e){}_doFragLoad(_e,tt,rt=null,nt){var it;const st=tt==null?void 0:tt.details;if(!this.levels||!st)throw new Error(`frag load aborted, missing level${st?"":" detail"}s`);let ot=null;if(_e.encrypted&&!((it=_e.decryptdata)!=null&&it.key)?(this.log(`Loading key for ${_e.sn} of [${st.startSN}-${st.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${_e.level}`),this.state=State.KEY_LOADING,this.fragCurrent=_e,ot=this.keyLoader.load(_e).then(ut=>{if(!this.fragContextChanged(ut.frag))return this.hls.trigger(Events.KEY_LOADED,ut),this.state===State.KEY_LOADING&&(this.state=State.IDLE),ut}),this.hls.trigger(Events.KEY_LOADING,{frag:_e}),this.fragCurrent===null&&(ot=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!_e.encrypted&&st.encryptedFragments.length&&this.keyLoader.loadClear(_e,st.encryptedFragments),rt=Math.max(_e.start,rt||0),this.config.lowLatencyMode&&_e.sn!=="initSegment"){const ut=st.partList;if(ut&&nt){rt>_e.end&&st.fragmentHint&&(_e=st.fragmentHint);const ct=this.getNextPart(ut,_e,rt);if(ct>-1){const dt=ut[ct];this.log(`Loading part sn: ${_e.sn} p: ${dt.index} cc: ${_e.cc} of playlist [${st.startSN}-${st.endSN}] parts [0-${ct}-${ut.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${_e.level}, target: ${parseFloat(rt.toFixed(3))}`),this.nextLoadPosition=dt.start+dt.duration,this.state=State.FRAG_LOADING;let ft;return ot?ft=ot.then(pt=>!pt||this.fragContextChanged(pt.frag)?null:this.doFragPartsLoad(_e,dt,tt,nt)).catch(pt=>this.handleFragLoadError(pt)):ft=this.doFragPartsLoad(_e,dt,tt,nt).catch(pt=>this.handleFragLoadError(pt)),this.hls.trigger(Events.FRAG_LOADING,{frag:_e,part:dt,targetBufferTime:rt}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):ft}else if(!_e.url||this.loadedEndOfParts(ut,rt))return Promise.resolve(null)}}this.log(`Loading fragment ${_e.sn} cc: ${_e.cc} ${st?"of ["+st.startSN+"-"+st.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${_e.level}, target: ${parseFloat(rt.toFixed(3))}`),isFiniteNumber(_e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=_e.start+_e.duration),this.state=State.FRAG_LOADING;const at=this.config.progressive;let lt;return at&&ot?lt=ot.then(ut=>!ut||this.fragContextChanged(ut==null?void 0:ut.frag)?null:this.fragmentLoader.load(_e,nt)).catch(ut=>this.handleFragLoadError(ut)):lt=Promise.all([this.fragmentLoader.load(_e,at?nt:void 0),ot]).then(([ut])=>(!at&&ut&&nt&&nt(ut),ut)).catch(ut=>this.handleFragLoadError(ut)),this.hls.trigger(Events.FRAG_LOADING,{frag:_e,targetBufferTime:rt}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):lt}doFragPartsLoad(_e,tt,rt,nt){return new Promise((it,st)=>{var ot;const at=[],lt=(ot=rt.details)==null?void 0:ot.partList,ut=ct=>{this.fragmentLoader.loadPart(_e,ct,nt).then(dt=>{at[ct.index]=dt;const ft=dt.part;this.hls.trigger(Events.FRAG_LOADED,dt);const pt=getPartWith(rt,_e.sn,ct.index+1)||findPart(lt,_e.sn,ct.index+1);if(pt)ut(pt);else return it({frag:_e,part:ft,partsLoaded:at})}).catch(st)};ut(tt)})}handleFragLoadError(_e){if("data"in _e){const tt=_e.data;_e.data&&tt.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(tt.frag,tt.part):this.hls.trigger(Events.ERROR,tt)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:_e,error:_e,fatal:!0});return null}_handleTransmuxerFlush(_e){const tt=this.getCurrentContext(_e);if(!tt||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:rt,part:nt,level:it}=tt,st=self.performance.now();rt.stats.parsing.end=st,nt&&(nt.stats.parsing.end=st),this.updateLevelTiming(rt,nt,it,_e.partial)}getCurrentContext(_e){const{levels:tt,fragCurrent:rt}=this,{level:nt,sn:it,part:st}=_e;if(!(tt!=null&&tt[nt]))return this.warn(`Levels object was unset while buffering fragment ${it} of level ${nt}. The current chunk will not be buffered.`),null;const ot=tt[nt],at=st>-1?getPartWith(ot,it,st):null,lt=at?at.fragment:getFragmentWithSN(ot,it,rt);return lt?(rt&&rt!==lt&&(lt.stats=rt.stats),{frag:lt,part:at,level:ot}):null}bufferFragmentData(_e,tt,rt,nt,it){var st;if(!_e||this.state!==State.PARSING)return;const{data1:ot,data2:at}=_e;let lt=ot;if(ot&&at&&(lt=appendUint8Array(ot,at)),!((st=lt)!=null&&st.length))return;const ut={type:_e.type,frag:tt,part:rt,chunkMeta:nt,parent:tt.type,data:lt};if(this.hls.trigger(Events.BUFFER_APPENDING,ut),_e.dropped&&_e.independent&&!rt){if(it)return;this.flushBufferGap(tt)}}flushBufferGap(_e){const tt=this.media;if(!tt)return;if(!BufferHelper.isBuffered(tt,tt.currentTime)){this.flushMainBuffer(0,_e.start);return}const rt=tt.currentTime,nt=BufferHelper.bufferInfo(tt,rt,0),it=_e.duration,st=Math.min(this.config.maxFragLookUpTolerance*2,it*.25),ot=Math.max(Math.min(_e.start-st,nt.end-st),rt+st);_e.start-ot>st&&this.flushMainBuffer(ot,_e.start)}getFwdBufferInfo(_e,tt){const rt=this.getLoadPosition();return isFiniteNumber(rt)?this.getFwdBufferInfoAtPos(_e,rt,tt):null}getFwdBufferInfoAtPos(_e,tt,rt){const{config:{maxBufferHole:nt}}=this,it=BufferHelper.bufferInfo(_e,tt,nt);if(it.len===0&&it.nextStart!==void 0){const st=this.fragmentTracker.getBufferedFrag(tt,rt);if(st&&it.nextStart<st.end)return BufferHelper.bufferInfo(_e,tt,Math.max(it.nextStart,nt))}return it}getMaxBufferLength(_e){const{config:tt}=this;let rt;return _e?rt=Math.max(8*tt.maxBufferSize/_e,tt.maxBufferLength):rt=tt.maxBufferLength,Math.min(rt,tt.maxMaxBufferLength)}reduceMaxBufferLength(_e){const tt=this.config,rt=_e||tt.maxBufferLength;return tt.maxMaxBufferLength>=rt?(tt.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${tt.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(_e,tt=PlaylistLevelType.MAIN){const rt=this.fragmentTracker.getAppendedFrag(_e,PlaylistLevelType.MAIN);return rt&&"fragment"in rt?rt.fragment:rt}getNextFragment(_e,tt){const rt=tt.fragments,nt=rt.length;if(!nt)return null;const{config:it}=this,st=rt[0].start;let ot;if(tt.live){const at=it.initialLiveManifestSize;if(nt<at)return this.warn(`Not enough fragments to start playback (have: ${nt}, need: ${at})`),null;(!tt.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||_e<st)&&(ot=this.getInitialLiveFragment(tt,rt),this.startPosition=this.nextLoadPosition=ot?this.hls.liveSyncPosition||ot.start:_e)}else _e<=st&&(ot=rt[0]);if(!ot){const at=it.lowLatencyMode?tt.partEnd:tt.fragmentEnd;ot=this.getFragmentAtPosition(_e,at,tt)}return this.mapToInitFragWhenRequired(ot)}isLoopLoading(_e,tt){const rt=this.fragmentTracker.getState(_e);return(rt===FragmentState.OK||rt===FragmentState.PARTIAL&&!!_e.gap)&&this.nextLoadPosition>tt}getNextFragmentLoopLoading(_e,tt,rt,nt,it){const st=_e.gap,ot=this.getNextFragment(this.nextLoadPosition,tt);if(ot===null)return ot;if(_e=ot,st&&_e&&!_e.gap&&rt.nextStart){const at=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,rt.nextStart,nt);if(at!==null&&rt.len+at.len>=it)return this.log(`buffer full after gaps in "${nt}" playlist starting at sn: ${_e.sn}`),null}return _e}mapToInitFragWhenRequired(_e){return _e!=null&&_e.initSegment&&!(_e!=null&&_e.initSegment.data)&&!this.bitrateTest?_e.initSegment:_e}getNextPart(_e,tt,rt){let nt=-1,it=!1,st=!0;for(let ot=0,at=_e.length;ot<at;ot++){const lt=_e[ot];if(st=st&&!lt.independent,nt>-1&&rt<lt.start)break;const ut=lt.loaded;ut?nt=-1:(it||lt.independent||st)&&lt.fragment===tt&&(nt=ot),it=ut}return nt}loadedEndOfParts(_e,tt){const rt=_e[_e.length-1];return rt&&tt>rt.start&&rt.loaded}getInitialLiveFragment(_e,tt){const rt=this.fragPrevious;let nt=null;if(rt){if(_e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${rt.programDateTime}`),nt=findFragmentByPDT(tt,rt.endProgramDateTime,this.config.maxFragLookUpTolerance)),!nt){const it=rt.sn+1;if(it>=_e.startSN&&it<=_e.endSN){const st=tt[it-_e.startSN];rt.cc===st.cc&&(nt=st,this.log(`Live playlist, switching playlist, load frag with next SN: ${nt.sn}`))}nt||(nt=findFragWithCC(tt,rt.cc),nt&&this.log(`Live playlist, switching playlist, load frag with same CC: ${nt.sn}`))}}else{const it=this.hls.liveSyncPosition;it!==null&&(nt=this.getFragmentAtPosition(it,this.bitrateTest?_e.fragmentEnd:_e.edge,_e))}return nt}getFragmentAtPosition(_e,tt,rt){const{config:nt}=this;let{fragPrevious:it}=this,{fragments:st,endSN:ot}=rt;const{fragmentHint:at}=rt,lt=nt.maxFragLookUpTolerance,ut=rt.partList,ct=!!(nt.lowLatencyMode&&ut!=null&&ut.length&&at);ct&&at&&!this.bitrateTest&&(st=st.concat(at),ot=at.sn);let dt;if(_e<tt){const ft=_e>tt-lt?0:lt;dt=findFragmentByPTS(it,st,_e,ft)}else dt=st[st.length-1];if(dt){const ft=dt.sn-rt.startSN,pt=this.fragmentTracker.getState(dt);if((pt===FragmentState.OK||pt===FragmentState.PARTIAL&&dt.gap)&&(it=dt),it&&dt.sn===it.sn&&(!ct||ut[0].fragment.sn>dt.sn)&&it&&dt.level===it.level){const ht=st[ft+1];dt.sn<ot&&this.fragmentTracker.getState(ht)!==FragmentState.OK?dt=ht:dt=null}}return dt}synchronizeToLiveEdge(_e){const{config:tt,media:rt}=this;if(!rt)return;const nt=this.hls.liveSyncPosition,it=rt.currentTime,st=_e.fragments[0].start,ot=_e.edge,at=it>=st-tt.maxFragLookUpTolerance&&it<=ot;if(nt!==null&&rt.duration>nt&&(it<nt||!at)){const lt=tt.liveMaxLatencyDuration!==void 0?tt.liveMaxLatencyDuration:tt.liveMaxLatencyDurationCount*_e.targetduration;(!at&&rt.readyState<4||it<ot-lt)&&(this.loadedmetadata||(this.nextLoadPosition=nt),rt.readyState&&(this.warn(`Playback: ${it.toFixed(3)} is located too far from the end of live sliding playlist: ${ot}, reset currentTime to : ${nt.toFixed(3)}`),rt.currentTime=nt))}}alignPlaylists(_e,tt,rt){const nt=_e.fragments.length;if(!nt)return this.warn("No fragments in live playlist"),0;const it=_e.fragments[0].start,st=!tt,ot=_e.alignedSliding&&isFiniteNumber(it);if(st||!ot&&!it){const{fragPrevious:at}=this;alignStream(at,rt,_e);const lt=_e.fragments[0].start;return this.log(`Live playlist sliding: ${lt.toFixed(2)} start-sn: ${tt?tt.startSN:"na"}->${_e.startSN} prev-sn: ${at?at.sn:"na"} fragments: ${nt}`),lt}return it}waitForCdnTuneIn(_e){return _e.live&&_e.canBlockReload&&_e.partTarget&&_e.tuneInGoal>Math.max(_e.partHoldBack,_e.partTarget*3)}setStartPosition(_e,tt){let rt=this.startPosition;if(rt<tt&&(rt=-1),rt===-1||this.lastCurrentTime===-1){const nt=this.startTimeOffset!==null,it=nt?this.startTimeOffset:_e.startTimeOffset;it!==null&&isFiniteNumber(it)?(rt=tt+it,it<0&&(rt+=_e.totalduration),rt=Math.min(Math.max(tt,rt),tt+_e.totalduration),this.log(`Start time offset ${it} found in ${nt?"multivariant":"media"} playlist, adjust startPosition to ${rt}`),this.startPosition=rt):_e.live?rt=this.hls.liveSyncPosition||tt:this.startPosition=rt=0,this.lastCurrentTime=rt}this.nextLoadPosition=rt}getLoadPosition(){const{media:_e}=this;let tt=0;return this.loadedmetadata&&_e?tt=_e.currentTime:this.nextLoadPosition&&(tt=this.nextLoadPosition),tt}handleFragLoadAborted(_e,tt){this.transmuxer&&_e.sn!=="initSegment"&&_e.stats.aborted&&(this.warn(`Fragment ${_e.sn}${tt?" part "+tt.index:""} of level ${_e.level} was aborted`),this.resetFragmentLoading(_e))}resetFragmentLoading(_e){(!this.fragCurrent||!this.fragContextChanged(_e)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(_e,tt){if(tt.chunkMeta&&!tt.frag){const ut=this.getCurrentContext(tt.chunkMeta);ut&&(tt.frag=ut.frag)}const rt=tt.frag;if(!rt||rt.type!==_e||!this.levels)return;if(this.fragContextChanged(rt)){var nt;this.warn(`Frag load error must match current frag to retry ${rt.url} > ${(nt=this.fragCurrent)==null?void 0:nt.url}`);return}const it=tt.details===ErrorDetails.FRAG_GAP;it&&this.fragmentTracker.fragBuffered(rt,!0);const st=tt.errorAction,{action:ot,retryCount:at=0,retryConfig:lt}=st||{};if(st&&ot===NetworkErrorAction.RetryRequest&&lt){this.resetStartWhenNotLoaded(this.levelLastLoaded);const ut=getRetryDelay(lt,at);this.warn(`Fragment ${rt.sn} of ${_e} ${rt.level} errored with ${tt.details}, retrying loading ${at+1}/${lt.maxNumRetry} in ${ut}ms`),st.resolved=!0,this.retryDate=self.performance.now()+ut,this.state=State.FRAG_LOADING_WAITING_RETRY}else if(lt&&st)if(this.resetFragmentErrors(_e),at<lt.maxNumRetry)!it&&ot!==NetworkErrorAction.RemoveAlternatePermanently&&(st.resolved=!0);else{logger.warn(`${tt.details} reached or exceeded max retry (${at})`);return}else(st==null?void 0:st.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(_e){if(this.state===State.PARSING||this.state===State.PARSED){const tt=_e.parent,rt=this.getFwdBufferInfo(this.mediaBuffer,tt),nt=rt&&rt.len>.5;nt&&this.reduceMaxBufferLength(rt.len);const it=!nt;return it&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${tt} buffer`),_e.frag&&(this.fragmentTracker.removeFragment(_e.frag),this.nextLoadPosition=_e.frag.start),this.resetLoadingState(),it}return!1}resetFragmentErrors(_e){_e===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(_e,tt,rt){if(!_e)return;const nt=BufferHelper.getBuffered(_e);this.fragmentTracker.detectEvictedFragments(tt,nt,rt),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(_e){if(!this.loadedmetadata){this.startFragRequested=!1;const tt=_e?_e.details:null;tt!=null&&tt.live?(this.startPosition=-1,this.setStartPosition(tt,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(_e){this.warn(`The loading context changed while buffering fragment ${_e.sn} of level ${_e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(_e=0){this.fragmentTracker.removeFragmentsInRange(_e,1/0,this.playlistType,!1,!0)}updateLevelTiming(_e,tt,rt,nt){var it;const st=rt.details;if(!st){this.warn("level.details undefined");return}if(!Object.keys(_e.elementaryStreams).reduce((at,lt)=>{const ut=_e.elementaryStreams[lt];if(ut){const ct=ut.endPTS-ut.startPTS;if(ct<=0)return this.warn(`Could not parse fragment ${_e.sn} ${lt} duration reliably (${ct})`),at||!1;const dt=nt?0:updateFragPTSDTS(st,_e,ut.startPTS,ut.endPTS,ut.startDTS,ut.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:st,level:rt,drift:dt,type:lt,frag:_e,start:ut.startPTS,end:ut.endPTS}),!0}return at},!1)&&((it=this.transmuxer)==null?void 0:it.error)===null){const at=new Error(`Found no media in fragment ${_e.sn} of level ${_e.level} resetting transmuxer to fallback to playlist timing`);if(rt.fragmentError===0&&(rt.fragmentError++,_e.gap=!0,this.fragmentTracker.removeFragment(_e),this.fragmentTracker.fragBuffered(_e,!0)),this.warn(at.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:at,frag:_e,reason:`Found no media in msn ${_e.sn} of level "${rt.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:_e,part:tt})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(_e){_e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(_e){const tt=this._state;tt!==_e&&(this._state=_e,this.log(`${tt}->${_e}`))}get state(){return this._state}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(_e){this.chunks.push(_e),this.dataLength+=_e.length}flush(){const{chunks:_e,dataLength:tt}=this;let rt;if(_e.length)_e.length===1?rt=_e[0]:rt=concatUint8Arrays(_e,tt);else return new Uint8Array(0);return this.reset(),rt}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(et,_e){const tt=new Uint8Array(_e);let rt=0;for(let nt=0;nt<et.length;nt++){const it=et[nt];tt.set(it,rt),rt+=it.length}return tt}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const et=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),_e=self.URL.createObjectURL(et);return{worker:new self.Worker(_e),objectURL:_e}}function loadWorker(et){const _e=new self.URL(et,self.location.href).href;return{worker:new self.Worker(_e),scriptURL:_e}}function dummyTrack(et="",_e=9e4){return{type:et,id:-1,pid:-1,inputTimeScale:_e,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(_e,tt,rt,nt){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(_e){this.initPTS=_e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(_e,tt){return!1}appendFrame(_e,tt,rt){}demux(_e,tt){this.cachedData&&(_e=appendUint8Array(this.cachedData,_e),this.cachedData=null);let rt=getID3Data(_e,0),nt=rt?rt.length:0,it;const st=this._audioTrack,ot=this._id3Track,at=rt?getTimeStamp(rt):void 0,lt=_e.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(at))&&(this.basePTS=initPTSFn(at,tt,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),rt&&rt.length>0&&ot.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:rt,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});nt<lt;){if(this.canParse(_e,nt)){const ut=this.appendFrame(st,_e,nt);ut?(this.frameIndex++,this.lastPTS=ut.sample.pts,nt+=ut.length,it=nt):nt=lt}else canParse$2(_e,nt)?(rt=getID3Data(_e,nt),ot.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:rt,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),nt+=rt.length,it=nt):nt++;if(nt===lt&&it!==lt){const ut=sliceUint8(_e,it);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,ut):this.cachedData=ut}}return{audioTrack:st,videoTrack:dummyTrack(),id3Track:ot,textTrack:dummyTrack()}}demuxSampleAes(_e,tt,rt){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(_e){const tt=this.cachedData;return tt&&(this.cachedData=null,this.demux(tt,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(et,_e,tt)=>{if(isFiniteNumber(et))return et*90;const rt=tt?tt.baseTime*9e4/tt.timescale:0;return _e*9e4+rt};function getAudioConfig(et,_e,tt,rt){let nt,it,st,ot;const at=navigator.userAgent.toLowerCase(),lt=rt,ut=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];nt=((_e[tt+2]&192)>>>6)+1;const ct=(_e[tt+2]&60)>>>2;if(ct>ut.length-1){const dt=new Error(`invalid ADTS sampling index:${ct}`);et.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:dt,reason:dt.message});return}return st=(_e[tt+2]&1)<<2,st|=(_e[tt+3]&192)>>>6,logger.log(`manifest codec:${rt}, ADTS type:${nt}, samplingIndex:${ct}`),/firefox/i.test(at)?ct>=6?(nt=5,ot=new Array(4),it=ct-3):(nt=2,ot=new Array(2),it=ct):at.indexOf("android")!==-1?(nt=2,ot=new Array(2),it=ct):(nt=5,ot=new Array(4),rt&&(rt.indexOf("mp4a.40.29")!==-1||rt.indexOf("mp4a.40.5")!==-1)||!rt&&ct>=6?it=ct-3:((rt&&rt.indexOf("mp4a.40.2")!==-1&&(ct>=6&&st===1||/vivaldi/i.test(at))||!rt&&st===1)&&(nt=2,ot=new Array(2)),it=ct)),ot[0]=nt<<3,ot[0]|=(ct&14)>>1,ot[1]|=(ct&1)<<7,ot[1]|=st<<3,nt===5&&(ot[1]|=(it&14)>>1,ot[2]=(it&1)<<7,ot[2]|=8,ot[3]=0),{config:ot,samplerate:ut[ct],channelCount:st,codec:"mp4a.40."+nt,manifestCodec:lt}}function isHeaderPattern$1(et,_e){return et[_e]===255&&(et[_e+1]&246)===240}function getHeaderLength(et,_e){return et[_e+1]&1?7:9}function getFullFrameLength(et,_e){return(et[_e+3]&3)<<11|et[_e+4]<<3|(et[_e+5]&224)>>>5}function canGetFrameLength(et,_e){return _e+5<et.length}function isHeader$1(et,_e){return _e+1<et.length&&isHeaderPattern$1(et,_e)}function canParse$1(et,_e){return canGetFrameLength(et,_e)&&isHeaderPattern$1(et,_e)&&getFullFrameLength(et,_e)<=et.length-_e}function probe$1(et,_e){if(isHeader$1(et,_e)){const tt=getHeaderLength(et,_e);if(_e+tt>=et.length)return!1;const rt=getFullFrameLength(et,_e);if(rt<=tt)return!1;const nt=_e+rt;return nt===et.length||isHeader$1(et,nt)}return!1}function initTrackConfig(et,_e,tt,rt,nt){if(!et.samplerate){const it=getAudioConfig(_e,tt,rt,nt);if(!it)return;et.config=it.config,et.samplerate=it.samplerate,et.channelCount=it.channelCount,et.codec=it.codec,et.manifestCodec=it.manifestCodec,logger.log(`parsed codec:${et.codec}, rate:${it.samplerate}, channels:${it.channelCount}`)}}function getFrameDuration(et){return 1024*9e4/et}function parseFrameHeader(et,_e){const tt=getHeaderLength(et,_e);if(_e+tt<=et.length){const rt=getFullFrameLength(et,_e)-tt;if(rt>0)return{headerLength:tt,frameLength:rt}}}function appendFrame$2(et,_e,tt,rt,nt){const it=getFrameDuration(et.samplerate),st=rt+nt*it,ot=parseFrameHeader(_e,tt);let at;if(ot){const{frameLength:ct,headerLength:dt}=ot,ft=dt+ct,pt=Math.max(0,tt+ft-_e.length);pt?(at=new Uint8Array(ft-dt),at.set(_e.subarray(tt+dt,_e.length),0)):at=_e.subarray(tt+dt,tt+ft);const mt={unit:at,pts:st};return pt||et.samples.push(mt),{sample:mt,length:ft,missing:pt}}const lt=_e.length-tt;return at=new Uint8Array(lt),at.set(_e.subarray(tt,_e.length),0),{sample:{unit:at,pts:st},length:lt,missing:-1}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame$1(et,_e,tt,rt,nt){if(tt+24>_e.length)return;const it=parseHeader(_e,tt);if(it&&tt+it.frameLength<=_e.length){const st=it.samplesPerFrame*9e4/it.sampleRate,ot=rt+nt*st,at={unit:_e.subarray(tt,tt+it.frameLength),pts:ot,dts:ot};return et.config=[],et.channelCount=it.channelCount,et.samplerate=it.sampleRate,et.samples.push(at),{sample:at,length:it.frameLength,missing:0}}}function parseHeader(et,_e){const tt=et[_e+1]>>3&3,rt=et[_e+1]>>1&3,nt=et[_e+2]>>4&15,it=et[_e+2]>>2&3;if(tt!==1&&nt!==0&&nt!==15&&it!==3){const st=et[_e+2]>>1&1,ot=et[_e+3]>>6,at=tt===3?3-rt:rt===3?3:4,lt=BitratesMap[at*14+nt-1]*1e3,ct=SamplingRateMap[(tt===3?0:tt===2?1:2)*3+it],dt=ot===3?1:2,ft=SamplesCoefficients[tt][rt],pt=BytesInSlot[rt],mt=ft*8*pt,ht=Math.floor(ft*lt/ct+st)*pt;if(chromeVersion$1===null){const yt=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=yt?parseInt(yt[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&rt===2&&lt>=224e3&&ot===0&&(et[_e+3]=et[_e+3]|128),{sampleRate:ct,channelCount:dt,frameLength:ht,samplesPerFrame:mt}}}function isHeaderPattern(et,_e){return et[_e]===255&&(et[_e+1]&224)===224&&(et[_e+1]&6)!==0}function isHeader(et,_e){return _e+1<et.length&&isHeaderPattern(et,_e)}function canParse(et,_e){return isHeaderPattern(et,_e)&&4<=et.length-_e}function probe(et,_e){if(_e+1<et.length&&isHeaderPattern(et,_e)){const rt=parseHeader(et,_e);let nt=4;rt!=null&&rt.frameLength&&(nt=rt.frameLength);const it=_e+nt;return it===et.length||isHeader(et,it)}return!1}class AACDemuxer extends BaseAudioDemuxer{constructor(_e,tt){super(),this.observer=void 0,this.config=void 0,this.observer=_e,this.config=tt}resetInitSegment(_e,tt,rt,nt){super.resetInitSegment(_e,tt,rt,nt),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:tt,duration:nt,inputTimeScale:9e4,dropped:0}}static probe(_e){if(!_e)return!1;const tt=getID3Data(_e,0);let rt=(tt==null?void 0:tt.length)||0;if(probe(_e,rt))return!1;for(let nt=_e.length;rt<nt;rt++)if(probe$1(_e,rt))return logger.log("ADTS sync word found !"),!0;return!1}canParse(_e,tt){return canParse$1(_e,tt)}appendFrame(_e,tt,rt){initTrackConfig(_e,this.observer,tt,rt,_e.manifestCodec);const nt=appendFrame$2(_e,tt,rt,this.basePTS,this.frameIndex);if(nt&&nt.missing===0)return nt}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(_e,tt){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=tt}resetTimeStamp(){}resetInitSegment(_e,tt,rt,nt){const it=this.videoTrack=dummyTrack("video",1),st=this.audioTrack=dummyTrack("audio",1),ot=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(_e!=null&&_e.byteLength))return;const at=parseInitSegment(_e);if(at.video){const{id:lt,timescale:ut,codec:ct}=at.video;it.id=lt,it.timescale=ot.timescale=ut,it.codec=ct}if(at.audio){const{id:lt,timescale:ut,codec:ct}=at.audio;st.id=lt,st.timescale=ut,st.codec=ct}ot.id=RemuxerTrackIdConfig.text,it.sampleDuration=0,it.duration=st.duration=nt}resetContiguity(){this.remainderData=null}static probe(_e){return hasMoofData(_e)}demux(_e,tt){this.timeOffset=tt;let rt=_e;const nt=this.videoTrack,it=this.txtTrack;if(this.config.progressive){this.remainderData&&(rt=appendUint8Array(this.remainderData,_e));const ot=segmentValidRange(rt);this.remainderData=ot.remainder,nt.samples=ot.valid||new Uint8Array}else nt.samples=rt;const st=this.extractID3Track(nt,tt);return it.samples=parseSamples(tt,nt),{videoTrack:nt,audioTrack:this.audioTrack,id3Track:st,textTrack:this.txtTrack}}flush(){const _e=this.timeOffset,tt=this.videoTrack,rt=this.txtTrack;tt.samples=this.remainderData||new Uint8Array,this.remainderData=null;const nt=this.extractID3Track(tt,this.timeOffset);return rt.samples=parseSamples(_e,tt),{videoTrack:tt,audioTrack:dummyTrack(),id3Track:nt,textTrack:dummyTrack()}}extractID3Track(_e,tt){const rt=this.id3Track;if(_e.samples.length){const nt=findBox(_e.samples,["emsg"]);nt&&nt.forEach(it=>{const st=parseEmsg(it);if(emsgSchemePattern.test(st.schemeIdUri)){const ot=isFiniteNumber(st.presentationTime)?st.presentationTime/st.timeScale:tt+st.presentationTimeDelta/st.timeScale;let at=st.eventDuration===4294967295?Number.POSITIVE_INFINITY:st.eventDuration/st.timeScale;at<=.001&&(at=Number.POSITIVE_INFINITY);const lt=st.payload;rt.samples.push({data:lt,len:lt.byteLength,dts:ot,pts:ot,type:MetadataSchema.emsg,duration:at})}})}return rt}demuxSampleAes(_e,tt,rt){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const getAudioBSID=(et,_e)=>{let tt=0,rt=5;_e+=rt;const nt=new Uint32Array(1),it=new Uint32Array(1),st=new Uint8Array(1);for(;rt>0;){st[0]=et[_e];const ot=Math.min(rt,8),at=8-ot;it[0]=4278190080>>>24+at<<at,nt[0]=(st[0]&it[0])>>at,tt=tt?tt<<ot|nt[0]:nt[0],_e+=1,rt-=ot}return tt};class AC3Demuxer extends BaseAudioDemuxer{constructor(_e){super(),this.observer=void 0,this.observer=_e}resetInitSegment(_e,tt,rt,nt){super.resetInitSegment(_e,tt,rt,nt),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:tt,duration:nt,inputTimeScale:9e4,dropped:0}}canParse(_e,tt){return tt+64<_e.length}appendFrame(_e,tt,rt){const nt=appendFrame(_e,tt,rt,this.basePTS,this.frameIndex);if(nt!==-1)return{sample:_e.samples[_e.samples.length-1],length:nt,missing:0}}static probe(_e){if(!_e)return!1;const tt=getID3Data(_e,0);if(!tt)return!1;const rt=tt.length;return _e[rt]===11&&_e[rt+1]===119&&getTimeStamp(tt)!==void 0&&getAudioBSID(_e,rt)<16}}function appendFrame(et,_e,tt,rt,nt){if(tt+8>_e.length||_e[tt]!==11||_e[tt+1]!==119)return-1;const it=_e[tt+4]>>6;if(it>=3)return-1;const ot=[48e3,44100,32e3][it],at=_e[tt+4]&63,ut=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][at*3+it]*2;if(tt+ut>_e.length)return-1;const ct=_e[tt+6]>>5;let dt=0;ct===2?dt+=2:(ct&1&&ct!==1&&(dt+=2),ct&4&&(dt+=2));const ft=(_e[tt+6]<<8|_e[tt+7])>>12-dt&1,mt=[2,1,2,3,3,4,4,5][ct]+ft,ht=_e[tt+5]>>3,gt=_e[tt+5]&7,vt=new Uint8Array([it<<6|ht<<1|gt>>2,(gt&3)<<6|ct<<3|ft<<2|at>>4,at<<4&224]),yt=1536/ot*9e4,bt=rt+nt*yt,xt=_e.subarray(tt,tt+ut);return et.config=vt,et.channelCount=mt,et.samplerate=ot,et.samples.push({unit:xt,pts:bt}),ut}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(_e,tt,rt,nt){return{key:_e,frame:!1,pts:tt,dts:rt,units:[],debug:nt,length:0}}getLastNalUnit(_e){var tt;let rt=this.VideoSample,nt;if((!rt||rt.units.length===0)&&(rt=_e[_e.length-1]),(tt=rt)!=null&&tt.units){const it=rt.units;nt=it[it.length-1]}return nt}pushAccessUnit(_e,tt){if(_e.units.length&&_e.frame){if(_e.pts===void 0){const rt=tt.samples,nt=rt.length;if(nt){const it=rt[nt-1];_e.pts=it.pts,_e.dts=it.dts}else{tt.dropped++;return}}tt.samples.push(_e)}_e.debug.length&&logger.log(_e.pts+"/"+_e.dts+":"+_e.debug)}}class ExpGolomb{constructor(_e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=_e,this.bytesAvailable=_e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const _e=this.data,tt=this.bytesAvailable,rt=_e.byteLength-tt,nt=new Uint8Array(4),it=Math.min(4,tt);if(it===0)throw new Error("no bytes available");nt.set(_e.subarray(rt,rt+it)),this.word=new DataView(nt.buffer).getUint32(0),this.bitsAvailable=it*8,this.bytesAvailable-=it}skipBits(_e){let tt;_e=Math.min(_e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>_e?(this.word<<=_e,this.bitsAvailable-=_e):(_e-=this.bitsAvailable,tt=_e>>3,_e-=tt<<3,this.bytesAvailable-=tt,this.loadWord(),this.word<<=_e,this.bitsAvailable-=_e)}readBits(_e){let tt=Math.min(this.bitsAvailable,_e);const rt=this.word>>>32-tt;if(_e>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=tt,this.bitsAvailable>0)this.word<<=tt;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return tt=_e-tt,tt>0&&this.bitsAvailable?rt<<tt|this.readBits(tt):rt}skipLZ(){let _e;for(_e=0;_e<this.bitsAvailable;++_e)if(this.word&2147483648>>>_e)return this.word<<=_e,this.bitsAvailable-=_e,_e;return this.loadWord(),_e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const _e=this.skipLZ();return this.readBits(_e+1)-1}readEG(){const _e=this.readUEG();return 1&_e?1+_e>>>1:-1*(_e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(_e){let tt=8,rt=8,nt;for(let it=0;it<_e;it++)rt!==0&&(nt=this.readEG(),rt=(tt+nt+256)%256),tt=rt===0?tt:rt}readSPS(){let _e=0,tt=0,rt=0,nt=0,it,st,ot;const at=this.readUByte.bind(this),lt=this.readBits.bind(this),ut=this.readUEG.bind(this),ct=this.readBoolean.bind(this),dt=this.skipBits.bind(this),ft=this.skipEG.bind(this),pt=this.skipUEG.bind(this),mt=this.skipScalingList.bind(this);at();const ht=at();if(lt(5),dt(3),at(),pt(),ht===100||ht===110||ht===122||ht===244||ht===44||ht===83||ht===86||ht===118||ht===128){const _t=ut();if(_t===3&&dt(1),pt(),pt(),dt(1),ct())for(st=_t!==3?8:12,ot=0;ot<st;ot++)ct()&&(ot<6?mt(16):mt(64))}pt();const gt=ut();if(gt===0)ut();else if(gt===1)for(dt(1),ft(),ft(),it=ut(),ot=0;ot<it;ot++)ft();pt(),dt(1);const vt=ut(),yt=ut(),bt=lt(1);bt===0&&dt(1),dt(1),ct()&&(_e=ut(),tt=ut(),rt=ut(),nt=ut());let xt=[1,1];if(ct()&&ct())switch(at()){case 1:xt=[1,1];break;case 2:xt=[12,11];break;case 3:xt=[10,11];break;case 4:xt=[16,11];break;case 5:xt=[40,33];break;case 6:xt=[24,11];break;case 7:xt=[20,11];break;case 8:xt=[32,11];break;case 9:xt=[80,33];break;case 10:xt=[18,11];break;case 11:xt=[15,11];break;case 12:xt=[64,33];break;case 13:xt=[160,99];break;case 14:xt=[4,3];break;case 15:xt=[3,2];break;case 16:xt=[2,1];break;case 255:{xt=[at()<<8|at(),at()<<8|at()];break}}return{width:Math.ceil((vt+1)*16-_e*2-tt*2),height:(2-bt)*(yt+1)*16-(bt?2:4)*(rt+nt),pixelRatio:xt}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class AvcVideoParser extends BaseVideoParser{parseAVCPES(_e,tt,rt,nt,it){const st=this.parseAVCNALu(_e,rt.data);let ot=this.VideoSample,at,lt=!1;rt.data=null,ot&&st.length&&!_e.audFound&&(this.pushAccessUnit(ot,_e),ot=this.VideoSample=this.createVideoSample(!1,rt.pts,rt.dts,"")),st.forEach(ut=>{var ct;switch(ut.type){case 1:{let mt=!1;at=!0;const ht=ut.data;if(lt&&ht.length>4){const gt=new ExpGolomb(ht).readSliceType();(gt===2||gt===4||gt===7||gt===9)&&(mt=!0)}if(mt){var dt;(dt=ot)!=null&&dt.frame&&!ot.key&&(this.pushAccessUnit(ot,_e),ot=this.VideoSample=null)}ot||(ot=this.VideoSample=this.createVideoSample(!0,rt.pts,rt.dts,"")),ot.frame=!0,ot.key=mt;break}case 5:at=!0,(ct=ot)!=null&&ct.frame&&!ot.key&&(this.pushAccessUnit(ot,_e),ot=this.VideoSample=null),ot||(ot=this.VideoSample=this.createVideoSample(!0,rt.pts,rt.dts,"")),ot.key=!0,ot.frame=!0;break;case 6:{at=!0,parseSEIMessageFromNALu(ut.data,1,rt.pts,tt.samples);break}case 7:{var ft,pt;at=!0,lt=!0;const mt=ut.data,gt=new ExpGolomb(mt).readSPS();if(!_e.sps||_e.width!==gt.width||_e.height!==gt.height||((ft=_e.pixelRatio)==null?void 0:ft[0])!==gt.pixelRatio[0]||((pt=_e.pixelRatio)==null?void 0:pt[1])!==gt.pixelRatio[1]){_e.width=gt.width,_e.height=gt.height,_e.pixelRatio=gt.pixelRatio,_e.sps=[mt],_e.duration=it;const vt=mt.subarray(1,4);let yt="avc1.";for(let bt=0;bt<3;bt++){let xt=vt[bt].toString(16);xt.length<2&&(xt="0"+xt),yt+=xt}_e.codec=yt}break}case 8:at=!0,_e.pps=[ut.data];break;case 9:at=!0,_e.audFound=!0,ot&&this.pushAccessUnit(ot,_e),ot=this.VideoSample=this.createVideoSample(!1,rt.pts,rt.dts,"");break;case 12:at=!0;break;default:at=!1,ot&&(ot.debug+="unknown NAL "+ut.type+" ");break}ot&&at&&ot.units.push(ut)}),nt&&ot&&(this.pushAccessUnit(ot,_e),this.VideoSample=null)}parseAVCNALu(_e,tt){const rt=tt.byteLength;let nt=_e.naluState||0;const it=nt,st=[];let ot=0,at,lt,ut,ct=-1,dt=0;for(nt===-1&&(ct=0,dt=tt[0]&31,nt=0,ot=1);ot<rt;){if(at=tt[ot++],!nt){nt=at?0:1;continue}if(nt===1){nt=at?0:2;continue}if(!at)nt=3;else if(at===1){if(lt=ot-nt-1,ct>=0){const ft={data:tt.subarray(ct,lt),type:dt};st.push(ft)}else{const ft=this.getLastNalUnit(_e.samples);ft&&(it&&ot<=4-it&&ft.state&&(ft.data=ft.data.subarray(0,ft.data.byteLength-it)),lt>0&&(ft.data=appendUint8Array(ft.data,tt.subarray(0,lt)),ft.state=0))}ot<rt?(ut=tt[ot]&31,ct=ot,dt=ut,nt=0):nt=-1}else nt=0}if(ct>=0&&nt>=0){const ft={data:tt.subarray(ct,rt),type:dt,state:nt};st.push(ft)}if(st.length===0){const ft=this.getLastNalUnit(_e.samples);ft&&(ft.data=appendUint8Array(ft.data,tt))}return _e.naluState=nt,st}}class SampleAesDecrypter{constructor(_e,tt,rt){this.keyData=void 0,this.decrypter=void 0,this.keyData=rt,this.decrypter=new Decrypter(tt,{removePKCS7Padding:!1})}decryptBuffer(_e){return this.decrypter.decrypt(_e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(_e,tt,rt){const nt=_e[tt].unit;if(nt.length<=16)return;const it=nt.subarray(16,nt.length-nt.length%16),st=it.buffer.slice(it.byteOffset,it.byteOffset+it.length);this.decryptBuffer(st).then(ot=>{const at=new Uint8Array(ot);nt.set(at,16),this.decrypter.isSync()||this.decryptAacSamples(_e,tt+1,rt)})}decryptAacSamples(_e,tt,rt){for(;;tt++){if(tt>=_e.length){rt();return}if(!(_e[tt].unit.length<32)&&(this.decryptAacSample(_e,tt,rt),!this.decrypter.isSync()))return}}getAvcEncryptedData(_e){const tt=Math.floor((_e.length-48)/160)*16+16,rt=new Int8Array(tt);let nt=0;for(let it=32;it<_e.length-16;it+=160,nt+=16)rt.set(_e.subarray(it,it+16),nt);return rt}getAvcDecryptedUnit(_e,tt){const rt=new Uint8Array(tt);let nt=0;for(let it=32;it<_e.length-16;it+=160,nt+=16)_e.set(rt.subarray(nt,nt+16),it);return _e}decryptAvcSample(_e,tt,rt,nt,it){const st=discardEPB(it.data),ot=this.getAvcEncryptedData(st);this.decryptBuffer(ot.buffer).then(at=>{it.data=this.getAvcDecryptedUnit(st,at),this.decrypter.isSync()||this.decryptAvcSamples(_e,tt,rt+1,nt)})}decryptAvcSamples(_e,tt,rt,nt){if(_e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;tt++,rt=0){if(tt>=_e.length){nt();return}const it=_e[tt].units;for(;!(rt>=it.length);rt++){const st=it[rt];if(!(st.data.length<=48||st.type!==1&&st.type!==5)&&(this.decryptAvcSample(_e,tt,rt,nt,st),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(_e,tt,rt){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=_e,this.config=tt,this.typeSupported=rt,this.videoParser=new AvcVideoParser}static probe(_e){const tt=TSDemuxer.syncOffset(_e);return tt>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${tt}`),tt!==-1}static syncOffset(_e){const tt=_e.length;let rt=Math.min(PACKET_LENGTH*5,tt-PACKET_LENGTH)+1,nt=0;for(;nt<rt;){let it=!1,st=-1,ot=0;for(let at=nt;at<tt;at+=PACKET_LENGTH)if(_e[at]===71&&(tt-at===PACKET_LENGTH||_e[at+PACKET_LENGTH]===71)){if(ot++,st===-1&&(st=at,st!==0&&(rt=Math.min(st+PACKET_LENGTH*99,_e.length-PACKET_LENGTH)+1)),it||(it=parsePID(_e,at)===0),it&&ot>1&&(st===0&&ot>2||at+PACKET_LENGTH>rt))return st}else{if(ot)return-1;break}nt++}return-1}static createTrack(_e,tt){return{container:_e==="video"||_e==="audio"?"video/mp2t":void 0,type:_e,id:RemuxerTrackIdConfig[_e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:_e==="audio"?tt:void 0}}resetInitSegment(_e,tt,rt,nt){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",nt),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=tt,this.videoCodec=rt,this._duration=nt}resetTimeStamp(){}resetContiguity(){const{_audioTrack:_e,_videoTrack:tt,_id3Track:rt}=this;_e&&(_e.pesData=null),tt&&(tt.pesData=null),rt&&(rt.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(_e,tt,rt=!1,nt=!1){rt||(this.sampleAes=null);let it;const st=this._videoTrack,ot=this._audioTrack,at=this._id3Track,lt=this._txtTrack;let ut=st.pid,ct=st.pesData,dt=ot.pid,ft=at.pid,pt=ot.pesData,mt=at.pesData,ht=null,gt=this.pmtParsed,vt=this._pmtId,yt=_e.length;if(this.remainderData&&(_e=appendUint8Array(this.remainderData,_e),yt=_e.length,this.remainderData=null),yt<PACKET_LENGTH&&!nt)return this.remainderData=_e,{audioTrack:ot,videoTrack:st,id3Track:at,textTrack:lt};const bt=Math.max(0,TSDemuxer.syncOffset(_e));yt-=(yt-bt)%PACKET_LENGTH,yt<_e.byteLength&&!nt&&(this.remainderData=new Uint8Array(_e.buffer,yt,_e.buffer.byteLength-yt));let xt=0;for(let wt=bt;wt<yt;wt+=PACKET_LENGTH)if(_e[wt]===71){const Ct=!!(_e[wt+1]&64),kt=parsePID(_e,wt),At=(_e[wt+3]&48)>>4;let $t;if(At>1){if($t=wt+5+_e[wt+4],$t===wt+PACKET_LENGTH)continue}else $t=wt+4;switch(kt){case ut:Ct&&(ct&&(it=parsePES(ct))&&this.videoParser.parseAVCPES(st,lt,it,!1,this._duration),ct={data:[],size:0}),ct&&(ct.data.push(_e.subarray($t,wt+PACKET_LENGTH)),ct.size+=wt+PACKET_LENGTH-$t);break;case dt:if(Ct){if(pt&&(it=parsePES(pt)))switch(ot.segmentCodec){case"aac":this.parseAACPES(ot,it);break;case"mp3":this.parseMPEGPES(ot,it);break;case"ac3":this.parseAC3PES(ot,it);break}pt={data:[],size:0}}pt&&(pt.data.push(_e.subarray($t,wt+PACKET_LENGTH)),pt.size+=wt+PACKET_LENGTH-$t);break;case ft:Ct&&(mt&&(it=parsePES(mt))&&this.parseID3PES(at,it),mt={data:[],size:0}),mt&&(mt.data.push(_e.subarray($t,wt+PACKET_LENGTH)),mt.size+=wt+PACKET_LENGTH-$t);break;case 0:Ct&&($t+=_e[$t]+1),vt=this._pmtId=parsePAT(_e,$t);break;case vt:{Ct&&($t+=_e[$t]+1);const Lt=parsePMT(_e,$t,this.typeSupported,rt);ut=Lt.videoPid,ut>0&&(st.pid=ut,st.segmentCodec=Lt.segmentVideoCodec),dt=Lt.audioPid,dt>0&&(ot.pid=dt,ot.segmentCodec=Lt.segmentAudioCodec),ft=Lt.id3Pid,ft>0&&(at.pid=ft),ht!==null&&!gt&&(logger.warn(`MPEG-TS PMT found at ${wt} after unknown PID '${ht}'. Backtracking to sync byte @${bt} to parse all TS packets.`),ht=null,wt=bt-188),gt=this.pmtParsed=!0;break}case 17:case 8191:break;default:ht=kt;break}}else xt++;if(xt>0){const wt=new Error(`Found ${xt} TS packet/s that do not start with 0x47`);this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:wt,reason:wt.message})}st.pesData=ct,ot.pesData=pt,at.pesData=mt;const _t={audioTrack:ot,videoTrack:st,id3Track:at,textTrack:lt};return nt&&this.extractRemainingSamples(_t),_t}flush(){const{remainderData:_e}=this;this.remainderData=null;let tt;return _e?tt=this.demux(_e,-1,!1,!0):tt={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(tt),this.sampleAes?this.decrypt(tt,this.sampleAes):tt}extractRemainingSamples(_e){const{audioTrack:tt,videoTrack:rt,id3Track:nt,textTrack:it}=_e,st=rt.pesData,ot=tt.pesData,at=nt.pesData;let lt;if(st&&(lt=parsePES(st))?(this.videoParser.parseAVCPES(rt,it,lt,!0,this._duration),rt.pesData=null):rt.pesData=st,ot&&(lt=parsePES(ot))){switch(tt.segmentCodec){case"aac":this.parseAACPES(tt,lt);break;case"mp3":this.parseMPEGPES(tt,lt);break;case"ac3":this.parseAC3PES(tt,lt);break}tt.pesData=null}else ot!=null&&ot.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),tt.pesData=ot;at&&(lt=parsePES(at))?(this.parseID3PES(nt,lt),nt.pesData=null):nt.pesData=at}demuxSampleAes(_e,tt,rt){const nt=this.demux(_e,rt,!0,!this.config.progressive),it=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,tt);return this.decrypt(nt,it)}decrypt(_e,tt){return new Promise(rt=>{const{audioTrack:nt,videoTrack:it}=_e;nt.samples&&nt.segmentCodec==="aac"?tt.decryptAacSamples(nt.samples,0,()=>{it.samples?tt.decryptAvcSamples(it.samples,0,0,()=>{rt(_e)}):rt(_e)}):it.samples&&tt.decryptAvcSamples(it.samples,0,0,()=>{rt(_e)})})}destroy(){this._duration=0}parseAACPES(_e,tt){let rt=0;const nt=this.aacOverFlow;let it=tt.data;if(nt){this.aacOverFlow=null;const ct=nt.missing,dt=nt.sample.unit.byteLength;if(ct===-1)it=appendUint8Array(nt.sample.unit,it);else{const ft=dt-ct;nt.sample.unit.set(it.subarray(0,ct),ft),_e.samples.push(nt.sample),rt=nt.missing}}let st,ot;for(st=rt,ot=it.length;st<ot-1&&!isHeader$1(it,st);st++);if(st!==rt){let ct;const dt=st<ot-1;dt?ct=`AAC PES did not start with ADTS header,offset:${st}`:ct="No ADTS header found in AAC PES";const ft=new Error(ct);if(logger.warn(`parsing error: ${ct}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:dt,error:ft,reason:ct}),!dt)return}initTrackConfig(_e,this.observer,it,st,this.audioCodec);let at;if(tt.pts!==void 0)at=tt.pts;else if(nt){const ct=getFrameDuration(_e.samplerate);at=nt.sample.pts+ct}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let lt=0,ut;for(;st<ot;)if(ut=appendFrame$2(_e,it,st,at,lt),st+=ut.length,ut.missing){this.aacOverFlow=ut;break}else for(lt++;st<ot-1&&!isHeader$1(it,st);st++);}parseMPEGPES(_e,tt){const rt=tt.data,nt=rt.length;let it=0,st=0;const ot=tt.pts;if(ot===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;st<nt;)if(isHeader(rt,st)){const at=appendFrame$1(_e,rt,st,ot,it);if(at)st+=at.length,it++;else break}else st++}parseAC3PES(_e,tt){{const rt=tt.data,nt=tt.pts;if(nt===void 0){logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const it=rt.length;let st=0,ot=0,at;for(;ot<it&&(at=appendFrame(_e,rt,ot,nt,st++))>0;)ot+=at}}parseID3PES(_e,tt){if(tt.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const rt=_extends({},tt,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});_e.samples.push(rt)}}function parsePID(et,_e){return((et[_e+1]&31)<<8)+et[_e+2]}function parsePAT(et,_e){return(et[_e+10]&31)<<8|et[_e+11]}function parsePMT(et,_e,tt,rt){const nt={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},it=(et[_e+1]&15)<<8|et[_e+2],st=_e+3+it-4,ot=(et[_e+10]&15)<<8|et[_e+11];for(_e+=12+ot;_e<st;){const at=parsePID(et,_e),lt=(et[_e+3]&15)<<8|et[_e+4];switch(et[_e]){case 207:if(!rt){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:nt.audioPid===-1&&(nt.audioPid=at);break;case 21:nt.id3Pid===-1&&(nt.id3Pid=at);break;case 219:if(!rt){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:nt.videoPid===-1&&(nt.videoPid=at,nt.segmentVideoCodec="avc");break;case 3:case 4:!tt.mpeg&&!tt.mp3?logger.log("MPEG audio found, not supported in this browser"):nt.audioPid===-1&&(nt.audioPid=at,nt.segmentAudioCodec="mp3");break;case 193:if(!rt){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:tt.ac3?nt.audioPid===-1&&(nt.audioPid=at,nt.segmentAudioCodec="ac3"):logger.log("AC-3 audio found, not supported in this browser");break;case 6:if(nt.audioPid===-1&&lt>0){let ut=_e+5,ct=lt;for(;ct>2;){switch(et[ut]){case 106:tt.ac3!==!0?logger.log("AC-3 audio found, not supported in this browser for now"):(nt.audioPid=at,nt.segmentAudioCodec="ac3");break}const ft=et[ut+1]+2;ut+=ft,ct-=ft}}break;case 194:case 135:logger.warn("Unsupported EC-3 in M2TS found");break;case 36:logger.warn("Unsupported HEVC in M2TS found");break}_e+=lt+5}return nt}function logEncryptedSamplesFoundInUnencryptedStream(et){logger.log(`${et} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(et){let _e=0,tt,rt,nt,it,st;const ot=et.data;if(!et||et.size===0)return null;for(;ot[0].length<19&&ot.length>1;)ot[0]=appendUint8Array(ot[0],ot[1]),ot.splice(1,1);if(tt=ot[0],(tt[0]<<16)+(tt[1]<<8)+tt[2]===1){if(rt=(tt[4]<<8)+tt[5],rt&&rt>et.size-6)return null;const lt=tt[7];lt&192&&(it=(tt[9]&14)*536870912+(tt[10]&255)*4194304+(tt[11]&254)*16384+(tt[12]&255)*128+(tt[13]&254)/2,lt&64?(st=(tt[14]&14)*536870912+(tt[15]&255)*4194304+(tt[16]&254)*16384+(tt[17]&255)*128+(tt[18]&254)/2,it-st>60*9e4&&(logger.warn(`${Math.round((it-st)/9e4)}s delta between PTS and DTS, align them`),it=st)):st=it),nt=tt[8];let ut=nt+9;if(et.size<=ut)return null;et.size-=ut;const ct=new Uint8Array(et.size);for(let dt=0,ft=ot.length;dt<ft;dt++){tt=ot[dt];let pt=tt.byteLength;if(ut)if(ut>pt){ut-=pt;continue}else tt=tt.subarray(ut),pt-=ut,ut=0;ct.set(tt,_e),_e+=pt}return rt&&(rt-=nt+3),{data:ct,pts:it,dts:st,len:rt}}return null}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(_e,tt,rt,nt){super.resetInitSegment(_e,tt,rt,nt),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:tt,duration:nt,inputTimeScale:9e4,dropped:0}}static probe(_e){if(!_e)return!1;const tt=getID3Data(_e,0);let rt=(tt==null?void 0:tt.length)||0;if(tt&&_e[rt]===11&&_e[rt+1]===119&&getTimeStamp(tt)!==void 0&&getAudioBSID(_e,rt)<=16)return!1;for(let nt=_e.length;rt<nt;rt++)if(probe(_e,rt))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(_e,tt){return canParse(_e,tt)}appendFrame(_e,tt,rt){if(this.basePTS!==null)return appendFrame$1(_e,tt,rt,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(_e,tt){switch(_e){case"mp4a.40.2":if(tt===1)return new Uint8Array([0,200,0,128,35,128]);if(tt===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(tt===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(tt===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(tt===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(tt===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(tt===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(tt===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(tt===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let _e;for(_e in MP4.types)MP4.types.hasOwnProperty(_e)&&(MP4.types[_e]=[_e.charCodeAt(0),_e.charCodeAt(1),_e.charCodeAt(2),_e.charCodeAt(3)]);const tt=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),rt=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:tt,audio:rt};const nt=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),it=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=it,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const st=new Uint8Array([105,115,111,109]),ot=new Uint8Array([97,118,99,49]),at=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,st,at,st,ot),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,nt))}static box(_e,...tt){let rt=8,nt=tt.length;const it=nt;for(;nt--;)rt+=tt[nt].byteLength;const st=new Uint8Array(rt);for(st[0]=rt>>24&255,st[1]=rt>>16&255,st[2]=rt>>8&255,st[3]=rt&255,st.set(_e,4),nt=0,rt=8;nt<it;nt++)st.set(tt[nt],rt),rt+=tt[nt].byteLength;return st}static hdlr(_e){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[_e])}static mdat(_e){return MP4.box(MP4.types.mdat,_e)}static mdhd(_e,tt){tt*=_e;const rt=Math.floor(tt/(UINT32_MAX+1)),nt=Math.floor(tt%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_e>>24&255,_e>>16&255,_e>>8&255,_e&255,rt>>24,rt>>16&255,rt>>8&255,rt&255,nt>>24,nt>>16&255,nt>>8&255,nt&255,85,196,0,0]))}static mdia(_e){return MP4.box(MP4.types.mdia,MP4.mdhd(_e.timescale,_e.duration),MP4.hdlr(_e.type),MP4.minf(_e))}static mfhd(_e){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,_e>>24,_e>>16&255,_e>>8&255,_e&255]))}static minf(_e){return _e.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(_e)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(_e))}static moof(_e,tt,rt){return MP4.box(MP4.types.moof,MP4.mfhd(_e),MP4.traf(rt,tt))}static moov(_e){let tt=_e.length;const rt=[];for(;tt--;)rt[tt]=MP4.trak(_e[tt]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(_e[0].timescale,_e[0].duration)].concat(rt).concat(MP4.mvex(_e)))}static mvex(_e){let tt=_e.length;const rt=[];for(;tt--;)rt[tt]=MP4.trex(_e[tt]);return MP4.box.apply(null,[MP4.types.mvex,...rt])}static mvhd(_e,tt){tt*=_e;const rt=Math.floor(tt/(UINT32_MAX+1)),nt=Math.floor(tt%(UINT32_MAX+1)),it=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_e>>24&255,_e>>16&255,_e>>8&255,_e&255,rt>>24,rt>>16&255,rt>>8&255,rt&255,nt>>24,nt>>16&255,nt>>8&255,nt&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,it)}static sdtp(_e){const tt=_e.samples||[],rt=new Uint8Array(4+tt.length);let nt,it;for(nt=0;nt<tt.length;nt++)it=tt[nt].flags,rt[nt+4]=it.dependsOn<<4|it.isDependedOn<<2|it.hasRedundancy;return MP4.box(MP4.types.sdtp,rt)}static stbl(_e){return MP4.box(MP4.types.stbl,MP4.stsd(_e),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(_e){let tt=[],rt=[],nt,it,st;for(nt=0;nt<_e.sps.length;nt++)it=_e.sps[nt],st=it.byteLength,tt.push(st>>>8&255),tt.push(st&255),tt=tt.concat(Array.prototype.slice.call(it));for(nt=0;nt<_e.pps.length;nt++)it=_e.pps[nt],st=it.byteLength,rt.push(st>>>8&255),rt.push(st&255),rt=rt.concat(Array.prototype.slice.call(it));const ot=MP4.box(MP4.types.avcC,new Uint8Array([1,tt[3],tt[4],tt[5],255,224|_e.sps.length].concat(tt).concat([_e.pps.length]).concat(rt))),at=_e.width,lt=_e.height,ut=_e.pixelRatio[0],ct=_e.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,at>>8&255,at&255,lt>>8&255,lt&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),ot,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([ut>>24,ut>>16&255,ut>>8&255,ut&255,ct>>24,ct>>16&255,ct>>8&255,ct&255])))}static esds(_e){const tt=_e.config.length;return new Uint8Array([0,0,0,0,3,23+tt,0,1,0,4,15+tt,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([tt]).concat(_e.config).concat([6,1,2]))}static audioStsd(_e){const tt=_e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_e.channelCount,0,16,0,0,0,0,tt>>8&255,tt&255,0,0])}static mp4a(_e){return MP4.box(MP4.types.mp4a,MP4.audioStsd(_e),MP4.box(MP4.types.esds,MP4.esds(_e)))}static mp3(_e){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(_e))}static ac3(_e){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(_e),MP4.box(MP4.types.dac3,_e.config))}static stsd(_e){return _e.type==="audio"?_e.segmentCodec==="mp3"&&_e.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(_e)):_e.segmentCodec==="ac3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(_e)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(_e)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(_e))}static tkhd(_e){const tt=_e.id,rt=_e.duration*_e.timescale,nt=_e.width,it=_e.height,st=Math.floor(rt/(UINT32_MAX+1)),ot=Math.floor(rt%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,tt>>24&255,tt>>16&255,tt>>8&255,tt&255,0,0,0,0,st>>24,st>>16&255,st>>8&255,st&255,ot>>24,ot>>16&255,ot>>8&255,ot&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,nt>>8&255,nt&255,0,0,it>>8&255,it&255,0,0]))}static traf(_e,tt){const rt=MP4.sdtp(_e),nt=_e.id,it=Math.floor(tt/(UINT32_MAX+1)),st=Math.floor(tt%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,nt>>24,nt>>16&255,nt>>8&255,nt&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,it>>24,it>>16&255,it>>8&255,it&255,st>>24,st>>16&255,st>>8&255,st&255])),MP4.trun(_e,rt.length+16+20+8+16+8+8),rt)}static trak(_e){return _e.duration=_e.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(_e),MP4.mdia(_e))}static trex(_e){const tt=_e.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,tt>>24,tt>>16&255,tt>>8&255,tt&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(_e,tt){const rt=_e.samples||[],nt=rt.length,it=12+16*nt,st=new Uint8Array(it);let ot,at,lt,ut,ct,dt;for(tt+=8+it,st.set([_e.type==="video"?1:0,0,15,1,nt>>>24&255,nt>>>16&255,nt>>>8&255,nt&255,tt>>>24&255,tt>>>16&255,tt>>>8&255,tt&255],0),ot=0;ot<nt;ot++)at=rt[ot],lt=at.duration,ut=at.size,ct=at.flags,dt=at.cts,st.set([lt>>>24&255,lt>>>16&255,lt>>>8&255,lt&255,ut>>>24&255,ut>>>16&255,ut>>>8&255,ut&255,ct.isLeading<<2|ct.dependsOn,ct.isDependedOn<<6|ct.hasRedundancy<<4|ct.paddingValue<<1|ct.isNonSync,ct.degradPrio&61440,ct.degradPrio&15,dt>>>24&255,dt>>>16&255,dt>>>8&255,dt&255],12+16*ot);return MP4.box(MP4.types.trun,st)}static initSegment(_e){MP4.types||MP4.init();const tt=MP4.moov(_e);return appendUint8Array(MP4.FTYP,tt)}}MP4.types=void 0,MP4.HDLR_TYPES=void 0,MP4.STTS=void 0,MP4.STSC=void 0,MP4.STCO=void 0,MP4.STSZ=void 0,MP4.VMHD=void 0,MP4.SMHD=void 0,MP4.STSD=void 0,MP4.FTYP=void 0,MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(et,_e,tt=1,rt=!1){const nt=et*_e*tt;return rt?Math.round(nt):nt}function toTimescaleFromScale(et,_e,tt=1,rt=!1){return toTimescaleFromBase(et,_e,1/tt,rt)}function toMsFromMpegTsClock(et,_e=!1){return toTimescaleFromBase(et,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,_e)}function toMpegTsClockFromTimescale(et,_e=1){return toTimescaleFromBase(et,MPEG_TS_CLOCK_FREQ_HZ,1/_e)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(_e,tt,rt,nt=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=_e,this.config=tt,this.typeSupported=rt,this.ISGenerated=!1,chromeVersion===null){const st=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=st?parseInt(st[1]):0}if(safariWebkitVersion===null){const it=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=it?parseInt(it[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(_e){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=_e}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(_e){let tt=!1;const rt=_e.reduce((nt,it)=>{const st=it.pts-nt;return st<-4294967296?(tt=!0,normalizePts(nt,it.pts)):st>0?nt:it.pts},_e[0].pts);return tt&&logger.debug("PTS rollover detected"),rt}remux(_e,tt,rt,nt,it,st,ot,at){let lt,ut,ct,dt,ft,pt,mt=it,ht=it;const gt=_e.pid>-1,vt=tt.pid>-1,yt=tt.samples.length,bt=_e.samples.length>0,xt=ot&&yt>0||yt>1;if((!gt||bt)&&(!vt||xt)||this.ISGenerated||ot){if(this.ISGenerated){var wt,Ct,kt,At;const Bt=this.videoTrackConfig;Bt&&(tt.width!==Bt.width||tt.height!==Bt.height||((wt=tt.pixelRatio)==null?void 0:wt[0])!==((Ct=Bt.pixelRatio)==null?void 0:Ct[0])||((kt=tt.pixelRatio)==null?void 0:kt[1])!==((At=Bt.pixelRatio)==null?void 0:At[1]))&&this.resetInitSegment()}else ct=this.generateIS(_e,tt,it,st);const $t=this.isVideoContiguous;let Lt=-1,Mt;if(xt&&(Lt=findKeyframeIndex(tt.samples),!$t&&this.config.forceKeyFrameOnDiscontinuity))if(pt=!0,Lt>0){logger.warn(`[mp4-remuxer]: Dropped ${Lt} out of ${yt} video samples due to a missing keyframe`);const Bt=this.getVideoStartPts(tt.samples);tt.samples=tt.samples.slice(Lt),tt.dropped+=Lt,ht+=(tt.samples[0].pts-Bt)/tt.inputTimeScale,Mt=ht}else Lt===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${yt} video samples`),pt=!1);if(this.ISGenerated){if(bt&&xt){const Bt=this.getVideoStartPts(tt.samples),Nt=(normalizePts(_e.samples[0].pts,Bt)-Bt)/tt.inputTimeScale;mt+=Math.max(0,Nt),ht+=Math.max(0,-Nt)}if(bt){if(_e.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),ct=this.generateIS(_e,tt,it,st)),ut=this.remuxAudio(_e,mt,this.isAudioContiguous,st,vt||xt||at===PlaylistLevelType.AUDIO?ht:void 0),xt){const Bt=ut?ut.endPTS-ut.startPTS:0;tt.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),ct=this.generateIS(_e,tt,it,st)),lt=this.remuxVideo(tt,ht,$t,Bt)}}else xt&&(lt=this.remuxVideo(tt,ht,$t,0));lt&&(lt.firstKeyFrame=Lt,lt.independent=Lt!==-1,lt.firstKeyFramePTS=Mt)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(rt.samples.length&&(ft=flushTextTrackMetadataCueSamples(rt,it,this._initPTS,this._initDTS)),nt.samples.length&&(dt=flushTextTrackUserdataCueSamples(nt,it,this._initPTS))),{audio:ut,video:lt,initSegment:ct,independent:pt,text:dt,id3:ft}}generateIS(_e,tt,rt,nt){const it=_e.samples,st=tt.samples,ot=this.typeSupported,at={},lt=this._initPTS;let ut=!lt||nt,ct="audio/mp4",dt,ft,pt;if(ut&&(dt=ft=1/0),_e.config&&it.length){switch(_e.timescale=_e.samplerate,_e.segmentCodec){case"mp3":ot.mpeg?(ct="audio/mpeg",_e.codec=""):ot.mp3&&(_e.codec="mp3");break;case"ac3":_e.codec="ac-3";break}at.audio={id:"audio",container:ct,codec:_e.codec,initSegment:_e.segmentCodec==="mp3"&&ot.mpeg?new Uint8Array(0):MP4.initSegment([_e]),metadata:{channelCount:_e.channelCount}},ut&&(pt=_e.inputTimeScale,!lt||pt!==lt.timescale?dt=ft=it[0].pts-Math.round(pt*rt):ut=!1)}if(tt.sps&&tt.pps&&st.length){if(tt.timescale=tt.inputTimeScale,at.video={id:"main",container:"video/mp4",codec:tt.codec,initSegment:MP4.initSegment([tt]),metadata:{width:tt.width,height:tt.height}},ut)if(pt=tt.inputTimeScale,!lt||pt!==lt.timescale){const mt=this.getVideoStartPts(st),ht=Math.round(pt*rt);ft=Math.min(ft,normalizePts(st[0].dts,mt)-ht),dt=Math.min(dt,mt-ht)}else ut=!1;this.videoTrackConfig={width:tt.width,height:tt.height,pixelRatio:tt.pixelRatio}}if(Object.keys(at).length)return this.ISGenerated=!0,ut?(this._initPTS={baseTime:dt,timescale:pt},this._initDTS={baseTime:ft,timescale:pt}):dt=pt=void 0,{tracks:at,initPTS:dt,timescale:pt}}remuxVideo(_e,tt,rt,nt){const it=_e.inputTimeScale,st=_e.samples,ot=[],at=st.length,lt=this._initPTS;let ut=this.nextAvcDts,ct=8,dt=this.videoSampleDuration,ft,pt,mt=Number.POSITIVE_INFINITY,ht=Number.NEGATIVE_INFINITY,gt=!1;if(!rt||ut===null){const Ut=tt*it,Ht=st[0].pts-normalizePts(st[0].dts,st[0].pts);chromeVersion&&ut!==null&&Math.abs(Ut-Ht-ut)<15e3?rt=!0:ut=Ut-Ht}const vt=lt.baseTime*it/lt.timescale;for(let Ut=0;Ut<at;Ut++){const Ht=st[Ut];Ht.pts=normalizePts(Ht.pts-vt,ut),Ht.dts=normalizePts(Ht.dts-vt,ut),Ht.dts<st[Ut>0?Ut-1:Ut].dts&&(gt=!0)}gt&&st.sort(function(Ut,Ht){const jt=Ut.dts-Ht.dts,Gt=Ut.pts-Ht.pts;return jt||Gt}),ft=st[0].dts,pt=st[st.length-1].dts;const yt=pt-ft,bt=yt?Math.round(yt/(at-1)):dt||_e.inputTimeScale/30;if(rt){const Ut=ft-ut,Ht=Ut>bt,jt=Ut<-1;if((Ht||jt)&&(Ht?logger.warn(`AVC: ${toMsFromMpegTsClock(Ut,!0)} ms (${Ut}dts) hole between fragments detected at ${tt.toFixed(3)}`):logger.warn(`AVC: ${toMsFromMpegTsClock(-Ut,!0)} ms (${Ut}dts) overlapping between fragments detected at ${tt.toFixed(3)}`),!jt||ut>=st[0].pts||chromeVersion)){ft=ut;const Gt=st[0].pts-Ut;if(Ht)st[0].dts=ft,st[0].pts=Gt;else for(let tr=0;tr<st.length&&!(st[tr].dts>Gt);tr++)st[tr].dts-=Ut,st[tr].pts-=Ut;logger.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(Gt,!0)}/${toMsFromMpegTsClock(ft,!0)}, delta: ${toMsFromMpegTsClock(Ut,!0)} ms`)}}ft=Math.max(0,ft);let xt=0,_t=0,wt=ft;for(let Ut=0;Ut<at;Ut++){const Ht=st[Ut],jt=Ht.units,Gt=jt.length;let tr=0;for(let Yt=0;Yt<Gt;Yt++)tr+=jt[Yt].data.length;_t+=tr,xt+=Gt,Ht.length=tr,Ht.dts<wt?(Ht.dts=wt,wt+=bt/4|0||1):wt=Ht.dts,mt=Math.min(Ht.pts,mt),ht=Math.max(Ht.pts,ht)}pt=st[at-1].dts;const Ct=_t+4*xt+8;let kt;try{kt=new Uint8Array(Ct)}catch(Ut){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:Ut,bytes:Ct,reason:`fail allocating video mdat ${Ct}`});return}const At=new DataView(kt.buffer);At.setUint32(0,Ct),kt.set(MP4.types.mdat,4);let $t=!1,Lt=Number.POSITIVE_INFINITY,Mt=Number.POSITIVE_INFINITY,Bt=Number.NEGATIVE_INFINITY,Pt=Number.NEGATIVE_INFINITY;for(let Ut=0;Ut<at;Ut++){const Ht=st[Ut],jt=Ht.units;let Gt=0;for(let Jt=0,rr=jt.length;Jt<rr;Jt++){const qt=jt[Jt],nr=qt.data,vr=qt.data.byteLength;At.setUint32(ct,vr),ct+=4,kt.set(nr,ct),ct+=vr,Gt+=4+vr}let tr;if(Ut<at-1)dt=st[Ut+1].dts-Ht.dts,tr=st[Ut+1].pts-Ht.pts;else{const Jt=this.config,rr=Ut>0?Ht.dts-st[Ut-1].dts:bt;if(tr=Ut>0?Ht.pts-st[Ut-1].pts:bt,Jt.stretchShortVideoTrack&&this.nextAudioPts!==null){const qt=Math.floor(Jt.maxBufferHole*it),nr=(nt?mt+nt*it:this.nextAudioPts)-Ht.pts;nr>qt?(dt=nr-rr,dt<0?dt=rr:$t=!0,logger.log(`[mp4-remuxer]: It is approximately ${nr/90} ms to the next segment; using duration ${dt/90} ms for the last video frame.`)):dt=rr}else dt=rr}const Yt=Math.round(Ht.pts-Ht.dts);Lt=Math.min(Lt,dt),Bt=Math.max(Bt,dt),Mt=Math.min(Mt,tr),Pt=Math.max(Pt,tr),ot.push(new Mp4Sample(Ht.key,dt,Gt,Yt))}if(ot.length){if(chromeVersion){if(chromeVersion<70){const Ut=ot[0].flags;Ut.dependsOn=2,Ut.isNonSync=0}}else if(safariWebkitVersion&&Pt-Mt<Bt-Lt&&bt/Bt<.025&&ot[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let Ut=ft;for(let Ht=0,jt=ot.length;Ht<jt;Ht++){const Gt=Ut+ot[Ht].duration,tr=Ut+ot[Ht].cts;if(Ht<jt-1){const Yt=Gt+ot[Ht+1].cts;ot[Ht].duration=Yt-tr}else ot[Ht].duration=Ht?ot[Ht-1].duration:bt;ot[Ht].cts=0,Ut=Gt}}}dt=$t||!dt?bt:dt,this.nextAvcDts=ut=pt+dt,this.videoSampleDuration=dt,this.isVideoContiguous=!0;const Ft={data1:MP4.moof(_e.sequenceNumber++,ft,_extends({},_e,{samples:ot})),data2:kt,startPTS:mt/it,endPTS:(ht+dt)/it,startDTS:ft/it,endDTS:ut/it,type:"video",hasAudio:!1,hasVideo:!0,nb:ot.length,dropped:_e.dropped};return _e.samples=[],_e.dropped=0,Ft}getSamplesPerFrame(_e){switch(_e.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}}remuxAudio(_e,tt,rt,nt,it){const st=_e.inputTimeScale,ot=_e.samplerate?_e.samplerate:st,at=st/ot,lt=this.getSamplesPerFrame(_e),ut=lt*at,ct=this._initPTS,dt=_e.segmentCodec==="mp3"&&this.typeSupported.mpeg,ft=[],pt=it!==void 0;let mt=_e.samples,ht=dt?0:8,gt=this.nextAudioPts||-1;const vt=tt*st,yt=ct.baseTime*st/ct.timescale;if(this.isAudioContiguous=rt=rt||mt.length&&gt>0&&(nt&&Math.abs(vt-gt)<9e3||Math.abs(normalizePts(mt[0].pts-yt,vt)-gt)<20*ut),mt.forEach(function(Nt){Nt.pts=normalizePts(Nt.pts-yt,vt)}),!rt||gt<0){if(mt=mt.filter(Nt=>Nt.pts>=0),!mt.length)return;it===0?gt=0:nt&&!pt?gt=Math.max(0,vt):gt=mt[0].pts}if(_e.segmentCodec==="aac"){const Nt=this.config.maxAudioFramesDrift;for(let It=0,Ft=gt;It<mt.length;It++){const Ut=mt[It],Ht=Ut.pts,jt=Ht-Ft,Gt=Math.abs(1e3*jt/st);if(jt<=-Nt*ut&&pt)It===0&&(logger.warn(`Audio frame @ ${(Ht/st).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*jt/st)} ms.`),this.nextAudioPts=gt=Ft=Ht);else if(jt>=Nt*ut&&Gt<MAX_SILENT_FRAME_DURATION&&pt){let tr=Math.round(jt/ut);Ft=Ht-tr*ut,Ft<0&&(tr--,Ft+=ut),It===0&&(this.nextAudioPts=gt=Ft),logger.warn(`[mp4-remuxer]: Injecting ${tr} audio frame @ ${(Ft/st).toFixed(3)}s due to ${Math.round(1e3*jt/st)} ms gap.`);for(let Yt=0;Yt<tr;Yt++){const Jt=Math.max(Ft,0);let rr=AAC.getSilentFrame(_e.manifestCodec||_e.codec,_e.channelCount);rr||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),rr=Ut.unit.subarray()),mt.splice(It,0,{unit:rr,pts:Jt}),Ft+=ut,It++}}Ut.pts=Ft,Ft+=ut}}let bt=null,xt=null,_t,wt=0,Ct=mt.length;for(;Ct--;)wt+=mt[Ct].unit.byteLength;for(let Nt=0,It=mt.length;Nt<It;Nt++){const Ft=mt[Nt],Ut=Ft.unit;let Ht=Ft.pts;if(xt!==null){const Gt=ft[Nt-1];Gt.duration=Math.round((Ht-xt)/at)}else if(rt&&_e.segmentCodec==="aac"&&(Ht=gt),bt=Ht,wt>0){wt+=ht;try{_t=new Uint8Array(wt)}catch(Gt){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:Gt,bytes:wt,reason:`fail allocating audio mdat ${wt}`});return}dt||(new DataView(_t.buffer).setUint32(0,wt),_t.set(MP4.types.mdat,4))}else return;_t.set(Ut,ht);const jt=Ut.byteLength;ht+=jt,ft.push(new Mp4Sample(!0,lt,jt,0)),xt=Ht}const kt=ft.length;if(!kt)return;const At=ft[ft.length-1];this.nextAudioPts=gt=xt+at*At.duration;const $t=dt?new Uint8Array(0):MP4.moof(_e.sequenceNumber++,bt/at,_extends({},_e,{samples:ft}));_e.samples=[];const Lt=bt/st,Mt=gt/st,Pt={data1:$t,data2:_t,startPTS:Lt,endPTS:Mt,startDTS:Lt,endDTS:Mt,type:"audio",hasAudio:!0,hasVideo:!1,nb:kt};return this.isAudioContiguous=!0,Pt}remuxEmptyAudio(_e,tt,rt,nt){const it=_e.inputTimeScale,st=_e.samplerate?_e.samplerate:it,ot=it/st,at=this.nextAudioPts,lt=this._initDTS,ut=lt.baseTime*9e4/lt.timescale,ct=(at!==null?at:nt.startDTS*it)+ut,dt=nt.endDTS*it+ut,ft=ot*AAC_SAMPLES_PER_FRAME,pt=Math.ceil((dt-ct)/ft),mt=AAC.getSilentFrame(_e.manifestCodec||_e.codec,_e.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!mt){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const ht=[];for(let gt=0;gt<pt;gt++){const vt=ct+gt*ft;ht.push({unit:mt,pts:vt,dts:vt})}return _e.samples=ht,this.remuxAudio(_e,tt,rt,!1)}}function normalizePts(et,_e){let tt;if(_e===null)return et;for(_e<et?tt=-8589934592:tt=8589934592;Math.abs(et-_e)>4294967296;)et+=tt;return et}function findKeyframeIndex(et){for(let _e=0;_e<et.length;_e++)if(et[_e].key)return _e;return-1}function flushTextTrackMetadataCueSamples(et,_e,tt,rt){const nt=et.samples.length;if(!nt)return;const it=et.inputTimeScale;for(let ot=0;ot<nt;ot++){const at=et.samples[ot];at.pts=normalizePts(at.pts-tt.baseTime*it/tt.timescale,_e*it)/it,at.dts=normalizePts(at.dts-rt.baseTime*it/rt.timescale,_e*it)/it}const st=et.samples;return et.samples=[],{samples:st}}function flushTextTrackUserdataCueSamples(et,_e,tt){const rt=et.samples.length;if(!rt)return;const nt=et.inputTimeScale;for(let st=0;st<rt;st++){const ot=et.samples[st];ot.pts=normalizePts(ot.pts-tt.baseTime*nt/tt.timescale,_e*nt)/nt}et.samples.sort((st,ot)=>st.pts-ot.pts);const it=et.samples;return et.samples=[],{samples:it}}class Mp4Sample{constructor(_e,tt,rt,nt){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=tt,this.size=rt,this.cts=nt,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:_e?2:1,isNonSync:_e?0:1}}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(_e){this.initPTS=_e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(_e,tt,rt,nt){this.audioCodec=tt,this.videoCodec=rt,this.generateInitSegment(patchEncyptionData(_e,nt)),this.emitInitSegment=!0}generateInitSegment(_e){let{audioCodec:tt,videoCodec:rt}=this;if(!(_e!=null&&_e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const nt=this.initData=parseInitSegment(_e);nt.audio&&(tt=getParsedTrackCodec(nt.audio,ElementaryStreamTypes.AUDIO)),nt.video&&(rt=getParsedTrackCodec(nt.video,ElementaryStreamTypes.VIDEO));const it={};nt.audio&&nt.video?it.audiovideo={container:"video/mp4",codec:tt+","+rt,initSegment:_e,id:"main"}:nt.audio?it.audio={container:"audio/mp4",codec:tt,initSegment:_e,id:"audio"}:nt.video?it.video={container:"video/mp4",codec:rt,initSegment:_e,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=it}remux(_e,tt,rt,nt,it,st){var ot,at;let{initPTS:lt,lastEndTime:ut}=this;const ct={audio:void 0,video:void 0,text:nt,id3:rt,initSegment:void 0};isFiniteNumber(ut)||(ut=this.lastEndTime=it||0);const dt=tt.samples;if(!(dt!=null&&dt.length))return ct;const ft={initPTS:void 0,timescale:1};let pt=this.initData;if((ot=pt)!=null&&ot.length||(this.generateInitSegment(dt),pt=this.initData),!((at=pt)!=null&&at.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ct;this.emitInitSegment&&(ft.tracks=this.initTracks,this.emitInitSegment=!1);const mt=getDuration(dt,pt),ht=getStartDTS(pt,dt),gt=ht===null?it:ht;(isInvalidInitPts(lt,gt,it,mt)||ft.timescale!==lt.timescale&&st)&&(ft.initPTS=gt-it,lt&&lt.timescale===1&&logger.warn(`Adjusting initPTS by ${ft.initPTS-lt.baseTime}`),this.initPTS=lt={baseTime:ft.initPTS,timescale:1});const vt=_e?gt-lt.baseTime/lt.timescale:ut,yt=vt+mt;offsetStartDTS(pt,dt,lt.baseTime/lt.timescale),mt>0?this.lastEndTime=yt:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const bt=!!pt.audio,xt=!!pt.video;let _t="";bt&&(_t+="audio"),xt&&(_t+="video");const wt={data1:dt,startPTS:vt,startDTS:vt,endPTS:yt,endDTS:yt,type:_t,hasAudio:bt,hasVideo:xt,nb:1,dropped:0};return ct.audio=wt.type==="audio"?wt:void 0,ct.video=wt.type!=="audio"?wt:void 0,ct.initSegment=ft,ct.id3=flushTextTrackMetadataCueSamples(rt,it,lt,lt),nt.samples.length&&(ct.text=flushTextTrackUserdataCueSamples(nt,it,lt)),ct}}function isInvalidInitPts(et,_e,tt,rt){if(et===null)return!0;const nt=Math.max(rt,1),it=_e-et.baseTime/et.timescale;return Math.abs(it-tt)>nt}function getParsedTrackCodec(et,_e){const tt=et==null?void 0:et.codec;if(tt&&tt.length>4)return tt;if(_e===ElementaryStreamTypes.AUDIO){if(tt==="ec-3"||tt==="ac-3"||tt==="alac")return tt;if(tt==="fLaC"||tt==="Opus")return getCodecCompatibleName(tt,!1);const rt="mp4a.40.5";return logger.info(`Parsed audio codec "${tt}" or audio object type not handled. Using "${rt}"`),rt}return logger.warn(`Unhandled video codec "${tt}"`),tt==="hvc1"||tt==="hev1"?"hvc1.1.6.L120.90":tt==="av01"?"av01.0.04M.08":"avc1.42e01e"}let now;try{now=self.performance.now.bind(self.performance)}catch(et){logger.debug("Unable to use Performance API on this environment"),now=optionalSelf==null?void 0:optionalSelf.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(_e,tt,rt,nt,it){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=_e,this.typeSupported=tt,this.config=rt,this.vendor=nt,this.id=it}configure(_e){this.transmuxConfig=_e,this.decrypter&&this.decrypter.reset()}push(_e,tt,rt,nt){const it=rt.transmuxing;it.executeStart=now();let st=new Uint8Array(_e);const{currentTransmuxState:ot,transmuxConfig:at}=this;nt&&(this.currentTransmuxState=nt);const{contiguous:lt,discontinuity:ut,trackSwitch:ct,accurateTimeOffset:dt,timeOffset:ft,initSegmentChange:pt}=nt||ot,{audioCodec:mt,videoCodec:ht,defaultInitPts:gt,duration:vt,initSegmentData:yt}=at,bt=getEncryptionType(st,tt);if(bt&&bt.method==="AES-128"){const Ct=this.getDecrypter();if(Ct.isSync()){let kt=Ct.softwareDecrypt(st,bt.key.buffer,bt.iv.buffer);if(rt.part>-1&&(kt=Ct.flush()),!kt)return it.executeEnd=now(),emptyResult(rt);st=new Uint8Array(kt)}else return this.decryptionPromise=Ct.webCryptoDecrypt(st,bt.key.buffer,bt.iv.buffer).then(kt=>{const At=this.push(kt,null,rt);return this.decryptionPromise=null,At}),this.decryptionPromise}const xt=this.needsProbing(ut,ct);if(xt){const Ct=this.configureTransmuxer(st);if(Ct)return logger.warn(`[transmuxer] ${Ct.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Ct,reason:Ct.message}),it.executeEnd=now(),emptyResult(rt)}(ut||ct||pt||xt)&&this.resetInitSegment(yt,mt,ht,vt,tt),(ut||pt||xt)&&this.resetInitialTimestamp(gt),lt||this.resetContiguity();const _t=this.transmux(st,bt,ft,dt,rt),wt=this.currentTransmuxState;return wt.contiguous=!0,wt.discontinuity=!1,wt.trackSwitch=!1,it.executeEnd=now(),_t}flush(_e){const tt=_e.transmuxing;tt.executeStart=now();const{decrypter:rt,currentTransmuxState:nt,decryptionPromise:it}=this;if(it)return it.then(()=>this.flush(_e));const st=[],{timeOffset:ot}=nt;if(rt){const ct=rt.flush();ct&&st.push(this.push(ct,null,_e))}const{demuxer:at,remuxer:lt}=this;if(!at||!lt)return tt.executeEnd=now(),[emptyResult(_e)];const ut=at.flush(ot);return isPromise(ut)?ut.then(ct=>(this.flushRemux(st,ct,_e),st)):(this.flushRemux(st,ut,_e),st)}flushRemux(_e,tt,rt){const{audioTrack:nt,videoTrack:it,id3Track:st,textTrack:ot}=tt,{accurateTimeOffset:at,timeOffset:lt}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${rt.sn}${rt.part>-1?" p: "+rt.part:""} of level ${rt.level}`);const ut=this.remuxer.remux(nt,it,st,ot,lt,at,!0,this.id);_e.push({remuxResult:ut,chunkMeta:rt}),rt.transmuxing.executeEnd=now()}resetInitialTimestamp(_e){const{demuxer:tt,remuxer:rt}=this;!tt||!rt||(tt.resetTimeStamp(_e),rt.resetTimeStamp(_e))}resetContiguity(){const{demuxer:_e,remuxer:tt}=this;!_e||!tt||(_e.resetContiguity(),tt.resetNextTimestamp())}resetInitSegment(_e,tt,rt,nt,it){const{demuxer:st,remuxer:ot}=this;!st||!ot||(st.resetInitSegment(_e,tt,rt,nt),ot.resetInitSegment(_e,tt,rt,it))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(_e,tt,rt,nt,it){let st;return tt&&tt.method==="SAMPLE-AES"?st=this.transmuxSampleAes(_e,tt,rt,nt,it):st=this.transmuxUnencrypted(_e,rt,nt,it),st}transmuxUnencrypted(_e,tt,rt,nt){const{audioTrack:it,videoTrack:st,id3Track:ot,textTrack:at}=this.demuxer.demux(_e,tt,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(it,st,ot,at,tt,rt,!1,this.id),chunkMeta:nt}}transmuxSampleAes(_e,tt,rt,nt,it){return this.demuxer.demuxSampleAes(_e,tt,rt).then(st=>({remuxResult:this.remuxer.remux(st.audioTrack,st.videoTrack,st.id3Track,st.textTrack,rt,nt,!1,this.id),chunkMeta:it}))}configureTransmuxer(_e){const{config:tt,observer:rt,typeSupported:nt,vendor:it}=this;let st;for(let dt=0,ft=muxConfig.length;dt<ft;dt++){var ot;if((ot=muxConfig[dt].demux)!=null&&ot.probe(_e)){st=muxConfig[dt];break}}if(!st)return new Error("Failed to find demuxer by probing fragment data");const at=this.demuxer,lt=this.remuxer,ut=st.remux,ct=st.demux;(!lt||!(lt instanceof ut))&&(this.remuxer=new ut(rt,tt,nt,it)),(!at||!(at instanceof ct))&&(this.demuxer=new ct(rt,tt,nt),this.probe=ct.probe)}needsProbing(_e,tt){return!this.demuxer||!this.remuxer||_e||tt}getDecrypter(){let _e=this.decrypter;return _e||(_e=this.decrypter=new Decrypter(this.config)),_e}}function getEncryptionType(et,_e){let tt=null;return et.byteLength>0&&(_e==null?void 0:_e.key)!=null&&_e.iv!==null&&_e.method!=null&&(tt=_e),tt}const emptyResult=et=>({remuxResult:{},chunkMeta:et});function isPromise(et){return"then"in et&&et.then instanceof Function}class TransmuxConfig{constructor(_e,tt,rt,nt,it){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=_e,this.videoCodec=tt,this.initSegmentData=rt,this.duration=nt,this.defaultInitPts=it||null}}class TransmuxState{constructor(_e,tt,rt,nt,it,st){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=_e,this.contiguous=tt,this.accurateTimeOffset=rt,this.trackSwitch=nt,this.timeOffset=it,this.initSegmentChange=st}}var eventemitter3={exports:{}};(function(et){var _e=Object.prototype.hasOwnProperty,tt="~";function rt(){}Object.create&&(rt.prototype=Object.create(null),new rt().__proto__||(tt=!1));function nt(at,lt,ut){this.fn=at,this.context=lt,this.once=ut||!1}function it(at,lt,ut,ct,dt){if(typeof ut!="function")throw new TypeError("The listener must be a function");var ft=new nt(ut,ct||at,dt),pt=tt?tt+lt:lt;return at._events[pt]?at._events[pt].fn?at._events[pt]=[at._events[pt],ft]:at._events[pt].push(ft):(at._events[pt]=ft,at._eventsCount++),at}function st(at,lt){--at._eventsCount===0?at._events=new rt:delete at._events[lt]}function ot(){this._events=new rt,this._eventsCount=0}ot.prototype.eventNames=function(){var lt=[],ut,ct;if(this._eventsCount===0)return lt;for(ct in ut=this._events)_e.call(ut,ct)&&lt.push(tt?ct.slice(1):ct);return Object.getOwnPropertySymbols?lt.concat(Object.getOwnPropertySymbols(ut)):lt},ot.prototype.listeners=function(lt){var ut=tt?tt+lt:lt,ct=this._events[ut];if(!ct)return[];if(ct.fn)return[ct.fn];for(var dt=0,ft=ct.length,pt=new Array(ft);dt<ft;dt++)pt[dt]=ct[dt].fn;return pt},ot.prototype.listenerCount=function(lt){var ut=tt?tt+lt:lt,ct=this._events[ut];return ct?ct.fn?1:ct.length:0},ot.prototype.emit=function(lt,ut,ct,dt,ft,pt){var mt=tt?tt+lt:lt;if(!this._events[mt])return!1;var ht=this._events[mt],gt=arguments.length,vt,yt;if(ht.fn){switch(ht.once&&this.removeListener(lt,ht.fn,void 0,!0),gt){case 1:return ht.fn.call(ht.context),!0;case 2:return ht.fn.call(ht.context,ut),!0;case 3:return ht.fn.call(ht.context,ut,ct),!0;case 4:return ht.fn.call(ht.context,ut,ct,dt),!0;case 5:return ht.fn.call(ht.context,ut,ct,dt,ft),!0;case 6:return ht.fn.call(ht.context,ut,ct,dt,ft,pt),!0}for(yt=1,vt=new Array(gt-1);yt<gt;yt++)vt[yt-1]=arguments[yt];ht.fn.apply(ht.context,vt)}else{var bt=ht.length,xt;for(yt=0;yt<bt;yt++)switch(ht[yt].once&&this.removeListener(lt,ht[yt].fn,void 0,!0),gt){case 1:ht[yt].fn.call(ht[yt].context);break;case 2:ht[yt].fn.call(ht[yt].context,ut);break;case 3:ht[yt].fn.call(ht[yt].context,ut,ct);break;case 4:ht[yt].fn.call(ht[yt].context,ut,ct,dt);break;default:if(!vt)for(xt=1,vt=new Array(gt-1);xt<gt;xt++)vt[xt-1]=arguments[xt];ht[yt].fn.apply(ht[yt].context,vt)}}return!0},ot.prototype.on=function(lt,ut,ct){return it(this,lt,ut,ct,!1)},ot.prototype.once=function(lt,ut,ct){return it(this,lt,ut,ct,!0)},ot.prototype.removeListener=function(lt,ut,ct,dt){var ft=tt?tt+lt:lt;if(!this._events[ft])return this;if(!ut)return st(this,ft),this;var pt=this._events[ft];if(pt.fn)pt.fn===ut&&(!dt||pt.once)&&(!ct||pt.context===ct)&&st(this,ft);else{for(var mt=0,ht=[],gt=pt.length;mt<gt;mt++)(pt[mt].fn!==ut||dt&&!pt[mt].once||ct&&pt[mt].context!==ct)&&ht.push(pt[mt]);ht.length?this._events[ft]=ht.length===1?ht[0]:ht:st(this,ft)}return this},ot.prototype.removeAllListeners=function(lt){var ut;return lt?(ut=tt?tt+lt:lt,this._events[ut]&&st(this,ut)):(this._events=new rt,this._eventsCount=0),this},ot.prototype.off=ot.prototype.removeListener,ot.prototype.addListener=ot.prototype.on,ot.prefixed=tt,ot.EventEmitter=ot,et.exports=ot})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TransmuxerInterface{constructor(_e,tt,rt,nt){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const it=_e.config;this.hls=_e,this.id=tt,this.useWorker=!!it.enableWorker,this.onTransmuxComplete=rt,this.onFlush=nt;const st=(ut,ct)=>{ct=ct||{},ct.frag=this.frag,ct.id=this.id,ut===Events.ERROR&&(this.error=ct.error),this.hls.trigger(ut,ct)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,st),this.observer.on(Events.ERROR,st);const ot=getMediaSource(it.preferManagedMediaSource)||{isTypeSupported:()=>!1},at={mpeg:ot.isTypeSupported("audio/mpeg"),mp3:ot.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:ot.isTypeSupported('audio/mp4; codecs="ac-3"')},lt=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(it.workerPath||hasUMDWorker())){try{it.workerPath?(logger.log(`loading Web Worker ${it.workerPath} for "${tt}"`),this.workerContext=loadWorker(it.workerPath)):(logger.log(`injecting Web Worker for "${tt}"`),this.workerContext=injectWorker()),this.onwmsg=dt=>this.onWorkerMessage(dt);const{worker:ct}=this.workerContext;ct.addEventListener("message",this.onwmsg),ct.onerror=dt=>{const ft=new Error(`${dt.message}  (${dt.filename}:${dt.lineno})`);it.enableWorker=!1,logger.warn(`Error in "${tt}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:ft})},ct.postMessage({cmd:"init",typeSupported:at,vendor:lt,id:tt,config:JSON.stringify(it)})}catch(ct){logger.warn(`Error setting up "${tt}" Web Worker, fallback to inline`,ct),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,at,it,lt,tt)}return}this.transmuxer=new Transmuxer(this.observer,at,it,lt,tt)}resetWorker(){if(this.workerContext){const{worker:_e,objectURL:tt}=this.workerContext;tt&&self.URL.revokeObjectURL(tt),_e.removeEventListener("message",this.onwmsg),_e.onerror=null,_e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const tt=this.transmuxer;tt&&(tt.destroy(),this.transmuxer=null)}const _e=this.observer;_e&&_e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(_e,tt,rt,nt,it,st,ot,at,lt,ut){var ct,dt;lt.transmuxing.start=self.performance.now();const{transmuxer:ft}=this,pt=st?st.start:it.start,mt=it.decryptdata,ht=this.frag,gt=!(ht&&it.cc===ht.cc),vt=!(ht&&lt.level===ht.level),yt=ht?lt.sn-ht.sn:-1,bt=this.part?lt.part-this.part.index:-1,xt=yt===0&&lt.id>1&&lt.id===(ht==null?void 0:ht.stats.chunkCount),_t=!vt&&(yt===1||yt===0&&(bt===1||xt&&bt<=0)),wt=self.performance.now();(vt||yt||it.stats.parsing.start===0)&&(it.stats.parsing.start=wt),st&&(bt||!_t)&&(st.stats.parsing.start=wt);const Ct=!(ht&&((ct=it.initSegment)==null?void 0:ct.url)===((dt=ht.initSegment)==null?void 0:dt.url)),kt=new TransmuxState(gt,_t,at,vt,pt,Ct);if(!_t||gt||Ct){logger.log(`[transmuxer-interface, ${it.type}]: Starting new transmux session for sn: ${lt.sn} p: ${lt.part} level: ${lt.level} id: ${lt.id}
        discontinuity: ${gt}
        trackSwitch: ${vt}
        contiguous: ${_t}
        accurateTimeOffset: ${at}
        timeOffset: ${pt}
        initSegmentChange: ${Ct}`);const At=new TransmuxConfig(rt,nt,tt,ot,ut);this.configureTransmuxer(At)}if(this.frag=it,this.part=st,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:_e,decryptdata:mt,chunkMeta:lt,state:kt},_e instanceof ArrayBuffer?[_e]:[]);else if(ft){const At=ft.push(_e,mt,lt,kt);isPromise(At)?(ft.async=!0,At.then($t=>{this.handleTransmuxComplete($t)}).catch($t=>{this.transmuxerError($t,lt,"transmuxer-interface push error")})):(ft.async=!1,this.handleTransmuxComplete(At))}}flush(_e){_e.transmuxing.start=self.performance.now();const{transmuxer:tt}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:_e});else if(tt){let rt=tt.flush(_e);isPromise(rt)||tt.async?(isPromise(rt)||(rt=Promise.resolve(rt)),rt.then(it=>{this.handleFlushResult(it,_e)}).catch(it=>{this.transmuxerError(it,_e,"transmuxer-interface flush error")})):this.handleFlushResult(rt,_e)}}transmuxerError(_e,tt,rt){this.hls&&(this.error=_e,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:tt,fatal:!1,error:_e,err:_e,reason:rt}))}handleFlushResult(_e,tt){_e.forEach(rt=>{this.handleTransmuxComplete(rt)}),this.onFlush(tt)}onWorkerMessage(_e){const tt=_e.data,rt=this.hls;switch(tt.event){case"init":{var nt;const it=(nt=this.workerContext)==null?void 0:nt.objectURL;it&&self.URL.revokeObjectURL(it);break}case"transmuxComplete":{this.handleTransmuxComplete(tt.data);break}case"flush":{this.onFlush(tt.data);break}case"workerLog":logger[tt.data.logType]&&logger[tt.data.logType](tt.data.message);break;default:{tt.data=tt.data||{},tt.data.frag=this.frag,tt.data.id=this.id,rt.trigger(tt.event,tt.data);break}}}configureTransmuxer(_e){const{transmuxer:tt}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:_e}):tt&&tt.configure(_e)}handleTransmuxComplete(_e){_e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(_e)}}function subtitleOptionsIdentical(et,_e){if(et.length!==_e.length)return!1;for(let tt=0;tt<et.length;tt++)if(!mediaAttributesIdentical(et[tt].attrs,_e[tt].attrs))return!1;return!0}function mediaAttributesIdentical(et,_e,tt){const rt=et["STABLE-RENDITION-ID"];return rt&&!tt?rt===_e["STABLE-RENDITION-ID"]:!(tt||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(nt=>et[nt]!==_e[nt])}function subtitleTrackMatchesTextTrack(et,_e){return _e.label.toLowerCase()===et.name.toLowerCase()&&(!_e.language||_e.language.toLowerCase()===(et.lang||"").toLowerCase())}const TICK_INTERVAL$2=100;class AudioStreamController extends BaseStreamController{constructor(_e,tt,rt){super(_e,tt,rt,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:_e}=this;_e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),_e.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),_e.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),_e.on(Events.ERROR,this.onError,this),_e.on(Events.BUFFER_RESET,this.onBufferReset,this),_e.on(Events.BUFFER_CREATED,this.onBufferCreated,this),_e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),_e.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),_e.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),_e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:_e}=this;_e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),_e.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),_e.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),_e.off(Events.ERROR,this.onError,this),_e.off(Events.BUFFER_RESET,this.onBufferReset,this),_e.off(Events.BUFFER_CREATED,this.onBufferCreated,this),_e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),_e.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),_e.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),_e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(_e,{frag:tt,id:rt,initPTS:nt,timescale:it}){if(rt==="main"){const st=tt.cc;this.initPTS[tt.cc]={baseTime:nt,timescale:it},this.log(`InitPTS for cc: ${st} found from main: ${nt}`),this.videoTrackCC=st,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(_e){if(!this.levels){this.startPosition=_e,this.state=State.STOPPED;return}const tt=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$2),tt>0&&_e===-1?(this.log(`Override startPosition with lastCurrentTime @${tt.toFixed(3)}`),_e=tt,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=_e,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var _e;const{levels:rt,trackId:nt}=this,it=rt==null||(_e=rt[nt])==null?void 0:_e.details;if(it){if(this.waitForCdnTuneIn(it))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var tt;const rt=performance.now(),nt=this.retryDate;if(!nt||rt>=nt||(tt=this.media)!=null&&tt.seeking){const{levels:it,trackId:st}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((it==null?void 0:it[st])||null),this.state=State.IDLE}break}case State.WAITING_INIT_PTS:{const rt=this.waitingData;if(rt){const{frag:nt,part:it,cache:st,complete:ot}=rt;if(this.initPTS[nt.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const at=st.flush(),lt={frag:nt,part:it,payload:at,networkDetails:null};this._handleFragmentLoadProgress(lt),ot&&super._handleFragmentLoadComplete(lt)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${nt.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const at=this.getLoadPosition(),lt=BufferHelper.bufferInfo(this.mediaBuffer,at,this.config.maxBufferHole);fragmentWithinToleranceTest(lt.end,this.config.maxFragLookUpTolerance,nt)<0&&(this.log(`Waiting fragment cc (${nt.cc}) @ ${nt.start} cancelled because another fragment at ${lt.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const _e=this.waitingData;_e&&(this.fragmentTracker.removeFragment(_e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:_e}=this;_e!=null&&_e.readyState&&(this.lastCurrentTime=_e.currentTime)}doTickIdle(){const{hls:_e,levels:tt,media:rt,trackId:nt}=this,it=_e.config;if(!rt&&(this.startFragRequested||!it.startFragPrefetch)||!(tt!=null&&tt[nt]))return;const st=tt[nt],ot=st.details;if(!ot||ot.live&&this.levelLastLoaded!==st||this.waitForCdnTuneIn(ot)){this.state=State.WAITING_TRACK;return}const at=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&at&&(this.bufferFlushed=!1,this.afterBufferFlushed(at,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const lt=this.getFwdBufferInfo(at,PlaylistLevelType.AUDIO);if(lt===null)return;const{bufferedTrack:ut,switchingTrack:ct}=this;if(!ct&&this._streamEnded(lt,ot)){_e.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const dt=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),ft=lt.len,pt=this.getMaxBufferLength(dt==null?void 0:dt.len),mt=ot.fragments,ht=mt[0].start;let gt=this.flushing?this.getLoadPosition():lt.end;if(ct&&rt){const xt=this.getLoadPosition();ut&&!mediaAttributesIdentical(ct.attrs,ut.attrs)&&(gt=xt),ot.PTSKnown&&xt<ht&&(lt.end>ht||lt.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),rt.currentTime=ht+.05)}if(ft>=pt&&!ct&&gt<mt[mt.length-1].start)return;let vt=this.getNextFragment(gt,ot),yt=!1;if(vt&&this.isLoopLoading(vt,gt)&&(yt=!!vt.gap,vt=this.getNextFragmentLoopLoading(vt,ot,lt,PlaylistLevelType.MAIN,pt)),!vt){this.bufferFlushed=!0;return}const bt=dt&&vt.start>dt.end+ot.targetduration;if(bt||!(dt!=null&&dt.len)&&lt.len){const xt=this.getAppendedFrag(vt.start,PlaylistLevelType.MAIN);if(xt===null||(yt||(yt=!!xt.gap||!!bt&&dt.len===0),bt&&!yt||yt&&lt.nextStart&&lt.nextStart<xt.end))return}this.loadFragment(vt,st,gt)}getMaxBufferLength(_e){const tt=super.getMaxBufferLength();return _e?Math.min(Math.max(tt,_e),this.config.maxMaxBufferLength):tt}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(_e,{audioTracks:tt}){this.resetTransmuxer(),this.levels=tt.map(rt=>new Level(rt))}onAudioTrackSwitching(_e,tt){const rt=!!tt.url;this.trackId=tt.id;const{fragCurrent:nt}=this;nt&&(nt.abortRequests(),this.removeUnbufferedFrags(nt.start)),this.resetLoadingState(),rt?this.setInterval(TICK_INTERVAL$2):this.resetTransmuxer(),rt?(this.switchingTrack=tt,this.state=State.IDLE,this.flushAudioIfNeeded(tt)):(this.switchingTrack=null,this.bufferedTrack=tt,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(_e,tt){this.mainDetails=tt.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(_e,tt){var rt;if(this.mainDetails==null){this.cachedTrackLoadedData=tt;return}const{levels:nt}=this,{details:it,id:st}=tt;if(!nt){this.warn(`Audio tracks were reset while loading level ${st}`);return}this.log(`Audio track ${st} loaded [${it.startSN},${it.endSN}]${it.lastPartSn?`[part-${it.lastPartSn}-${it.lastPartIndex}]`:""},duration:${it.totalduration}`);const ot=nt[st];let at=0;if(it.live||(rt=ot.details)!=null&&rt.live){this.checkLiveUpdate(it);const ut=this.mainDetails;if(it.deltaUpdateFailed||!ut)return;if(!ot.details&&it.hasProgramDateTime&&ut.hasProgramDateTime)alignMediaPlaylistByPDT(it,ut),at=it.fragments[0].start;else{var lt;at=this.alignPlaylists(it,ot.details,(lt=this.levelLastLoaded)==null?void 0:lt.details)}}ot.details=it,this.levelLastLoaded=ot,!this.startFragRequested&&(this.mainDetails||!it.live)&&this.setStartPosition(this.mainDetails||it,at),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(it)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(_e){var tt;const{frag:rt,part:nt,payload:it}=_e,{config:st,trackId:ot,levels:at}=this;if(!at){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${rt.sn} of level ${rt.level} will not be buffered`);return}const lt=at[ot];if(!lt){this.warn("Audio track is undefined on fragment load progress");return}const ut=lt.details;if(!ut){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(rt.start);return}const ct=st.defaultAudioCodec||lt.audioCodec||"mp4a.40.2";let dt=this.transmuxer;dt||(dt=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const ft=this.initPTS[rt.cc],pt=(tt=rt.initSegment)==null?void 0:tt.data;if(ft!==void 0){const ht=nt?nt.index:-1,gt=ht!==-1,vt=new ChunkMetadata(rt.level,rt.sn,rt.stats.chunkCount,it.byteLength,ht,gt);dt.push(it,pt,ct,"",rt,nt,ut.totalduration,!1,vt,ft)}else{this.log(`Unknown video PTS for cc ${rt.cc}, waiting for video PTS before demuxing audio frag ${rt.sn} of [${ut.startSN} ,${ut.endSN}],track ${ot}`);const{cache:mt}=this.waitingData=this.waitingData||{frag:rt,part:nt,cache:new ChunkCache,complete:!1};mt.push(new Uint8Array(it)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(_e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(_e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(_e,tt){const rt=tt.tracks.audio;rt&&(this.mediaBuffer=rt.buffer||null),tt.tracks.video&&(this.videoBuffer=tt.tracks.video.buffer||null)}onFragBuffered(_e,tt){const{frag:rt,part:nt}=tt;if(rt.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&rt.type===PlaylistLevelType.MAIN){const it=this.videoBuffer||this.media;it&&BufferHelper.getBuffered(it).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(rt)){this.warn(`Fragment ${rt.sn}${nt?" p: "+nt.index:""} of level ${rt.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(rt.sn!=="initSegment"){this.fragPrevious=rt;const it=this.switchingTrack;it&&(this.bufferedTrack=it,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},it)))}this.fragBufferedComplete(rt,nt)}onError(_e,tt){var rt;if(tt.fatal){this.state=State.ERROR;return}switch(tt.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,tt);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!tt.levelRetry&&this.state===State.WAITING_TRACK&&((rt=tt.context)==null?void 0:rt.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!tt.parent||tt.parent!=="audio")return;if(tt.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(tt)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(tt);break}}onBufferFlushing(_e,{type:tt}){tt!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)}onBufferFlushed(_e,{type:tt}){if(tt!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);const rt=this.mediaBuffer||this.media;rt&&(this.afterBufferFlushed(rt,tt,PlaylistLevelType.AUDIO),this.tick())}}_handleTransmuxComplete(_e){var tt;const rt="audio",{hls:nt}=this,{remuxResult:it,chunkMeta:st}=_e,ot=this.getCurrentContext(st);if(!ot){this.resetWhenMissingContext(st);return}const{frag:at,part:lt,level:ut}=ot,{details:ct}=ut,{audio:dt,text:ft,id3:pt,initSegment:mt}=it;if(this.fragContextChanged(at)||!ct){this.fragmentTracker.removeFragment(at);return}if(this.state=State.PARSING,this.switchingTrack&&dt&&this.completeAudioSwitch(this.switchingTrack),mt!=null&&mt.tracks){const ht=at.initSegment||at;this._bufferInitSegment(ut,mt.tracks,ht,st),nt.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:ht,id:rt,tracks:mt.tracks})}if(dt){const{startPTS:ht,endPTS:gt,startDTS:vt,endDTS:yt}=dt;lt&&(lt.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:ht,endPTS:gt,startDTS:vt,endDTS:yt}),at.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,ht,gt,vt,yt),this.bufferFragmentData(dt,at,lt,st)}if(pt!=null&&(tt=pt.samples)!=null&&tt.length){const ht=_extends({id:rt,frag:at,details:ct},pt);nt.trigger(Events.FRAG_PARSING_METADATA,ht)}if(ft){const ht=_extends({id:rt,frag:at,details:ct},ft);nt.trigger(Events.FRAG_PARSING_USERDATA,ht)}}_bufferInitSegment(_e,tt,rt,nt){if(this.state!==State.PARSING)return;tt.video&&delete tt.video;const it=tt.audio;if(!it)return;it.id="audio";const st=_e.audioCodec;this.log(`Init audio buffer, container:${it.container}, codecs[level/parsed]=[${st}/${it.codec}]`),st&&st.split(",").length===1&&(it.levelCodec=st),this.hls.trigger(Events.BUFFER_CODECS,tt);const ot=it.initSegment;if(ot!=null&&ot.byteLength){const at={type:"audio",frag:rt,part:null,chunkMeta:nt,parent:rt.type,data:ot};this.hls.trigger(Events.BUFFER_APPENDING,at)}this.tickImmediate()}loadFragment(_e,tt,rt){const nt=this.fragmentTracker.getState(_e);if(this.fragCurrent=_e,this.switchingTrack||nt===FragmentState.NOT_LOADED||nt===FragmentState.PARTIAL){var it;if(_e.sn==="initSegment")this._loadInitSegment(_e,tt);else if((it=tt.details)!=null&&it.live&&!this.initPTS[_e.cc]){this.log(`Waiting for video PTS in continuity counter ${_e.cc} of live stream before loading audio fragment ${_e.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS;const st=this.mainDetails;st&&st.fragments[0].start!==tt.details.fragments[0].start&&alignMediaPlaylistByPDT(tt.details,st)}else this.startFragRequested=!0,super.loadFragment(_e,tt,rt)}else this.clearTrackerIfNeeded(_e)}flushAudioIfNeeded(_e){const{media:tt,bufferedTrack:rt}=this,nt=rt==null?void 0:rt.attrs,it=_e.attrs;tt&&nt&&(nt.CHANNELS!==it.CHANNELS||rt.name!==_e.name||rt.lang!==_e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(_e){const{hls:tt}=this;this.flushAudioIfNeeded(_e),this.bufferedTrack=_e,this.switchingTrack=null,tt.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},_e))}}class AudioTrackController extends BasePlaylistController{constructor(_e){super(_e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:_e}=this;_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),_e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),_e.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),_e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:_e}=this;_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),_e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),_e.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),_e.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(_e,tt){this.tracks=tt.audioTracks||[]}onAudioTrackLoaded(_e,tt){const{id:rt,groupId:nt,details:it}=tt,st=this.tracksInGroup[rt];if(!st||st.groupId!==nt){this.warn(`Audio track with id:${rt} and group:${nt} not found in active group ${st==null?void 0:st.groupId}`);return}const ot=st.details;st.details=tt.details,this.log(`Audio track ${rt} "${st.name}" lang:${st.lang} group:${nt} loaded [${it.startSN}-${it.endSN}]`),rt===this.trackId&&this.playlistLoaded(rt,tt,ot)}onLevelLoading(_e,tt){this.switchLevel(tt.level)}onLevelSwitching(_e,tt){this.switchLevel(tt.level)}switchLevel(_e){const tt=this.hls.levels[_e];if(!tt)return;const rt=tt.audioGroups||null,nt=this.groupIds;let it=this.currentTrack;if(!rt||(nt==null?void 0:nt.length)!==(rt==null?void 0:rt.length)||rt!=null&&rt.some(ot=>(nt==null?void 0:nt.indexOf(ot))===-1)){this.groupIds=rt,this.trackId=-1,this.currentTrack=null;const ot=this.tracks.filter(dt=>!rt||rt.indexOf(dt.groupId)!==-1);if(ot.length)this.selectDefaultTrack&&!ot.some(dt=>dt.default)&&(this.selectDefaultTrack=!1),ot.forEach((dt,ft)=>{dt.id=ft});else if(!it&&!this.tracksInGroup.length)return;this.tracksInGroup=ot;const at=this.hls.config.audioPreference;if(!it&&at){const dt=findMatchingOption(at,ot,audioMatchPredicate);if(dt>-1)it=ot[dt];else{const ft=findMatchingOption(at,this.tracks);it=this.tracks[ft]}}let lt=this.findTrackId(it);lt===-1&&it&&(lt=this.findTrackId(null));const ut={audioTracks:ot};this.log(`Updating audio tracks, ${ot.length} track(s) found in group(s): ${rt==null?void 0:rt.join(",")}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,ut);const ct=this.trackId;if(lt!==-1&&ct===-1)this.setAudioTrack(lt);else if(ot.length&&ct===-1){var st;const dt=new Error(`No audio track selected for current audio group-ID(s): ${(st=this.groupIds)==null?void 0:st.join(",")} track count: ${ot.length}`);this.warn(dt.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:dt})}}else this.shouldReloadPlaylist(it)&&this.setAudioTrack(this.trackId)}onError(_e,tt){tt.fatal||!tt.context||tt.context.type===PlaylistContextType.AUDIO_TRACK&&tt.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(tt.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(tt))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(_e){this.selectDefaultTrack=!1,this.setAudioTrack(_e)}setAudioOption(_e){const tt=this.hls;if(tt.config.audioPreference=_e,_e){const rt=this.allAudioTracks;if(this.selectDefaultTrack=!1,rt.length){const nt=this.currentTrack;if(nt&&matchesOption(_e,nt,audioMatchPredicate))return nt;const it=findMatchingOption(_e,this.tracksInGroup,audioMatchPredicate);if(it>-1){const st=this.tracksInGroup[it];return this.setAudioTrack(it),st}else if(nt){let st=tt.loadLevel;st===-1&&(st=tt.firstAutoLevel);const ot=findClosestLevelWithAudioGroup(_e,tt.levels,rt,st,audioMatchPredicate);if(ot===-1)return null;tt.nextLoadLevel=ot}if(_e.channels||_e.audioCodec){const st=findMatchingOption(_e,rt);if(st>-1)return rt[st]}}}return null}setAudioTrack(_e){const tt=this.tracksInGroup;if(_e<0||_e>=tt.length){this.warn(`Invalid audio track id: ${_e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const rt=this.currentTrack,nt=tt[_e],it=nt.details&&!nt.details.live;if(_e===this.trackId&&nt===rt&&it||(this.log(`Switching to audio-track ${_e} "${nt.name}" lang:${nt.lang} group:${nt.groupId} channels:${nt.channels}`),this.trackId=_e,this.currentTrack=nt,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},nt)),it))return;const st=this.switchParams(nt.url,rt==null?void 0:rt.details);this.loadPlaylist(st)}findTrackId(_e){const tt=this.tracksInGroup;for(let rt=0;rt<tt.length;rt++){const nt=tt[rt];if(!(this.selectDefaultTrack&&!nt.default)&&(!_e||matchesOption(_e,nt,audioMatchPredicate)))return rt}if(_e){const{name:rt,lang:nt,assocLang:it,characteristics:st,audioCodec:ot,channels:at}=_e;for(let lt=0;lt<tt.length;lt++){const ut=tt[lt];if(matchesOption({name:rt,lang:nt,assocLang:it,characteristics:st,audioCodec:ot,channels:at},ut,audioMatchPredicate))return lt}for(let lt=0;lt<tt.length;lt++){const ut=tt[lt];if(mediaAttributesIdentical(_e.attrs,ut.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return lt}for(let lt=0;lt<tt.length;lt++){const ut=tt[lt];if(mediaAttributesIdentical(_e.attrs,ut.attrs,["LANGUAGE"]))return lt}}return-1}loadPlaylist(_e){const tt=this.currentTrack;if(this.shouldLoadPlaylist(tt)&&tt){super.loadPlaylist();const rt=tt.id,nt=tt.groupId;let it=tt.url;if(_e)try{it=_e.addDirectives(it)}catch(st){this.warn(`Could not construct new URL with HLS Delivery Directives: ${st}`)}this.log(`loading audio-track playlist ${rt} "${tt.name}" lang:${tt.lang} group:${nt}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:it,id:rt,groupId:nt,deliveryDirectives:_e||null})}}}const TICK_INTERVAL$1=500;class SubtitleStreamController extends BaseStreamController{constructor(_e,tt,rt){super(_e,tt,rt,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:_e}=this;_e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.on(Events.ERROR,this.onError,this),_e.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),_e.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),_e.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),_e.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),_e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),_e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:_e}=this;_e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.off(Events.ERROR,this.onError,this),_e.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),_e.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),_e.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),_e.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),_e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),_e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(_e){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$1),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=_e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(_e,tt){this.mainDetails=tt.details}onSubtitleFragProcessed(_e,tt){const{frag:rt,success:nt}=tt;if(this.fragPrevious=rt,this.state=State.IDLE,!nt)return;const it=this.tracksBuffered[this.currentTrackId];if(!it)return;let st;const ot=rt.start;for(let lt=0;lt<it.length;lt++)if(ot>=it[lt].start&&ot<=it[lt].end){st=it[lt];break}const at=rt.start+rt.duration;st?st.end=at:(st={start:ot,end:at},it.push(st)),this.fragmentTracker.fragBuffered(rt),this.fragBufferedComplete(rt,null)}onBufferFlushing(_e,tt){const{startOffset:rt,endOffset:nt}=tt;if(rt===0&&nt!==Number.POSITIVE_INFINITY){const it=nt-1;if(it<=0)return;tt.endOffsetSubtitles=Math.max(0,it),this.tracksBuffered.forEach(st=>{for(let ot=0;ot<st.length;){if(st[ot].end<=it){st.shift();continue}else if(st[ot].start<it)st[ot].start=it;else break;ot++}}),this.fragmentTracker.removeFragmentsInRange(rt,it,PlaylistLevelType.SUBTITLE)}}onFragBuffered(_e,tt){if(!this.loadedmetadata&&tt.frag.type===PlaylistLevelType.MAIN){var rt;(rt=this.media)!=null&&rt.buffered.length&&(this.loadedmetadata=!0)}}onError(_e,tt){const rt=tt.frag;(rt==null?void 0:rt.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(_e,{subtitleTracks:tt}){if(this.levels&&subtitleOptionsIdentical(this.levels,tt)){this.levels=tt.map(rt=>new Level(rt));return}this.tracksBuffered=[],this.levels=tt.map(rt=>{const nt=new Level(rt);return this.tracksBuffered[nt.id]=[],nt}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(_e,tt){var rt;if(this.currentTrackId=tt.id,!((rt=this.levels)!=null&&rt.length)||this.currentTrackId===-1){this.clearInterval();return}const nt=this.levels[this.currentTrackId];nt!=null&&nt.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,nt&&this.setInterval(TICK_INTERVAL$1)}onSubtitleTrackLoaded(_e,tt){var rt;const{currentTrackId:nt,levels:it}=this,{details:st,id:ot}=tt;if(!it){this.warn(`Subtitle tracks were reset while loading level ${ot}`);return}const at=it[nt];if(ot>=it.length||ot!==nt||!at)return;this.log(`Subtitle track ${ot} loaded [${st.startSN},${st.endSN}]${st.lastPartSn?`[part-${st.lastPartSn}-${st.lastPartIndex}]`:""},duration:${st.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let lt=0;if(st.live||(rt=at.details)!=null&&rt.live){const ct=this.mainDetails;if(st.deltaUpdateFailed||!ct)return;const dt=ct.fragments[0];if(!at.details)st.hasProgramDateTime&&ct.hasProgramDateTime?(alignMediaPlaylistByPDT(st,ct),lt=st.fragments[0].start):dt&&(lt=dt.start,addSliding(st,lt));else{var ut;lt=this.alignPlaylists(st,at.details,(ut=this.levelLastLoaded)==null?void 0:ut.details),lt===0&&dt&&(lt=dt.start,addSliding(st,lt))}}at.details=st,this.levelLastLoaded=at,!this.startFragRequested&&(this.mainDetails||!st.live)&&this.setStartPosition(this.mainDetails||st,lt),this.tick(),st.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,st.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),at.details=void 0))}_handleFragmentLoadComplete(_e){const{frag:tt,payload:rt}=_e,nt=tt.decryptdata,it=this.hls;if(!this.fragContextChanged(tt)&&rt&&rt.byteLength>0&&nt!=null&&nt.key&&nt.iv&&nt.method==="AES-128"){const st=performance.now();this.decrypter.decrypt(new Uint8Array(rt),nt.key.buffer,nt.iv.buffer).catch(ot=>{throw it.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:ot,reason:ot.message,frag:tt}),ot}).then(ot=>{const at=performance.now();it.trigger(Events.FRAG_DECRYPTED,{frag:tt,payload:ot,stats:{tstart:st,tdecrypt:at}})}).catch(ot=>{this.warn(`${ot.name}: ${ot.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:_e,levels:tt}=this,rt=tt==null?void 0:tt[_e];if(!rt||!tt.length||!rt.details)return;const{config:nt}=this,it=this.getLoadPosition(),st=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],it,nt.maxBufferHole),{end:ot,len:at}=st,lt=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),ut=rt.details,ct=this.getMaxBufferLength(lt==null?void 0:lt.len)+ut.levelTargetDuration;if(at>ct)return;const dt=ut.fragments,ft=dt.length,pt=ut.edge;let mt=null;const ht=this.fragPrevious;if(ot<pt){const gt=nt.maxFragLookUpTolerance,vt=ot>pt-gt?0:gt;mt=findFragmentByPTS(ht,dt,Math.max(dt[0].start,ot),vt),!mt&&ht&&ht.start<dt[0].start&&(mt=dt[0])}else mt=dt[ft-1];if(!mt)return;if(mt=this.mapToInitFragWhenRequired(mt),mt.sn!=="initSegment"){const gt=mt.sn-ut.startSN,vt=dt[gt-1];vt&&vt.cc===mt.cc&&this.fragmentTracker.getState(vt)===FragmentState.NOT_LOADED&&(mt=vt)}this.fragmentTracker.getState(mt)===FragmentState.NOT_LOADED&&this.loadFragment(mt,rt,ot)}}getMaxBufferLength(_e){const tt=super.getMaxBufferLength();return _e?Math.max(tt,_e):tt}loadFragment(_e,tt,rt){this.fragCurrent=_e,_e.sn==="initSegment"?this._loadInitSegment(_e,tt):(this.startFragRequested=!0,super.loadFragment(_e,tt,rt))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(_e){this.buffered=void 0;const tt=(rt,nt,it)=>{if(nt=nt>>>0,nt>it-1)throw new DOMException(`Failed to execute '${rt}' on 'TimeRanges': The index provided (${nt}) is greater than the maximum bound (${it})`);return _e[nt][rt]};this.buffered={get length(){return _e.length},end(rt){return tt("end",rt,_e.length)},start(rt){return tt("start",rt,_e.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(_e){super(_e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let tt=null;const rt=filterSubtitleTracks(this.media.textTracks);for(let it=0;it<rt.length;it++)if(rt[it].mode==="hidden")tt=rt[it];else if(rt[it].mode==="showing"){tt=rt[it];break}const nt=this.findTrackForTextTrack(tt);this.subtitleTrack!==nt&&this.setSubtitleTrack(nt)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(_e){this._subtitleDisplay=_e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:_e}=this;_e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),_e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),_e.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),_e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:_e}=this;_e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),_e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),_e.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),_e.off(Events.ERROR,this.onError,this)}onMediaAttached(_e,tt){this.media=tt.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(_e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,_e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(tt=>{clearCurrentCues(tt)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(_e,tt){this.tracks=tt.subtitleTracks}onSubtitleTrackLoaded(_e,tt){const{id:rt,groupId:nt,details:it}=tt,st=this.tracksInGroup[rt];if(!st||st.groupId!==nt){this.warn(`Subtitle track with id:${rt} and group:${nt} not found in active group ${st==null?void 0:st.groupId}`);return}const ot=st.details;st.details=tt.details,this.log(`Subtitle track ${rt} "${st.name}" lang:${st.lang} group:${nt} loaded [${it.startSN}-${it.endSN}]`),rt===this.trackId&&this.playlistLoaded(rt,tt,ot)}onLevelLoading(_e,tt){this.switchLevel(tt.level)}onLevelSwitching(_e,tt){this.switchLevel(tt.level)}switchLevel(_e){const tt=this.hls.levels[_e];if(!tt)return;const rt=tt.subtitleGroups||null,nt=this.groupIds;let it=this.currentTrack;if(!rt||(nt==null?void 0:nt.length)!==(rt==null?void 0:rt.length)||rt!=null&&rt.some(st=>(nt==null?void 0:nt.indexOf(st))===-1)){this.groupIds=rt,this.trackId=-1,this.currentTrack=null;const st=this.tracks.filter(ut=>!rt||rt.indexOf(ut.groupId)!==-1);if(st.length)this.selectDefaultTrack&&!st.some(ut=>ut.default)&&(this.selectDefaultTrack=!1),st.forEach((ut,ct)=>{ut.id=ct});else if(!it&&!this.tracksInGroup.length)return;this.tracksInGroup=st;const ot=this.hls.config.subtitlePreference;if(!it&&ot){this.selectDefaultTrack=!1;const ut=findMatchingOption(ot,st);if(ut>-1)it=st[ut];else{const ct=findMatchingOption(ot,this.tracks);it=this.tracks[ct]}}let at=this.findTrackId(it);at===-1&&it&&(at=this.findTrackId(null));const lt={subtitleTracks:st};this.log(`Updating subtitle tracks, ${st.length} track(s) found in "${rt==null?void 0:rt.join(",")}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,lt),at!==-1&&this.trackId===-1&&this.setSubtitleTrack(at)}else this.shouldReloadPlaylist(it)&&this.setSubtitleTrack(this.trackId)}findTrackId(_e){const tt=this.tracksInGroup,rt=this.selectDefaultTrack;for(let nt=0;nt<tt.length;nt++){const it=tt[nt];if(!(rt&&!it.default||!rt&&!_e)&&(!_e||matchesOption(it,_e)))return nt}if(_e){for(let nt=0;nt<tt.length;nt++){const it=tt[nt];if(mediaAttributesIdentical(_e.attrs,it.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return nt}for(let nt=0;nt<tt.length;nt++){const it=tt[nt];if(mediaAttributesIdentical(_e.attrs,it.attrs,["LANGUAGE"]))return nt}}return-1}findTrackForTextTrack(_e){if(_e){const tt=this.tracksInGroup;for(let rt=0;rt<tt.length;rt++){const nt=tt[rt];if(subtitleTrackMatchesTextTrack(nt,_e))return rt}}return-1}onError(_e,tt){tt.fatal||!tt.context||tt.context.type===PlaylistContextType.SUBTITLE_TRACK&&tt.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(tt.context.groupId)!==-1)&&this.checkRetry(tt)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(_e){this.selectDefaultTrack=!1,this.setSubtitleTrack(_e)}setSubtitleOption(_e){if(this.hls.config.subtitlePreference=_e,_e){const tt=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,tt.length){const rt=this.currentTrack;if(rt&&matchesOption(_e,rt))return rt;const nt=findMatchingOption(_e,this.tracksInGroup);if(nt>-1){const it=this.tracksInGroup[nt];return this.setSubtitleTrack(nt),it}else{if(rt)return null;{const it=findMatchingOption(_e,tt);if(it>-1)return tt[it]}}}}return null}loadPlaylist(_e){super.loadPlaylist();const tt=this.currentTrack;if(this.shouldLoadPlaylist(tt)&&tt){const rt=tt.id,nt=tt.groupId;let it=tt.url;if(_e)try{it=_e.addDirectives(it)}catch(st){this.warn(`Could not construct new URL with HLS Delivery Directives: ${st}`)}this.log(`Loading subtitle playlist for id ${rt}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:it,id:rt,groupId:nt,deliveryDirectives:_e||null})}}toggleTrackModes(){const{media:_e}=this;if(!_e)return;const tt=filterSubtitleTracks(_e.textTracks),rt=this.currentTrack;let nt;if(rt&&(nt=tt.filter(it=>subtitleTrackMatchesTextTrack(rt,it))[0],nt||this.warn(`Unable to find subtitle TextTrack with name "${rt.name}" and language "${rt.lang}"`)),[].slice.call(tt).forEach(it=>{it.mode!=="disabled"&&it!==nt&&(it.mode="disabled")}),nt){const it=this.subtitleDisplay?"showing":"hidden";nt.mode!==it&&(nt.mode=it)}}setSubtitleTrack(_e){const tt=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=_e;return}if(_e<-1||_e>=tt.length||!isFiniteNumber(_e)){this.warn(`Invalid subtitle track id: ${_e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const rt=this.currentTrack,nt=tt[_e]||null;if(this.trackId=_e,this.currentTrack=nt,this.toggleTrackModes(),!nt){this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:_e});return}const it=!!nt.details&&!nt.details.live;if(_e===this.trackId&&nt===rt&&it)return;this.log(`Switching to subtitle-track ${_e}`+(nt?` "${nt.name}" lang:${nt.lang} group:${nt.groupId}`:""));const{id:st,groupId:ot="",name:at,type:lt,url:ut}=nt;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:st,groupId:ot,name:at,type:lt,url:ut});const ct=this.switchParams(nt.url,rt==null?void 0:rt.details);this.loadPlaylist(ct)}}class BufferOperationQueue{constructor(_e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=_e}append(_e,tt,rt){const nt=this.queues[tt];nt.push(_e),nt.length===1&&!rt&&this.executeNext(tt)}insertAbort(_e,tt){this.queues[tt].unshift(_e),this.executeNext(tt)}appendBlocker(_e){let tt;const rt=new Promise(it=>{tt=it}),nt={execute:tt,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(nt,_e),rt}executeNext(_e){const tt=this.queues[_e];if(tt.length){const rt=tt[0];try{rt.execute()}catch(nt){logger.warn(`[buffer-operation-queue]: Exception executing "${_e}" SourceBuffer operation: ${nt}`),rt.onError(nt);const it=this.buffers[_e];it!=null&&it.updating||this.shiftAndExecuteNext(_e)}}}shiftAndExecuteNext(_e){this.queues[_e].shift(),this.executeNext(_e)}current(_e){return this.queues[_e][0]}}const VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class BufferController{constructor(_e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=rt=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=rt=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:rt,mediaSource:nt}=this;this.log("Media source opened"),rt&&(rt.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:rt,mediaSource:nt})),nt&&nt.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:rt,_objectUrl:nt}=this;rt!==nt&&logger.error(`Media element src was set while attaching MediaSource (${nt} > ${rt})`)},this.hls=_e;const tt="[buffer-controller]";this.appendSource=_e.config.preferManagedMediaSource&&typeof self<"u"&&self.ManagedMediaSource,this.log=logger.log.bind(logger,tt),this.warn=logger.warn.bind(logger,tt),this.error=logger.error.bind(logger,tt),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:_e}=this;_e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.on(Events.BUFFER_RESET,this.onBufferReset,this),_e.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),_e.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),_e.on(Events.BUFFER_EOS,this.onBufferEos,this),_e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),_e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),_e.on(Events.FRAG_PARSED,this.onFragParsed,this),_e.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:_e}=this;_e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.off(Events.BUFFER_RESET,this.onBufferReset,this),_e.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),_e.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),_e.off(Events.BUFFER_EOS,this.onBufferEos,this),_e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),_e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),_e.off(Events.FRAG_PARSED,this.onFragParsed,this),_e.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(_e,tt){let rt=2;(tt.audio&&!tt.video||!tt.altAudio)&&(rt=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=rt,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(_e,tt){const rt=this.media=tt.media,nt=getMediaSource(this.appendSource);if(rt&&nt){var it;const st=this.mediaSource=new nt;this.log(`created media source: ${(it=st.constructor)==null?void 0:it.name}`),st.addEventListener("sourceopen",this._onMediaSourceOpen),st.addEventListener("sourceended",this._onMediaSourceEnded),st.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(st.addEventListener("startstreaming",this._onStartStreaming),st.addEventListener("endstreaming",this._onEndStreaming));const ot=this._objectUrl=self.URL.createObjectURL(st);if(this.appendSource)try{rt.removeAttribute("src");const at=self.ManagedMediaSource;rt.disableRemotePlayback=rt.disableRemotePlayback||at&&st instanceof at,removeSourceChildren(rt),addSource(rt,ot),rt.load()}catch{rt.src=ot}else rt.src=ot;rt.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:_e,mediaSource:tt,_objectUrl:rt}=this;if(tt){if(this.log("media source detaching"),tt.readyState==="open")try{tt.endOfStream()}catch(nt){this.warn(`onMediaDetaching: ${nt.message} while calling endOfStream`)}this.onBufferReset(),tt.removeEventListener("sourceopen",this._onMediaSourceOpen),tt.removeEventListener("sourceended",this._onMediaSourceEnded),tt.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(tt.removeEventListener("startstreaming",this._onStartStreaming),tt.removeEventListener("endstreaming",this._onEndStreaming)),_e&&(_e.removeEventListener("emptied",this._onMediaEmptied),rt&&self.URL.revokeObjectURL(rt),this.mediaSrc===rt?(_e.removeAttribute("src"),this.appendSource&&removeSourceChildren(_e),_e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(_e=>{this.resetBuffer(_e)}),this._initSourceBuffer()}resetBuffer(_e){const tt=this.sourceBuffer[_e];try{if(tt){var rt;this.removeBufferListeners(_e),this.sourceBuffer[_e]=void 0,(rt=this.mediaSource)!=null&&rt.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(tt)}}catch(nt){this.warn(`onBufferReset ${_e}`,nt)}}onBufferCodecs(_e,tt){const rt=this.getSourceBufferTypes().length,nt=Object.keys(tt);if(nt.forEach(st=>{if(rt){const at=this.tracks[st];if(at&&typeof at.buffer.changeType=="function"){var ot;const{id:lt,codec:ut,levelCodec:ct,container:dt,metadata:ft}=tt[st],pt=pickMostCompleteCodecName(at.codec,at.levelCodec),mt=pt==null?void 0:pt.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");let ht=pickMostCompleteCodecName(ut,ct);const gt=(ot=ht)==null?void 0:ot.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");if(ht&&mt!==gt){st.slice(0,5)==="audio"&&(ht=getCodecCompatibleName(ht,this.appendSource));const vt=`${dt};codecs=${ht}`;this.appendChangeType(st,vt),this.log(`switching codec ${pt} to ${ht}`),this.tracks[st]={buffer:at.buffer,codec:ut,container:dt,levelCodec:ct,metadata:ft,id:lt}}}}else this.pendingTracks[st]=tt[st]}),rt)return;const it=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==it&&(this.log(`${it} bufferCodec event(s) expected ${nt.join(",")}`),this.bufferCodecEventsExpected=it),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(_e,tt){const{operationQueue:rt}=this,nt={execute:()=>{const it=this.sourceBuffer[_e];it&&(this.log(`changing ${_e} sourceBuffer type to ${tt}`),it.changeType(tt)),rt.shiftAndExecuteNext(_e)},onStart:()=>{},onComplete:()=>{},onError:it=>{this.warn(`Failed to change ${_e} SourceBuffer type`,it)}};rt.append(nt,_e,!!this.pendingTracks[_e])}onBufferAppending(_e,tt){const{hls:rt,operationQueue:nt,tracks:it}=this,{data:st,type:ot,frag:at,part:lt,chunkMeta:ut}=tt,ct=ut.buffering[ot],dt=self.performance.now();ct.start=dt;const ft=at.stats.buffering,pt=lt?lt.stats.buffering:null;ft.start===0&&(ft.start=dt),pt&&pt.start===0&&(pt.start=dt);const mt=it.audio;let ht=!1;ot==="audio"&&(mt==null?void 0:mt.container)==="audio/mpeg"&&(ht=!this.lastMpegAudioChunk||ut.id===1||this.lastMpegAudioChunk.sn!==ut.sn,this.lastMpegAudioChunk=ut);const gt=at.start,vt={execute:()=>{if(ct.executeStart=self.performance.now(),ht){const yt=this.sourceBuffer[ot];if(yt){const bt=gt-yt.timestampOffset;Math.abs(bt)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${gt} (delta: ${bt}) sn: ${at.sn})`),yt.timestampOffset=gt)}}this.appendExecutor(st,ot)},onStart:()=>{},onComplete:()=>{const yt=self.performance.now();ct.executeEnd=ct.end=yt,ft.first===0&&(ft.first=yt),pt&&pt.first===0&&(pt.first=yt);const{sourceBuffer:bt}=this,xt={};for(const _t in bt)xt[_t]=BufferHelper.getBuffered(bt[_t]);this.appendErrors[ot]=0,ot==="audio"||ot==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Events.BUFFER_APPENDED,{type:ot,frag:at,part:lt,chunkMeta:ut,parent:at.type,timeRanges:xt})},onError:yt=>{const bt={type:ErrorTypes.MEDIA_ERROR,parent:at.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:ot,frag:at,part:lt,chunkMeta:ut,error:yt,err:yt,fatal:!1};if(yt.code===DOMException.QUOTA_EXCEEDED_ERR)bt.details=ErrorDetails.BUFFER_FULL_ERROR;else{const xt=++this.appendErrors[ot];bt.details=ErrorDetails.BUFFER_APPEND_ERROR,this.warn(`Failed ${xt}/${rt.config.appendErrorMaxRetry} times to append segment in "${ot}" sourceBuffer`),xt>=rt.config.appendErrorMaxRetry&&(bt.fatal=!0)}rt.trigger(Events.ERROR,bt)}};nt.append(vt,ot,!!this.pendingTracks[ot])}onBufferFlushing(_e,tt){const{operationQueue:rt}=this,nt=it=>({execute:this.removeExecutor.bind(this,it,tt.startOffset,tt.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:it})},onError:st=>{this.warn(`Failed to remove from ${it} SourceBuffer`,st)}});tt.type?rt.append(nt(tt.type),tt.type):this.getSourceBufferTypes().forEach(it=>{rt.append(nt(it),it)})}onFragParsed(_e,tt){const{frag:rt,part:nt}=tt,it=[],st=nt?nt.elementaryStreams:rt.elementaryStreams;st[ElementaryStreamTypes.AUDIOVIDEO]?it.push("audiovideo"):(st[ElementaryStreamTypes.AUDIO]&&it.push("audio"),st[ElementaryStreamTypes.VIDEO]&&it.push("video"));const ot=()=>{const at=self.performance.now();rt.stats.buffering.end=at,nt&&(nt.stats.buffering.end=at);const lt=nt?nt.stats:rt.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:rt,part:nt,stats:lt,id:rt.type})};it.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${rt.type} level: ${rt.level} sn: ${rt.sn}`),this.blockBuffers(ot,it)}onFragChanged(_e,tt){this.trimBuffers()}onBufferEos(_e,tt){this.getSourceBufferTypes().reduce((nt,it)=>{const st=this.sourceBuffer[it];return st&&(!tt.type||tt.type===it)&&(st.ending=!0,st.ended||(st.ended=!0,this.log(`${it} sourceBuffer now EOS`))),nt&&!!(!st||st.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(it=>{const st=this.sourceBuffer[it];st&&(st.ending=!1)});const{mediaSource:nt}=this;if(!nt||nt.readyState!=="open"){nt&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${nt.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),nt.endOfStream()}))}onLevelUpdated(_e,{details:tt}){tt.fragments.length&&(this.details=tt,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:_e,details:tt,media:rt}=this;if(!rt||tt===null||!this.getSourceBufferTypes().length)return;const it=_e.config,st=rt.currentTime,ot=tt.levelTargetDuration,at=tt.live&&it.liveBackBufferLength!==null?it.liveBackBufferLength:it.backBufferLength;if(isFiniteNumber(at)&&at>0){const lt=Math.max(at,ot),ut=Math.floor(st/ot)*ot-lt;this.flushBackBuffer(st,ot,ut)}if(isFiniteNumber(it.frontBufferFlushThreshold)&&it.frontBufferFlushThreshold>0){const lt=Math.max(it.maxBufferLength,it.frontBufferFlushThreshold),ut=Math.max(lt,ot),ct=Math.floor(st/ot)*ot+ut;this.flushFrontBuffer(st,ot,ct)}}flushBackBuffer(_e,tt,rt){const{details:nt,sourceBuffer:it}=this;this.getSourceBufferTypes().forEach(ot=>{const at=it[ot];if(at){const lt=BufferHelper.getBuffered(at);if(lt.length>0&&rt>lt.start(0)){if(this.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:rt}),nt!=null&&nt.live)this.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:rt});else if(at.ended&&lt.end(lt.length-1)-_e<tt*2){this.log(`Cannot flush ${ot} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:rt,type:ot})}}})}flushFrontBuffer(_e,tt,rt){const{sourceBuffer:nt}=this;this.getSourceBufferTypes().forEach(st=>{const ot=nt[st];if(ot){const at=BufferHelper.getBuffered(ot),lt=at.length;if(lt<2)return;const ut=at.start(lt-1),ct=at.end(lt-1);if(rt>ut||_e>=ut&&_e<=ct)return;if(ot.ended&&_e-ct<2*tt){this.log(`Cannot flush ${st} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:ut,endOffset:1/0,type:st})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:_e,hls:tt,media:rt,mediaSource:nt}=this,it=_e.fragments[0].start+_e.totalduration,st=rt.duration,ot=isFiniteNumber(nt.duration)?nt.duration:0;_e.live&&tt.config.liveDurationInfinity?(nt.duration=1/0,this.updateSeekableRange(_e)):(it>ot&&it>st||!isFiniteNumber(st))&&(this.log(`Updating Media Source duration to ${it.toFixed(3)}`),nt.duration=it)}updateSeekableRange(_e){const tt=this.mediaSource,rt=_e.fragments;if(rt.length&&_e.live&&tt!=null&&tt.setLiveSeekableRange){const it=Math.max(0,rt[0].start),st=Math.max(it,it+_e.totalduration);this.log(`Media Source duration is set to ${tt.duration}. Setting seekable range to ${it}-${st}.`),tt.setLiveSeekableRange(it,st)}}checkPendingTracks(){const{bufferCodecEventsExpected:_e,operationQueue:tt,pendingTracks:rt}=this,nt=Object.keys(rt).length;if(nt&&(!_e||nt===2||"audiovideo"in rt)){this.createSourceBuffers(rt),this.pendingTracks={};const it=this.getSourceBufferTypes();if(it.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),it.forEach(st=>{tt.executeNext(st)});else{const st=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:st,reason:st.message})}}}createSourceBuffers(_e){const{sourceBuffer:tt,mediaSource:rt}=this;if(!rt)throw Error("createSourceBuffers called when mediaSource was null");for(const nt in _e)if(!tt[nt]){const it=_e[nt];if(!it)throw Error(`source buffer exists for track ${nt}, however track does not`);let st=it.levelCodec||it.codec;st&&nt.slice(0,5)==="audio"&&(st=getCodecCompatibleName(st,this.appendSource));const ot=`${it.container};codecs=${st}`;this.log(`creating sourceBuffer(${ot})`);try{const at=tt[nt]=rt.addSourceBuffer(ot),lt=nt;this.addBufferListener(lt,"updatestart",this._onSBUpdateStart),this.addBufferListener(lt,"updateend",this._onSBUpdateEnd),this.addBufferListener(lt,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(lt,"bufferedchange",(ut,ct)=>{const dt=ct.removedRanges;dt!=null&&dt.length&&this.hls.trigger(Events.BUFFER_FLUSHED,{type:nt})}),this.tracks[nt]={buffer:at,codec:st,container:it.container,levelCodec:it.levelCodec,metadata:it.metadata,id:it.id}}catch(at){this.error(`error while trying to add sourceBuffer: ${at.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:at,sourceBufferName:nt,mimeType:ot})}}}get mediaSrc(){var _e;const tt=((_e=this.media)==null?void 0:_e.firstChild)||this.media;return tt==null?void 0:tt.src}_onSBUpdateStart(_e){const{operationQueue:tt}=this;tt.current(_e).onStart()}_onSBUpdateEnd(_e){var tt;if(((tt=this.mediaSource)==null?void 0:tt.readyState)==="closed"){this.resetBuffer(_e);return}const{operationQueue:rt}=this;rt.current(_e).onComplete(),rt.shiftAndExecuteNext(_e)}_onSBUpdateError(_e,tt){var rt;const nt=new Error(`${_e} SourceBuffer error. MediaSource readyState: ${(rt=this.mediaSource)==null?void 0:rt.readyState}`);this.error(`${nt}`,tt),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:_e,error:nt,fatal:!1});const it=this.operationQueue.current(_e);it&&it.onError(nt)}removeExecutor(_e,tt,rt){const{media:nt,mediaSource:it,operationQueue:st,sourceBuffer:ot}=this,at=ot[_e];if(!nt||!it||!at){this.warn(`Attempting to remove from the ${_e} SourceBuffer, but it does not exist`),st.shiftAndExecuteNext(_e);return}const lt=isFiniteNumber(nt.duration)?nt.duration:1/0,ut=isFiniteNumber(it.duration)?it.duration:1/0,ct=Math.max(0,tt),dt=Math.min(rt,lt,ut);dt>ct&&(!at.ending||at.ended)?(at.ended=!1,this.log(`Removing [${ct},${dt}] from the ${_e} SourceBuffer`),at.remove(ct,dt)):st.shiftAndExecuteNext(_e)}appendExecutor(_e,tt){const rt=this.sourceBuffer[tt];if(!rt){if(!this.pendingTracks[tt])throw new Error(`Attempting to append to the ${tt} SourceBuffer, but it does not exist`);return}rt.ended=!1,rt.appendBuffer(_e)}blockBuffers(_e,tt=this.getSourceBufferTypes()){if(!tt.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(_e);return}const{operationQueue:rt}=this,nt=tt.map(it=>rt.appendBlocker(it));Promise.all(nt).then(()=>{_e(),tt.forEach(it=>{const st=this.sourceBuffer[it];st!=null&&st.updating||rt.shiftAndExecuteNext(it)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(_e,tt,rt){const nt=this.sourceBuffer[_e];if(!nt)return;const it=rt.bind(this,_e);this.listeners[_e].push({event:tt,listener:it}),nt.addEventListener(tt,it)}removeBufferListeners(_e){const tt=this.sourceBuffer[_e];tt&&this.listeners[_e].forEach(rt=>{tt.removeEventListener(rt.event,rt.listener)})}}function removeSourceChildren(et){const _e=et.querySelectorAll("source");[].slice.call(_e).forEach(tt=>{et.removeChild(tt)})}function addSource(et,_e){const tt=self.document.createElement("source");tt.type="video/mp4",tt.src=_e,et.appendChild(tt)}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function et(_e){let tt=_e;return specialCea608CharsCodes.hasOwnProperty(_e)&&(tt=specialCea608CharsCodes[_e]),String.fromCharCode(tt)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(_e,tt){if(this.verboseLevel>=_e){const rt=typeof tt=="function"?tt():tt;logger.log(`${this.time} [${_e}] ${rt}`)}}}const numArrayToHexArray=function et(_e){const tt=[];for(let rt=0;rt<_e.length;rt++)tt.push(_e[rt].toString(16));return tt};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(_e){const tt=["foreground","underline","italics","background","flash"];for(let rt=0;rt<tt.length;rt++){const nt=tt[rt];_e.hasOwnProperty(nt)&&(this[nt]=_e[nt])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(_e){return this.foreground===_e.foreground&&this.underline===_e.underline&&this.italics===_e.italics&&this.background===_e.background&&this.flash===_e.flash}copy(_e){this.foreground=_e.foreground,this.underline=_e.underline,this.italics=_e.italics,this.background=_e.background,this.flash=_e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(_e,tt){this.uchar=_e,this.penState.copy(tt)}setPenState(_e){this.penState.copy(_e)}equals(_e){return this.uchar===_e.uchar&&this.penState.equals(_e.penState)}copy(_e){this.uchar=_e.uchar,this.penState.copy(_e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(_e){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let tt=0;tt<NR_COLS;tt++)this.chars.push(new StyledUnicodeChar);this.logger=_e}equals(_e){for(let tt=0;tt<NR_COLS;tt++)if(!this.chars[tt].equals(_e.chars[tt]))return!1;return!0}copy(_e){for(let tt=0;tt<NR_COLS;tt++)this.chars[tt].copy(_e.chars[tt])}isEmpty(){let _e=!0;for(let tt=0;tt<NR_COLS;tt++)if(!this.chars[tt].isEmpty()){_e=!1;break}return _e}setCursor(_e){this.pos!==_e&&(this.pos=_e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(_e){const tt=this.pos+_e;if(_e>1)for(let rt=this.pos+1;rt<tt+1;rt++)this.chars[rt].setPenState(this.currPenState);this.setCursor(tt)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(_e){_e>=144&&this.backSpace();const tt=getCharForByte(_e);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+_e.toString(16)+" ("+tt+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(tt,this.currPenState),this.moveCursor(1)}clearFromPos(_e){let tt;for(tt=_e;tt<NR_COLS;tt++)this.chars[tt].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const _e=[];let tt=!0;for(let rt=0;rt<NR_COLS;rt++){const nt=this.chars[rt].uchar;nt!==" "&&(tt=!1),_e.push(nt)}return tt?"":_e.join("")}setPenStyles(_e){this.currPenState.setStyles(_e),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(_e){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let tt=0;tt<NR_ROWS;tt++)this.rows.push(new Row(_e));this.logger=_e}reset(){for(let _e=0;_e<NR_ROWS;_e++)this.rows[_e].clear();this.currRow=NR_ROWS-1}equals(_e){let tt=!0;for(let rt=0;rt<NR_ROWS;rt++)if(!this.rows[rt].equals(_e.rows[rt])){tt=!1;break}return tt}copy(_e){for(let tt=0;tt<NR_ROWS;tt++)this.rows[tt].copy(_e.rows[tt])}isEmpty(){let _e=!0;for(let tt=0;tt<NR_ROWS;tt++)if(!this.rows[tt].isEmpty()){_e=!1;break}return _e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(_e){this.rows[this.currRow].insertChar(_e)}setPen(_e){this.rows[this.currRow].setPenStyles(_e)}moveCursor(_e){this.rows[this.currRow].moveCursor(_e)}setCursor(_e){this.logger.log(2,"setCursor: "+_e),this.rows[this.currRow].setCursor(_e)}setPAC(_e){this.logger.log(2,()=>"pacData = "+JSON.stringify(_e));let tt=_e.row-1;if(this.nrRollUpRows&&tt<this.nrRollUpRows-1&&(tt=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==tt){for(let ot=0;ot<NR_ROWS;ot++)this.rows[ot].clear();const it=this.currRow+1-this.nrRollUpRows,st=this.lastOutputScreen;if(st){const ot=st.rows[it].cueStartTime,at=this.logger.time;if(ot!==null&&at!==null&&ot<at)for(let lt=0;lt<this.nrRollUpRows;lt++)this.rows[tt-this.nrRollUpRows+lt+1].copy(st.rows[it+lt])}}this.currRow=tt;const rt=this.rows[this.currRow];if(_e.indent!==null){const it=_e.indent,st=Math.max(it-1,0);rt.setCursor(_e.indent),_e.color=rt.chars[st].penState.foreground}const nt={foreground:_e.color,underline:_e.underline,italics:_e.italics,background:"black",flash:!1};this.setPen(nt)}setBkgData(_e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(_e)),this.backSpace(),this.setPen(_e),this.insertChar(32)}setRollUpRows(_e){this.nrRollUpRows=_e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const _e=this.currRow+1-this.nrRollUpRows,tt=this.rows.splice(_e,1)[0];tt.clear(),this.rows.splice(this.currRow,0,tt),this.logger.log(2,"Rolling up")}getDisplayText(_e){_e=_e||!1;const tt=[];let rt="",nt=-1;for(let it=0;it<NR_ROWS;it++){const st=this.rows[it].getTextString();st&&(nt=it+1,_e?tt.push("Row "+nt+": '"+st+"'"):tt.push(st.trim()))}return tt.length>0&&(_e?rt="["+tt.join(" | ")+"]":rt=tt.join(`
`)),rt}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(_e,tt,rt){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=_e,this.outputFilter=tt,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(rt),this.nonDisplayedMemory=new CaptionScreen(rt),this.lastOutputScreen=new CaptionScreen(rt),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=rt}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(_e){this.outputFilter=_e}setPAC(_e){this.writeScreen.setPAC(_e)}setBkgData(_e){this.writeScreen.setBkgData(_e)}setMode(_e){_e!==this.mode&&(this.mode=_e,this.logger.log(2,()=>"MODE="+_e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=_e)}insertChars(_e){for(let rt=0;rt<_e.length;rt++)this.writeScreen.insertChar(_e[rt]);const tt=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>tt+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(_e){this.logger.log(2,"RU("+_e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(_e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const _e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=_e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(_e){this.logger.log(2,"TO("+_e+") - Tab Offset"),this.writeScreen.moveCursor(_e)}ccMIDROW(_e){const tt={flash:!1};if(tt.underline=_e%2===1,tt.italics=_e>=46,tt.italics)tt.foreground="white";else{const rt=Math.floor(_e/2)-16,nt=["white","green","blue","cyan","red","yellow","magenta"];tt.foreground=nt[rt]}this.logger.log(2,"MIDROW: "+JSON.stringify(tt)),this.writeScreen.setPen(tt)}outputDataUpdate(_e=!1){const tt=this.logger.time;tt!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=tt:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,tt,this.lastOutputScreen),_e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:tt),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(_e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,_e,this.displayedMemory),this.cueStartTime=_e))}}class Cea608Parser{constructor(_e,tt,rt){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;const nt=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(_e,tt,nt),new Cea608Channel(_e+1,rt,nt)]}getHandler(_e){return this.channels[_e].getHandler()}setHandler(_e,tt){this.channels[_e].setHandler(tt)}addData(_e,tt){let rt,nt,it,st=!1;this.logger.time=_e;for(let ot=0;ot<tt.length;ot+=2)if(nt=tt[ot]&127,it=tt[ot+1]&127,!(nt===0&&it===0)){if(this.logger.log(3,"["+numArrayToHexArray([tt[ot],tt[ot+1]])+"] -> ("+numArrayToHexArray([nt,it])+")"),rt=this.parseCmd(nt,it),rt||(rt=this.parseMidrow(nt,it)),rt||(rt=this.parsePAC(nt,it)),rt||(rt=this.parseBackgroundAttributes(nt,it)),!rt&&(st=this.parseChars(nt,it),st)){const at=this.currentChannel;at&&at>0?this.channels[at].insertChars(st):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!rt&&!st&&this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([nt,it])+" orig: "+numArrayToHexArray([tt[ot],tt[ot+1]]))}}parseCmd(_e,tt){const{cmdHistory:rt}=this,nt=(_e===20||_e===28||_e===21||_e===29)&&tt>=32&&tt<=47,it=(_e===23||_e===31)&&tt>=33&&tt<=35;if(!(nt||it))return!1;if(hasCmdRepeated(_e,tt,rt))return setLastCmd(null,null,rt),this.logger.log(3,"Repeated command ("+numArrayToHexArray([_e,tt])+") is dropped"),!0;const st=_e===20||_e===21||_e===23?1:2,ot=this.channels[st];return _e===20||_e===21||_e===28||_e===29?tt===32?ot.ccRCL():tt===33?ot.ccBS():tt===34?ot.ccAOF():tt===35?ot.ccAON():tt===36?ot.ccDER():tt===37?ot.ccRU(2):tt===38?ot.ccRU(3):tt===39?ot.ccRU(4):tt===40?ot.ccFON():tt===41?ot.ccRDC():tt===42?ot.ccTR():tt===43?ot.ccRTD():tt===44?ot.ccEDM():tt===45?ot.ccCR():tt===46?ot.ccENM():tt===47&&ot.ccEOC():ot.ccTO(tt-32),setLastCmd(_e,tt,rt),this.currentChannel=st,!0}parseMidrow(_e,tt){let rt=0;if((_e===17||_e===25)&&tt>=32&&tt<=47){if(_e===17?rt=1:rt=2,rt!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const nt=this.channels[rt];return nt?(nt.ccMIDROW(tt),this.logger.log(3,"MIDROW ("+numArrayToHexArray([_e,tt])+")"),!0):!1}return!1}parsePAC(_e,tt){let rt;const nt=this.cmdHistory,it=(_e>=17&&_e<=23||_e>=25&&_e<=31)&&tt>=64&&tt<=127,st=(_e===16||_e===24)&&tt>=64&&tt<=95;if(!(it||st))return!1;if(hasCmdRepeated(_e,tt,nt))return setLastCmd(null,null,nt),!0;const ot=_e<=23?1:2;tt>=64&&tt<=95?rt=ot===1?rowsLowCh1[_e]:rowsLowCh2[_e]:rt=ot===1?rowsHighCh1[_e]:rowsHighCh2[_e];const at=this.channels[ot];return at?(at.setPAC(this.interpretPAC(rt,tt)),setLastCmd(_e,tt,nt),this.currentChannel=ot,!0):!1}interpretPAC(_e,tt){let rt;const nt={color:null,italics:!1,indent:null,underline:!1,row:_e};return tt>95?rt=tt-96:rt=tt-64,nt.underline=(rt&1)===1,rt<=13?nt.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(rt/2)]:rt<=15?(nt.italics=!0,nt.color="white"):nt.indent=Math.floor((rt-16)/2)*4,nt}parseChars(_e,tt){let rt,nt=null,it=null;if(_e>=25?(rt=2,it=_e-8):(rt=1,it=_e),it>=17&&it<=19){let st;it===17?st=tt+80:it===18?st=tt+112:st=tt+144,this.logger.log(2,"Special char '"+getCharForByte(st)+"' in channel "+rt),nt=[st]}else _e>=32&&_e<=127&&(nt=tt===0?[_e]:[_e,tt]);if(nt){const st=numArrayToHexArray(nt);this.logger.log(3,"Char codes =  "+st.join(",")),setLastCmd(_e,tt,this.cmdHistory)}return nt}parseBackgroundAttributes(_e,tt){const rt=(_e===16||_e===24)&&tt>=32&&tt<=47,nt=(_e===23||_e===31)&&tt>=45&&tt<=47;if(!(rt||nt))return!1;let it;const st={};_e===16||_e===24?(it=Math.floor((tt-32)/2),st.background=backgroundColors[it],tt%2===1&&(st.background=st.background+"_semi")):tt===45?st.background="transparent":(st.foreground="black",tt===47&&(st.underline=!0));const ot=_e<=23?1:2;return this.channels[ot].setBkgData(st),setLastCmd(_e,tt,this.cmdHistory),!0}reset(){for(let _e=0;_e<Object.keys(this.channels).length;_e++){const tt=this.channels[_e];tt&&tt.reset()}this.cmdHistory=createCmdHistory()}cueSplitAtTime(_e){for(let tt=0;tt<this.channels.length;tt++){const rt=this.channels[tt];rt&&rt.cueSplitAtTime(_e)}}}function setLastCmd(et,_e,tt){tt.a=et,tt.b=_e}function hasCmdRepeated(et,_e,tt){return tt.a===et&&tt.b===_e}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(_e,tt){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=_e,this.trackName=tt}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(_e,tt,rt){(this.startTime===null||this.startTime>_e)&&(this.startTime=_e),this.endTime=tt,this.screen=rt,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(optionalSelf!=null&&optionalSelf.VTTCue)return self.VTTCue;const et=["","lr","rl"],_e=["start","middle","end","left","right"];function tt(ot,at){if(typeof at!="string"||!Array.isArray(ot))return!1;const lt=at.toLowerCase();return~ot.indexOf(lt)?lt:!1}function rt(ot){return tt(et,ot)}function nt(ot){return tt(_e,ot)}function it(ot,...at){let lt=1;for(;lt<arguments.length;lt++){const ut=arguments[lt];for(const ct in ut)ot[ct]=ut[ct]}return ot}function st(ot,at,lt){const ut=this,ct={enumerable:!0};ut.hasBeenReset=!1;let dt="",ft=!1,pt=ot,mt=at,ht=lt,gt=null,vt="",yt=!0,bt="auto",xt="start",_t=50,wt="middle",Ct=50,kt="middle";Object.defineProperty(ut,"id",it({},ct,{get:function(){return dt},set:function(At){dt=""+At}})),Object.defineProperty(ut,"pauseOnExit",it({},ct,{get:function(){return ft},set:function(At){ft=!!At}})),Object.defineProperty(ut,"startTime",it({},ct,{get:function(){return pt},set:function(At){if(typeof At!="number")throw new TypeError("Start time must be set to a number.");pt=At,this.hasBeenReset=!0}})),Object.defineProperty(ut,"endTime",it({},ct,{get:function(){return mt},set:function(At){if(typeof At!="number")throw new TypeError("End time must be set to a number.");mt=At,this.hasBeenReset=!0}})),Object.defineProperty(ut,"text",it({},ct,{get:function(){return ht},set:function(At){ht=""+At,this.hasBeenReset=!0}})),Object.defineProperty(ut,"region",it({},ct,{get:function(){return gt},set:function(At){gt=At,this.hasBeenReset=!0}})),Object.defineProperty(ut,"vertical",it({},ct,{get:function(){return vt},set:function(At){const $t=rt(At);if($t===!1)throw new SyntaxError("An invalid or illegal string was specified.");vt=$t,this.hasBeenReset=!0}})),Object.defineProperty(ut,"snapToLines",it({},ct,{get:function(){return yt},set:function(At){yt=!!At,this.hasBeenReset=!0}})),Object.defineProperty(ut,"line",it({},ct,{get:function(){return bt},set:function(At){if(typeof At!="number"&&At!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");bt=At,this.hasBeenReset=!0}})),Object.defineProperty(ut,"lineAlign",it({},ct,{get:function(){return xt},set:function(At){const $t=nt(At);if(!$t)throw new SyntaxError("An invalid or illegal string was specified.");xt=$t,this.hasBeenReset=!0}})),Object.defineProperty(ut,"position",it({},ct,{get:function(){return _t},set:function(At){if(At<0||At>100)throw new Error("Position must be between 0 and 100.");_t=At,this.hasBeenReset=!0}})),Object.defineProperty(ut,"positionAlign",it({},ct,{get:function(){return wt},set:function(At){const $t=nt(At);if(!$t)throw new SyntaxError("An invalid or illegal string was specified.");wt=$t,this.hasBeenReset=!0}})),Object.defineProperty(ut,"size",it({},ct,{get:function(){return Ct},set:function(At){if(At<0||At>100)throw new Error("Size must be between 0 and 100.");Ct=At,this.hasBeenReset=!0}})),Object.defineProperty(ut,"align",it({},ct,{get:function(){return kt},set:function(At){const $t=nt(At);if(!$t)throw new SyntaxError("An invalid or illegal string was specified.");kt=$t,this.hasBeenReset=!0}})),ut.displayState=void 0}return st.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},st}();class StringDecoder{decode(_e,tt){if(!_e)return"";if(typeof _e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(_e))}}function parseTimeStamp(et){function _e(rt,nt,it,st){return(rt|0)*3600+(nt|0)*60+(it|0)+parseFloat(st||0)}const tt=et.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return tt?parseFloat(tt[2])>59?_e(tt[2],tt[3],0,tt[4]):_e(tt[1],tt[2],tt[3],tt[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(_e,tt){!this.get(_e)&&tt!==""&&(this.values[_e]=tt)}get(_e,tt,rt){return rt?this.has(_e)?this.values[_e]:tt[rt]:this.has(_e)?this.values[_e]:tt}has(_e){return _e in this.values}alt(_e,tt,rt){for(let nt=0;nt<rt.length;++nt)if(tt===rt[nt]){this.set(_e,tt);break}}integer(_e,tt){/^-?\d+$/.test(tt)&&this.set(_e,parseInt(tt,10))}percent(_e,tt){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(tt)){const rt=parseFloat(tt);if(rt>=0&&rt<=100)return this.set(_e,rt),!0}return!1}}function parseOptions(et,_e,tt,rt){const nt=rt?et.split(rt):[et];for(const it in nt){if(typeof nt[it]!="string")continue;const st=nt[it].split(tt);if(st.length!==2)continue;const ot=st[0],at=st[1];_e(ot,at)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue(et,_e,tt){const rt=et;function nt(){const ot=parseTimeStamp(et);if(ot===null)throw new Error("Malformed timestamp: "+rt);return et=et.replace(/^[^\sa-zA-Z-]+/,""),ot}function it(ot,at){const lt=new Settings;parseOptions(ot,function(dt,ft){let pt;switch(dt){case"region":for(let mt=tt.length-1;mt>=0;mt--)if(tt[mt].id===ft){lt.set(dt,tt[mt].region);break}break;case"vertical":lt.alt(dt,ft,["rl","lr"]);break;case"line":pt=ft.split(","),lt.integer(dt,pt[0]),lt.percent(dt,pt[0])&&lt.set("snapToLines",!1),lt.alt(dt,pt[0],["auto"]),pt.length===2&&lt.alt("lineAlign",pt[1],["start",center,"end"]);break;case"position":pt=ft.split(","),lt.percent(dt,pt[0]),pt.length===2&&lt.alt("positionAlign",pt[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":lt.percent(dt,ft);break;case"align":lt.alt(dt,ft,["start",center,"end","left","right"]);break}},/:/,/\s/),at.region=lt.get("region",null),at.vertical=lt.get("vertical","");let ut=lt.get("line","auto");ut==="auto"&&defaults.line===-1&&(ut=-1),at.line=ut,at.lineAlign=lt.get("lineAlign","start"),at.snapToLines=lt.get("snapToLines",!0),at.size=lt.get("size",100),at.align=lt.get("align",center);let ct=lt.get("position","auto");ct==="auto"&&defaults.position===50&&(ct=at.align==="start"||at.align==="left"?0:at.align==="end"||at.align==="right"?100:50),at.position=ct}function st(){et=et.replace(/^\s+/,"")}if(st(),_e.startTime=nt(),st(),et.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+rt);et=et.slice(3),st(),_e.endTime=nt(),st(),it(et,_e)}function fixLineBreaks(et){return et.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(_e){const tt=this;_e&&(tt.buffer+=tt.decoder.decode(_e,{stream:!0}));function rt(){let it=tt.buffer,st=0;for(it=fixLineBreaks(it);st<it.length&&it[st]!=="\r"&&it[st]!==`
`;)++st;const ot=it.slice(0,st);return it[st]==="\r"&&++st,it[st]===`
`&&++st,tt.buffer=it.slice(st),ot}function nt(it){parseOptions(it,function(st,ot){},/:/)}try{let it="";if(tt.state==="INITIAL"){if(!/\r\n|\n/.test(tt.buffer))return this;it=rt();const ot=it.match(/^()?WEBVTT([ \t].*)?$/);if(!(ot!=null&&ot[0]))throw new Error("Malformed WebVTT signature.");tt.state="HEADER"}let st=!1;for(;tt.buffer;){if(!/\r\n|\n/.test(tt.buffer))return this;switch(st?st=!1:it=rt(),tt.state){case"HEADER":/:/.test(it)?nt(it):it||(tt.state="ID");continue;case"NOTE":it||(tt.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(it)){tt.state="NOTE";break}if(!it)continue;if(tt.cue=new VTTCue(0,0,""),tt.state="CUE",it.indexOf("-->")===-1){tt.cue.id=it;continue}case"CUE":if(!tt.cue){tt.state="BADCUE";continue}try{parseCue(it,tt.cue,tt.regionList)}catch{tt.cue=null,tt.state="BADCUE";continue}tt.state="CUETEXT";continue;case"CUETEXT":{const ot=it.indexOf("-->")!==-1;if(!it||ot&&(st=!0)){tt.oncue&&tt.cue&&tt.oncue(tt.cue),tt.cue=null,tt.state="ID";continue}if(tt.cue===null)continue;tt.cue.text&&(tt.cue.text+=`
`),tt.cue.text+=it}continue;case"BADCUE":it||(tt.state="ID")}}}catch{tt.state==="CUETEXT"&&tt.cue&&tt.oncue&&tt.oncue(tt.cue),tt.cue=null,tt.state=tt.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const _e=this;try{if((_e.cue||_e.state==="HEADER")&&(_e.buffer+=`

`,_e.parse()),_e.state==="INITIAL"||_e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(tt){_e.onparsingerror&&_e.onparsingerror(tt)}return _e.onflush&&_e.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function et(_e,tt,rt=0){return _e.slice(rt,rt+tt.length)===tt},cueString2millis=function et(_e){let tt=parseInt(_e.slice(-3));const rt=parseInt(_e.slice(-6,-4)),nt=parseInt(_e.slice(-9,-7)),it=_e.length>9?parseInt(_e.substring(0,_e.indexOf(":"))):0;if(!isFiniteNumber(tt)||!isFiniteNumber(rt)||!isFiniteNumber(nt)||!isFiniteNumber(it))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${_e}`);return tt+=1e3*rt,tt+=60*1e3*nt,tt+=60*60*1e3*it,tt},hash=function et(_e){let tt=5381,rt=_e.length;for(;rt;)tt=tt*33^_e.charCodeAt(--rt);return(tt>>>0).toString()};function generateCueId(et,_e,tt){return hash(et.toString())+hash(_e.toString())+hash(tt)}const calculateOffset=function et(_e,tt,rt){let nt=_e[tt],it=_e[nt.prevCC];if(!it||!it.new&&nt.new){_e.ccOffset=_e.presentationOffset=nt.start,nt.new=!1;return}for(;(st=it)!=null&&st.new;){var st;_e.ccOffset+=nt.start-it.start,nt.new=!1,nt=it,it=_e[nt.prevCC]}_e.presentationOffset=rt};function parseWebVTT(et,_e,tt,rt,nt,it,st){const ot=new VTTParser,at=utf8ArrayToStr(new Uint8Array(et)).trim().replace(LINEBREAKS,`
`).split(`
`),lt=[],ut=_e?toMpegTsClockFromTimescale(_e.baseTime,_e.timescale):0;let ct="00:00.000",dt=0,ft=0,pt,mt=!0;ot.oncue=function(ht){const gt=tt[rt];let vt=tt.ccOffset;const yt=(dt-ut)/9e4;if(gt!=null&&gt.new&&(ft!==void 0?vt=tt.ccOffset=gt.start:calculateOffset(tt,rt,yt)),yt){if(!_e){pt=new Error("Missing initPTS for VTT MPEGTS");return}vt=yt-tt.presentationOffset}const bt=ht.endTime-ht.startTime,xt=normalizePts((ht.startTime+vt-ft)*9e4,nt*9e4)/9e4;ht.startTime=Math.max(xt,0),ht.endTime=Math.max(xt+bt,0);const _t=ht.text.trim();ht.text=decodeURIComponent(encodeURIComponent(_t)),ht.id||(ht.id=generateCueId(ht.startTime,ht.endTime,_t)),ht.endTime>0&&lt.push(ht)},ot.onparsingerror=function(ht){pt=ht},ot.onflush=function(){if(pt){st(pt);return}it(lt)},at.forEach(ht=>{if(mt)if(startsWith(ht,"X-TIMESTAMP-MAP=")){mt=!1,ht.slice(16).split(",").forEach(gt=>{startsWith(gt,"LOCAL:")?ct=gt.slice(6):startsWith(gt,"MPEGTS:")&&(dt=parseInt(gt.slice(7)))});try{ft=cueString2millis(ct)/1e3}catch(gt){pt=gt}return}else ht===""&&(mt=!1);ot.parse(ht+`
`)}),ot.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(et,_e,tt,rt){const nt=findBox(new Uint8Array(et),["mdat"]);if(nt.length===0){rt(new Error("Could not parse IMSC1 mdat"));return}const it=nt.map(ot=>utf8ArrayToStr(ot)),st=toTimescaleFromScale(_e.baseTime,1,_e.timescale);try{it.forEach(ot=>tt(parseTTML(ot,st)))}catch(ot){rt(ot)}}function parseTTML(et,_e){const nt=new DOMParser().parseFromString(et,"text/xml").getElementsByTagName("tt")[0];if(!nt)throw new Error("Invalid ttml");const it={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},st=Object.keys(it).reduce((ct,dt)=>(ct[dt]=nt.getAttribute(`ttp:${dt}`)||it[dt],ct),{}),ot=nt.getAttribute("xml:space")!=="preserve",at=collectionToDictionary(getElementCollection(nt,"styling","style")),lt=collectionToDictionary(getElementCollection(nt,"layout","region")),ut=getElementCollection(nt,"body","[begin]");return[].map.call(ut,ct=>{const dt=getTextContent(ct,ot);if(!dt||!ct.hasAttribute("begin"))return null;const ft=parseTtmlTime(ct.getAttribute("begin"),st),pt=parseTtmlTime(ct.getAttribute("dur"),st);let mt=parseTtmlTime(ct.getAttribute("end"),st);if(ft===null)throw timestampParsingError(ct);if(mt===null){if(pt===null)throw timestampParsingError(ct);mt=ft+pt}const ht=new VTTCue(ft-_e,mt-_e,dt);ht.id=generateCueId(ht.startTime,ht.endTime,ht.text);const gt=lt[ct.getAttribute("region")],vt=at[ct.getAttribute("style")],yt=getTtmlStyles(gt,vt,at),{textAlign:bt}=yt;if(bt){const xt=textAlignToLineAlign[bt];xt&&(ht.lineAlign=xt),ht.align=bt}return _extends(ht,yt),ht}).filter(ct=>ct!==null)}function getElementCollection(et,_e,tt){const rt=et.getElementsByTagName(_e)[0];return rt?[].slice.call(rt.querySelectorAll(tt)):[]}function collectionToDictionary(et){return et.reduce((_e,tt)=>{const rt=tt.getAttribute("xml:id");return rt&&(_e[rt]=tt),_e},{})}function getTextContent(et,_e){return[].slice.call(et.childNodes).reduce((tt,rt,nt)=>{var it;return rt.nodeName==="br"&&nt?tt+`
`:(it=rt.childNodes)!=null&&it.length?getTextContent(rt,_e):_e?tt+rt.textContent.trim().replace(/\s+/g," "):tt+rt.textContent},"")}function getTtmlStyles(et,_e,tt){const rt="http://www.w3.org/ns/ttml#styling";let nt=null;const it=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],st=et!=null&&et.hasAttribute("style")?et.getAttribute("style"):null;return st&&tt.hasOwnProperty(st)&&(nt=tt[st]),it.reduce((ot,at)=>{const lt=getAttributeNS(_e,rt,at)||getAttributeNS(et,rt,at)||getAttributeNS(nt,rt,at);return lt&&(ot[at]=lt),ot},{})}function getAttributeNS(et,_e,tt){return et&&et.hasAttributeNS(_e,tt)?et.getAttributeNS(_e,tt):null}function timestampParsingError(et){return new Error(`Could not parse ttml timestamp ${et}`)}function parseTtmlTime(et,_e){if(!et)return null;let tt=parseTimeStamp(et);return tt===null&&(HMSF_REGEX.test(et)?tt=parseHoursMinutesSecondsFrames(et,_e):TIME_UNIT_REGEX.test(et)&&(tt=parseTimeUnits(et,_e))),tt}function parseHoursMinutesSecondsFrames(et,_e){const tt=HMSF_REGEX.exec(et),rt=(tt[4]|0)+(tt[5]|0)/_e.subFrameRate;return(tt[1]|0)*3600+(tt[2]|0)*60+(tt[3]|0)+rt/_e.frameRate}function parseTimeUnits(et,_e){const tt=TIME_UNIT_REGEX.exec(et),rt=Number(tt[1]);switch(tt[2]){case"h":return rt*3600;case"m":return rt*60;case"ms":return rt*1e3;case"f":return rt/_e.frameRate;case"t":return rt/_e.tickRate}return rt}class TimelineController{constructor(_e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=_e,this.config=_e.config,this.Cues=_e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},_e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),_e.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),_e.on(Events.FRAG_LOADING,this.onFragLoading,this),_e.on(Events.FRAG_LOADED,this.onFragLoaded,this),_e.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),_e.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),_e.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),_e.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),_e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:_e}=this;_e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),_e.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),_e.off(Events.FRAG_LOADING,this.onFragLoading,this),_e.off(Events.FRAG_LOADED,this.onFragLoaded,this),_e.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),_e.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),_e.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),_e.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),_e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const _e=new OutputFilter(this,"textTrack1"),tt=new OutputFilter(this,"textTrack2"),rt=new OutputFilter(this,"textTrack3"),nt=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,_e,tt),this.cea608Parser2=new Cea608Parser(3,rt,nt)}}addCues(_e,tt,rt,nt,it){let st=!1;for(let ot=it.length;ot--;){const at=it[ot],lt=intersection(at[0],at[1],tt,rt);if(lt>=0&&(at[0]=Math.min(at[0],tt),at[1]=Math.max(at[1],rt),st=!0,lt/(rt-tt)>.5))return}if(st||it.push([tt,rt]),this.config.renderTextTracksNatively){const ot=this.captionsTracks[_e];this.Cues.newCue(ot,tt,rt,nt)}else{const ot=this.Cues.newCue(null,tt,rt,nt);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:ot,track:_e})}}onInitPtsFound(_e,{frag:tt,id:rt,initPTS:nt,timescale:it}){const{unparsedVttFrags:st}=this;rt==="main"&&(this.initPTS[tt.cc]={baseTime:nt,timescale:it}),st.length&&(this.unparsedVttFrags=[],st.forEach(ot=>{this.onFragLoaded(Events.FRAG_LOADED,ot)}))}getExistingTrack(_e,tt){const{media:rt}=this;if(rt)for(let nt=0;nt<rt.textTracks.length;nt++){const it=rt.textTracks[nt];if(canReuseVttTextTrack(it,{name:_e,lang:tt,attrs:{}}))return it}return null}createCaptionsTrack(_e){this.config.renderTextTracksNatively?this.createNativeTrack(_e):this.createNonNativeTrack(_e)}createNativeTrack(_e){if(this.captionsTracks[_e])return;const{captionsProperties:tt,captionsTracks:rt,media:nt}=this,{label:it,languageCode:st}=tt[_e],ot=this.getExistingTrack(it,st);if(ot)rt[_e]=ot,clearCurrentCues(rt[_e]),sendAddTrackEvent(rt[_e],nt);else{const at=this.createTextTrack("captions",it,st);at&&(at[_e]=!0,rt[_e]=at)}}createNonNativeTrack(_e){if(this.nonNativeCaptionsTracks[_e])return;const tt=this.captionsProperties[_e];if(!tt)return;const rt=tt.label,nt={_id:_e,label:rt,kind:"captions",default:tt.media?!!tt.media.default:!1,closedCaptions:tt.media};this.nonNativeCaptionsTracks[_e]=nt,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[nt]})}createTextTrack(_e,tt,rt){const nt=this.media;if(nt)return nt.addTextTrack(_e,tt,rt)}onMediaAttaching(_e,tt){this.media=tt.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:_e}=this;Object.keys(_e).forEach(tt=>{clearCurrentCues(_e[tt]),delete _e[tt]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:_e}=this;if(!_e)return;const tt=_e.textTracks;if(tt)for(let rt=0;rt<tt.length;rt++)clearCurrentCues(tt[rt])}onSubtitleTracksUpdated(_e,tt){const rt=tt.subtitleTracks||[],nt=rt.some(it=>it.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||nt&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,rt)){this.tracks=rt;return}if(this.textTracks=[],this.tracks=rt,this.config.renderTextTracksNatively){const st=this.media,ot=st?filterSubtitleTracks(st.textTracks):null;if(this.tracks.forEach((at,lt)=>{let ut;if(ot){let ct=null;for(let dt=0;dt<ot.length;dt++)if(ot[dt]&&canReuseVttTextTrack(ot[dt],at)){ct=ot[dt],ot[dt]=null;break}ct&&(ut=ct)}if(ut)clearCurrentCues(ut);else{const ct=captionsOrSubtitlesFromCharacteristics(at);ut=this.createTextTrack(ct,at.name,at.lang),ut&&(ut.mode="disabled")}ut&&this.textTracks.push(ut)}),ot!=null&&ot.length){const at=ot.filter(lt=>lt!==null).map(lt=>lt.label);at.length&&logger.warn(`Media element contains unused subtitle tracks: ${at.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const st=this.tracks.map(ot=>({label:ot.name,kind:ot.type.toLowerCase(),default:ot.default,subtitleTrack:ot}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:st})}}}onManifestLoaded(_e,tt){this.config.enableCEA708Captions&&tt.captions&&tt.captions.forEach(rt=>{const nt=/(?:CC|SERVICE)([1-4])/.exec(rt.instreamId);if(!nt)return;const it=`textTrack${nt[1]}`,st=this.captionsProperties[it];st&&(st.label=rt.name,rt.lang&&(st.languageCode=rt.lang),st.media=rt)})}closedCaptionsForLevel(_e){const tt=this.hls.levels[_e.level];return tt==null?void 0:tt.attrs["CLOSED-CAPTIONS"]}onFragLoading(_e,tt){this.initCea608Parsers();const{cea608Parser1:rt,cea608Parser2:nt,lastCc:it,lastSn:st,lastPartIndex:ot}=this;if(!(!this.enabled||!rt||!nt)&&tt.frag.type===PlaylistLevelType.MAIN){var at,lt;const{cc:ut,sn:ct}=tt.frag,dt=(at=tt==null||(lt=tt.part)==null?void 0:lt.index)!=null?at:-1;ct===st+1||ct===st&&dt===ot+1||ut===it||(rt.reset(),nt.reset()),this.lastCc=ut,this.lastSn=ct,this.lastPartIndex=dt}}onFragLoaded(_e,tt){const{frag:rt,payload:nt}=tt;if(rt.type===PlaylistLevelType.SUBTITLE)if(nt.byteLength){const it=rt.decryptdata,st="stats"in tt;if(it==null||!it.encrypted||st){const ot=this.tracks[rt.level],at=this.vttCCs;at[rt.cc]||(at[rt.cc]={start:rt.start,prevCC:this.prevCC,new:!0},this.prevCC=rt.cc),ot&&ot.textCodec===IMSC1_CODEC?this._parseIMSC1(rt,nt):this._parseVTTs(tt)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:rt,error:new Error("Empty subtitle payload")})}_parseIMSC1(_e,tt){const rt=this.hls;parseIMSC1(tt,this.initPTS[_e.cc],nt=>{this._appendCues(nt,_e.level),rt.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:_e})},nt=>{logger.log(`Failed to parse IMSC1: ${nt}`),rt.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:_e,error:nt})})}_parseVTTs(_e){var tt;const{frag:rt,payload:nt}=_e,{initPTS:it,unparsedVttFrags:st}=this,ot=it.length-1;if(!it[rt.cc]&&ot===-1){st.push(_e);return}const at=this.hls,lt=(tt=rt.initSegment)!=null&&tt.data?appendUint8Array(rt.initSegment.data,new Uint8Array(nt)):nt;parseWebVTT(lt,this.initPTS[rt.cc],this.vttCCs,rt.cc,rt.start,ut=>{this._appendCues(ut,rt.level),at.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:rt})},ut=>{const ct=ut.message==="Missing initPTS for VTT MPEGTS";ct?st.push(_e):this._fallbackToIMSC1(rt,nt),logger.log(`Failed to parse VTT cue: ${ut}`),!(ct&&ot>rt.cc)&&at.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:rt,error:ut})})}_fallbackToIMSC1(_e,tt){const rt=this.tracks[_e.level];rt.textCodec||parseIMSC1(tt,this.initPTS[_e.cc],()=>{rt.textCodec=IMSC1_CODEC,this._parseIMSC1(_e,tt)},()=>{rt.textCodec="wvtt"})}_appendCues(_e,tt){const rt=this.hls;if(this.config.renderTextTracksNatively){const nt=this.textTracks[tt];if(!nt||nt.mode==="disabled")return;_e.forEach(it=>addCueToTrack(nt,it))}else{const nt=this.tracks[tt];if(!nt)return;const it=nt.default?"default":"subtitles"+tt;rt.trigger(Events.CUES_PARSED,{type:"subtitles",cues:_e,track:it})}}onFragDecrypted(_e,tt){const{frag:rt}=tt;rt.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,tt)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(_e,tt){this.initCea608Parsers();const{cea608Parser1:rt,cea608Parser2:nt}=this;if(!this.enabled||!rt||!nt)return;const{frag:it,samples:st}=tt;if(!(it.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(it)==="NONE"))for(let ot=0;ot<st.length;ot++){const at=st[ot].bytes;if(at){const lt=this.extractCea608Data(at);rt.addData(st[ot].pts,lt[0]),nt.addData(st[ot].pts,lt[1])}}}onBufferFlushing(_e,{startOffset:tt,endOffset:rt,endOffsetSubtitles:nt,type:it}){const{media:st}=this;if(!(!st||st.currentTime<rt)){if(!it||it==="video"){const{captionsTracks:ot}=this;Object.keys(ot).forEach(at=>removeCuesInRange(ot[at],tt,rt))}if(this.config.renderTextTracksNatively&&tt===0&&nt!==void 0){const{textTracks:ot}=this;Object.keys(ot).forEach(at=>removeCuesInRange(ot[at],tt,nt))}}}extractCea608Data(_e){const tt=[[],[]],rt=_e[0]&31;let nt=2;for(let it=0;it<rt;it++){const st=_e[nt++],ot=127&_e[nt++],at=127&_e[nt++];if(ot===0&&at===0)continue;if((4&st)!==0){const ut=3&st;(ut===0||ut===1)&&(tt[ut].push(ot),tt[ut].push(at))}}return tt}}function captionsOrSubtitlesFromCharacteristics(et){return et.characteristics&&/transcribes-spoken-dialog/gi.test(et.characteristics)&&/describes-music-and-sound/gi.test(et.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(et,_e){return!!et&&et.kind===captionsOrSubtitlesFromCharacteristics(_e)&&subtitleTrackMatchesTextTrack(_e,et)}function intersection(et,_e,tt,rt){return Math.min(_e,rt)-Math.max(et,tt)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(_e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=_e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(_e){this.streamController=_e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:_e}=this;_e.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),_e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_e.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),_e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:_e}=this;_e.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),_e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_e.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),_e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(_e,tt){const rt=this.hls.levels[tt.droppedLevel];this.isLevelAllowed(rt)&&this.restrictedLevels.push({bitrate:rt.bitrate,height:rt.height,width:rt.width})}onMediaAttaching(_e,tt){this.media=tt.media instanceof HTMLVideoElement?tt.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(_e,tt){const rt=this.hls;this.restrictedLevels=[],this.firstLevel=tt.firstLevel,rt.config.capLevelToPlayerSize&&tt.video&&this.startCapping()}onLevelsUpdated(_e,tt){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(_e,tt){this.hls.config.capLevelToPlayerSize&&tt.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const _e=this.hls.levels;if(_e.length){const tt=this.hls,rt=this.getMaxLevel(_e.length-1);rt!==this.autoLevelCapping&&logger.log(`Setting autoLevelCapping to ${rt}: ${_e[rt].height}p@${_e[rt].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),tt.autoLevelCapping=rt,tt.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=tt.autoLevelCapping}}}getMaxLevel(_e){const tt=this.hls.levels;if(!tt.length)return-1;const rt=tt.filter((nt,it)=>this.isLevelAllowed(nt)&&it<=_e);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(rt,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const _e=this.media,tt={width:0,height:0};if(_e){const rt=_e.getBoundingClientRect();tt.width=rt.width,tt.height=rt.height,!tt.width&&!tt.height&&(tt.width=rt.right-rt.left||_e.width||0,tt.height=rt.bottom-rt.top||_e.height||0)}return this.clientRect=tt,tt}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let _e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{_e=self.devicePixelRatio}catch{}return _e}isLevelAllowed(_e){return!this.restrictedLevels.some(rt=>_e.bitrate===rt.bitrate&&_e.width===rt.width&&_e.height===rt.height)}static getMaxLevelByMediaSize(_e,tt,rt){if(!(_e!=null&&_e.length))return-1;const nt=(ot,at)=>at?ot.width!==at.width||ot.height!==at.height:!0;let it=_e.length-1;const st=Math.max(tt,rt);for(let ot=0;ot<_e.length;ot+=1){const at=_e[ot];if((at.width>=st||at.height>=st)&&nt(at,_e[ot+1])){it=ot;break}}return it}}class FPSController{constructor(_e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=_e,this.registerListeners()}setStreamController(_e){this.streamController=_e}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(_e,tt){const rt=this.hls.config;if(rt.capLevelOnFPSDrop){const nt=tt.media instanceof self.HTMLVideoElement?tt.media:null;this.media=nt,nt&&typeof nt.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),rt.fpsDroppedMonitoringPeriod)}}checkFPS(_e,tt,rt){const nt=performance.now();if(tt){if(this.lastTime){const it=nt-this.lastTime,st=rt-this.lastDroppedFrames,ot=tt-this.lastDecodedFrames,at=1e3*st/it,lt=this.hls;if(lt.trigger(Events.FPS_DROP,{currentDropped:st,currentDecoded:ot,totalDroppedFrames:rt}),at>0&&st>lt.config.fpsDroppedMonitoringThreshold*ot){let ut=lt.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+ut),ut>0&&(lt.autoLevelCapping===-1||lt.autoLevelCapping>=ut)&&(ut=ut-1,lt.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:ut,droppedLevel:lt.currentLevel}),lt.autoLevelCapping=ut,this.streamController.nextLevelSwitch())}}this.lastTime=nt,this.lastDroppedFrames=rt,this.lastDecodedFrames=tt}}checkFPSInterval(){const _e=this.media;if(_e)if(this.isVideoPlaybackQualityAvailable){const tt=_e.getVideoPlaybackQuality();this.checkFPS(_e,tt.totalVideoFrames,tt.droppedVideoFrames)}else this.checkFPS(_e,_e.webkitDecodedFrameCount,_e.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(_e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=_e,this.config=_e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const _e=this.config;_e.requestMediaKeySystemAccessFunc=null,_e.licenseXhrSetup=_e.licenseResponseCallback=void 0,_e.drmSystems=_e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(_e){const{drmSystems:tt,widevineLicenseUrl:rt}=this.config,nt=tt[_e];if(nt)return nt.licenseUrl;if(_e===KeySystems.WIDEVINE&&rt)return rt;throw new Error(`no license server URL configured for key-system "${_e}"`)}getServerCertificateUrl(_e){const{drmSystems:tt}=this.config,rt=tt[_e];if(rt)return rt.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${_e}"]`)}attemptKeySystemAccess(_e){const tt=this.hls.levels,rt=(st,ot,at)=>!!st&&at.indexOf(st)===ot,nt=tt.map(st=>st.audioCodec).filter(rt),it=tt.map(st=>st.videoCodec).filter(rt);return nt.length+it.length===0&&it.push("avc1.42e01e"),new Promise((st,ot)=>{const at=lt=>{const ut=lt.shift();this.getMediaKeysPromise(ut,nt,it).then(ct=>st({keySystem:ut,mediaKeys:ct})).catch(ct=>{lt.length?at(lt):ct instanceof EMEKeyError?ot(ct):ot(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:ct,fatal:!0},ct.message))})};at(_e)})}requestMediaKeySystemAccess(_e,tt){const{requestMediaKeySystemAccessFunc:rt}=this.config;if(typeof rt!="function"){let nt=`Configured requestMediaKeySystemAccess is not a function ${rt}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(nt=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(nt))}return rt(_e,tt)}getMediaKeysPromise(_e,tt,rt){const nt=getSupportedMediaKeySystemConfigurations(_e,tt,rt,this.config.drmSystemOptions),it=this.keySystemAccessPromises[_e];let st=it==null?void 0:it.keySystemAccess;if(!st){this.log(`Requesting encrypted media "${_e}" key-system access with config: ${JSON.stringify(nt)}`),st=this.requestMediaKeySystemAccess(_e,nt);const ot=this.keySystemAccessPromises[_e]={keySystemAccess:st};return st.catch(at=>{this.log(`Failed to obtain access to key-system "${_e}": ${at}`)}),st.then(at=>{this.log(`Access for key-system "${at.keySystem}" obtained`);const lt=this.fetchServerCertificate(_e);return this.log(`Create media-keys for "${_e}"`),ot.mediaKeys=at.createMediaKeys().then(ut=>(this.log(`Media-keys created for "${_e}"`),lt.then(ct=>ct?this.setMediaKeysServerCertificate(ut,_e,ct):ut))),ot.mediaKeys.catch(ut=>{this.error(`Failed to create media-keys for "${_e}"}: ${ut}`)}),ot.mediaKeys})}return st.then(()=>it.mediaKeys)}createMediaKeySessionContext({decryptdata:_e,keySystem:tt,mediaKeys:rt}){this.log(`Creating key-system session "${tt}" keyId: ${Hex.hexDump(_e.keyId||[])}`);const nt=rt.createSession(),it={decryptdata:_e,keySystem:tt,mediaKeys:rt,mediaKeysSession:nt,keyStatus:"status-pending"};return this.mediaKeySessions.push(it),it}renewKeySession(_e){const tt=_e.decryptdata;if(tt.pssh){const rt=this.createMediaKeySessionContext(_e),nt=this.getKeyIdString(tt),it="cenc";this.keyIdToKeySessionPromise[nt]=this.generateRequestWithPreferredKeySession(rt,it,tt.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(_e)}getKeyIdString(_e){if(!_e)throw new Error("Could not read keyId of undefined decryptdata");if(_e.keyId===null)throw new Error("keyId is null");return Hex.hexDump(_e.keyId)}updateKeySession(_e,tt){var rt;const nt=_e.mediaKeysSession;return this.log(`Updating key-session "${nt.sessionId}" for keyID ${Hex.hexDump(((rt=_e.decryptdata)==null?void 0:rt.keyId)||[])}
      } (data length: ${tt&&tt.byteLength})`),nt.update(tt)}selectKeySystemFormat(_e){const tt=Object.keys(_e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${_e.sn} ${_e.type}: ${_e.level}) key formats ${tt.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(tt)),this.keyFormatPromise}getKeyFormatPromise(_e){return new Promise((tt,rt)=>{const nt=getKeySystemsForConfig(this.config),it=_e.map(keySystemFormatToKeySystemDomain).filter(st=>!!st&&nt.indexOf(st)!==-1);return this.getKeySystemSelectionPromise(it).then(({keySystem:st})=>{const ot=keySystemDomainToKeySystemFormat(st);ot?tt(ot):rt(new Error(`Unable to find format for key-system "${st}"`))}).catch(rt)})}loadKey(_e){const tt=_e.keyInfo.decryptdata,rt=this.getKeyIdString(tt),nt=`(keyId: ${rt} format: "${tt.keyFormat}" method: ${tt.method} uri: ${tt.uri})`;this.log(`Starting session for key ${nt}`);let it=this.keyIdToKeySessionPromise[rt];return it||(it=this.keyIdToKeySessionPromise[rt]=this.getKeySystemForKeyPromise(tt).then(({keySystem:st,mediaKeys:ot})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${_e.frag.sn} ${_e.frag.type}: ${_e.frag.level} using key ${nt}`),this.attemptSetMediaKeys(st,ot).then(()=>{this.throwIfDestroyed();const at=this.createMediaKeySessionContext({keySystem:st,mediaKeys:ot,decryptdata:tt});return this.generateRequestWithPreferredKeySession(at,"cenc",tt.pssh,"playlist-key")}))),it.catch(st=>this.handleError(st))),it}throwIfDestroyed(_e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(_e){this.hls&&(this.error(_e.message),_e instanceof EMEKeyError?this.hls.trigger(Events.ERROR,_e.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:_e,fatal:!0}))}getKeySystemForKeyPromise(_e){const tt=this.getKeyIdString(_e),rt=this.keyIdToKeySessionPromise[tt];if(!rt){const nt=keySystemFormatToKeySystemDomain(_e.keyFormat),it=nt?[nt]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(it)}return rt}getKeySystemSelectionPromise(_e){if(_e.length||(_e=getKeySystemsForConfig(this.config)),_e.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(_e)}_onMediaEncrypted(_e){const{initDataType:tt,initData:rt}=_e;if(this.debug(`"${_e.type}" event: init data type: "${tt}"`),rt===null)return;let nt,it;if(tt==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const ut=bin2str(new Uint8Array(rt));try{const ct=base64Decode(JSON.parse(ut).sinf),dt=parseSinf(new Uint8Array(ct));if(!dt)return;nt=dt.subarray(8,24),it=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const ut=parsePssh(rt);if(ut===null)return;ut.version===0&&ut.systemId===KeySystemIds.WIDEVINE&&ut.data&&(nt=ut.data.subarray(8,24)),it=keySystemIdToKeySystemDomain(ut.systemId)}if(!it||!nt)return;const st=Hex.hexDump(nt),{keyIdToKeySessionPromise:ot,mediaKeySessions:at}=this;let lt=ot[st];for(let ut=0;ut<at.length;ut++){const ct=at[ut],dt=ct.decryptdata;if(dt.pssh||!dt.keyId)continue;const ft=Hex.hexDump(dt.keyId);if(st===ft||dt.uri.replace(/-/g,"").indexOf(st)!==-1){lt=ot[ft],delete ot[ft],dt.pssh=new Uint8Array(rt),dt.keyId=nt,lt=ot[st]=lt.then(()=>this.generateRequestWithPreferredKeySession(ct,tt,rt,"encrypted-event-key-match"));break}}lt||(lt=ot[st]=this.getKeySystemSelectionPromise([it]).then(({keySystem:ut,mediaKeys:ct})=>{var dt;this.throwIfDestroyed();const ft=new LevelKey("ISO-23001-7",st,(dt=keySystemDomainToKeySystemFormat(ut))!=null?dt:"");return ft.pssh=new Uint8Array(rt),ft.keyId=nt,this.attemptSetMediaKeys(ut,ct).then(()=>{this.throwIfDestroyed();const pt=this.createMediaKeySessionContext({decryptdata:ft,keySystem:ut,mediaKeys:ct});return this.generateRequestWithPreferredKeySession(pt,tt,rt,"encrypted-event-no-match")})})),lt.catch(ut=>this.handleError(ut))}_onWaitingForKey(_e){this.log(`"${_e.type}" event`)}attemptSetMediaKeys(_e,tt){const rt=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${_e}"`);const nt=Promise.all(rt).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(tt)});return this.setMediaKeysQueue.push(nt),nt.then(()=>{this.log(`Media-keys set for "${_e}"`),rt.push(nt),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(it=>rt.indexOf(it)===-1)})}generateRequestWithPreferredKeySession(_e,tt,rt,nt){var it,st;const ot=(it=this.config.drmSystems)==null||(st=it[_e.keySystem])==null?void 0:st.generateRequest;if(ot)try{const pt=ot.call(this.hls,tt,rt,_e);if(!pt)throw new Error("Invalid response from configured generateRequest filter");tt=pt.initDataType,rt=_e.decryptdata.pssh=pt.initData?new Uint8Array(pt.initData):null}catch(pt){var at;if(this.warn(pt.message),(at=this.hls)!=null&&at.config.debug)throw pt}if(rt===null)return this.log(`Skipping key-session request for "${nt}" (no initData)`),Promise.resolve(_e);const lt=this.getKeyIdString(_e.decryptdata);this.log(`Generating key-session request for "${nt}": ${lt} (init data type: ${tt} length: ${rt?rt.byteLength:null})`);const ut=new EventEmitter,ct=_e._onmessage=pt=>{const mt=_e.mediaKeysSession;if(!mt){ut.emit("error",new Error("invalid state"));return}const{messageType:ht,message:gt}=pt;this.log(`"${ht}" message event for session "${mt.sessionId}" message size: ${gt.byteLength}`),ht==="license-request"||ht==="license-renewal"?this.renewLicense(_e,gt).catch(vt=>{this.handleError(vt),ut.emit("error",vt)}):ht==="license-release"?_e.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(_e,strToUtf8array("acknowledged")),this.removeSession(_e)):this.warn(`unhandled media key message type "${ht}"`)},dt=_e._onkeystatuseschange=pt=>{if(!_e.mediaKeysSession){ut.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(_e);const ht=_e.keyStatus;ut.emit("keyStatus",ht),ht==="expired"&&(this.warn(`${_e.keySystem} expired for key ${lt}`),this.renewKeySession(_e))};_e.mediaKeysSession.addEventListener("message",ct),_e.mediaKeysSession.addEventListener("keystatuseschange",dt);const ft=new Promise((pt,mt)=>{ut.on("error",mt),ut.on("keyStatus",ht=>{ht.startsWith("usable")?pt():ht==="output-restricted"?mt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):ht==="internal-error"?mt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${ht}"`)):ht==="expired"?mt(new Error("key expired while generating request")):this.warn(`unhandled key status change "${ht}"`)})});return _e.mediaKeysSession.generateRequest(tt,rt).then(()=>{var pt;this.log(`Request generated for key-session "${(pt=_e.mediaKeysSession)==null?void 0:pt.sessionId}" keyId: ${lt}`)}).catch(pt=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:pt,fatal:!1},`Error generating key-session request: ${pt}`)}).then(()=>ft).catch(pt=>{throw ut.removeAllListeners(),this.removeSession(_e),pt}).then(()=>(ut.removeAllListeners(),_e))}onKeyStatusChange(_e){_e.mediaKeysSession.keyStatuses.forEach((tt,rt)=>{this.log(`key status change "${tt}" for keyStatuses keyId: ${Hex.hexDump("buffer"in rt?new Uint8Array(rt.buffer,rt.byteOffset,rt.byteLength):new Uint8Array(rt))} session keyId: ${Hex.hexDump(new Uint8Array(_e.decryptdata.keyId||[]))} uri: ${_e.decryptdata.uri}`),_e.keyStatus=tt})}fetchServerCertificate(_e){const tt=this.config,rt=tt.loader,nt=new rt(tt),it=this.getServerCertificateUrl(_e);return it?(this.log(`Fetching server certificate for "${_e}"`),new Promise((st,ot)=>{const at={responseType:"arraybuffer",url:it},lt=tt.certLoadPolicy.default,ut={loadPolicy:lt,timeout:lt.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},ct={onSuccess:(dt,ft,pt,mt)=>{st(dt.data)},onError:(dt,ft,pt,mt)=>{ot(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:pt,response:_objectSpread2({url:at.url,data:void 0},dt)},`"${_e}" certificate request failed (${it}). Status: ${dt.code} (${dt.text})`))},onTimeout:(dt,ft,pt)=>{ot(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:pt,response:{url:at.url,data:void 0}},`"${_e}" certificate request timed out (${it})`))},onAbort:(dt,ft,pt)=>{ot(new Error("aborted"))}};nt.load(at,ut,ct)})):Promise.resolve()}setMediaKeysServerCertificate(_e,tt,rt){return new Promise((nt,it)=>{_e.setServerCertificate(rt).then(st=>{this.log(`setServerCertificate ${st?"success":"not supported by CDM"} (${rt==null?void 0:rt.byteLength}) on "${tt}"`),nt(_e)}).catch(st=>{it(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:st,fatal:!0},st.message))})})}renewLicense(_e,tt){return this.requestLicense(_e,new Uint8Array(tt)).then(rt=>this.updateKeySession(_e,new Uint8Array(rt)).catch(nt=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:nt,fatal:!0},nt.message)}))}unpackPlayReadyKeyMessage(_e,tt){const rt=String.fromCharCode.apply(null,new Uint16Array(tt.buffer));if(!rt.includes("PlayReadyKeyMessage"))return _e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),tt;const nt=new DOMParser().parseFromString(rt,"application/xml"),it=nt.querySelectorAll("HttpHeader");if(it.length>0){let ut;for(let ct=0,dt=it.length;ct<dt;ct++){var st,ot;ut=it[ct];const ft=(st=ut.querySelector("name"))==null?void 0:st.textContent,pt=(ot=ut.querySelector("value"))==null?void 0:ot.textContent;ft&&pt&&_e.setRequestHeader(ft,pt)}}const at=nt.querySelector("Challenge"),lt=at==null?void 0:at.textContent;if(!lt)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(lt))}setupLicenseXHR(_e,tt,rt,nt){const it=this.config.licenseXhrSetup;return it?Promise.resolve().then(()=>{if(!rt.decryptdata)throw new Error("Key removed");return it.call(this.hls,_e,tt,rt,nt)}).catch(st=>{if(!rt.decryptdata)throw st;return _e.open("POST",tt,!0),it.call(this.hls,_e,tt,rt,nt)}).then(st=>(_e.readyState||_e.open("POST",tt,!0),{xhr:_e,licenseChallenge:st||nt})):(_e.open("POST",tt,!0),Promise.resolve({xhr:_e,licenseChallenge:nt}))}requestLicense(_e,tt){const rt=this.config.keyLoadPolicy.default;return new Promise((nt,it)=>{const st=this.getLicenseServerUrl(_e.keySystem);this.log(`Sending license request to URL: ${st}`);const ot=new XMLHttpRequest;ot.responseType="arraybuffer",ot.onreadystatechange=()=>{if(!this.hls||!_e.mediaKeysSession)return it(new Error("invalid state"));if(ot.readyState===4)if(ot.status===200){this._requestLicenseFailureCount=0;let at=ot.response;this.log(`License received ${at instanceof ArrayBuffer?at.byteLength:at}`);const lt=this.config.licenseResponseCallback;if(lt)try{at=lt.call(this.hls,ot,st,_e)}catch(ut){this.error(ut)}nt(at)}else{const at=rt.errorRetry,lt=at?at.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>lt||ot.status>=400&&ot.status<500)it(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:ot,response:{url:st,data:void 0,code:ot.status,text:ot.statusText}},`License Request XHR failed (${st}). Status: ${ot.status} (${ot.statusText})`));else{const ut=lt-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${ut} attempts left`),this.requestLicense(_e,tt).then(nt,it)}}},_e.licenseXhr&&_e.licenseXhr.readyState!==XMLHttpRequest.DONE&&_e.licenseXhr.abort(),_e.licenseXhr=ot,this.setupLicenseXHR(ot,st,_e,tt).then(({xhr:at,licenseChallenge:lt})=>{_e.keySystem==KeySystems.PLAYREADY&&(lt=this.unpackPlayReadyKeyMessage(at,lt)),at.send(lt)})})}onMediaAttached(_e,tt){if(!this.config.emeEnabled)return;const rt=tt.media;this.media=rt,rt.addEventListener("encrypted",this.onMediaEncrypted),rt.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const _e=this.media,tt=this.mediaKeySessions;_e&&(_e.removeEventListener("encrypted",this.onMediaEncrypted),_e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const rt=tt.length;EMEController.CDMCleanupPromise=Promise.all(tt.map(nt=>this.removeSession(nt)).concat(_e==null?void 0:_e.setMediaKeys(null).catch(nt=>{this.log(`Could not clear media keys: ${nt}`)}))).then(()=>{rt&&(this.log("finished closing key sessions and clearing media keys"),tt.length=0)}).catch(nt=>{this.log(`Could not close sessions and clear media keys: ${nt}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(_e,{sessionKeys:tt}){if(!(!tt||!this.config.emeEnabled)&&!this.keyFormatPromise){const rt=tt.reduce((nt,it)=>(nt.indexOf(it.keyFormat)===-1&&nt.push(it.keyFormat),nt),[]);this.log(`Selecting key-system from session-keys ${rt.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(rt)}}removeSession(_e){const{mediaKeysSession:tt,licenseXhr:rt}=_e;if(tt){this.log(`Remove licenses and keys and close session ${tt.sessionId}`),_e._onmessage&&(tt.removeEventListener("message",_e._onmessage),_e._onmessage=void 0),_e._onkeystatuseschange&&(tt.removeEventListener("keystatuseschange",_e._onkeystatuseschange),_e._onkeystatuseschange=void 0),rt&&rt.readyState!==XMLHttpRequest.DONE&&rt.abort(),_e.mediaKeysSession=_e.decryptdata=_e.licenseXhr=void 0;const nt=this.mediaKeySessions.indexOf(_e);return nt>-1&&this.mediaKeySessions.splice(nt,1),tt.remove().catch(it=>{this.log(`Could not remove session: ${it}`)}).then(()=>tt.close()).catch(it=>{this.log(`Could not close session: ${it}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(_e,tt){super(tt),this.data=void 0,_e.error||(_e.error=new Error(tt)),this.data=_e,_e.err=_e.error}}var CmObjectType;(function(et){et.MANIFEST="m",et.AUDIO="a",et.VIDEO="v",et.MUXED="av",et.INIT="i",et.CAPTION="c",et.TIMED_TEXT="tt",et.KEY="k",et.OTHER="o"})(CmObjectType||(CmObjectType={}));var CmStreamingFormat;(function(et){et.DASH="d",et.HLS="h",et.SMOOTH="s",et.OTHER="o"})(CmStreamingFormat||(CmStreamingFormat={}));var CmcdHeaderField;(function(et){et.OBJECT="CMCD-Object",et.REQUEST="CMCD-Request",et.SESSION="CMCD-Session",et.STATUS="CMCD-Status"})(CmcdHeaderField||(CmcdHeaderField={}));const CmcdHeaderMap={[CmcdHeaderField.OBJECT]:["br","d","ot","tb"],[CmcdHeaderField.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[CmcdHeaderField.SESSION]:["cid","pr","sf","sid","st","v"],[CmcdHeaderField.STATUS]:["bs","rtp"]};class SfItem{constructor(_e,tt){this.value=void 0,this.params=void 0,Array.isArray(_e)&&(_e=_e.map(rt=>rt instanceof SfItem?rt:new SfItem(rt))),this.value=_e,this.params=tt}}class SfToken{constructor(_e){this.description=void 0,this.description=_e}}const DICT="Dict";function format(et){return Array.isArray(et)?JSON.stringify(et):et instanceof Map?"Map{}":et instanceof Set?"Set{}":typeof et=="object"?JSON.stringify(et):String(et)}function throwError(et,_e,tt,rt){return new Error(`failed to ${et} "${format(_e)}" as ${tt}`,{cause:rt})}const BARE_ITEM="Bare Item",BOOLEAN="Boolean",BYTES="Byte Sequence",DECIMAL="Decimal",INTEGER="Integer";function isInvalidInt(et){return et<-999999999999999||999999999999999<et}const STRING_REGEX=/[\x00-\x1f\x7f]+/,TOKEN="Token",KEY="Key";function serializeError(et,_e,tt){return throwError("serialize",et,_e,tt)}function serializeBoolean(et){if(typeof et!="boolean")throw serializeError(et,BOOLEAN);return et?"?1":"?0"}function base64encode(et){return btoa(String.fromCharCode(...et))}function serializeByteSequence(et){if(ArrayBuffer.isView(et)===!1)throw serializeError(et,BYTES);return`:${base64encode(et)}:`}function serializeInteger(et){if(isInvalidInt(et))throw serializeError(et,INTEGER);return et.toString()}function serializeDate(et){return`@${serializeInteger(et.getTime()/1e3)}`}function roundToEven(et,_e){if(et<0)return-roundToEven(-et,_e);const tt=Math.pow(10,_e);if(Math.abs(et*tt%1-.5)<Number.EPSILON){const nt=Math.floor(et*tt);return(nt%2===0?nt:nt+1)/tt}else return Math.round(et*tt)/tt}function serializeDecimal(et){const _e=roundToEven(et,3);if(Math.floor(Math.abs(_e)).toString().length>12)throw serializeError(et,DECIMAL);const tt=_e.toString();return tt.includes(".")?tt:`${tt}.0`}const STRING="String";function serializeString(et){if(STRING_REGEX.test(et))throw serializeError(et,STRING);return`"${et.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function symbolToStr(et){return et.description||et.toString().slice(7,-1)}function serializeToken(et){const _e=symbolToStr(et);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(_e)===!1)throw serializeError(_e,TOKEN);return _e}function serializeBareItem(et){switch(typeof et){case"number":if(!isFiniteNumber(et))throw serializeError(et,BARE_ITEM);return Number.isInteger(et)?serializeInteger(et):serializeDecimal(et);case"string":return serializeString(et);case"symbol":return serializeToken(et);case"boolean":return serializeBoolean(et);case"object":if(et instanceof Date)return serializeDate(et);if(et instanceof Uint8Array)return serializeByteSequence(et);if(et instanceof SfToken)return serializeToken(et);default:throw serializeError(et,BARE_ITEM)}}function serializeKey(et){if(/^[a-z*][a-z0-9\-_.*]*$/.test(et)===!1)throw serializeError(et,KEY);return et}function serializeParams(et){return et==null?"":Object.entries(et).map(([_e,tt])=>tt===!0?`;${serializeKey(_e)}`:`;${serializeKey(_e)}=${serializeBareItem(tt)}`).join("")}function serializeItem(et){return et instanceof SfItem?`${serializeBareItem(et.value)}${serializeParams(et.params)}`:serializeBareItem(et)}function serializeInnerList(et){return`(${et.value.map(serializeItem).join(" ")})${serializeParams(et.params)}`}function serializeDict(et,_e={whitespace:!0}){if(typeof et!="object")throw serializeError(et,DICT);const tt=et instanceof Map?et.entries():Object.entries(et),rt=_e!=null&&_e.whitespace?" ":"";return Array.from(tt).map(([nt,it])=>{it instanceof SfItem||(it=new SfItem(it));let st=serializeKey(nt);return it.value===!0?st+=serializeParams(it.params):(st+="=",Array.isArray(it.value)?st+=serializeInnerList(it):st+=serializeItem(it)),st}).join(`,${rt}`)}function encodeSfDict(et,_e){return serializeDict(et,_e)}const isTokenField=et=>et==="ot"||et==="sf"||et==="st",isValid=et=>typeof et=="number"?isFiniteNumber(et):et!=null&&et!==""&&et!==!1;function urlToRelativePath(et,_e){const tt=new URL(et),rt=new URL(_e);if(tt.origin!==rt.origin)return et;const nt=tt.pathname.split("/").slice(1),it=rt.pathname.split("/").slice(1,-1);for(;nt[0]===it[0];)nt.shift(),it.shift();for(;it.length;)it.shift(),nt.unshift("..");return nt.join("/")}function uuid(){try{return crypto.randomUUID()}catch{try{const _e=URL.createObjectURL(new Blob),tt=_e.toString();return URL.revokeObjectURL(_e),tt.slice(tt.lastIndexOf("/")+1)}catch{let tt=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,nt=>{const it=(tt+Math.random()*16)%16|0;return tt=Math.floor(tt/16),(nt=="x"?it:it&3|8).toString(16)})}}}const toRounded=et=>Math.round(et),toUrlSafe=(et,_e)=>(_e!=null&&_e.baseUrl&&(et=urlToRelativePath(et,_e.baseUrl)),encodeURIComponent(et)),toHundred=et=>toRounded(et/100)*100,CmcdFormatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:toUrlSafe,rtp:toHundred,tb:toRounded};function processCmcd(et,_e){const tt={};if(et==null||typeof et!="object")return tt;const rt=Object.keys(et).sort(),nt=_extends({},CmcdFormatters,_e==null?void 0:_e.formatters),it=_e==null?void 0:_e.filter;return rt.forEach(st=>{if(it!=null&&it(st))return;let ot=et[st];const at=nt[st];at&&(ot=at(ot,_e)),!(st==="v"&&ot===1)&&(st=="pr"&&ot===1||isValid(ot)&&(isTokenField(st)&&typeof ot=="string"&&(ot=new SfToken(ot)),tt[st]=ot))}),tt}function encodeCmcd(et,_e={}){return et?encodeSfDict(processCmcd(et,_e),_extends({whitespace:!1},_e)):""}function toCmcdHeaders(et,_e={}){if(!et)return{};const tt=Object.entries(et),rt=Object.entries(CmcdHeaderMap).concat(Object.entries((_e==null?void 0:_e.customHeaderMap)||{})),nt=tt.reduce((it,st)=>{var ot,at;const[lt,ut]=st,ct=((ot=rt.find(dt=>dt[1].includes(lt)))==null?void 0:ot[0])||CmcdHeaderField.REQUEST;return(at=it[ct])!=null||(it[ct]={}),it[ct][lt]=ut,it},{});return Object.entries(nt).reduce((it,[st,ot])=>(it[st]=encodeCmcd(ot,_e),it),{})}function appendCmcdHeaders(et,_e,tt){return _extends(et,toCmcdHeaders(_e,tt))}const CMCD_PARAM="CMCD";function toCmcdQuery(et,_e={}){if(!et)return"";const tt=encodeCmcd(et,_e);return`${CMCD_PARAM}=${encodeURIComponent(tt)}`}const REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(et,_e,tt){const rt=toCmcdQuery(_e,tt);if(!rt)return et;if(REGEX.test(et))return et.replace(REGEX,rt);const nt=et.includes("?")?"&":"?";return`${et}${nt}${rt}`}class CMCDController{constructor(_e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=nt=>{try{this.apply(nt,{ot:CmObjectType.MANIFEST,su:!this.initialized})}catch(it){logger.warn("Could not generate manifest CMCD data.",it)}},this.applyFragmentData=nt=>{try{const it=nt.frag,st=this.hls.levels[it.level],ot=this.getObjectType(it),at={d:it.duration*1e3,ot};(ot===CmObjectType.VIDEO||ot===CmObjectType.AUDIO||ot==CmObjectType.MUXED)&&(at.br=st.bitrate/1e3,at.tb=this.getTopBandwidth(ot)/1e3,at.bl=this.getBufferLength(ot)),this.apply(nt,at)}catch(it){logger.warn("Could not generate segment CMCD data.",it)}},this.hls=_e;const tt=this.config=_e.config,{cmcd:rt}=tt;rt!=null&&(tt.pLoader=this.createPlaylistLoader(),tt.fLoader=this.createFragmentLoader(),this.sid=rt.sessionId||uuid(),this.cid=rt.contentId,this.useHeaders=rt.useHeaders===!0,this.includeKeys=rt.includeKeys,this.registerListeners())}registerListeners(){const _e=this.hls;_e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),_e.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const _e=this.hls;_e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),_e.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(_e,tt){this.media=tt.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(_e,tt){var rt,nt;this.audioBuffer=(rt=tt.tracks.audio)==null?void 0:rt.buffer,this.videoBuffer=(nt=tt.tracks.video)==null?void 0:nt.buffer}createData(){var _e;return{v:1,sf:CmStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(_e=this.media)==null?void 0:_e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(_e,tt={}){_extends(tt,this.createData());const rt=tt.ot===CmObjectType.INIT||tt.ot===CmObjectType.VIDEO||tt.ot===CmObjectType.MUXED;this.starved&&rt&&(tt.bs=!0,tt.su=!0,this.starved=!1),tt.su==null&&(tt.su=this.buffering);const{includeKeys:nt}=this;nt&&(tt=Object.keys(tt).reduce((it,st)=>(nt.includes(st)&&(it[st]=tt[st]),it),{})),this.useHeaders?(_e.headers||(_e.headers={}),appendCmcdHeaders(_e.headers,tt)):_e.url=appendCmcdQuery(_e.url,tt)}getObjectType(_e){const{type:tt}=_e;if(tt==="subtitle")return CmObjectType.TIMED_TEXT;if(_e.sn==="initSegment")return CmObjectType.INIT;if(tt==="audio")return CmObjectType.AUDIO;if(tt==="main")return this.hls.audioTracks.length?CmObjectType.VIDEO:CmObjectType.MUXED}getTopBandwidth(_e){let tt=0,rt;const nt=this.hls;if(_e===CmObjectType.AUDIO)rt=nt.audioTracks;else{const it=nt.maxAutoLevel,st=it>-1?it+1:nt.levels.length;rt=nt.levels.slice(0,st)}for(const it of rt)it.bitrate>tt&&(tt=it.bitrate);return tt>0?tt:NaN}getBufferLength(_e){const tt=this.hls.media,rt=_e===CmObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!rt||!tt?NaN:BufferHelper.bufferInfo(rt,tt.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:_e}=this.config,tt=this.applyPlaylistData,rt=_e||this.config.loader;return class{constructor(it){this.loader=void 0,this.loader=new rt(it)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(it,st,ot){tt(it),this.loader.load(it,st,ot)}}}createFragmentLoader(){const{fLoader:_e}=this.config,tt=this.applyFragmentData,rt=_e||this.config.loader;return class{constructor(it){this.loader=void 0,this.loader=new rt(it)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(it,st,ot){tt(it),this.loader.load(it,st,ot)}}}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(_e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=_e,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const _e=this.hls;_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),_e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const _e=this.hls;_e&&(_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),_e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const _e=this.timeToLoad*1e3-(performance.now()-this.updated);if(_e>0){this.scheduleRefresh(this.uri,_e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(_e){const tt=this.levels;tt&&(this.levels=tt.filter(rt=>rt!==_e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(_e,tt){const{contentSteering:rt}=tt;rt!==null&&(this.pathwayId=rt.pathwayId,this.uri=rt.uri,this.started&&this.startLoad())}onManifestParsed(_e,tt){this.audioTracks=tt.audioTracks,this.subtitleTracks=tt.subtitleTracks}onError(_e,tt){const{errorAction:rt}=tt;if((rt==null?void 0:rt.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&rt.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){const nt=this.levels;let it=this.pathwayPriority,st=this.pathwayId;if(tt.context){const{groupId:ot,pathwayId:at,type:lt}=tt.context;ot&&nt?st=this.getPathwayForGroupId(ot,lt,st):at&&(st=at)}st in this.penalizedPathways||(this.penalizedPathways[st]=performance.now()),!it&&nt&&(it=nt.reduce((ot,at)=>(ot.indexOf(at.pathwayId)===-1&&ot.push(at.pathwayId),ot),[])),it&&it.length>1&&(this.updatePathwayPriority(it),rt.resolved=this.pathwayId!==st),rt.resolved||logger.warn(`Could not resolve ${tt.details} ("${tt.error.message}") with content-steering for Pathway: ${st} levels: ${nt&&nt.length} priorities: ${JSON.stringify(it)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(_e){this.levels=_e;let tt=this.getLevelsForPathway(this.pathwayId);if(tt.length===0){const rt=_e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${rt}"`),tt=this.getLevelsForPathway(rt),this.pathwayId=rt}return tt.length!==_e.length?(this.log(`Found ${tt.length}/${_e.length} levels in Pathway "${this.pathwayId}"`),tt):_e}getLevelsForPathway(_e){return this.levels===null?[]:this.levels.filter(tt=>_e===tt.pathwayId)}updatePathwayPriority(_e){this.pathwayPriority=_e;let tt;const rt=this.penalizedPathways,nt=performance.now();Object.keys(rt).forEach(it=>{nt-rt[it]>PATHWAY_PENALTY_DURATION_MS&&delete rt[it]});for(let it=0;it<_e.length;it++){const st=_e[it];if(st in rt)continue;if(st===this.pathwayId)return;const ot=this.hls.nextLoadLevel,at=this.hls.levels[ot];if(tt=this.getLevelsForPathway(st),tt.length>0){this.log(`Setting Pathway to "${st}"`),this.pathwayId=st,reassignFragmentLevelIndexes(tt),this.hls.trigger(Events.LEVELS_UPDATED,{levels:tt});const lt=this.hls.levels[ot];at&&lt&&this.levels&&(lt.attrs["STABLE-VARIANT-ID"]!==at.attrs["STABLE-VARIANT-ID"]&&lt.bitrate!==at.bitrate&&this.log(`Unstable Pathways change from bitrate ${at.bitrate} to ${lt.bitrate}`),this.hls.nextLoadLevel=ot);break}}}getPathwayForGroupId(_e,tt,rt){const nt=this.getLevelsForPathway(rt).concat(this.levels||[]);for(let it=0;it<nt.length;it++)if(tt===PlaylistContextType.AUDIO_TRACK&&nt[it].hasAudioGroup(_e)||tt===PlaylistContextType.SUBTITLE_TRACK&&nt[it].hasSubtitleGroup(_e))return nt[it].pathwayId;return rt}clonePathways(_e){const tt=this.levels;if(!tt)return;const rt={},nt={};_e.forEach(it=>{const{ID:st,"BASE-ID":ot,"URI-REPLACEMENT":at}=it;if(tt.some(ut=>ut.pathwayId===st))return;const lt=this.getLevelsForPathway(ot).map(ut=>{const ct=new AttrList(ut.attrs);ct["PATHWAY-ID"]=st;const dt=ct.AUDIO&&`${ct.AUDIO}_clone_${st}`,ft=ct.SUBTITLES&&`${ct.SUBTITLES}_clone_${st}`;dt&&(rt[ct.AUDIO]=dt,ct.AUDIO=dt),ft&&(nt[ct.SUBTITLES]=ft,ct.SUBTITLES=ft);const pt=performUriReplacement(ut.uri,ct["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",at),mt=new Level({attrs:ct,audioCodec:ut.audioCodec,bitrate:ut.bitrate,height:ut.height,name:ut.name,url:pt,videoCodec:ut.videoCodec,width:ut.width});if(ut.audioGroups)for(let ht=1;ht<ut.audioGroups.length;ht++)mt.addGroupId("audio",`${ut.audioGroups[ht]}_clone_${st}`);if(ut.subtitleGroups)for(let ht=1;ht<ut.subtitleGroups.length;ht++)mt.addGroupId("text",`${ut.subtitleGroups[ht]}_clone_${st}`);return mt});tt.push(...lt),cloneRenditionGroups(this.audioTracks,rt,at,st),cloneRenditionGroups(this.subtitleTracks,nt,at,st)})}loadSteeringManifest(_e){const tt=this.hls.config,rt=tt.loader;this.loader&&this.loader.destroy(),this.loader=new rt(tt);let nt;try{nt=new self.URL(_e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${_e}`);return}if(nt.protocol!=="data:"){const ut=(this.hls.bandwidthEstimate||tt.abrEwmaDefaultEstimate)|0;nt.searchParams.set("_HLS_pathway",this.pathwayId),nt.searchParams.set("_HLS_throughput",""+ut)}const it={responseType:"json",url:nt.href},st=tt.steeringManifestLoadPolicy.default,ot=st.errorRetry||st.timeoutRetry||{},at={loadPolicy:st,timeout:st.maxLoadTimeMs,maxRetry:ot.maxNumRetry||0,retryDelay:ot.retryDelayMs||0,maxRetryDelay:ot.maxRetryDelayMs||0},lt={onSuccess:(ut,ct,dt,ft)=>{this.log(`Loaded steering manifest: "${nt}"`);const pt=ut.data;if(pt.VERSION!==1){this.log(`Steering VERSION ${pt.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=pt.TTL;const{"RELOAD-URI":mt,"PATHWAY-CLONES":ht,"PATHWAY-PRIORITY":gt}=pt;if(mt)try{this.uri=new self.URL(mt,nt).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${mt}`);return}this.scheduleRefresh(this.uri||dt.url),ht&&this.clonePathways(ht);const vt={steeringManifest:pt,url:nt.toString()};this.hls.trigger(Events.STEERING_MANIFEST_LOADED,vt),gt&&this.updatePathwayPriority(gt)},onError:(ut,ct,dt,ft)=>{if(this.log(`Error loading steering manifest: ${ut.code} ${ut.text} (${ct.url})`),this.stopLoad(),ut.code===410){this.enabled=!1,this.log(`Steering manifest ${ct.url} no longer available`);return}let pt=this.timeToLoad*1e3;if(ut.code===429){const mt=this.loader;if(typeof(mt==null?void 0:mt.getResponseHeader)=="function"){const ht=mt.getResponseHeader("Retry-After");ht&&(pt=parseFloat(ht)*1e3)}this.log(`Steering manifest ${ct.url} rate limited`);return}this.scheduleRefresh(this.uri||ct.url,pt)},onTimeout:(ut,ct,dt)=>{this.log(`Timeout loading steering manifest (${ct.url})`),this.scheduleRefresh(this.uri||ct.url)}};this.log(`Requesting steering manifest: ${nt}`),this.loader.load(it,at,lt)}scheduleRefresh(_e,tt=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var rt;const nt=(rt=this.hls)==null?void 0:rt.media;if(nt&&!nt.ended){this.loadSteeringManifest(_e);return}this.scheduleRefresh(_e,this.timeToLoad*1e3)},tt)}}function cloneRenditionGroups(et,_e,tt,rt){et&&Object.keys(_e).forEach(nt=>{const it=et.filter(st=>st.groupId===nt).map(st=>{const ot=_extends({},st);return ot.details=void 0,ot.attrs=new AttrList(ot.attrs),ot.url=ot.attrs.URI=performUriReplacement(st.url,st.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",tt),ot.groupId=ot.attrs["GROUP-ID"]=_e[nt],ot.attrs["PATHWAY-ID"]=rt,ot});et.push(...it)})}function performUriReplacement(et,_e,tt,rt){const{HOST:nt,PARAMS:it,[tt]:st}=rt;let ot;_e&&(ot=st==null?void 0:st[_e],ot&&(et=ot));const at=new self.URL(et);return nt&&!ot&&(at.host=nt),it&&Object.keys(it).sort().forEach(lt=>{lt&&at.searchParams.set(lt,it[lt])}),at.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(_e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=_e&&_e.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null}abortInternal(){const _e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),_e&&(_e.onreadystatechange=null,_e.onprogress=null,_e.readyState!==4&&(this.stats.aborted=!0,_e.abort()))}abort(){var _e;this.abortInternal(),(_e=this.callbacks)!=null&&_e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(_e,tt,rt){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=_e,this.config=tt,this.callbacks=rt,this.loadInternal()}loadInternal(){const{config:_e,context:tt}=this;if(!_e||!tt)return;const rt=this.loader=new self.XMLHttpRequest,nt=this.stats;nt.loading.first=0,nt.loaded=0,nt.aborted=!1;const it=this.xhrSetup;it?Promise.resolve().then(()=>{if(!this.stats.aborted)return it(rt,tt.url)}).catch(st=>(rt.open("GET",tt.url,!0),it(rt,tt.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(rt,tt,_e)}).catch(st=>{this.callbacks.onError({code:rt.status,text:st.message},tt,rt,nt)}):this.openAndSendXhr(rt,tt,_e)}openAndSendXhr(_e,tt,rt){_e.readyState||_e.open("GET",tt.url,!0);const nt=tt.headers,{maxTimeToFirstByteMs:it,maxLoadTimeMs:st}=rt.loadPolicy;if(nt)for(const ot in nt)_e.setRequestHeader(ot,nt[ot]);tt.rangeEnd&&_e.setRequestHeader("Range","bytes="+tt.rangeStart+"-"+(tt.rangeEnd-1)),_e.onreadystatechange=this.readystatechange.bind(this),_e.onprogress=this.loadprogress.bind(this),_e.responseType=tt.responseType,self.clearTimeout(this.requestTimeout),rt.timeout=it&&isFiniteNumber(it)?it:st,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),rt.timeout),_e.send()}readystatechange(){const{context:_e,loader:tt,stats:rt}=this;if(!_e||!tt)return;const nt=tt.readyState,it=this.config;if(!rt.aborted&&nt>=2&&(rt.loading.first===0&&(rt.loading.first=Math.max(self.performance.now(),rt.loading.start),it.timeout!==it.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),it.timeout=it.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),it.loadPolicy.maxLoadTimeMs-(rt.loading.first-rt.loading.start)))),nt===4)){self.clearTimeout(this.requestTimeout),tt.onreadystatechange=null,tt.onprogress=null;const st=tt.status,ot=tt.responseType!=="text";if(st>=200&&st<300&&(ot&&tt.response||tt.responseText!==null)){rt.loading.end=Math.max(self.performance.now(),rt.loading.first);const at=ot?tt.response:tt.responseText,lt=tt.responseType==="arraybuffer"?at.byteLength:at.length;if(rt.loaded=rt.total=lt,rt.bwEstimate=rt.total*8e3/(rt.loading.end-rt.loading.first),!this.callbacks)return;const ut=this.callbacks.onProgress;if(ut&&ut(rt,_e,at,tt),!this.callbacks)return;const ct={url:tt.responseURL,data:at,code:st};this.callbacks.onSuccess(ct,rt,_e,tt)}else{const at=it.loadPolicy.errorRetry,lt=rt.retry,ut={url:_e.url,data:void 0,code:st};shouldRetry(at,lt,!1,ut)?this.retry(at):(logger.error(`${st} while loading ${_e.url}`),this.callbacks.onError({code:st,text:tt.statusText},_e,tt,rt))}}}loadtimeout(){var _e;const tt=(_e=this.config)==null?void 0:_e.loadPolicy.timeoutRetry,rt=this.stats.retry;if(shouldRetry(tt,rt,!0))this.retry(tt);else{var nt;logger.warn(`timeout while loading ${(nt=this.context)==null?void 0:nt.url}`);const it=this.callbacks;it&&(this.abortInternal(),it.onTimeout(this.stats,this.context,this.loader))}}retry(_e){const{context:tt,stats:rt}=this;this.retryDelay=getRetryDelay(_e,rt.retry),rt.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${tt==null?void 0:tt.url}, retrying ${rt.retry}/${_e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(_e){const tt=this.stats;tt.loaded=_e.loaded,_e.lengthComputable&&(tt.total=_e.total)}getCacheAge(){let _e=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const tt=this.loader.getResponseHeader("age");_e=tt?parseFloat(tt):null}return _e}getResponseHeader(_e){return this.loader&&new RegExp(`^${_e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(_e):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(_e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=_e.fetchSetup||getRequest$1,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var _e;this.abortInternal(),(_e=this.callbacks)!=null&&_e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(_e,tt,rt){const nt=this.stats;if(nt.loading.start)throw new Error("Loader can only be used once.");nt.loading.start=self.performance.now();const it=getRequestParameters(_e,this.controller.signal),st=rt.onProgress,ot=_e.responseType==="arraybuffer",at=ot?"byteLength":"length",{maxTimeToFirstByteMs:lt,maxLoadTimeMs:ut}=tt.loadPolicy;this.context=_e,this.config=tt,this.callbacks=rt,this.request=this.fetchSetup(_e,it),self.clearTimeout(this.requestTimeout),tt.timeout=lt&&isFiniteNumber(lt)?lt:ut,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),rt.onTimeout(nt,_e,this.response)},tt.timeout),self.fetch(this.request).then(ct=>{this.response=this.loader=ct;const dt=Math.max(self.performance.now(),nt.loading.start);if(self.clearTimeout(this.requestTimeout),tt.timeout=ut,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),rt.onTimeout(nt,_e,this.response)},ut-(dt-nt.loading.start)),!ct.ok){const{status:ft,statusText:pt}=ct;throw new FetchError(pt||"fetch, bad network response",ft,ct)}return nt.loading.first=dt,nt.total=getContentLength(ct.headers)||nt.total,st&&isFiniteNumber(tt.highWaterMark)?this.loadProgressively(ct,nt,_e,tt.highWaterMark,st):ot?ct.arrayBuffer():_e.responseType==="json"?ct.json():ct.text()}).then(ct=>{const dt=this.response;if(!dt)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),nt.loading.end=Math.max(self.performance.now(),nt.loading.first);const ft=ct[at];ft&&(nt.loaded=nt.total=ft);const pt={url:dt.url,data:ct,code:dt.status};st&&!isFiniteNumber(tt.highWaterMark)&&st(nt,_e,ct,dt),rt.onSuccess(pt,nt,_e,dt)}).catch(ct=>{if(self.clearTimeout(this.requestTimeout),nt.aborted)return;const dt=ct&&ct.code||0,ft=ct?ct.message:null;rt.onError({code:dt,text:ft},_e,ct?ct.details:null,nt)})}getCacheAge(){let _e=null;if(this.response){const tt=this.response.headers.get("age");_e=tt?parseFloat(tt):null}return _e}getResponseHeader(_e){return this.response?this.response.headers.get(_e):null}loadProgressively(_e,tt,rt,nt=0,it){const st=new ChunkCache,ot=_e.body.getReader(),at=()=>ot.read().then(lt=>{if(lt.done)return st.dataLength&&it(tt,rt,st.flush(),_e),Promise.resolve(new ArrayBuffer(0));const ut=lt.value,ct=ut.length;return tt.loaded+=ct,ct<nt||st.dataLength?(st.push(ut),st.dataLength>=nt&&it(tt,rt,st.flush(),_e)):it(tt,rt,ut,_e),at()}).catch(()=>Promise.reject());return at()}}function getRequestParameters(et,_e){const tt={method:"GET",mode:"cors",credentials:"same-origin",signal:_e,headers:new self.Headers(_extends({},et.headers))};return et.rangeEnd&&tt.headers.set("Range","bytes="+et.rangeStart+"-"+String(et.rangeEnd-1)),tt}function getByteRangeLength(et){const _e=BYTERANGE.exec(et);if(_e)return parseInt(_e[2])-parseInt(_e[1])+1}function getContentLength(et){const _e=et.get("Content-Range");if(_e){const rt=getByteRangeLength(_e);if(isFiniteNumber(rt))return rt}const tt=et.get("Content-Length");if(tt)return parseInt(tt)}function getRequest$1(et,_e){return new self.Request(et.url,_e)}class FetchError extends Error{constructor(_e,tt,rt){super(_e),this.code=void 0,this.details=void 0,this.code=tt,this.details=rt}}const WHITESPACE_CHAR=/\s/,Cues={newCue(et,_e,tt,rt){const nt=[];let it,st,ot,at,lt;const ut=self.VTTCue||self.TextTrackCue;for(let dt=0;dt<rt.rows.length;dt++)if(it=rt.rows[dt],ot=!0,at=0,lt="",!it.isEmpty()){var ct;for(let mt=0;mt<it.chars.length;mt++)WHITESPACE_CHAR.test(it.chars[mt].uchar)&&ot?at++:(lt+=it.chars[mt].uchar,ot=!1);it.cueStartTime=_e,_e===tt&&(tt+=1e-4),at>=16?at--:at++;const ft=fixLineBreaks(lt.trim()),pt=generateCueId(_e,tt,ft);et!=null&&(ct=et.cues)!=null&&ct.getCueById(pt)||(st=new ut(_e,tt,ft),st.id=pt,st.line=dt+1,st.align="left",st.position=10+Math.min(80,Math.floor(at*8/32)*10),nt.push(st))}return et&&nt.length&&(nt.sort((dt,ft)=>dt.line==="auto"||ft.line==="auto"?0:dt.line>8&&ft.line>8?ft.line-dt.line:dt.line-ft.line),nt.forEach(dt=>addCueToTrack(et,dt))),nt}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(et,_e){if((_e.liveSyncDurationCount||_e.liveMaxLatencyDurationCount)&&(_e.liveSyncDuration||_e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(_e.liveMaxLatencyDurationCount!==void 0&&(_e.liveSyncDurationCount===void 0||_e.liveMaxLatencyDurationCount<=_e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(_e.liveMaxLatencyDuration!==void 0&&(_e.liveSyncDuration===void 0||_e.liveMaxLatencyDuration<=_e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const tt=deepCpy(et),rt=["manifest","level","frag"],nt=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return rt.forEach(it=>{const st=`${it==="level"?"playlist":it}LoadPolicy`,ot=_e[st]===void 0,at=[];nt.forEach(lt=>{const ut=`${it}Loading${lt}`,ct=_e[ut];if(ct!==void 0&&ot){at.push(ut);const dt=tt[st].default;switch(_e[st]={default:dt},lt){case"TimeOut":dt.maxLoadTimeMs=ct,dt.maxTimeToFirstByteMs=ct;break;case"MaxRetry":dt.errorRetry.maxNumRetry=ct,dt.timeoutRetry.maxNumRetry=ct;break;case"RetryDelay":dt.errorRetry.retryDelayMs=ct,dt.timeoutRetry.retryDelayMs=ct;break;case"MaxRetryTimeout":dt.errorRetry.maxRetryDelayMs=ct,dt.timeoutRetry.maxRetryDelayMs=ct;break}}}),at.length&&logger.warn(`hls.js config: "${at.join('", "')}" setting(s) are deprecated, use "${st}": ${JSON.stringify(_e[st])}`)}),_objectSpread2(_objectSpread2({},tt),_e)}function deepCpy(et){return et&&typeof et=="object"?Array.isArray(et)?et.map(deepCpy):Object.keys(et).reduce((_e,tt)=>(_e[tt]=deepCpy(et[tt]),_e),{}):et}function enableStreamingMode(et){const _e=et.loader;_e!==FetchLoader&&_e!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),et.progressive=!1):fetchSupported()&&(et.loader=FetchLoader,et.progressive=!0,et.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(_e,tt){super(_e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=tt,this._registerListeners()}_registerListeners(){const{hls:_e}=this;_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),_e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),_e.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:_e}=this;_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),_e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),_e.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(tt=>{tt.loadError=0,tt.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(_e,tt){this.resetLevels()}onManifestLoaded(_e,tt){const rt=this.hls.config.preferManagedMediaSource,nt=[],it={},st={};let ot=!1,at=!1,lt=!1;tt.levels.forEach(ut=>{var ct,dt;const ft=ut.attrs;let{audioCodec:pt,videoCodec:mt}=ut;((ct=pt)==null?void 0:ct.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(ut.audioCodec=pt=void 0)),pt&&(ut.audioCodec=pt=getCodecCompatibleName(pt,rt)),((dt=mt)==null?void 0:dt.indexOf("avc1"))===0&&(mt=ut.videoCodec=convertAVC1ToAVCOTI(mt));const{width:ht,height:gt,unknownCodecs:vt}=ut;if(ot||(ot=!!(ht&&gt)),at||(at=!!mt),lt||(lt=!!pt),vt!=null&&vt.length||pt&&!areCodecsMediaSourceSupported(pt,"audio",rt)||mt&&!areCodecsMediaSourceSupported(mt,"video",rt))return;const{CODECS:yt,"FRAME-RATE":bt,"HDCP-LEVEL":xt,"PATHWAY-ID":_t,RESOLUTION:wt,"VIDEO-RANGE":Ct}=ft,At=`${`${_t||"."}-`}${ut.bitrate}-${wt}-${bt}-${yt}-${Ct}-${xt}`;if(it[At])if(it[At].uri!==ut.url&&!ut.attrs["PATHWAY-ID"]){const $t=st[At]+=1;ut.attrs["PATHWAY-ID"]=new Array($t+1).join(".");const Lt=new Level(ut);it[At]=Lt,nt.push(Lt)}else it[At].addGroupId("audio",ft.AUDIO),it[At].addGroupId("text",ft.SUBTITLES);else{const $t=new Level(ut);it[At]=$t,st[At]=1,nt.push($t)}}),this.filterAndSortMediaOptions(nt,tt,ot,at,lt)}filterAndSortMediaOptions(_e,tt,rt,nt,it){let st=[],ot=[],at=_e;if((rt||nt)&&it&&(at=at.filter(({videoCodec:pt,videoRange:mt,width:ht,height:gt})=>(!!pt||!!(ht&&gt))&&isVideoRange(mt))),at.length===0){Promise.resolve().then(()=>{if(this.hls){tt.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(tt.levels[0].attrs)}`);const pt=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:tt.url,error:pt,reason:pt.message})}});return}if(tt.audioTracks){const{preferManagedMediaSource:pt}=this.hls.config;st=tt.audioTracks.filter(mt=>!mt.audioCodec||areCodecsMediaSourceSupported(mt.audioCodec,"audio",pt)),assignTrackIdsByGroup(st)}tt.subtitles&&(ot=tt.subtitles,assignTrackIdsByGroup(ot));const lt=at.slice(0);at.sort((pt,mt)=>{if(pt.attrs["HDCP-LEVEL"]!==mt.attrs["HDCP-LEVEL"])return(pt.attrs["HDCP-LEVEL"]||"")>(mt.attrs["HDCP-LEVEL"]||"")?1:-1;if(rt&&pt.height!==mt.height)return pt.height-mt.height;if(pt.frameRate!==mt.frameRate)return pt.frameRate-mt.frameRate;if(pt.videoRange!==mt.videoRange)return VideoRangeValues.indexOf(pt.videoRange)-VideoRangeValues.indexOf(mt.videoRange);if(pt.videoCodec!==mt.videoCodec){const ht=videoCodecPreferenceValue(pt.videoCodec),gt=videoCodecPreferenceValue(mt.videoCodec);if(ht!==gt)return gt-ht}if(pt.uri===mt.uri&&pt.codecSet!==mt.codecSet){const ht=codecsSetSelectionPreferenceValue(pt.codecSet),gt=codecsSetSelectionPreferenceValue(mt.codecSet);if(ht!==gt)return gt-ht}return pt.averageBitrate!==mt.averageBitrate?pt.averageBitrate-mt.averageBitrate:0});let ut=lt[0];if(this.steering&&(at=this.steering.filterParsedLevels(at),at.length!==lt.length)){for(let pt=0;pt<lt.length;pt++)if(lt[pt].pathwayId===at[0].pathwayId){ut=lt[pt];break}}this._levels=at;for(let pt=0;pt<at.length;pt++)if(at[pt]===ut){var ct;this._firstLevel=pt;const mt=ut.bitrate,ht=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${at.length} level(s) found, first bitrate: ${mt}`),((ct=this.hls.userConfig)==null?void 0:ct.abrEwmaDefaultEstimate)===void 0){const gt=Math.min(mt,this.hls.config.abrEwmaDefaultEstimateMax);gt>ht&&ht===hlsDefaultConfig.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=gt)}break}const dt=it&&!nt,ft={levels:at,audioTracks:st,subtitleTracks:ot,sessionData:tt.sessionData,sessionKeys:tt.sessionKeys,firstLevel:this._firstLevel,stats:tt.stats,audio:it,video:nt,altAudio:!dt&&st.some(pt=>!!pt.url)};this.hls.trigger(Events.MANIFEST_PARSED,ft),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(_e){const tt=this._levels;if(tt.length===0)return;if(_e<0||_e>=tt.length){const ut=new Error("invalid level idx"),ct=_e<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:_e,fatal:ct,error:ut,reason:ut.message}),ct)return;_e=Math.min(_e,tt.length-1)}const rt=this.currentLevelIndex,nt=this.currentLevel,it=nt?nt.attrs["PATHWAY-ID"]:void 0,st=tt[_e],ot=st.attrs["PATHWAY-ID"];if(this.currentLevelIndex=_e,this.currentLevel=st,rt===_e&&st.details&&nt&&it===ot)return;this.log(`Switching to level ${_e} (${st.height?st.height+"p ":""}${st.videoRange?st.videoRange+" ":""}${st.codecSet?st.codecSet+" ":""}@${st.bitrate})${ot?" with Pathway "+ot:""} from level ${rt}${it?" with Pathway "+it:""}`);const at={level:_e,attrs:st.attrs,details:st.details,bitrate:st.bitrate,averageBitrate:st.averageBitrate,maxBitrate:st.maxBitrate,realBitrate:st.realBitrate,width:st.width,height:st.height,codecSet:st.codecSet,audioCodec:st.audioCodec,videoCodec:st.videoCodec,audioGroups:st.audioGroups,subtitleGroups:st.subtitleGroups,loaded:st.loaded,loadError:st.loadError,fragmentError:st.fragmentError,name:st.name,id:st.id,uri:st.uri,url:st.url,urlId:0,audioGroupIds:st.audioGroupIds,textGroupIds:st.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,at);const lt=st.details;if(!lt||lt.live){const ut=this.switchParams(st.uri,nt==null?void 0:nt.details);this.loadPlaylist(ut)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(_e){this.manualLevelIndex=_e,this._startLevel===void 0&&(this._startLevel=_e),_e!==-1&&(this.level=_e)}get firstLevel(){return this._firstLevel}set firstLevel(_e){this._firstLevel=_e}get startLevel(){if(this._startLevel===void 0){const _e=this.hls.config.startLevel;return _e!==void 0?_e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(_e){this._startLevel=_e}onError(_e,tt){tt.fatal||!tt.context||tt.context.type===PlaylistContextType.LEVEL&&tt.context.level===this.level&&this.checkRetry(tt)}onFragBuffered(_e,{frag:tt}){if(tt!==void 0&&tt.type===PlaylistLevelType.MAIN){const rt=tt.elementaryStreams;if(!Object.keys(rt).some(it=>!!rt[it]))return;const nt=this._levels[tt.level];nt!=null&&nt.loadError&&(this.log(`Resetting level error count of ${nt.loadError} on frag buffered`),nt.loadError=0)}}onLevelLoaded(_e,tt){var rt;const{level:nt,details:it}=tt,st=this._levels[nt];if(!st){var ot;this.warn(`Invalid level index ${nt}`),(ot=tt.deliveryDirectives)!=null&&ot.skip&&(it.deltaUpdateFailed=!0);return}nt===this.currentLevelIndex?(st.fragmentError===0&&(st.loadError=0),this.playlistLoaded(nt,tt,st.details)):(rt=tt.deliveryDirectives)!=null&&rt.skip&&(it.deltaUpdateFailed=!0)}loadPlaylist(_e){super.loadPlaylist();const tt=this.currentLevelIndex,rt=this.currentLevel;if(rt&&this.shouldLoadPlaylist(rt)){let nt=rt.uri;if(_e)try{nt=_e.addDirectives(nt)}catch(st){this.warn(`Could not construct new URL with HLS Delivery Directives: ${st}`)}const it=rt.attrs["PATHWAY-ID"];this.log(`Loading level index ${tt}${(_e==null?void 0:_e.msn)!==void 0?" at sn "+_e.msn+" part "+_e.part:""} with${it?" Pathway "+it:""} ${nt}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:nt,level:tt,pathwayId:rt.attrs["PATHWAY-ID"],id:0,deliveryDirectives:_e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(_e){this.level=_e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=_e)}removeLevel(_e){var tt;const rt=this._levels.filter((nt,it)=>it!==_e?!0:(this.steering&&this.steering.removeLevel(nt),nt===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,nt.details&&nt.details.fragments.forEach(st=>st.level=-1)),!1));reassignFragmentLevelIndexes(rt),this._levels=rt,this.currentLevelIndex>-1&&(tt=this.currentLevel)!=null&&tt.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Events.LEVELS_UPDATED,{levels:rt})}onLevelsUpdated(_e,{levels:tt}){this._levels=tt}checkMaxAutoUpdated(){const{autoLevelCapping:_e,maxAutoLevel:tt,maxHdcpLevel:rt}=this.hls;this._maxAutoLevel!==tt&&(this._maxAutoLevel=tt,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:_e,levels:this.levels,maxAutoLevel:tt,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:rt}))}}function assignTrackIdsByGroup(et){const _e={};et.forEach(tt=>{const rt=tt.groupId||"";tt.id=_e[rt]=_e[rt]||0,_e[rt]++})}class KeyLoader{constructor(_e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=_e}abort(_e){for(const rt in this.keyUriToKeyInfo){const nt=this.keyUriToKeyInfo[rt].loader;if(nt){var tt;if(_e&&_e!==((tt=nt.context)==null?void 0:tt.frag.type))return;nt.abort()}}}detach(){for(const _e in this.keyUriToKeyInfo){const tt=this.keyUriToKeyInfo[_e];(tt.mediaKeySessionContext||tt.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[_e]}}destroy(){this.detach();for(const _e in this.keyUriToKeyInfo){const tt=this.keyUriToKeyInfo[_e].loader;tt&&tt.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(_e,tt=ErrorDetails.KEY_LOAD_ERROR,rt,nt,it){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:tt,fatal:!1,frag:_e,response:it,error:rt,networkDetails:nt})}loadClear(_e,tt){if(this.emeController&&this.config.emeEnabled){const{sn:rt,cc:nt}=_e;for(let it=0;it<tt.length;it++){const st=tt[it];if(nt<=st.cc&&(rt==="initSegment"||st.sn==="initSegment"||rt<st.sn)){this.emeController.selectKeySystemFormat(st).then(ot=>{st.setKeyFormat(ot)});break}}}}load(_e){return!_e.decryptdata&&_e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(_e).then(tt=>this.loadInternal(_e,tt)):this.loadInternal(_e)}loadInternal(_e,tt){var rt,nt;tt&&_e.setKeyFormat(tt);const it=_e.decryptdata;if(!it){const lt=new Error(tt?`Expected frag.decryptdata to be defined after setting format ${tt}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(_e,ErrorDetails.KEY_LOAD_ERROR,lt))}const st=it.uri;if(!st)return Promise.reject(this.createKeyLoadError(_e,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${st}"`)));let ot=this.keyUriToKeyInfo[st];if((rt=ot)!=null&&rt.decryptdata.key)return it.key=ot.decryptdata.key,Promise.resolve({frag:_e,keyInfo:ot});if((nt=ot)!=null&&nt.keyLoadPromise){var at;switch((at=ot.mediaKeySessionContext)==null?void 0:at.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return ot.keyLoadPromise.then(lt=>(it.key=lt.keyInfo.decryptdata.key,{frag:_e,keyInfo:ot}))}}switch(ot=this.keyUriToKeyInfo[st]={decryptdata:it,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},it.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return it.keyFormat==="identity"?this.loadKeyHTTP(ot,_e):this.loadKeyEME(ot,_e);case"AES-128":return this.loadKeyHTTP(ot,_e);default:return Promise.reject(this.createKeyLoadError(_e,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${it.method}"`)))}}loadKeyEME(_e,tt){const rt={frag:tt,keyInfo:_e};if(this.emeController&&this.config.emeEnabled){const nt=this.emeController.loadKey(rt);if(nt)return(_e.keyLoadPromise=nt.then(it=>(_e.mediaKeySessionContext=it,rt))).catch(it=>{throw _e.keyLoadPromise=null,it})}return Promise.resolve(rt)}loadKeyHTTP(_e,tt){const rt=this.config,nt=rt.loader,it=new nt(rt);return tt.keyLoader=_e.loader=it,_e.keyLoadPromise=new Promise((st,ot)=>{const at={keyInfo:_e,frag:tt,responseType:"arraybuffer",url:_e.decryptdata.uri},lt=rt.keyLoadPolicy.default,ut={loadPolicy:lt,timeout:lt.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},ct={onSuccess:(dt,ft,pt,mt)=>{const{frag:ht,keyInfo:gt,url:vt}=pt;if(!ht.decryptdata||gt!==this.keyUriToKeyInfo[vt])return ot(this.createKeyLoadError(ht,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),mt));gt.decryptdata.key=ht.decryptdata.key=new Uint8Array(dt.data),ht.keyLoader=null,gt.loader=null,st({frag:ht,keyInfo:gt})},onError:(dt,ft,pt,mt)=>{this.resetLoader(ft),ot(this.createKeyLoadError(tt,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${dt.code} loading key ${dt.text}`),pt,_objectSpread2({url:at.url,data:void 0},dt)))},onTimeout:(dt,ft,pt)=>{this.resetLoader(ft),ot(this.createKeyLoadError(tt,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),pt))},onAbort:(dt,ft,pt)=>{this.resetLoader(ft),ot(this.createKeyLoadError(tt,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),pt))}};it.load(at,ut,ct)})}resetLoader(_e){const{frag:tt,keyInfo:rt,url:nt}=_e,it=rt.loader;tt.keyLoader===it&&(tt.keyLoader=null,rt.loader=null),delete this.keyUriToKeyInfo[nt],it&&it.destroy()}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const _e=getSourceBuffer();return!_e||_e.prototype&&typeof _e.prototype.appendBuffer=="function"&&typeof _e.prototype.remove=="function"}function isSupported(){if(!isMSESupported())return!1;const et=getMediaSource();return typeof(et==null?void 0:et.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(_e=>et.isTypeSupported(mimeTypeForCodec(_e,"video")))||["mp4a.40.2","fLaC"].some(_e=>et.isTypeSupported(mimeTypeForCodec(_e,"audio"))))}function changeTypeSupported(){var et;const _e=getSourceBuffer();return typeof(_e==null||(et=_e.prototype)==null?void 0:et.changeType)=="function"}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(_e,tt,rt,nt){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=_e,this.media=tt,this.fragmentTracker=rt,this.hls=nt}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(_e,tt){const{config:rt,media:nt,stalled:it}=this;if(nt===null)return;const{currentTime:st,seeking:ot}=nt,at=this.seeking&&!ot,lt=!this.seeking&&ot;if(this.seeking=ot,st!==_e){if(this.moved=!0,ot||(this.nudgeRetry=0),it!==null){if(this.stallReported){const ht=self.performance.now()-it;logger.warn(`playback not stuck anymore @${st}, after ${Math.round(ht)}ms`),this.stallReported=!1}this.stalled=null}return}if(lt||at){this.stalled=null;return}if(nt.paused&&!ot||nt.ended||nt.playbackRate===0||!BufferHelper.getBuffered(nt).length){this.nudgeRetry=0;return}const ut=BufferHelper.bufferInfo(nt,st,0),ct=ut.nextStart||0;if(ot){const ht=ut.len>MAX_START_GAP_JUMP,gt=!ct||tt&&tt.start<=st||ct-st>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(st);if(ht||gt)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var dt;if(!(ut.len>0)&&!ct)return;const gt=Math.max(ct,ut.start||0)-st,vt=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,bt=(vt==null||(dt=vt.details)==null?void 0:dt.live)?vt.details.targetduration*2:MAX_START_GAP_JUMP,xt=this.fragmentTracker.getPartialFragment(st);if(gt>0&&(gt<=bt||xt)){nt.paused||this._trySkipBufferHole(xt);return}}const ft=self.performance.now();if(it===null){this.stalled=ft;return}const pt=ft-it;if(!ot&&pt>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(ut),!this.media))return;const mt=BufferHelper.bufferInfo(nt,st,rt.maxBufferHole);this._tryFixBufferStall(mt,pt)}_tryFixBufferStall(_e,tt){const{config:rt,fragmentTracker:nt,media:it}=this;if(it===null)return;const st=it.currentTime,ot=nt.getPartialFragment(st);ot&&(this._trySkipBufferHole(ot)||!this.media)||(_e.len>rt.maxBufferHole||_e.nextStart&&_e.nextStart-st<rt.maxBufferHole)&&tt>rt.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(_e){const{hls:tt,media:rt,stallReported:nt}=this;if(!nt&&rt){this.stallReported=!0;const it=new Error(`Playback stalling at @${rt.currentTime} due to low buffer (${JSON.stringify(_e)})`);logger.warn(it.message),tt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:it,buffer:_e.len})}}_trySkipBufferHole(_e){const{config:tt,hls:rt,media:nt}=this;if(nt===null)return 0;const it=nt.currentTime,st=BufferHelper.bufferInfo(nt,it,0),ot=it<st.start?st.start:st.nextStart;if(ot){const at=st.len<=tt.maxBufferHole,lt=st.len>0&&st.len<1&&nt.readyState<3,ut=ot-it;if(ut>0&&(at||lt)){if(ut>tt.maxBufferHole){const{fragmentTracker:dt}=this;let ft=!1;if(it===0){const pt=dt.getAppendedFrag(0,PlaylistLevelType.MAIN);pt&&ot<pt.end&&(ft=!0)}if(!ft){const pt=_e||dt.getAppendedFrag(it,PlaylistLevelType.MAIN);if(pt){let mt=!1,ht=pt.end;for(;ht<ot;){const gt=dt.getPartialFragment(ht);if(gt)ht+=gt.duration;else{mt=!0;break}}if(mt)return 0}}}const ct=Math.max(ot+SKIP_BUFFER_RANGE_START,it+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${it} to ${ct}`),this.moved=!0,this.stalled=null,nt.currentTime=ct,_e&&!_e.gap){const dt=new Error(`fragment loaded with buffer holes, seeking from ${it} to ${ct}`);rt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:dt,reason:dt.message,frag:_e})}return ct}}return 0}_tryNudgeBuffer(){const{config:_e,hls:tt,media:rt,nudgeRetry:nt}=this;if(rt===null)return;const it=rt.currentTime;if(this.nudgeRetry++,nt<_e.nudgeMaxRetry){const st=it+(nt+1)*_e.nudgeOffset,ot=new Error(`Nudging 'currentTime' from ${it} to ${st}`);logger.warn(ot.message),rt.currentTime=st,tt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:ot,fatal:!1})}else{const st=new Error(`Playhead still not moving while enough data buffered @${it} after ${_e.nudgeMaxRetry} nudges`);logger.error(st.message),tt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:st,fatal:!0})}}}const TICK_INTERVAL=100;class StreamController extends BaseStreamController{constructor(_e,tt,rt){super(_e,tt,rt,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:_e}=this;_e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),_e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),_e.on(Events.ERROR,this.onError,this),_e.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),_e.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),_e.on(Events.BUFFER_CREATED,this.onBufferCreated,this),_e.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),_e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:_e}=this;_e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),_e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),_e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),_e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),_e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),_e.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),_e.off(Events.ERROR,this.onError,this),_e.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),_e.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),_e.off(Events.BUFFER_CREATED,this.onBufferCreated,this),_e.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),_e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(_e){if(this.levels){const{lastCurrentTime:tt,hls:rt}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){let nt=rt.startLevel;nt===-1&&(rt.config.testBandwidth&&this.levels.length>1?(nt=0,this.bitrateTest=!0):nt=rt.firstAutoLevel),rt.nextLoadLevel=nt,this.level=rt.loadLevel,this.loadedmetadata=!1}tt>0&&_e===-1&&(this.log(`Override startPosition with lastCurrentTime @${tt.toFixed(3)}`),_e=tt),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=_e,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{const{levels:tt,level:rt}=this,nt=tt==null?void 0:tt[rt],it=nt==null?void 0:nt.details;if(it&&(!it.live||this.levelLastLoaded===nt)){if(this.waitForCdnTuneIn(it))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var _e;const tt=self.performance.now(),rt=this.retryDate;if(!rt||tt>=rt||(_e=this.media)!=null&&_e.seeking){const{levels:nt,level:it}=this,st=nt==null?void 0:nt[it];this.resetStartWhenNotLoaded(st||null),this.state=State.IDLE}}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:_e,levelLastLoaded:tt,levels:rt,media:nt}=this;if(tt===null||!nt&&(this.startFragRequested||!_e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const it=_e.nextLoadLevel;if(!(rt!=null&&rt[it]))return;const st=rt[it],ot=this.getMainFwdBufferInfo();if(ot===null)return;const at=this.getLevelDetails();if(at&&this._streamEnded(ot,at)){const mt={};this.altAudio&&(mt.type="video"),this.hls.trigger(Events.BUFFER_EOS,mt),this.state=State.ENDED;return}_e.loadLevel!==it&&_e.manualLevel===-1&&this.log(`Adapting to level ${it} from level ${this.level}`),this.level=_e.nextLoadLevel=it;const lt=st.details;if(!lt||this.state===State.WAITING_LEVEL||lt.live&&this.levelLastLoaded!==st){this.level=it,this.state=State.WAITING_LEVEL;return}const ut=ot.len,ct=this.getMaxBufferLength(st.maxBitrate);if(ut>=ct)return;this.backtrackFragment&&this.backtrackFragment.start>ot.end&&(this.backtrackFragment=null);const dt=this.backtrackFragment?this.backtrackFragment.start:ot.end;let ft=this.getNextFragment(dt,lt);if(this.couldBacktrack&&!this.fragPrevious&&ft&&ft.sn!=="initSegment"&&this.fragmentTracker.getState(ft)!==FragmentState.OK){var pt;const ht=((pt=this.backtrackFragment)!=null?pt:ft).sn-lt.startSN,gt=lt.fragments[ht-1];gt&&ft.cc===gt.cc&&(ft=gt,this.fragmentTracker.removeFragment(gt))}else this.backtrackFragment&&ot.len&&(this.backtrackFragment=null);if(ft&&this.isLoopLoading(ft,dt)){if(!ft.gap){const ht=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,gt=(ht===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;gt&&this.afterBufferFlushed(gt,ht,PlaylistLevelType.MAIN)}ft=this.getNextFragmentLoopLoading(ft,lt,ot,PlaylistLevelType.MAIN,ct)}ft&&(ft.initSegment&&!ft.initSegment.data&&!this.bitrateTest&&(ft=ft.initSegment),this.loadFragment(ft,st,dt))}loadFragment(_e,tt,rt){const nt=this.fragmentTracker.getState(_e);this.fragCurrent=_e,nt===FragmentState.NOT_LOADED||nt===FragmentState.PARTIAL?_e.sn==="initSegment"?this._loadInitSegment(_e,tt):this.bitrateTest?(this.log(`Fragment ${_e.sn} of level ${_e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(_e,tt)):(this.startFragRequested=!0,super.loadFragment(_e,tt,rt)):this.clearTrackerIfNeeded(_e)}getBufferedFrag(_e){return this.fragmentTracker.getBufferedFrag(_e,PlaylistLevelType.MAIN)}followingBufferedFrag(_e){return _e?this.getBufferedFrag(_e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:_e,media:tt}=this;if(tt!=null&&tt.readyState){let rt;const nt=this.getAppendedFrag(tt.currentTime);nt&&nt.start>1&&this.flushMainBuffer(0,nt.start-1);const it=this.getLevelDetails();if(it!=null&&it.live){const ot=this.getMainFwdBufferInfo();if(!ot||ot.len<it.targetduration*2)return}if(!tt.paused&&_e){const ot=this.hls.nextLoadLevel,at=_e[ot],lt=this.fragLastKbps;lt&&this.fragCurrent?rt=this.fragCurrent.duration*at.maxBitrate/(1e3*lt)+1:rt=0}else rt=0;const st=this.getBufferedFrag(tt.currentTime+rt);if(st){const ot=this.followingBufferedFrag(st);if(ot){this.abortCurrentFrag();const at=ot.maxStartPTS?ot.maxStartPTS:ot.start,lt=ot.duration,ut=Math.max(st.end,at+Math.min(Math.max(lt-this.config.maxFragLookUpTolerance,lt*(this.couldBacktrack?.5:.125)),lt*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(ut,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const _e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,_e&&(_e.abortRequests(),this.fragmentTracker.removeFragment(_e)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(_e,tt){super.flushMainBuffer(_e,tt,this.altAudio?"video":null)}onMediaAttached(_e,tt){super.onMediaAttached(_e,tt);const rt=tt.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),rt.addEventListener("playing",this.onvplaying),rt.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,rt,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:_e}=this;_e&&this.onvplaying&&this.onvseeked&&(_e.removeEventListener("playing",this.onvplaying),_e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const _e=this.media,tt=_e?_e.currentTime:null;isFiniteNumber(tt)&&this.log(`Media seeked to ${tt.toFixed(3)}`);const rt=this.getMainFwdBufferInfo();if(rt===null||rt.len===0){this.warn(`Main forward buffer length on "seeked" event ${rt?rt.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(_e,tt){let rt=!1,nt=!1;tt.levels.forEach(it=>{const st=it.audioCodec;st&&(rt=rt||st.indexOf("mp4a.40.2")!==-1,nt=nt||st.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=rt&&nt&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=tt.levels,this.startFragRequested=!1}onLevelLoading(_e,tt){const{levels:rt}=this;if(!rt||this.state!==State.IDLE)return;const nt=rt[tt.level];(!nt.details||nt.details.live&&this.levelLastLoaded!==nt||this.waitForCdnTuneIn(nt.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(_e,tt){var rt;const{levels:nt}=this,it=tt.level,st=tt.details,ot=st.totalduration;if(!nt){this.warn(`Levels were reset while loading level ${it}`);return}this.log(`Level ${it} loaded [${st.startSN},${st.endSN}]${st.lastPartSn?`[part-${st.lastPartSn}-${st.lastPartIndex}]`:""}, cc [${st.startCC}, ${st.endCC}] duration:${ot}`);const at=nt[it],lt=this.fragCurrent;lt&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&lt.level!==tt.level&&lt.loader&&this.abortCurrentFrag();let ut=0;if(st.live||(rt=at.details)!=null&&rt.live){var ct;if(this.checkLiveUpdate(st),st.deltaUpdateFailed)return;ut=this.alignPlaylists(st,at.details,(ct=this.levelLastLoaded)==null?void 0:ct.details)}if(at.details=st,this.levelLastLoaded=at,this.hls.trigger(Events.LEVEL_UPDATED,{details:st,level:it}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(st))return;this.state=State.IDLE}this.startFragRequested?st.live&&this.synchronizeToLiveEdge(st):this.setStartPosition(st,ut),this.tick()}_handleFragmentLoadProgress(_e){var tt;const{frag:rt,part:nt,payload:it}=_e,{levels:st}=this;if(!st){this.warn(`Levels were reset while fragment load was in progress. Fragment ${rt.sn} of level ${rt.level} will not be buffered`);return}const ot=st[rt.level],at=ot.details;if(!at){this.warn(`Dropping fragment ${rt.sn} of level ${rt.level} after level details were reset`),this.fragmentTracker.removeFragment(rt);return}const lt=ot.videoCodec,ut=at.PTSKnown||!at.live,ct=(tt=rt.initSegment)==null?void 0:tt.data,dt=this._getAudioCodec(ot),ft=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),pt=nt?nt.index:-1,mt=pt!==-1,ht=new ChunkMetadata(rt.level,rt.sn,rt.stats.chunkCount,it.byteLength,pt,mt),gt=this.initPTS[rt.cc];ft.push(it,ct,dt,lt,rt,nt,at.totalduration,ut,ht,gt)}onAudioTrackSwitching(_e,tt){const rt=this.altAudio;if(!!!tt.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const st=this.fragCurrent;st&&(this.log("Switching to main audio track, cancel main fragment load"),st.abortRequests(),this.fragmentTracker.removeFragment(st)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const it=this.hls;rt&&(it.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),it.trigger(Events.AUDIO_TRACK_SWITCHED,tt)}}onAudioTrackSwitched(_e,tt){const rt=tt.id,nt=!!this.hls.audioTracks[rt].url;if(nt){const it=this.videoBuffer;it&&this.mediaBuffer!==it&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=it)}this.altAudio=nt,this.tick()}onBufferCreated(_e,tt){const rt=tt.tracks;let nt,it,st=!1;for(const ot in rt){const at=rt[ot];if(at.id==="main"){if(it=ot,nt=at,ot==="video"){const lt=rt[ot];lt&&(this.videoBuffer=lt.buffer)}}else st=!0}st&&nt?(this.log(`Alternate track found, use ${it}.buffered to schedule main fragment loading`),this.mediaBuffer=nt.buffer):this.mediaBuffer=this.media}onFragBuffered(_e,tt){const{frag:rt,part:nt}=tt;if(rt&&rt.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(rt)){this.warn(`Fragment ${rt.sn}${nt?" p: "+nt.index:""} of level ${rt.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const it=nt?nt.stats:rt.stats;this.fragLastKbps=Math.round(8*it.total/(it.buffering.end-it.loading.first)),rt.sn!=="initSegment"&&(this.fragPrevious=rt),this.fragBufferedComplete(rt,nt)}onError(_e,tt){var rt;if(tt.fatal){this.state=State.ERROR;return}switch(tt.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,tt);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!tt.levelRetry&&this.state===State.WAITING_LEVEL&&((rt=tt.context)==null?void 0:rt.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!tt.parent||tt.parent!=="main")return;if(tt.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(tt)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(tt);break}}checkBuffer(){const{media:_e,gapController:tt}=this;if(!(!_e||!tt||!_e.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(_e).length){const rt=this.state!==State.IDLE?this.fragCurrent:null;tt.poll(this.lastCurrentTime,rt)}this.lastCurrentTime=_e.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(_e,{type:tt}){if(tt!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const rt=(tt===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(rt,tt,PlaylistLevelType.MAIN),this.tick()}}onLevelsUpdated(_e,tt){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=tt.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:_e}=this;if(!_e)return;const tt=_e.currentTime;let rt=this.startPosition;if(rt>=0&&tt<rt){if(_e.seeking){this.log(`could not seek to ${rt}, already seeking at ${tt}`);return}const nt=BufferHelper.getBuffered(_e),st=(nt.length?nt.start(0):0)-rt;st>0&&(st<this.config.maxBufferHole||st<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${st} to match buffer start`),rt+=st,this.startPosition=rt),this.log(`seek to target start position ${rt} from current time ${tt}`),_e.currentTime=rt}}_getAudioCodec(_e){let tt=this.config.defaultAudioCodec||_e.audioCodec;return this.audioCodecSwap&&tt&&(this.log("Swapping audio codec"),tt.indexOf("mp4a.40.5")!==-1?tt="mp4a.40.2":tt="mp4a.40.5"),tt}_loadBitrateTestFrag(_e,tt){_e.bitrateTest=!0,this._doFragLoad(_e,tt).then(rt=>{const{hls:nt}=this;if(!rt||this.fragContextChanged(_e))return;tt.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const it=_e.stats;it.parsing.start=it.parsing.end=it.buffering.start=it.buffering.end=self.performance.now(),nt.trigger(Events.FRAG_LOADED,rt),_e.bitrateTest=!1})}_handleTransmuxComplete(_e){var tt;const rt="main",{hls:nt}=this,{remuxResult:it,chunkMeta:st}=_e,ot=this.getCurrentContext(st);if(!ot){this.resetWhenMissingContext(st);return}const{frag:at,part:lt,level:ut}=ot,{video:ct,text:dt,id3:ft,initSegment:pt}=it,{details:mt}=ut,ht=this.altAudio?void 0:it.audio;if(this.fragContextChanged(at)){this.fragmentTracker.removeFragment(at);return}if(this.state=State.PARSING,pt){if(pt!=null&&pt.tracks){const yt=at.initSegment||at;this._bufferInitSegment(ut,pt.tracks,yt,st),nt.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:yt,id:rt,tracks:pt.tracks})}const gt=pt.initPTS,vt=pt.timescale;isFiniteNumber(gt)&&(this.initPTS[at.cc]={baseTime:gt,timescale:vt},nt.trigger(Events.INIT_PTS_FOUND,{frag:at,id:rt,initPTS:gt,timescale:vt}))}if(ct&&mt&&at.sn!=="initSegment"){const gt=mt.fragments[at.sn-1-mt.startSN],vt=at.sn===mt.startSN,yt=!gt||at.cc>gt.cc;if(it.independent!==!1){const{startPTS:bt,endPTS:xt,startDTS:_t,endDTS:wt}=ct;if(lt)lt.elementaryStreams[ct.type]={startPTS:bt,endPTS:xt,startDTS:_t,endDTS:wt};else if(ct.firstKeyFrame&&ct.independent&&st.id===1&&!yt&&(this.couldBacktrack=!0),ct.dropped&&ct.independent){const Ct=this.getMainFwdBufferInfo(),kt=(Ct?Ct.end:this.getLoadPosition())+this.config.maxBufferHole,At=ct.firstKeyFramePTS?ct.firstKeyFramePTS:bt;if(!vt&&kt<At-this.config.maxBufferHole&&!yt){this.backtrack(at);return}else yt&&(at.gap=!0);at.setElementaryStreamInfo(ct.type,at.start,xt,at.start,wt,!0)}else vt&&bt>MAX_START_GAP_JUMP&&(at.gap=!0);at.setElementaryStreamInfo(ct.type,bt,xt,_t,wt),this.backtrackFragment&&(this.backtrackFragment=at),this.bufferFragmentData(ct,at,lt,st,vt||yt)}else if(vt||yt)at.gap=!0;else{this.backtrack(at);return}}if(ht){const{startPTS:gt,endPTS:vt,startDTS:yt,endDTS:bt}=ht;lt&&(lt.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:gt,endPTS:vt,startDTS:yt,endDTS:bt}),at.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,gt,vt,yt,bt),this.bufferFragmentData(ht,at,lt,st)}if(mt&&ft!=null&&(tt=ft.samples)!=null&&tt.length){const gt={id:rt,frag:at,details:mt,samples:ft.samples};nt.trigger(Events.FRAG_PARSING_METADATA,gt)}if(mt&&dt){const gt={id:rt,frag:at,details:mt,samples:dt.samples};nt.trigger(Events.FRAG_PARSING_USERDATA,gt)}}_bufferInitSegment(_e,tt,rt,nt){if(this.state!==State.PARSING)return;this.audioOnly=!!tt.audio&&!tt.video,this.altAudio&&!this.audioOnly&&delete tt.audio;const{audio:it,video:st,audiovideo:ot}=tt;if(it){let at=_e.audioCodec;const lt=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(at&&(at.indexOf("mp4a.40.5")!==-1?at="mp4a.40.2":at="mp4a.40.5"),it.metadata.channelCount!==1&&lt.indexOf("firefox")===-1&&(at="mp4a.40.5")),at&&at.indexOf("mp4a.40.5")!==-1&&lt.indexOf("android")!==-1&&it.container!=="audio/mpeg"&&(at="mp4a.40.2",this.log(`Android: force audio codec to ${at}`)),_e.audioCodec&&_e.audioCodec!==at&&this.log(`Swapping manifest audio codec "${_e.audioCodec}" for "${at}"`),it.levelCodec=at,it.id="main",this.log(`Init audio buffer, container:${it.container}, codecs[selected/level/parsed]=[${at||""}/${_e.audioCodec||""}/${it.codec}]`)}st&&(st.levelCodec=_e.videoCodec,st.id="main",this.log(`Init video buffer, container:${st.container}, codecs[level/parsed]=[${_e.videoCodec||""}/${st.codec}]`)),ot&&this.log(`Init audiovideo buffer, container:${ot.container}, codecs[level/parsed]=[${_e.codecs}/${ot.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,tt),Object.keys(tt).forEach(at=>{const ut=tt[at].initSegment;ut!=null&&ut.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:at,data:ut,frag:rt,part:null,chunkMeta:nt,parent:rt.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(_e){this.couldBacktrack=!0,this.backtrackFragment=_e,this.resetTransmuxer(),this.flushBufferGap(_e),this.fragmentTracker.removeFragment(_e),this.fragPrevious=null,this.nextLoadPosition=_e.start,this.state=State.IDLE}checkFragmentChanged(){const _e=this.media;let tt=null;if(_e&&_e.readyState>1&&_e.seeking===!1){const rt=_e.currentTime;if(BufferHelper.isBuffered(_e,rt)?tt=this.getAppendedFrag(rt):BufferHelper.isBuffered(_e,rt+.1)&&(tt=this.getAppendedFrag(rt+.1)),tt){this.backtrackFragment=null;const nt=this.fragPlaying,it=tt.level;(!nt||tt.sn!==nt.sn||nt.level!==it)&&(this.fragPlaying=tt,this.hls.trigger(Events.FRAG_CHANGED,{frag:tt}),(!nt||nt.level!==it)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:it}))}}}get nextLevel(){const _e=this.nextBufferedFrag;return _e?_e.level:-1}get currentFrag(){const _e=this.media;return _e?this.fragPlaying||this.getAppendedFrag(_e.currentTime):null}get currentProgramDateTime(){const _e=this.media;if(_e){const tt=_e.currentTime,rt=this.currentFrag;if(rt&&isFiniteNumber(tt)&&isFiniteNumber(rt.programDateTime)){const nt=rt.programDateTime+(tt-rt.start)*1e3;return new Date(nt)}}return null}get currentLevel(){const _e=this.currentFrag;return _e?_e.level:-1}get nextBufferedFrag(){const _e=this.currentFrag;return _e?this.followingBufferedFrag(_e):null}get forceStartLoad(){return this._forceStartLoad}}class Hls{static get version(){return"1.5.7"}static isMSESupported(){return isMSESupported()}static isSupported(){return isSupported()}static getMediaSource(){return getMediaSource()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(_e){Hls.defaultConfig=_e}constructor(_e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,enableLogs(_e.debug||!1,"Hls instance");const tt=this.config=mergeConfig(Hls.DefaultConfig,_e);this.userConfig=_e,tt.progressive&&enableStreamingMode(tt);const{abrController:rt,bufferController:nt,capLevelController:it,errorController:st,fpsController:ot}=tt,at=new st(this),lt=this.abrController=new rt(this),ut=this.bufferController=new nt(this),ct=this.capLevelController=new it(this),dt=new ot(this),ft=new PlaylistLoader(this),pt=new ID3TrackController(this),mt=tt.contentSteeringController,ht=mt?new mt(this):null,gt=this.levelController=new LevelController(this,ht),vt=new FragmentTracker(this),yt=new KeyLoader(this.config),bt=this.streamController=new StreamController(this,vt,yt);ct.setStreamController(bt),dt.setStreamController(bt);const xt=[ft,gt,bt];ht&&xt.splice(1,0,ht),this.networkControllers=xt;const _t=[lt,ut,ct,dt,pt,vt];this.audioTrackController=this.createController(tt.audioTrackController,xt);const wt=tt.audioStreamController;wt&&xt.push(new wt(this,vt,yt)),this.subtitleTrackController=this.createController(tt.subtitleTrackController,xt);const Ct=tt.subtitleStreamController;Ct&&xt.push(new Ct(this,vt,yt)),this.createController(tt.timelineController,_t),yt.emeController=this.emeController=this.createController(tt.emeController,_t),this.cmcdController=this.createController(tt.cmcdController,_t),this.latencyController=this.createController(LatencyController,_t),this.coreComponents=_t,xt.push(at);const kt=at.onErrorOut;typeof kt=="function"&&this.on(Events.ERROR,kt,at)}createController(_e,tt){if(_e){const rt=new _e(this);return tt&&tt.push(rt),rt}return null}on(_e,tt,rt=this){this._emitter.on(_e,tt,rt)}once(_e,tt,rt=this){this._emitter.once(_e,tt,rt)}removeAllListeners(_e){this._emitter.removeAllListeners(_e)}off(_e,tt,rt=this,nt){this._emitter.off(_e,tt,rt,nt)}listeners(_e){return this._emitter.listeners(_e)}emit(_e,tt,rt){return this._emitter.emit(_e,tt,rt)}trigger(_e,tt){if(this.config.debug)return this.emit(_e,_e,tt);try{return this.emit(_e,_e,tt)}catch(rt){if(logger.error("An internal error happened while handling event "+_e+'. Error message: "'+rt.message+'". Here is a stacktrace:',rt),!this.triggeringException){this.triggeringException=!0;const nt=_e===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:nt,event:_e,error:rt}),this.triggeringException=!1}}return!1}listenerCount(_e){return this._emitter.listenerCount(_e)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(tt=>tt.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(tt=>tt.destroy()),this.coreComponents.length=0;const _e=this.config;_e.xhrSetup=_e.fetchSetup=void 0,this.userConfig=null}attachMedia(_e){logger.log("attachMedia"),this._media=_e,this.trigger(Events.MEDIA_ATTACHING,{media:_e})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(_e){this.stopLoad();const tt=this.media,rt=this.url,nt=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,_e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,logger.log(`loadSource:${nt}`),tt&&rt&&(rt!==nt||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(tt)),this.trigger(Events.MANIFEST_LOADING,{url:_e})}startLoad(_e=-1){logger.log(`startLoad(${_e})`),this.started=!0,this.networkControllers.forEach(tt=>{tt.startLoad(_e)})}stopLoad(){logger.log("stopLoad"),this.started=!1,this.networkControllers.forEach(_e=>{_e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(_e=>{"fragmentLoader"in _e&&_e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(_e=>{"fragmentLoader"in _e&&_e.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const _e=this._media;this.detachMedia(),_e&&this.attachMedia(_e)}removeLevel(_e){this.levelController.removeLevel(_e)}get levels(){const _e=this.levelController.levels;return _e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(_e){logger.log(`set currentLevel:${_e}`),this.levelController.manualLevel=_e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(_e){logger.log(`set nextLevel:${_e}`),this.levelController.manualLevel=_e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(_e){logger.log(`set loadLevel:${_e}`),this.levelController.manualLevel=_e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(_e){this.levelController.nextLoadLevel=_e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(_e){logger.log(`set firstLevel:${_e}`),this.levelController.firstLevel=_e}get startLevel(){const _e=this.levelController.startLevel;return _e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:_e}set startLevel(_e){logger.log(`set startLevel:${_e}`),_e!==-1&&(_e=Math.max(_e,this.minAutoLevel)),this.levelController.startLevel=_e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(_e){const tt=!!_e;tt!==this.config.capLevelToPlayerSize&&(tt?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=tt)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:_e}=this.abrController;return _e?_e.getEstimate():NaN}set bandwidthEstimate(_e){this.abrController.resetEstimator(_e)}get ttfbEstimate(){const{bwEstimator:_e}=this.abrController;return _e?_e.getEstimateTTFB():NaN}set autoLevelCapping(_e){this._autoLevelCapping!==_e&&(logger.log(`set autoLevelCapping:${_e}`),this._autoLevelCapping=_e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(_e){isHdcpLevel(_e)&&this._maxHdcpLevel!==_e&&(this._maxHdcpLevel=_e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:_e,config:{minAutoBitrate:tt}}=this;if(!_e)return 0;const rt=_e.length;for(let nt=0;nt<rt;nt++)if(_e[nt].maxBitrate>=tt)return nt;return 0}get maxAutoLevel(){const{levels:_e,autoLevelCapping:tt,maxHdcpLevel:rt}=this;let nt;if(tt===-1&&_e!=null&&_e.length?nt=_e.length-1:nt=tt,rt)for(let it=nt;it--;){const st=_e[it].attrs["HDCP-LEVEL"];if(st&&st<=rt)return it}return nt}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(_e){this.abrController.nextAutoLevel=_e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(_e){var tt;return(tt=this.audioTrackController)==null?void 0:tt.setAudioOption(_e)}setSubtitleOption(_e){var tt;return(tt=this.subtitleTrackController)==null||tt.setSubtitleOption(_e),null}get allAudioTracks(){const _e=this.audioTrackController;return _e?_e.allAudioTracks:[]}get audioTracks(){const _e=this.audioTrackController;return _e?_e.audioTracks:[]}get audioTrack(){const _e=this.audioTrackController;return _e?_e.audioTrack:-1}set audioTrack(_e){const tt=this.audioTrackController;tt&&(tt.audioTrack=_e)}get allSubtitleTracks(){const _e=this.subtitleTrackController;return _e?_e.allSubtitleTracks:[]}get subtitleTracks(){const _e=this.subtitleTrackController;return _e?_e.subtitleTracks:[]}get subtitleTrack(){const _e=this.subtitleTrackController;return _e?_e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(_e){const tt=this.subtitleTrackController;tt&&(tt.subtitleTrack=_e)}get subtitleDisplay(){const _e=this.subtitleTrackController;return _e?_e.subtitleDisplay:!1}set subtitleDisplay(_e){const tt=this.subtitleTrackController;tt&&(tt.subtitleDisplay=_e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(_e){this.config.lowLatencyMode=_e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;const useGetImageResource=(et,_e="200,",tt="full")=>{Array.isArray(et)&&(et=et[0]);const{id:rt,service:nt}=et;let it;if(!nt)return rt;if(Array.isArray(et.service)&&et.service.length>0&&(it=nt[0]),it){if(it["@id"])return`${it["@id"]}/${tt}/${_e}/0/default.jpg`;if(it.id)return`${it.id}/${tt}/${_e}/0/default.jpg`}},StyledResource=styled("img",{objectFit:"cover"}),ContentResource=et=>{const _e=F$2(null),{contentResource:tt,altAsLabel:rt,region:nt="full"}=et;let it;rt&&(it=getLabelAsString(rt));const ot=sanitizeAttributes(et,["contentResource","altAsLabel"]),{type:at,id:lt,width:ut=200,height:ct=200,duration:dt}=tt;_(()=>{if(!lt&&!_e.current||["Image"].includes(at)||!lt.includes("m3u8"))return;const mt=new Hls;return _e.current&&(mt.attachMedia(_e.current),mt.on(Hls.Events.MEDIA_ATTACHED,function(){mt.loadSource(lt)})),mt.on(Hls.Events.ERROR,function(ht,gt){if(gt.fatal)switch(gt.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${ht} network error encountered, try to recover`),mt.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${ht} media error encountered, try to recover`),mt.recoverMediaError();break;default:mt.destroy();break}}),()=>{mt&&(mt.detachMedia(),mt.destroy())}},[lt,at]);const ft=x$3(()=>{if(!_e.current)return;let mt=0,ht=30;if(dt&&(ht=dt),!lt.split("#t=")&&dt&&(mt=dt*.1),lt.split("#t=").pop()){const vt=lt.split("#t=").pop();vt&&(mt=parseInt(vt.split(",")[0]))}const gt=_e.current;gt.autoplay=!0,gt.currentTime=mt,setTimeout(()=>ft(),ht*1e3)},[dt,lt]);_(()=>ft(),[ft]);const pt=useGetImageResource(tt,`${ut},${ct}`,nt);switch(at){case"Image":return y$3(StyledResource,{as:"img",alt:it,css:{width:ut,height:ct},key:lt,src:pt,...ot});case"Video":return y$3(StyledResource,{as:"video",css:{width:ut,height:ct},disablePictureInPicture:!0,key:lt,loop:!0,muted:!0,onPause:ft,ref:_e,src:lt});default:return console.warn(`Resource type: ${at} is not valid or not yet supported in Primitives.`),y$3(g$3,null)}},StyledHomepage=styled("a",{}),Homepage=et=>{const{children:_e,homepage:tt}=et,nt=sanitizeAttributes(et,["children","homepage"]);return y$3(g$3,null,tt&&tt.map(it=>{const st=getLabelAsString(it.label,nt.lang);return y$3(StyledHomepage,{"aria-label":_e?st:void 0,href:it.id,key:it.id,...nt},_e||st)}))},defaultState={delimiter:", "},PrimitivesContext=G$3(void 0),usePrimitivesContext=()=>{const et=P$3(PrimitivesContext);if(et===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return et},PrimitivesProvider=({children:et,initialState:_e=defaultState})=>{const tt=getRealPropertyValue(_e,"delimiter");return y$3(PrimitivesContext.Provider,{value:{delimiter:tt}},et)},getRealPropertyValue=(et,_e)=>Object.hasOwn(et,_e)?et[_e].toString():void 0,StyledMarkup=styled("span",{}),Markup=et=>{const{as:_e,markup:tt}=et,{delimiter:rt}=usePrimitivesContext();if(!tt)return y$3(g$3,null);const it=sanitizeAttributes(et,["as","markup"]),st=createMarkup(getLabelAsString(tt,it.lang,rt));return y$3(StyledMarkup,{as:_e,...it,dangerouslySetInnerHTML:st})},MarkupWrapper=et=>wn.useContext(PrimitivesContext)?y$3(Markup,{...et}):y$3(PrimitivesProvider,null,y$3(Markup,{...et})),Value=({as:et="dd",lang:_e,value:tt})=>y$3(MarkupWrapper,{markup:tt,as:et,lang:_e}),StyledCustomValue=styled("span",{}),CustomValue=({as:et="dd",customValueContent:_e,lang:tt,value:rt})=>{var st;const{delimiter:nt}=usePrimitivesContext(),it=(st=getLabelEntries(rt,tt))==null?void 0:st.map(ot=>sn(_e,{value:ot}));return y$3(StyledCustomValue,{as:et,lang:tt},it==null?void 0:it.map((ot,at)=>[at>0&&`${nt}`,y$3(g$3,{key:at},ot)]))},MetadataItem=et=>{var ot;const{item:_e,lang:tt,customValueContent:rt}=et,{label:nt,value:it}=_e,st=(ot=getLabelAsString(nt))==null?void 0:ot.replace(" ","-").toLowerCase();return y$3("div",{role:"group","data-label":st},y$3(Label$1,{as:"dt",label:nt,lang:tt}),rt?y$3(CustomValue,{as:"dd",customValueContent:rt,value:it,lang:tt}):y$3(Value,{as:"dd",value:it,lang:tt}))};function parseCustomContent(et,_e){const tt=_e.filter(rt=>{const{matchingLabel:nt}=rt,it=Object.keys(rt.matchingLabel)[0],st=getLabelAsString(nt,it);if(getLabelAsString(et,it)===st)return!0}).map(rt=>rt.Content);if(Array.isArray(tt))return tt[0]}const StyledMetadata=styled("dl",{}),Metadata=et=>{const{as:_e,customValueContent:tt,metadata:rt}=et;if(!Array.isArray(rt))return y$3(g$3,null);const nt=getRealPropertyValue$1(et,"customValueDelimiter"),st=sanitizeAttributes(et,["as","customValueContent","customValueDelimiter","metadata"]);return y$3(PrimitivesProvider,{...typeof nt=="string"?{initialState:{delimiter:nt}}:void 0},rt.length>0&&y$3(StyledMetadata,{as:_e,...st},rt.map((ot,at)=>{const lt=tt?parseCustomContent(ot.label,tt):void 0;return y$3(MetadataItem,{customValueContent:lt,item:ot,key:at,lang:st==null?void 0:st.lang})})))};styled("li",{}),styled("ul",{});const StyledRequiredStatement=styled("dl",{}),RequiredStatement=et=>{const{as:_e,requiredStatement:tt}=et;if(!tt)return y$3(g$3,null);const rt=getRealPropertyValue$1(et,"customValueDelimiter"),it=sanitizeAttributes(et,["as","customValueDelimiter","requiredStatement"]);return y$3(PrimitivesProvider,{...typeof rt=="string"?{initialState:{delimiter:rt}}:void 0},y$3(StyledRequiredStatement,{as:_e,...it},y$3(MetadataItem,{item:tt,lang:it.lang})))},StyledSeeAlso=styled("li",{}),StyledWrapper=styled("ul",{}),SeeAlso=et=>{const{as:_e,seeAlso:tt}=et,nt=sanitizeAttributes(et,["as","seeAlso"]);return y$3(StyledWrapper,{as:_e},tt&&tt.map(it=>{const st=getLabelAsString(it.label,nt.lang);return y$3(StyledSeeAlso,{key:it.id},y$3("a",{href:it.id,...nt},st||it.id))}))},Summary=et=>{const{as:_e,summary:tt}=et,nt=sanitizeAttributes(et,["as","customValueDelimiter","summary"]);return y$3(MarkupWrapper,{as:_e,markup:tt,...nt})},Thumbnail$1=et=>{const{thumbnail:_e,region:tt}=et,nt=sanitizeAttributes(et,["thumbnail"]);return y$3(g$3,null,_e&&_e.map(it=>y$3(ContentResource,{contentResource:it,key:it.id,region:tt,...nt})))},PropertiesHomepage=({homepage:et})=>(et==null?void 0:et.length)===0?y$3(g$3,null):y$3(g$3,null,y$3("span",{className:"manifest-property-title"},"Homepage"),y$3(Homepage,{homepage:et})),PropertiesId=({id:et,htmlLabel:_e,parent:tt="manifest"})=>y$3(g$3,null,y$3("span",{className:"manifest-property-title"},_e),y$3("a",{href:et,target:"_blank",id:`iiif-${tt}-id`},et)),PropertiesMetadata=({metadata:et,parent:_e="manifest"})=>et?y$3(g$3,null,y$3(Metadata,{metadata:et,id:`iiif-${_e}-metadata`})):y$3(g$3,null),PropertiesRequiredStatement=({requiredStatement:et,parent:_e="manifest"})=>et?y$3(g$3,null,y$3(RequiredStatement,{requiredStatement:et,id:`iiif-${_e}-required-statement`})):y$3(g$3,null),PropertiesRights=({rights:et})=>et?y$3(g$3,null,y$3("span",{className:"manifest-property-title"},"Rights"),y$3("a",{href:et,target:"_blank"},et)):y$3(g$3,null),PropertiesSeeAlso=({seeAlso:et})=>(et==null?void 0:et.length)===0?y$3(g$3,null):y$3(g$3,null,y$3("span",{className:"manifest-property-title"},"See Also"),y$3(SeeAlso,{seeAlso:et})),PropertiesSummary=({summary:et,parent:_e="manifest"})=>et?y$3(g$3,null,y$3(Summary,{summary:et,as:"p",id:`iiif-${_e}-summary`})):y$3(g$3,null),PropertiesThumbnail=({label:et,thumbnail:_e})=>(_e==null?void 0:_e.length)===0?y$3(g$3,null):y$3(g$3,null,y$3(Thumbnail$1,{altAsLabel:et||{none:["resource"]},thumbnail:_e,style:{backgroundColor:"#6663",objectFit:"cover"}})),About=()=>{const et=useViewerState(),{activeManifest:_e,vault:tt}=et,[rt,nt]=p$2(),[it,st]=p$2([]),[ot,at]=p$2([]),[lt,ut]=p$2([]);return _(()=>{var dt,ft,pt;const ct=tt.get(_e);nt(ct),((dt=ct.homepage)==null?void 0:dt.length)>0&&st(tt.get(ct.homepage)),((ft=ct.seeAlso)==null?void 0:ft.length)>0&&at(tt.get(ct.seeAlso)),((pt=ct.thumbnail)==null?void 0:pt.length)>0&&ut(tt.get(ct.thumbnail))},[_e,tt]),rt?y$3(AboutStyled,null,y$3(AboutContent,null,y$3(PropertiesThumbnail,{thumbnail:lt,label:rt.label}),y$3(PropertiesSummary,{summary:rt.summary}),y$3(PropertiesMetadata,{metadata:rt.metadata}),y$3(PropertiesRequiredStatement,{requiredStatement:rt.requiredStatement}),y$3(PropertiesRights,{rights:rt.rights}),y$3(PropertiesHomepage,{homepage:it}),y$3(PropertiesSeeAlso,{seeAlso:ot}),y$3(PropertiesId,{id:rt.id,htmlLabel:"IIIF Manifest"}))):y$3(g$3,null)},InformationPanel=({activeCanvas:et,annotationResources:_e})=>{const tt=useViewerState(),{configOptions:{informationPanel:rt}}=tt,[nt,it]=p$2(),st=rt==null?void 0:rt.renderAbout,ot=rt==null?void 0:rt.renderAnnotation;return _(()=>{st?it("manifest-about"):_e&&(_e==null?void 0:_e.length)>0&&!st&&it(_e[0].id)},[et,st,_e]),y$3(Wrapper$3,{"data-testid":"information-panel",defaultValue:nt,onValueChange:lt=>{it(lt)},orientation:"horizontal",value:nt,className:"clover-viewer-information-panel"},y$3(List,{"aria-label":"select chapter","data-testid":"information-panel-list"},st&&y$3(Trigger$1,{value:"manifest-about"},"About"),ot&&_e&&_e.map((lt,ut)=>y$3(Trigger$1,{key:ut,value:lt.id},y$3(Label$1,{label:lt.label})))),y$3(Scroll,null,st&&y$3(Content$1,{value:"manifest-about"},y$3(About,null)),ot&&_e&&_e.map(lt=>y$3(Content$1,{key:lt.id,value:lt.id},y$3(AnnotationPage,{annotationPage:lt})))))},Form=styled("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),Input=styled("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),Button$1=styled("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),Direction=styled("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),Wrapper$2=styled("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${Form}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),useKeyPress=(et,_e)=>{_(()=>{function tt(rt){rt.key===et&&_e()}return window.addEventListener("keyup",tt),()=>window.removeEventListener("keyup",tt)},[])},PreviousIcon=()=>y$3("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},y$3("title",null,"Arrow Back"),y$3("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),NextIcon=()=>y$3("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},y$3("title",null,"Arrow Forward"),y$3("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),CloseIcon$1=()=>y$3("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},y$3("title",null,"Close"),y$3("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),SearchIcon=()=>y$3("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},y$3("title",null,"Search"),y$3("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),Controls$1=({handleCanvasToggle:et,handleFilter:_e,activeIndex:tt,canvasLength:rt})=>{const[nt,it]=p$2(!1),[st,ot]=p$2(!1),[at,lt]=p$2(!1);_(()=>{lt(tt===0),tt===rt-1?ot(!0):ot(!1)},[tt,rt]),useKeyPress("Escape",()=>{it(!1),_e("")});const ut=()=>{it(dt=>!dt),_e("")};return y$3(Wrapper$2,{isToggle:nt},y$3(Form,null,nt&&y$3(Input,{autoFocus:!0,onChange:dt=>_e(dt.target.value),placeholder:"Search"}),!nt&&y$3(Direction,null,y$3(Button$1,{onClick:()=>et(-1),disabled:at,type:"button"},y$3(PreviousIcon,null)),y$3("span",null,tt+1," of ",rt),y$3(Button$1,{onClick:()=>et(1),disabled:st,type:"button"},y$3(NextIcon,null))),y$3(Button$1,{onClick:ut,type:"button"},y$3(nt?CloseIcon$1:SearchIcon,null))))},Group=styled($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"}),Add=()=>y$3("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),Audio=()=>y$3(g$3,null,y$3("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),y$3("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),y$3("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),Close=()=>y$3("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),Image$1=()=>y$3("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),Video=()=>y$3("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),StyledIcon=styled("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),Title=({children:et})=>y$3("title",null,et),Icon=et=>y$3(StyledIcon,{...et,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},et.children);Icon.Title=Title,Icon.Add=Add,Icon.Audio=Audio,Icon.Close=Close,Icon.Image=Image$1,Icon.Video=Video;function $addc16e1bbe58fd0$export$3a72a57244d6e765(et,_e=globalThis==null?void 0:globalThis.document){const tt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(et);_(()=>{const rt=nt=>{nt.key==="Escape"&&tt(nt)};return _e.addEventListener("keydown",rt),()=>_e.removeEventListener("keydown",rt)},[tt,_e])}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=G$3({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=N$2((et,_e)=>{var tt;const{disableOutsidePointerEvents:rt=!1,onEscapeKeyDown:nt,onPointerDownOutside:it,onFocusOutside:st,onInteractOutside:ot,onDismiss:at,...lt}=et,ut=P$3($5cb92bef7577960e$var$DismissableLayerContext),[ct,dt]=p$2(null),ft=(tt=ct==null?void 0:ct.ownerDocument)!==null&&tt!==void 0?tt:globalThis==null?void 0:globalThis.document,[,pt]=p$2({}),mt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,Ct=>dt(Ct)),ht=Array.from(ut.layers),[gt]=[...ut.layersWithOutsidePointerEventsDisabled].slice(-1),vt=ht.indexOf(gt),yt=ct?ht.indexOf(ct):-1,bt=ut.layersWithOutsidePointerEventsDisabled.size>0,xt=yt>=vt,_t=$5cb92bef7577960e$var$usePointerDownOutside(Ct=>{const kt=Ct.target,At=[...ut.branches].some($t=>$t.contains(kt));!xt||At||(it==null||it(Ct),ot==null||ot(Ct),Ct.defaultPrevented||at==null||at())},ft),wt=$5cb92bef7577960e$var$useFocusOutside(Ct=>{const kt=Ct.target;[...ut.branches].some($t=>$t.contains(kt))||(st==null||st(Ct),ot==null||ot(Ct),Ct.defaultPrevented||at==null||at())},ft);return $addc16e1bbe58fd0$export$3a72a57244d6e765(Ct=>{yt===ut.layers.size-1&&(nt==null||nt(Ct),!Ct.defaultPrevented&&at&&(Ct.preventDefault(),at()))},ft),_(()=>{if(ct)return rt&&(ut.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=ft.body.style.pointerEvents,ft.body.style.pointerEvents="none"),ut.layersWithOutsidePointerEventsDisabled.add(ct)),ut.layers.add(ct),$5cb92bef7577960e$var$dispatchUpdate(),()=>{rt&&ut.layersWithOutsidePointerEventsDisabled.size===1&&(ft.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[ct,ft,rt,ut]),_(()=>()=>{ct&&(ut.layers.delete(ct),ut.layersWithOutsidePointerEventsDisabled.delete(ct),$5cb92bef7577960e$var$dispatchUpdate())},[ct,ut]),_(()=>{const Ct=()=>pt({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Ct),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Ct)},[]),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},lt,{ref:mt,style:{pointerEvents:bt?xt?"auto":"none":void 0,...et.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onFocusCapture,wt.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onBlurCapture,wt.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onPointerDownCapture,_t.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(et,_e=globalThis==null?void 0:globalThis.document){const tt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(et),rt=F$2(!1),nt=F$2(()=>{});return _(()=>{const it=ot=>{if(ot.target&&!rt.current){let lt=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,tt,at,{discrete:!0})};const at={originalEvent:ot};ot.pointerType==="touch"?(_e.removeEventListener("click",nt.current),nt.current=lt,_e.addEventListener("click",nt.current,{once:!0})):lt()}else _e.removeEventListener("click",nt.current);rt.current=!1},st=window.setTimeout(()=>{_e.addEventListener("pointerdown",it)},0);return()=>{window.clearTimeout(st),_e.removeEventListener("pointerdown",it),_e.removeEventListener("click",nt.current)}},[_e,tt]),{onPointerDownCapture:()=>rt.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(et,_e=globalThis==null?void 0:globalThis.document){const tt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(et),rt=F$2(!1);return _(()=>{const nt=it=>{it.target&&!rt.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,tt,{originalEvent:it},{discrete:!1})};return _e.addEventListener("focusin",nt),()=>_e.removeEventListener("focusin",nt)},[_e,tt]),{onFocusCapture:()=>rt.current=!0,onBlurCapture:()=>rt.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const et=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(et)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(et,_e,tt,{discrete:rt}){const nt=tt.originalEvent.target,it=new CustomEvent(et,{bubbles:!1,cancelable:!0,detail:tt});_e&&nt.addEventListener(et,_e,{once:!0}),rt?$8927f6f2acc4f386$export$6d1a0317bde7de7f(nt,it):nt.dispatchEvent(it)}let $3db38b7d1fb3fe6a$var$count=0;function $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(){_(()=>{var et,_e;const tt=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(et=tt[0])!==null&&et!==void 0?et:$3db38b7d1fb3fe6a$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",(_e=tt[1])!==null&&_e!==void 0?_e:$3db38b7d1fb3fe6a$var$createFocusGuard()),$3db38b7d1fb3fe6a$var$count++,()=>{$3db38b7d1fb3fe6a$var$count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(rt=>rt.remove()),$3db38b7d1fb3fe6a$var$count--}},[])}function $3db38b7d1fb3fe6a$var$createFocusGuard(){const et=document.createElement("span");return et.setAttribute("data-radix-focus-guard",""),et.tabIndex=0,et.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",et}const $d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",$d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",$d3863c46a17e8a28$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d3863c46a17e8a28$export$20e40289641fbbb6=N$2((et,_e)=>{const{loop:tt=!1,trapped:rt=!1,onMountAutoFocus:nt,onUnmountAutoFocus:it,...st}=et,[ot,at]=p$2(null),lt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(nt),ut=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(it),ct=F$2(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,mt=>at(mt)),ft=F$2({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_(()=>{if(rt){let mt=function(yt){if(ft.paused||!ot)return;const bt=yt.target;ot.contains(bt)?ct.current=bt:$d3863c46a17e8a28$var$focus(ct.current,{select:!0})},ht=function(yt){if(ft.paused||!ot)return;const bt=yt.relatedTarget;bt!==null&&(ot.contains(bt)||$d3863c46a17e8a28$var$focus(ct.current,{select:!0}))},gt=function(yt){if(document.activeElement===document.body)for(const xt of yt)xt.removedNodes.length>0&&$d3863c46a17e8a28$var$focus(ot)};document.addEventListener("focusin",mt),document.addEventListener("focusout",ht);const vt=new MutationObserver(gt);return ot&&vt.observe(ot,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",mt),document.removeEventListener("focusout",ht),vt.disconnect()}}},[rt,ot,ft.paused]),_(()=>{if(ot){$d3863c46a17e8a28$var$focusScopesStack.add(ft);const mt=document.activeElement;if(!ot.contains(mt)){const gt=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);ot.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,lt),ot.dispatchEvent(gt),gt.defaultPrevented||($d3863c46a17e8a28$var$focusFirst($d3863c46a17e8a28$var$removeLinks($d3863c46a17e8a28$var$getTabbableCandidates(ot)),{select:!0}),document.activeElement===mt&&$d3863c46a17e8a28$var$focus(ot))}return()=>{ot.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,lt),setTimeout(()=>{const gt=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);ot.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,ut),ot.dispatchEvent(gt),gt.defaultPrevented||$d3863c46a17e8a28$var$focus(mt??document.body,{select:!0}),ot.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,ut),$d3863c46a17e8a28$var$focusScopesStack.remove(ft)},0)}}},[ot,lt,ut,ft]);const pt=x$3(mt=>{if(!tt&&!rt||ft.paused)return;const ht=mt.key==="Tab"&&!mt.altKey&&!mt.ctrlKey&&!mt.metaKey,gt=document.activeElement;if(ht&&gt){const vt=mt.currentTarget,[yt,bt]=$d3863c46a17e8a28$var$getTabbableEdges(vt);yt&&bt?!mt.shiftKey&&gt===bt?(mt.preventDefault(),tt&&$d3863c46a17e8a28$var$focus(yt,{select:!0})):mt.shiftKey&&gt===yt&&(mt.preventDefault(),tt&&$d3863c46a17e8a28$var$focus(bt,{select:!0})):gt===vt&&mt.preventDefault()}},[tt,rt,ft.paused]);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:-1},st,{ref:dt,onKeyDown:pt}))});function $d3863c46a17e8a28$var$focusFirst(et,{select:_e=!1}={}){const tt=document.activeElement;for(const rt of et)if($d3863c46a17e8a28$var$focus(rt,{select:_e}),document.activeElement!==tt)return}function $d3863c46a17e8a28$var$getTabbableEdges(et){const _e=$d3863c46a17e8a28$var$getTabbableCandidates(et),tt=$d3863c46a17e8a28$var$findVisible(_e,et),rt=$d3863c46a17e8a28$var$findVisible(_e.reverse(),et);return[tt,rt]}function $d3863c46a17e8a28$var$getTabbableCandidates(et){const _e=[],tt=document.createTreeWalker(et,NodeFilter.SHOW_ELEMENT,{acceptNode:rt=>{const nt=rt.tagName==="INPUT"&&rt.type==="hidden";return rt.disabled||rt.hidden||nt?NodeFilter.FILTER_SKIP:rt.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;tt.nextNode();)_e.push(tt.currentNode);return _e}function $d3863c46a17e8a28$var$findVisible(et,_e){for(const tt of et)if(!$d3863c46a17e8a28$var$isHidden(tt,{upTo:_e}))return tt}function $d3863c46a17e8a28$var$isHidden(et,{upTo:_e}){if(getComputedStyle(et).visibility==="hidden")return!0;for(;et;){if(_e!==void 0&&et===_e)return!1;if(getComputedStyle(et).display==="none")return!0;et=et.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput(et){return et instanceof HTMLInputElement&&"select"in et}function $d3863c46a17e8a28$var$focus(et,{select:_e=!1}={}){if(et&&et.focus){const tt=document.activeElement;et.focus({preventScroll:!0}),et!==tt&&$d3863c46a17e8a28$var$isSelectableInput(et)&&_e&&et.select()}}const $d3863c46a17e8a28$var$focusScopesStack=$d3863c46a17e8a28$var$createFocusScopesStack();function $d3863c46a17e8a28$var$createFocusScopesStack(){let et=[];return{add(_e){const tt=et[0];_e!==tt&&(tt==null||tt.pause()),et=$d3863c46a17e8a28$var$arrayRemove(et,_e),et.unshift(_e)},remove(_e){var tt;et=$d3863c46a17e8a28$var$arrayRemove(et,_e),(tt=et[0])===null||tt===void 0||tt.resume()}}}function $d3863c46a17e8a28$var$arrayRemove(et,_e){const tt=[...et],rt=tt.indexOf(_e);return rt!==-1&&tt.splice(rt,1),tt}function $d3863c46a17e8a28$var$removeLinks(et){return et.filter(_e=>_e.tagName!=="A")}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=et=>({x:et,y:et}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(et,_e,tt){return max(et,min(_e,tt))}function evaluate(et,_e){return typeof et=="function"?et(_e):et}function getSide(et){return et.split("-")[0]}function getAlignment(et){return et.split("-")[1]}function getOppositeAxis(et){return et==="x"?"y":"x"}function getAxisLength(et){return et==="y"?"height":"width"}function getSideAxis(et){return["top","bottom"].includes(getSide(et))?"y":"x"}function getAlignmentAxis(et){return getOppositeAxis(getSideAxis(et))}function getAlignmentSides(et,_e,tt){tt===void 0&&(tt=!1);const rt=getAlignment(et),nt=getAlignmentAxis(et),it=getAxisLength(nt);let st=nt==="x"?rt===(tt?"end":"start")?"right":"left":rt==="start"?"bottom":"top";return _e.reference[it]>_e.floating[it]&&(st=getOppositePlacement(st)),[st,getOppositePlacement(st)]}function getExpandedPlacements(et){const _e=getOppositePlacement(et);return[getOppositeAlignmentPlacement(et),_e,getOppositeAlignmentPlacement(_e)]}function getOppositeAlignmentPlacement(et){return et.replace(/start|end/g,_e=>oppositeAlignmentMap[_e])}function getSideList(et,_e,tt){const rt=["left","right"],nt=["right","left"],it=["top","bottom"],st=["bottom","top"];switch(et){case"top":case"bottom":return tt?_e?nt:rt:_e?rt:nt;case"left":case"right":return _e?it:st;default:return[]}}function getOppositeAxisPlacements(et,_e,tt,rt){const nt=getAlignment(et);let it=getSideList(getSide(et),tt==="start",rt);return nt&&(it=it.map(st=>st+"-"+nt),_e&&(it=it.concat(it.map(getOppositeAlignmentPlacement)))),it}function getOppositePlacement(et){return et.replace(/left|right|bottom|top/g,_e=>oppositeSideMap[_e])}function expandPaddingObject(et){return{top:0,right:0,bottom:0,left:0,...et}}function getPaddingObject(et){return typeof et!="number"?expandPaddingObject(et):{top:et,right:et,bottom:et,left:et}}function rectToClientRect(et){return{...et,top:et.y,left:et.x,right:et.x+et.width,bottom:et.y+et.height}}function computeCoordsFromPlacement(et,_e,tt){let{reference:rt,floating:nt}=et;const it=getSideAxis(_e),st=getAlignmentAxis(_e),ot=getAxisLength(st),at=getSide(_e),lt=it==="y",ut=rt.x+rt.width/2-nt.width/2,ct=rt.y+rt.height/2-nt.height/2,dt=rt[ot]/2-nt[ot]/2;let ft;switch(at){case"top":ft={x:ut,y:rt.y-nt.height};break;case"bottom":ft={x:ut,y:rt.y+rt.height};break;case"right":ft={x:rt.x+rt.width,y:ct};break;case"left":ft={x:rt.x-nt.width,y:ct};break;default:ft={x:rt.x,y:rt.y}}switch(getAlignment(_e)){case"start":ft[st]-=dt*(tt&&lt?-1:1);break;case"end":ft[st]+=dt*(tt&&lt?-1:1);break}return ft}const computePosition$1=async(et,_e,tt)=>{const{placement:rt="bottom",strategy:nt="absolute",middleware:it=[],platform:st}=tt,ot=it.filter(Boolean),at=await(st.isRTL==null?void 0:st.isRTL(_e));let lt=await st.getElementRects({reference:et,floating:_e,strategy:nt}),{x:ut,y:ct}=computeCoordsFromPlacement(lt,rt,at),dt=rt,ft={},pt=0;for(let mt=0;mt<ot.length;mt++){const{name:ht,fn:gt}=ot[mt],{x:vt,y:yt,data:bt,reset:xt}=await gt({x:ut,y:ct,initialPlacement:rt,placement:dt,strategy:nt,middlewareData:ft,rects:lt,platform:st,elements:{reference:et,floating:_e}});ut=vt??ut,ct=yt??ct,ft={...ft,[ht]:{...ft[ht],...bt}},xt&&pt<=50&&(pt++,typeof xt=="object"&&(xt.placement&&(dt=xt.placement),xt.rects&&(lt=xt.rects===!0?await st.getElementRects({reference:et,floating:_e,strategy:nt}):xt.rects),{x:ut,y:ct}=computeCoordsFromPlacement(lt,dt,at)),mt=-1)}return{x:ut,y:ct,placement:dt,strategy:nt,middlewareData:ft}};async function detectOverflow(et,_e){var tt;_e===void 0&&(_e={});const{x:rt,y:nt,platform:it,rects:st,elements:ot,strategy:at}=et,{boundary:lt="clippingAncestors",rootBoundary:ut="viewport",elementContext:ct="floating",altBoundary:dt=!1,padding:ft=0}=evaluate(_e,et),pt=getPaddingObject(ft),ht=ot[dt?ct==="floating"?"reference":"floating":ct],gt=rectToClientRect(await it.getClippingRect({element:(tt=await(it.isElement==null?void 0:it.isElement(ht)))==null||tt?ht:ht.contextElement||await(it.getDocumentElement==null?void 0:it.getDocumentElement(ot.floating)),boundary:lt,rootBoundary:ut,strategy:at})),vt=ct==="floating"?{...st.floating,x:rt,y:nt}:st.reference,yt=await(it.getOffsetParent==null?void 0:it.getOffsetParent(ot.floating)),bt=await(it.isElement==null?void 0:it.isElement(yt))?await(it.getScale==null?void 0:it.getScale(yt))||{x:1,y:1}:{x:1,y:1},xt=rectToClientRect(it.convertOffsetParentRelativeRectToViewportRelativeRect?await it.convertOffsetParentRelativeRectToViewportRelativeRect({elements:ot,rect:vt,offsetParent:yt,strategy:at}):vt);return{top:(gt.top-xt.top+pt.top)/bt.y,bottom:(xt.bottom-gt.bottom+pt.bottom)/bt.y,left:(gt.left-xt.left+pt.left)/bt.x,right:(xt.right-gt.right+pt.right)/bt.x}}const arrow$2=et=>({name:"arrow",options:et,async fn(_e){const{x:tt,y:rt,placement:nt,rects:it,platform:st,elements:ot,middlewareData:at}=_e,{element:lt,padding:ut=0}=evaluate(et,_e)||{};if(lt==null)return{};const ct=getPaddingObject(ut),dt={x:tt,y:rt},ft=getAlignmentAxis(nt),pt=getAxisLength(ft),mt=await st.getDimensions(lt),ht=ft==="y",gt=ht?"top":"left",vt=ht?"bottom":"right",yt=ht?"clientHeight":"clientWidth",bt=it.reference[pt]+it.reference[ft]-dt[ft]-it.floating[pt],xt=dt[ft]-it.reference[ft],_t=await(st.getOffsetParent==null?void 0:st.getOffsetParent(lt));let wt=_t?_t[yt]:0;(!wt||!await(st.isElement==null?void 0:st.isElement(_t)))&&(wt=ot.floating[yt]||it.floating[pt]);const Ct=bt/2-xt/2,kt=wt/2-mt[pt]/2-1,At=min(ct[gt],kt),$t=min(ct[vt],kt),Lt=At,Mt=wt-mt[pt]-$t,Bt=wt/2-mt[pt]/2+Ct,Pt=clamp(Lt,Bt,Mt),Nt=!at.arrow&&getAlignment(nt)!=null&&Bt!==Pt&&it.reference[pt]/2-(Bt<Lt?At:$t)-mt[pt]/2<0,It=Nt?Bt<Lt?Bt-Lt:Bt-Mt:0;return{[ft]:dt[ft]+It,data:{[ft]:Pt,centerOffset:Bt-Pt-It,...Nt&&{alignmentOffset:It}},reset:Nt}}}),flip$1=function(et){return et===void 0&&(et={}),{name:"flip",options:et,async fn(_e){var tt,rt;const{placement:nt,middlewareData:it,rects:st,initialPlacement:ot,platform:at,elements:lt}=_e,{mainAxis:ut=!0,crossAxis:ct=!0,fallbackPlacements:dt,fallbackStrategy:ft="bestFit",fallbackAxisSideDirection:pt="none",flipAlignment:mt=!0,...ht}=evaluate(et,_e);if((tt=it.arrow)!=null&&tt.alignmentOffset)return{};const gt=getSide(nt),vt=getSide(ot)===ot,yt=await(at.isRTL==null?void 0:at.isRTL(lt.floating)),bt=dt||(vt||!mt?[getOppositePlacement(ot)]:getExpandedPlacements(ot));!dt&&pt!=="none"&&bt.push(...getOppositeAxisPlacements(ot,mt,pt,yt));const xt=[ot,...bt],_t=await detectOverflow(_e,ht),wt=[];let Ct=((rt=it.flip)==null?void 0:rt.overflows)||[];if(ut&&wt.push(_t[gt]),ct){const Lt=getAlignmentSides(nt,st,yt);wt.push(_t[Lt[0]],_t[Lt[1]])}if(Ct=[...Ct,{placement:nt,overflows:wt}],!wt.every(Lt=>Lt<=0)){var kt,At;const Lt=(((kt=it.flip)==null?void 0:kt.index)||0)+1,Mt=xt[Lt];if(Mt)return{data:{index:Lt,overflows:Ct},reset:{placement:Mt}};let Bt=(At=Ct.filter(Pt=>Pt.overflows[0]<=0).sort((Pt,Nt)=>Pt.overflows[1]-Nt.overflows[1])[0])==null?void 0:At.placement;if(!Bt)switch(ft){case"bestFit":{var $t;const Pt=($t=Ct.map(Nt=>[Nt.placement,Nt.overflows.filter(It=>It>0).reduce((It,Ft)=>It+Ft,0)]).sort((Nt,It)=>Nt[1]-It[1])[0])==null?void 0:$t[0];Pt&&(Bt=Pt);break}case"initialPlacement":Bt=ot;break}if(nt!==Bt)return{reset:{placement:Bt}}}return{}}}};function getSideOffsets(et,_e){return{top:et.top-_e.height,right:et.right-_e.width,bottom:et.bottom-_e.height,left:et.left-_e.width}}function isAnySideFullyClipped(et){return sides.some(_e=>et[_e]>=0)}const hide$1=function(et){return et===void 0&&(et={}),{name:"hide",options:et,async fn(_e){const{rects:tt}=_e,{strategy:rt="referenceHidden",...nt}=evaluate(et,_e);switch(rt){case"referenceHidden":{const it=await detectOverflow(_e,{...nt,elementContext:"reference"}),st=getSideOffsets(it,tt.reference);return{data:{referenceHiddenOffsets:st,referenceHidden:isAnySideFullyClipped(st)}}}case"escaped":{const it=await detectOverflow(_e,{...nt,altBoundary:!0}),st=getSideOffsets(it,tt.floating);return{data:{escapedOffsets:st,escaped:isAnySideFullyClipped(st)}}}default:return{}}}}};async function convertValueToCoords(et,_e){const{placement:tt,platform:rt,elements:nt}=et,it=await(rt.isRTL==null?void 0:rt.isRTL(nt.floating)),st=getSide(tt),ot=getAlignment(tt),at=getSideAxis(tt)==="y",lt=["left","top"].includes(st)?-1:1,ut=it&&at?-1:1,ct=evaluate(_e,et);let{mainAxis:dt,crossAxis:ft,alignmentAxis:pt}=typeof ct=="number"?{mainAxis:ct,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...ct};return ot&&typeof pt=="number"&&(ft=ot==="end"?pt*-1:pt),at?{x:ft*ut,y:dt*lt}:{x:dt*lt,y:ft*ut}}const offset=function(et){return et===void 0&&(et=0),{name:"offset",options:et,async fn(_e){var tt,rt;const{x:nt,y:it,placement:st,middlewareData:ot}=_e,at=await convertValueToCoords(_e,et);return st===((tt=ot.offset)==null?void 0:tt.placement)&&(rt=ot.arrow)!=null&&rt.alignmentOffset?{}:{x:nt+at.x,y:it+at.y,data:{...at,placement:st}}}}},shift$1=function(et){return et===void 0&&(et={}),{name:"shift",options:et,async fn(_e){const{x:tt,y:rt,placement:nt}=_e,{mainAxis:it=!0,crossAxis:st=!1,limiter:ot={fn:ht=>{let{x:gt,y:vt}=ht;return{x:gt,y:vt}}},...at}=evaluate(et,_e),lt={x:tt,y:rt},ut=await detectOverflow(_e,at),ct=getSideAxis(getSide(nt)),dt=getOppositeAxis(ct);let ft=lt[dt],pt=lt[ct];if(it){const ht=dt==="y"?"top":"left",gt=dt==="y"?"bottom":"right",vt=ft+ut[ht],yt=ft-ut[gt];ft=clamp(vt,ft,yt)}if(st){const ht=ct==="y"?"top":"left",gt=ct==="y"?"bottom":"right",vt=pt+ut[ht],yt=pt-ut[gt];pt=clamp(vt,pt,yt)}const mt=ot.fn({..._e,[dt]:ft,[ct]:pt});return{...mt,data:{x:mt.x-tt,y:mt.y-rt}}}}},limitShift$1=function(et){return et===void 0&&(et={}),{options:et,fn(_e){const{x:tt,y:rt,placement:nt,rects:it,middlewareData:st}=_e,{offset:ot=0,mainAxis:at=!0,crossAxis:lt=!0}=evaluate(et,_e),ut={x:tt,y:rt},ct=getSideAxis(nt),dt=getOppositeAxis(ct);let ft=ut[dt],pt=ut[ct];const mt=evaluate(ot,_e),ht=typeof mt=="number"?{mainAxis:mt,crossAxis:0}:{mainAxis:0,crossAxis:0,...mt};if(at){const yt=dt==="y"?"height":"width",bt=it.reference[dt]-it.floating[yt]+ht.mainAxis,xt=it.reference[dt]+it.reference[yt]-ht.mainAxis;ft<bt?ft=bt:ft>xt&&(ft=xt)}if(lt){var gt,vt;const yt=dt==="y"?"width":"height",bt=["top","left"].includes(getSide(nt)),xt=it.reference[ct]-it.floating[yt]+(bt&&((gt=st.offset)==null?void 0:gt[ct])||0)+(bt?0:ht.crossAxis),_t=it.reference[ct]+it.reference[yt]+(bt?0:((vt=st.offset)==null?void 0:vt[ct])||0)-(bt?ht.crossAxis:0);pt<xt?pt=xt:pt>_t&&(pt=_t)}return{[dt]:ft,[ct]:pt}}}},size$1=function(et){return et===void 0&&(et={}),{name:"size",options:et,async fn(_e){const{placement:tt,rects:rt,platform:nt,elements:it}=_e,{apply:st=()=>{},...ot}=evaluate(et,_e),at=await detectOverflow(_e,ot),lt=getSide(tt),ut=getAlignment(tt),ct=getSideAxis(tt)==="y",{width:dt,height:ft}=rt.floating;let pt,mt;lt==="top"||lt==="bottom"?(pt=lt,mt=ut===(await(nt.isRTL==null?void 0:nt.isRTL(it.floating))?"start":"end")?"left":"right"):(mt=lt,pt=ut==="end"?"top":"bottom");const ht=ft-at[pt],gt=dt-at[mt],vt=!_e.middlewareData.shift;let yt=ht,bt=gt;if(ct){const _t=dt-at.left-at.right;bt=ut||vt?min(gt,_t):_t}else{const _t=ft-at.top-at.bottom;yt=ut||vt?min(ht,_t):_t}if(vt&&!ut){const _t=max(at.left,0),wt=max(at.right,0),Ct=max(at.top,0),kt=max(at.bottom,0);ct?bt=dt-2*(_t!==0||wt!==0?_t+wt:max(at.left,at.right)):yt=ft-2*(Ct!==0||kt!==0?Ct+kt:max(at.top,at.bottom))}await st({..._e,availableWidth:bt,availableHeight:yt});const xt=await nt.getDimensions(it.floating);return dt!==xt.width||ft!==xt.height?{reset:{rects:!0}}:{}}}};function getNodeName(et){return isNode(et)?(et.nodeName||"").toLowerCase():"#document"}function getWindow(et){var _e;return(et==null||(_e=et.ownerDocument)==null?void 0:_e.defaultView)||window}function getDocumentElement(et){var _e;return(_e=(isNode(et)?et.ownerDocument:et.document)||window.document)==null?void 0:_e.documentElement}function isNode(et){return et instanceof Node||et instanceof getWindow(et).Node}function isElement(et){return et instanceof Element||et instanceof getWindow(et).Element}function isHTMLElement(et){return et instanceof HTMLElement||et instanceof getWindow(et).HTMLElement}function isShadowRoot(et){return typeof ShadowRoot>"u"?!1:et instanceof ShadowRoot||et instanceof getWindow(et).ShadowRoot}function isOverflowElement(et){const{overflow:_e,overflowX:tt,overflowY:rt,display:nt}=getComputedStyle$1(et);return/auto|scroll|overlay|hidden|clip/.test(_e+rt+tt)&&!["inline","contents"].includes(nt)}function isTableElement(et){return["table","td","th"].includes(getNodeName(et))}function isContainingBlock(et){const _e=isWebKit(),tt=getComputedStyle$1(et);return tt.transform!=="none"||tt.perspective!=="none"||(tt.containerType?tt.containerType!=="normal":!1)||!_e&&(tt.backdropFilter?tt.backdropFilter!=="none":!1)||!_e&&(tt.filter?tt.filter!=="none":!1)||["transform","perspective","filter"].some(rt=>(tt.willChange||"").includes(rt))||["paint","layout","strict","content"].some(rt=>(tt.contain||"").includes(rt))}function getContainingBlock(et){let _e=getParentNode(et);for(;isHTMLElement(_e)&&!isLastTraversableNode(_e);){if(isContainingBlock(_e))return _e;_e=getParentNode(_e)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(et){return["html","body","#document"].includes(getNodeName(et))}function getComputedStyle$1(et){return getWindow(et).getComputedStyle(et)}function getNodeScroll(et){return isElement(et)?{scrollLeft:et.scrollLeft,scrollTop:et.scrollTop}:{scrollLeft:et.pageXOffset,scrollTop:et.pageYOffset}}function getParentNode(et){if(getNodeName(et)==="html")return et;const _e=et.assignedSlot||et.parentNode||isShadowRoot(et)&&et.host||getDocumentElement(et);return isShadowRoot(_e)?_e.host:_e}function getNearestOverflowAncestor(et){const _e=getParentNode(et);return isLastTraversableNode(_e)?et.ownerDocument?et.ownerDocument.body:et.body:isHTMLElement(_e)&&isOverflowElement(_e)?_e:getNearestOverflowAncestor(_e)}function getOverflowAncestors(et,_e,tt){var rt;_e===void 0&&(_e=[]),tt===void 0&&(tt=!0);const nt=getNearestOverflowAncestor(et),it=nt===((rt=et.ownerDocument)==null?void 0:rt.body),st=getWindow(nt);return it?_e.concat(st,st.visualViewport||[],isOverflowElement(nt)?nt:[],st.frameElement&&tt?getOverflowAncestors(st.frameElement):[]):_e.concat(nt,getOverflowAncestors(nt,[],tt))}function getCssDimensions(et){const _e=getComputedStyle$1(et);let tt=parseFloat(_e.width)||0,rt=parseFloat(_e.height)||0;const nt=isHTMLElement(et),it=nt?et.offsetWidth:tt,st=nt?et.offsetHeight:rt,ot=round(tt)!==it||round(rt)!==st;return ot&&(tt=it,rt=st),{width:tt,height:rt,$:ot}}function unwrapElement(et){return isElement(et)?et:et.contextElement}function getScale(et){const _e=unwrapElement(et);if(!isHTMLElement(_e))return createCoords(1);const tt=_e.getBoundingClientRect(),{width:rt,height:nt,$:it}=getCssDimensions(_e);let st=(it?round(tt.width):tt.width)/rt,ot=(it?round(tt.height):tt.height)/nt;return(!st||!Number.isFinite(st))&&(st=1),(!ot||!Number.isFinite(ot))&&(ot=1),{x:st,y:ot}}const noOffsets=createCoords(0);function getVisualOffsets(et){const _e=getWindow(et);return!isWebKit()||!_e.visualViewport?noOffsets:{x:_e.visualViewport.offsetLeft,y:_e.visualViewport.offsetTop}}function shouldAddVisualOffsets(et,_e,tt){return _e===void 0&&(_e=!1),!tt||_e&&tt!==getWindow(et)?!1:_e}function getBoundingClientRect(et,_e,tt,rt){_e===void 0&&(_e=!1),tt===void 0&&(tt=!1);const nt=et.getBoundingClientRect(),it=unwrapElement(et);let st=createCoords(1);_e&&(rt?isElement(rt)&&(st=getScale(rt)):st=getScale(et));const ot=shouldAddVisualOffsets(it,tt,rt)?getVisualOffsets(it):createCoords(0);let at=(nt.left+ot.x)/st.x,lt=(nt.top+ot.y)/st.y,ut=nt.width/st.x,ct=nt.height/st.y;if(it){const dt=getWindow(it),ft=rt&&isElement(rt)?getWindow(rt):rt;let pt=dt,mt=pt.frameElement;for(;mt&&rt&&ft!==pt;){const ht=getScale(mt),gt=mt.getBoundingClientRect(),vt=getComputedStyle$1(mt),yt=gt.left+(mt.clientLeft+parseFloat(vt.paddingLeft))*ht.x,bt=gt.top+(mt.clientTop+parseFloat(vt.paddingTop))*ht.y;at*=ht.x,lt*=ht.y,ut*=ht.x,ct*=ht.y,at+=yt,lt+=bt,pt=getWindow(mt),mt=pt.frameElement}}return rectToClientRect({width:ut,height:ct,x:at,y:lt})}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(et){return topLayerSelectors.some(_e=>{try{return et.matches(_e)}catch{return!1}})}function convertOffsetParentRelativeRectToViewportRelativeRect(et){let{elements:_e,rect:tt,offsetParent:rt,strategy:nt}=et;const it=nt==="fixed",st=getDocumentElement(rt),ot=_e?isTopLayer(_e.floating):!1;if(rt===st||ot&&it)return tt;let at={scrollLeft:0,scrollTop:0},lt=createCoords(1);const ut=createCoords(0),ct=isHTMLElement(rt);if((ct||!ct&&!it)&&((getNodeName(rt)!=="body"||isOverflowElement(st))&&(at=getNodeScroll(rt)),isHTMLElement(rt))){const dt=getBoundingClientRect(rt);lt=getScale(rt),ut.x=dt.x+rt.clientLeft,ut.y=dt.y+rt.clientTop}return{width:tt.width*lt.x,height:tt.height*lt.y,x:tt.x*lt.x-at.scrollLeft*lt.x+ut.x,y:tt.y*lt.y-at.scrollTop*lt.y+ut.y}}function getClientRects(et){return Array.from(et.getClientRects())}function getWindowScrollBarX(et){return getBoundingClientRect(getDocumentElement(et)).left+getNodeScroll(et).scrollLeft}function getDocumentRect(et){const _e=getDocumentElement(et),tt=getNodeScroll(et),rt=et.ownerDocument.body,nt=max(_e.scrollWidth,_e.clientWidth,rt.scrollWidth,rt.clientWidth),it=max(_e.scrollHeight,_e.clientHeight,rt.scrollHeight,rt.clientHeight);let st=-tt.scrollLeft+getWindowScrollBarX(et);const ot=-tt.scrollTop;return getComputedStyle$1(rt).direction==="rtl"&&(st+=max(_e.clientWidth,rt.clientWidth)-nt),{width:nt,height:it,x:st,y:ot}}function getViewportRect(et,_e){const tt=getWindow(et),rt=getDocumentElement(et),nt=tt.visualViewport;let it=rt.clientWidth,st=rt.clientHeight,ot=0,at=0;if(nt){it=nt.width,st=nt.height;const lt=isWebKit();(!lt||lt&&_e==="fixed")&&(ot=nt.offsetLeft,at=nt.offsetTop)}return{width:it,height:st,x:ot,y:at}}function getInnerBoundingClientRect(et,_e){const tt=getBoundingClientRect(et,!0,_e==="fixed"),rt=tt.top+et.clientTop,nt=tt.left+et.clientLeft,it=isHTMLElement(et)?getScale(et):createCoords(1),st=et.clientWidth*it.x,ot=et.clientHeight*it.y,at=nt*it.x,lt=rt*it.y;return{width:st,height:ot,x:at,y:lt}}function getClientRectFromClippingAncestor(et,_e,tt){let rt;if(_e==="viewport")rt=getViewportRect(et,tt);else if(_e==="document")rt=getDocumentRect(getDocumentElement(et));else if(isElement(_e))rt=getInnerBoundingClientRect(_e,tt);else{const nt=getVisualOffsets(et);rt={..._e,x:_e.x-nt.x,y:_e.y-nt.y}}return rectToClientRect(rt)}function hasFixedPositionAncestor(et,_e){const tt=getParentNode(et);return tt===_e||!isElement(tt)||isLastTraversableNode(tt)?!1:getComputedStyle$1(tt).position==="fixed"||hasFixedPositionAncestor(tt,_e)}function getClippingElementAncestors(et,_e){const tt=_e.get(et);if(tt)return tt;let rt=getOverflowAncestors(et,[],!1).filter(ot=>isElement(ot)&&getNodeName(ot)!=="body"),nt=null;const it=getComputedStyle$1(et).position==="fixed";let st=it?getParentNode(et):et;for(;isElement(st)&&!isLastTraversableNode(st);){const ot=getComputedStyle$1(st),at=isContainingBlock(st);!at&&ot.position==="fixed"&&(nt=null),(it?!at&&!nt:!at&&ot.position==="static"&&!!nt&&["absolute","fixed"].includes(nt.position)||isOverflowElement(st)&&!at&&hasFixedPositionAncestor(et,st))?rt=rt.filter(ut=>ut!==st):nt=ot,st=getParentNode(st)}return _e.set(et,rt),rt}function getClippingRect(et){let{element:_e,boundary:tt,rootBoundary:rt,strategy:nt}=et;const st=[...tt==="clippingAncestors"?getClippingElementAncestors(_e,this._c):[].concat(tt),rt],ot=st[0],at=st.reduce((lt,ut)=>{const ct=getClientRectFromClippingAncestor(_e,ut,nt);return lt.top=max(ct.top,lt.top),lt.right=min(ct.right,lt.right),lt.bottom=min(ct.bottom,lt.bottom),lt.left=max(ct.left,lt.left),lt},getClientRectFromClippingAncestor(_e,ot,nt));return{width:at.right-at.left,height:at.bottom-at.top,x:at.left,y:at.top}}function getDimensions(et){const{width:_e,height:tt}=getCssDimensions(et);return{width:_e,height:tt}}function getRectRelativeToOffsetParent(et,_e,tt){const rt=isHTMLElement(_e),nt=getDocumentElement(_e),it=tt==="fixed",st=getBoundingClientRect(et,!0,it,_e);let ot={scrollLeft:0,scrollTop:0};const at=createCoords(0);if(rt||!rt&&!it)if((getNodeName(_e)!=="body"||isOverflowElement(nt))&&(ot=getNodeScroll(_e)),rt){const ct=getBoundingClientRect(_e,!0,it,_e);at.x=ct.x+_e.clientLeft,at.y=ct.y+_e.clientTop}else nt&&(at.x=getWindowScrollBarX(nt));const lt=st.left+ot.scrollLeft-at.x,ut=st.top+ot.scrollTop-at.y;return{x:lt,y:ut,width:st.width,height:st.height}}function getTrueOffsetParent(et,_e){return!isHTMLElement(et)||getComputedStyle$1(et).position==="fixed"?null:_e?_e(et):et.offsetParent}function getOffsetParent(et,_e){const tt=getWindow(et);if(!isHTMLElement(et)||isTopLayer(et))return tt;let rt=getTrueOffsetParent(et,_e);for(;rt&&isTableElement(rt)&&getComputedStyle$1(rt).position==="static";)rt=getTrueOffsetParent(rt,_e);return rt&&(getNodeName(rt)==="html"||getNodeName(rt)==="body"&&getComputedStyle$1(rt).position==="static"&&!isContainingBlock(rt))?tt:rt||getContainingBlock(et)||tt}const getElementRects=async function(et){const _e=this.getOffsetParent||getOffsetParent,tt=this.getDimensions;return{reference:getRectRelativeToOffsetParent(et.reference,await _e(et.floating),et.strategy),floating:{x:0,y:0,...await tt(et.floating)}}};function isRTL(et){return getComputedStyle$1(et).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(et,_e){let tt=null,rt;const nt=getDocumentElement(et);function it(){var ot;clearTimeout(rt),(ot=tt)==null||ot.disconnect(),tt=null}function st(ot,at){ot===void 0&&(ot=!1),at===void 0&&(at=1),it();const{left:lt,top:ut,width:ct,height:dt}=et.getBoundingClientRect();if(ot||_e(),!ct||!dt)return;const ft=floor(ut),pt=floor(nt.clientWidth-(lt+ct)),mt=floor(nt.clientHeight-(ut+dt)),ht=floor(lt),vt={rootMargin:-ft+"px "+-pt+"px "+-mt+"px "+-ht+"px",threshold:max(0,min(1,at))||1};let yt=!0;function bt(xt){const _t=xt[0].intersectionRatio;if(_t!==at){if(!yt)return st();_t?st(!1,_t):rt=setTimeout(()=>{st(!1,1e-7)},100)}yt=!1}try{tt=new IntersectionObserver(bt,{...vt,root:nt.ownerDocument})}catch{tt=new IntersectionObserver(bt,vt)}tt.observe(et)}return st(!0),it}function autoUpdate(et,_e,tt,rt){rt===void 0&&(rt={});const{ancestorScroll:nt=!0,ancestorResize:it=!0,elementResize:st=typeof ResizeObserver=="function",layoutShift:ot=typeof IntersectionObserver=="function",animationFrame:at=!1}=rt,lt=unwrapElement(et),ut=nt||it?[...lt?getOverflowAncestors(lt):[],...getOverflowAncestors(_e)]:[];ut.forEach(gt=>{nt&&gt.addEventListener("scroll",tt,{passive:!0}),it&&gt.addEventListener("resize",tt)});const ct=lt&&ot?observeMove(lt,tt):null;let dt=-1,ft=null;st&&(ft=new ResizeObserver(gt=>{let[vt]=gt;vt&&vt.target===lt&&ft&&(ft.unobserve(_e),cancelAnimationFrame(dt),dt=requestAnimationFrame(()=>{var yt;(yt=ft)==null||yt.observe(_e)})),tt()}),lt&&!at&&ft.observe(lt),ft.observe(_e));let pt,mt=at?getBoundingClientRect(et):null;at&&ht();function ht(){const gt=getBoundingClientRect(et);mt&&(gt.x!==mt.x||gt.y!==mt.y||gt.width!==mt.width||gt.height!==mt.height)&&tt(),mt=gt,pt=requestAnimationFrame(ht)}return tt(),()=>{var gt;ut.forEach(vt=>{nt&&vt.removeEventListener("scroll",tt),it&&vt.removeEventListener("resize",tt)}),ct==null||ct(),(gt=ft)==null||gt.disconnect(),ft=null,at&&cancelAnimationFrame(pt)}}const shift=shift$1,flip=flip$1,size=size$1,hide=hide$1,arrow$1=arrow$2,limitShift=limitShift$1,computePosition=(et,_e,tt)=>{const rt=new Map,nt={platform,...tt},it={...nt.platform,_c:rt};return computePosition$1(et,_e,{...nt,platform:it})},arrow=et=>{function _e(tt){return{}.hasOwnProperty.call(tt,"current")}return{name:"arrow",options:et,fn(tt){const{element:rt,padding:nt}=typeof et=="function"?et(tt):et;return rt&&_e(rt)?rt.current!=null?arrow$1({element:rt.current,padding:nt}).fn(tt):{}:rt?arrow$1({element:rt,padding:nt}).fn(tt):{}}}};var index=typeof document<"u"?A$3:_;function deepEqual(et,_e){if(et===_e)return!0;if(typeof et!=typeof _e)return!1;if(typeof et=="function"&&et.toString()===_e.toString())return!0;let tt,rt,nt;if(et&&_e&&typeof et=="object"){if(Array.isArray(et)){if(tt=et.length,tt!==_e.length)return!1;for(rt=tt;rt--!==0;)if(!deepEqual(et[rt],_e[rt]))return!1;return!0}if(nt=Object.keys(et),tt=nt.length,tt!==Object.keys(_e).length)return!1;for(rt=tt;rt--!==0;)if(!{}.hasOwnProperty.call(_e,nt[rt]))return!1;for(rt=tt;rt--!==0;){const it=nt[rt];if(!(it==="_owner"&&et.$$typeof)&&!deepEqual(et[it],_e[it]))return!1}return!0}return et!==et&&_e!==_e}function getDPR(et){return typeof window>"u"?1:(et.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(et,_e){const tt=getDPR(et);return Math.round(_e*tt)/tt}function useLatestRef(et){const _e=F$2(et);return index(()=>{_e.current=et}),_e}function useFloating(et){et===void 0&&(et={});const{placement:_e="bottom",strategy:tt="absolute",middleware:rt=[],platform:nt,elements:{reference:it,floating:st}={},transform:ot=!0,whileElementsMounted:at,open:lt}=et,[ut,ct]=p$2({x:0,y:0,strategy:tt,placement:_e,middlewareData:{},isPositioned:!1}),[dt,ft]=p$2(rt);deepEqual(dt,rt)||ft(rt);const[pt,mt]=p$2(null),[ht,gt]=p$2(null),vt=x$3(It=>{It!==_t.current&&(_t.current=It,mt(It))},[]),yt=x$3(It=>{It!==wt.current&&(wt.current=It,gt(It))},[]),bt=it||pt,xt=st||ht,_t=F$2(null),wt=F$2(null),Ct=F$2(ut),kt=at!=null,At=useLatestRef(at),$t=useLatestRef(nt),Lt=x$3(()=>{if(!_t.current||!wt.current)return;const It={placement:_e,strategy:tt,middleware:dt};$t.current&&(It.platform=$t.current),computePosition(_t.current,wt.current,It).then(Ft=>{const Ut={...Ft,isPositioned:!0};Mt.current&&!deepEqual(Ct.current,Ut)&&(Ct.current=Ut,reactDomExports.flushSync(()=>{ct(Ut)}))})},[dt,_e,tt,$t]);index(()=>{lt===!1&&Ct.current.isPositioned&&(Ct.current.isPositioned=!1,ct(It=>({...It,isPositioned:!1})))},[lt]);const Mt=F$2(!1);index(()=>(Mt.current=!0,()=>{Mt.current=!1}),[]),index(()=>{if(bt&&(_t.current=bt),xt&&(wt.current=xt),bt&&xt){if(At.current)return At.current(bt,xt,Lt);Lt()}},[bt,xt,Lt,At,kt]);const Bt=q$2(()=>({reference:_t,floating:wt,setReference:vt,setFloating:yt}),[vt,yt]),Pt=q$2(()=>({reference:bt,floating:xt}),[bt,xt]),Nt=q$2(()=>{const It={position:tt,left:0,top:0};if(!Pt.floating)return It;const Ft=roundByDPR(Pt.floating,ut.x),Ut=roundByDPR(Pt.floating,ut.y);return ot?{...It,transform:"translate("+Ft+"px, "+Ut+"px)",...getDPR(Pt.floating)>=1.5&&{willChange:"transform"}}:{position:tt,left:Ft,top:Ut}},[tt,ot,Pt.floating,ut.x,ut.y]);return q$2(()=>({...ut,update:Lt,refs:Bt,elements:Pt,floatingStyles:Nt}),[ut,Lt,Bt,Pt,Nt])}const $7e8f5cd07187803e$export$21b07c8f274aebd5=N$2((et,_e)=>{const{children:tt,width:rt=10,height:nt=5,...it}=et;return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$1({},it,{ref:_e,width:rt,height:nt,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),et.asChild?tt:y$3("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5,$cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=et=>{const{__scopePopper:_e,children:tt}=et,[rt,nt]=p$2(null);return y$3($cf1ac5d9fe0e8206$var$PopperProvider,{scope:_e,anchor:rt,onAnchorChange:nt},tt)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=N$2((et,_e)=>{const{__scopePopper:tt,virtualRef:rt,...nt}=et,it=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,tt),st=F$2(null),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,st);return _(()=>{it.onAnchorChange((rt==null?void 0:rt.current)||st.current)}),rt?null:y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},nt,{ref:ot}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=N$2((et,_e)=>{var tt,rt,nt,it,st,ot,at,lt;const{__scopePopper:ut,side:ct="bottom",sideOffset:dt=0,align:ft="center",alignOffset:pt=0,arrowPadding:mt=0,avoidCollisions:ht=!0,collisionBoundary:gt=[],collisionPadding:vt=0,sticky:yt="partial",hideWhenDetached:bt=!1,updatePositionStrategy:xt="optimized",onPlaced:_t,...wt}=et,Ct=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,ut),[kt,At]=p$2(null),$t=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,Vt=>At(Vt)),[Lt,Mt]=p$2(null),Bt=$db6c3485150b8e66$export$1ab7ae714698c4b8(Lt),Pt=(tt=Bt==null?void 0:Bt.width)!==null&&tt!==void 0?tt:0,Nt=(rt=Bt==null?void 0:Bt.height)!==null&&rt!==void 0?rt:0,It=ct+(ft!=="center"?"-"+ft:""),Ft=typeof vt=="number"?vt:{top:0,right:0,bottom:0,left:0,...vt},Ut=Array.isArray(gt)?gt:[gt],Ht=Ut.length>0,jt={padding:Ft,boundary:Ut.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:Ht},{refs:Gt,floatingStyles:tr,placement:Yt,isPositioned:Jt,middlewareData:rr}=useFloating({strategy:"fixed",placement:It,whileElementsMounted:(...Vt)=>autoUpdate(...Vt,{animationFrame:xt==="always"}),elements:{reference:Ct.anchor},middleware:[offset({mainAxis:dt+Nt,alignmentAxis:pt}),ht&&shift({mainAxis:!0,crossAxis:!1,limiter:yt==="partial"?limitShift():void 0,...jt}),ht&&flip({...jt}),size({...jt,apply:({elements:Vt,rects:zt,availableWidth:Wt,availableHeight:ar})=>{const{width:Qt,height:mr}=zt.reference,gr=Vt.floating.style;gr.setProperty("--radix-popper-available-width",`${Wt}px`),gr.setProperty("--radix-popper-available-height",`${ar}px`),gr.setProperty("--radix-popper-anchor-width",`${Qt}px`),gr.setProperty("--radix-popper-anchor-height",`${mr}px`)}}),Lt&&arrow({element:Lt,padding:mt}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:Pt,arrowHeight:Nt}),bt&&hide({strategy:"referenceHidden",...jt})]}),[qt,nr]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Yt),vr=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_t);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Jt&&(vr==null||vr())},[Jt,vr]);const fr=(nt=rr.arrow)===null||nt===void 0?void 0:nt.x,hr=(it=rr.arrow)===null||it===void 0?void 0:it.y,pr=((st=rr.arrow)===null||st===void 0?void 0:st.centerOffset)!==0,[Et,Rt]=p$2();return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{kt&&Rt(window.getComputedStyle(kt).zIndex)},[kt]),y$3("div",{ref:Gt.setFloating,"data-radix-popper-content-wrapper":"",style:{...tr,transform:Jt?tr.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Et,"--radix-popper-transform-origin":[(ot=rr.transformOrigin)===null||ot===void 0?void 0:ot.x,(at=rr.transformOrigin)===null||at===void 0?void 0:at.y].join(" ")},dir:et.dir},y$3($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:ut,placedSide:qt,onArrowChange:Mt,arrowX:fr,arrowY:hr,shouldHideArrow:pr},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-side":qt,"data-align":nr},wt,{ref:$t,style:{...wt.style,animation:Jt?void 0:"none",opacity:(lt=rr.hide)!==null&&lt!==void 0&&lt.referenceHidden?0:void 0}}))))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=N$2(function et(_e,tt){const{__scopePopper:rt,...nt}=_e,it=$cf1ac5d9fe0e8206$var$useContentContext($cf1ac5d9fe0e8206$var$ARROW_NAME,rt),st=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[it.placedSide];return y$3("span",{ref:it.onArrowChange,style:{position:"absolute",left:it.arrowX,top:it.arrowY,[st]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[it.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[it.placedSide],visibility:it.shouldHideArrow?"hidden":void 0}},y$3($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$1({},nt,{ref:tt,style:{...nt.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isNotNull(et){return et!==null}const $cf1ac5d9fe0e8206$var$transformOrigin=et=>({name:"transformOrigin",options:et,fn(_e){var tt,rt,nt,it,st;const{placement:ot,rects:at,middlewareData:lt}=_e,ct=((tt=lt.arrow)===null||tt===void 0?void 0:tt.centerOffset)!==0,dt=ct?0:et.arrowWidth,ft=ct?0:et.arrowHeight,[pt,mt]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(ot),ht={start:"0%",center:"50%",end:"100%"}[mt],gt=((rt=(nt=lt.arrow)===null||nt===void 0?void 0:nt.x)!==null&&rt!==void 0?rt:0)+dt/2,vt=((it=(st=lt.arrow)===null||st===void 0?void 0:st.y)!==null&&it!==void 0?it:0)+ft/2;let yt="",bt="";return pt==="bottom"?(yt=ct?ht:`${gt}px`,bt=`${-ft}px`):pt==="top"?(yt=ct?ht:`${gt}px`,bt=`${at.floating.height+ft}px`):pt==="right"?(yt=`${-ft}px`,bt=ct?ht:`${vt}px`):pt==="left"&&(yt=`${at.floating.width+ft}px`,bt=ct?ht:`${vt}px`),{data:{x:yt,y:bt}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(et){const[_e,tt="center"]=et.split("-");return[_e,tt]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0,$f1701beae083dbae$export$602eac185826482c=N$2((et,_e)=>{var tt;const{container:rt=globalThis==null||(tt=globalThis.document)===null||tt===void 0?void 0:tt.body,...nt}=et;return rt?$7SXl2$reactdom.createPortal(y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},nt,{ref:_e})),rt):null});var getDefaultParent=function(et){if(typeof document>"u")return null;var _e=Array.isArray(et)?et[0]:et;return _e.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(et){return et&&(et.host||unwrapHost(et.parentNode))},correctTargets=function(et,_e){return _e.map(function(tt){if(et.contains(tt))return tt;var rt=unwrapHost(tt);return rt&&et.contains(rt)?rt:(console.error("aria-hidden",tt,"in not contained inside",et,". Doing nothing"),null)}).filter(function(tt){return!!tt})},applyAttributeToOthers=function(et,_e,tt,rt){var nt=correctTargets(_e,Array.isArray(et)?et:[et]);markerMap[tt]||(markerMap[tt]=new WeakMap);var it=markerMap[tt],st=[],ot=new Set,at=new Set(nt),lt=function(ct){!ct||ot.has(ct)||(ot.add(ct),lt(ct.parentNode))};nt.forEach(lt);var ut=function(ct){!ct||at.has(ct)||Array.prototype.forEach.call(ct.children,function(dt){if(ot.has(dt))ut(dt);else{var ft=dt.getAttribute(rt),pt=ft!==null&&ft!=="false",mt=(counterMap.get(dt)||0)+1,ht=(it.get(dt)||0)+1;counterMap.set(dt,mt),it.set(dt,ht),st.push(dt),mt===1&&pt&&uncontrolledNodes.set(dt,!0),ht===1&&dt.setAttribute(tt,"true"),pt||dt.setAttribute(rt,"true")}})};return ut(_e),ot.clear(),lockCount++,function(){st.forEach(function(ct){var dt=counterMap.get(ct)-1,ft=it.get(ct)-1;counterMap.set(ct,dt),it.set(ct,ft),dt||(uncontrolledNodes.has(ct)||ct.removeAttribute(rt),uncontrolledNodes.delete(ct)),ft||ct.removeAttribute(tt)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(et,_e,tt){tt===void 0&&(tt="data-aria-hidden");var rt=Array.from(Array.isArray(et)?et:[et]),nt=_e||getDefaultParent(et);return nt?(rt.push.apply(rt,Array.from(nt.querySelectorAll("[aria-live]"))),applyAttributeToOthers(rt,nt,tt,"aria-hidden")):function(){return null}},__assign=function(){return __assign=Object.assign||function(_e){for(var tt,rt=1,nt=arguments.length;rt<nt;rt++){tt=arguments[rt];for(var it in tt)Object.prototype.hasOwnProperty.call(tt,it)&&(_e[it]=tt[it])}return _e},__assign.apply(this,arguments)};function __rest(et,_e){var tt={};for(var rt in et)Object.prototype.hasOwnProperty.call(et,rt)&&_e.indexOf(rt)<0&&(tt[rt]=et[rt]);if(et!=null&&typeof Object.getOwnPropertySymbols=="function")for(var nt=0,rt=Object.getOwnPropertySymbols(et);nt<rt.length;nt++)_e.indexOf(rt[nt])<0&&Object.prototype.propertyIsEnumerable.call(et,rt[nt])&&(tt[rt[nt]]=et[rt[nt]]);return tt}function __spreadArray(et,_e,tt){if(tt||arguments.length===2)for(var rt=0,nt=_e.length,it;rt<nt;rt++)(it||!(rt in _e))&&(it||(it=Array.prototype.slice.call(_e,0,rt)),it[rt]=_e[rt]);return et.concat(it||Array.prototype.slice.call(_e))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(et,_e){return typeof et=="function"?et(_e):et&&(et.current=_e),et}function useCallbackRef(et,_e){var tt=p$2(function(){return{value:et,callback:_e,facade:{get current(){return tt.value},set current(rt){var nt=tt.value;nt!==rt&&(tt.value=rt,tt.callback(rt,nt))}}}})[0];return tt.callback=_e,tt.facade}var currentValues=new WeakMap;function useMergeRefs(et,_e){var tt=useCallbackRef(_e||null,function(rt){return et.forEach(function(nt){return assignRef(nt,rt)})});return A$3(function(){var rt=currentValues.get(tt);if(rt){var nt=new Set(rt),it=new Set(et),st=tt.current;nt.forEach(function(ot){it.has(ot)||assignRef(ot,null)}),it.forEach(function(ot){nt.has(ot)||assignRef(ot,st)})}currentValues.set(tt,et)},[et]),tt}function ItoI(et){return et}function innerCreateMedium(et,_e){_e===void 0&&(_e=ItoI);var tt=[],rt=!1,nt={read:function(){if(rt)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return tt.length?tt[tt.length-1]:et},useMedium:function(it){var st=_e(it,rt);return tt.push(st),function(){tt=tt.filter(function(ot){return ot!==st})}},assignSyncMedium:function(it){for(rt=!0;tt.length;){var st=tt;tt=[],st.forEach(it)}tt={push:function(ot){return it(ot)},filter:function(){return tt}}},assignMedium:function(it){rt=!0;var st=[];if(tt.length){var ot=tt;tt=[],ot.forEach(it),st=tt}var at=function(){var ut=st;st=[],ut.forEach(it)},lt=function(){return Promise.resolve().then(at)};lt(),tt={push:function(ut){st.push(ut),lt()},filter:function(ut){return st=st.filter(ut),tt}}}};return nt}function createSidecarMedium(et){et===void 0&&(et={});var _e=innerCreateMedium(null);return _e.options=__assign({async:!0,ssr:!1},et),_e}var SideCar$1=function(et){var _e=et.sideCar,tt=__rest(et,["sideCar"]);if(!_e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var rt=_e.read();if(!rt)throw new Error("Sidecar medium not found");return y$3(rt,__assign({},tt))};SideCar$1.isSideCarExport=!0;function exportSidecar(et,_e){return et.useMedium(_e),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=N$2(function(et,_e){var tt=F$2(null),rt=p$2({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),nt=rt[0],it=rt[1],st=et.forwardProps,ot=et.children,at=et.className,lt=et.removeScrollBar,ut=et.enabled,ct=et.shards,dt=et.sideCar,ft=et.noIsolation,pt=et.inert,mt=et.allowPinchZoom,ht=et.as,gt=ht===void 0?"div":ht,vt=__rest(et,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),yt=dt,bt=useMergeRefs([tt,_e]),xt=__assign(__assign({},vt),nt);return y$3(g$3,null,ut&&y$3(yt,{sideCar:effectCar,removeScrollBar:lt,shards:ct,noIsolation:ft,inert:pt,setCallbacks:it,allowPinchZoom:!!mt,lockRef:tt}),st?sn(A$2.only(ot),__assign(__assign({},xt),{ref:bt})):y$3(gt,__assign({},xt,{className:at,ref:bt}),ot))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var et=document.createElement("style");et.type="text/css";var _e=getNonce();return _e&&et.setAttribute("nonce",_e),et}function injectStyles(et,_e){et.styleSheet?et.styleSheet.cssText=_e:et.appendChild(document.createTextNode(_e))}function insertStyleTag(et){var _e=document.head||document.getElementsByTagName("head")[0];_e.appendChild(et)}var stylesheetSingleton=function(){var et=0,_e=null;return{add:function(tt){et==0&&(_e=makeStyleTag())&&(injectStyles(_e,tt),insertStyleTag(_e)),et++},remove:function(){et--,!et&&_e&&(_e.parentNode&&_e.parentNode.removeChild(_e),_e=null)}}},styleHookSingleton=function(){var et=stylesheetSingleton();return function(_e,tt){_(function(){return et.add(_e),function(){et.remove()}},[_e&&tt])}},styleSingleton=function(){var et=styleHookSingleton(),_e=function(tt){var rt=tt.styles,nt=tt.dynamic;return et(rt,nt),null};return _e},zeroGap={left:0,top:0,right:0,gap:0},parse=function(et){return parseInt(et||"",10)||0},getOffset=function(et){var _e=window.getComputedStyle(document.body),tt=_e[et==="padding"?"paddingLeft":"marginLeft"],rt=_e[et==="padding"?"paddingTop":"marginTop"],nt=_e[et==="padding"?"paddingRight":"marginRight"];return[parse(tt),parse(rt),parse(nt)]},getGapWidth=function(et){if(et===void 0&&(et="margin"),typeof window>"u")return zeroGap;var _e=getOffset(et),tt=document.documentElement.clientWidth,rt=window.innerWidth;return{left:_e[0],top:_e[1],right:_e[2],gap:Math.max(0,rt-tt+_e[2]-_e[0])}},Style=styleSingleton(),lockAttribute="data-scroll-locked",getStyles=function(et,_e,tt,rt){var nt=et.left,it=et.top,st=et.right,ot=et.gap;return tt===void 0&&(tt="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(rt,`;
   padding-right: `).concat(ot,"px ").concat(rt,`;
  }
  body[`).concat(lockAttribute,`] {
    overflow: hidden `).concat(rt,`;
    overscroll-behavior: contain;
    `).concat([_e&&"position: relative ".concat(rt,";"),tt==="margin"&&`
    padding-left: `.concat(nt,`px;
    padding-top: `).concat(it,`px;
    padding-right: `).concat(st,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(ot,"px ").concat(rt,`;
    `),tt==="padding"&&"padding-right: ".concat(ot,"px ").concat(rt,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(ot,"px ").concat(rt,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(ot,"px ").concat(rt,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(rt,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(rt,`;
  }
  
  body[`).concat(lockAttribute,`] {
    `).concat(removedBarSizeVariable,": ").concat(ot,`px;
  }
`)},RemoveScrollBar=function(et){var _e=et.noRelative,tt=et.noImportant,rt=et.gapMode,nt=rt===void 0?"margin":rt,it=q$2(function(){return getGapWidth(nt)},[nt]);return _(function(){return document.body.setAttribute(lockAttribute,""),function(){document.body.removeAttribute(lockAttribute)}},[]),y$3(Style,{styles:getStyles(it,!_e,nt,tt?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(et){return et.tagName==="TEXTAREA"},elementCanBeScrolled=function(et,_e){var tt=window.getComputedStyle(et);return tt[_e]!=="hidden"&&!(tt.overflowY===tt.overflowX&&!alwaysContainsScroll(et)&&tt[_e]==="visible")},elementCouldBeVScrolled=function(et){return elementCanBeScrolled(et,"overflowY")},elementCouldBeHScrolled=function(et){return elementCanBeScrolled(et,"overflowX")},locationCouldBeScrolled=function(et,_e){var tt=_e;do{typeof ShadowRoot<"u"&&tt instanceof ShadowRoot&&(tt=tt.host);var rt=elementCouldBeScrolled(et,tt);if(rt){var nt=getScrollVariables(et,tt),it=nt[1],st=nt[2];if(it>st)return!0}tt=tt.parentNode}while(tt&&tt!==document.body);return!1},getVScrollVariables=function(et){var _e=et.scrollTop,tt=et.scrollHeight,rt=et.clientHeight;return[_e,tt,rt]},getHScrollVariables=function(et){var _e=et.scrollLeft,tt=et.scrollWidth,rt=et.clientWidth;return[_e,tt,rt]},elementCouldBeScrolled=function(et,_e){return et==="v"?elementCouldBeVScrolled(_e):elementCouldBeHScrolled(_e)},getScrollVariables=function(et,_e){return et==="v"?getVScrollVariables(_e):getHScrollVariables(_e)},getDirectionFactor=function(et,_e){return et==="h"&&_e==="rtl"?-1:1},handleScroll=function(et,_e,tt,rt,nt){var it=getDirectionFactor(et,window.getComputedStyle(_e).direction),st=it*rt,ot=tt.target,at=_e.contains(ot),lt=!1,ut=st>0,ct=0,dt=0;do{var ft=getScrollVariables(et,ot),pt=ft[0],mt=ft[1],ht=ft[2],gt=mt-ht-it*pt;(pt||gt)&&elementCouldBeScrolled(et,ot)&&(ct+=gt,dt+=pt),ot=ot.parentNode}while(!at&&ot!==document.body||at&&(_e.contains(ot)||_e===ot));return(ut&&(nt&&ct===0||!nt&&st>ct)||!ut&&(nt&&dt===0||!nt&&-st>dt))&&(lt=!0),lt},getTouchXY=function(et){return"changedTouches"in et?[et.changedTouches[0].clientX,et.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(et){return[et.deltaX,et.deltaY]},extractRef=function(et){return et&&"current"in et?et.current:et},deltaCompare=function(et,_e){return et[0]===_e[0]&&et[1]===_e[1]},generateStyle=function(et){return`
  .block-interactivity-`.concat(et,` {pointer-events: none;}
  .allow-interactivity-`).concat(et,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(et){var _e=F$2([]),tt=F$2([0,0]),rt=F$2(),nt=p$2(idCounter++)[0],it=p$2(function(){return styleSingleton()})[0],st=F$2(et);_(function(){st.current=et},[et]),_(function(){if(et.inert){document.body.classList.add("block-interactivity-".concat(nt));var mt=__spreadArray([et.lockRef.current],(et.shards||[]).map(extractRef),!0).filter(Boolean);return mt.forEach(function(ht){return ht.classList.add("allow-interactivity-".concat(nt))}),function(){document.body.classList.remove("block-interactivity-".concat(nt)),mt.forEach(function(ht){return ht.classList.remove("allow-interactivity-".concat(nt))})}}},[et.inert,et.lockRef.current,et.shards]);var ot=x$3(function(mt,ht){if("touches"in mt&&mt.touches.length===2)return!st.current.allowPinchZoom;var gt=getTouchXY(mt),vt=tt.current,yt="deltaX"in mt?mt.deltaX:vt[0]-gt[0],bt="deltaY"in mt?mt.deltaY:vt[1]-gt[1],xt,_t=mt.target,wt=Math.abs(yt)>Math.abs(bt)?"h":"v";if("touches"in mt&&wt==="h"&&_t.type==="range")return!1;var Ct=locationCouldBeScrolled(wt,_t);if(!Ct)return!0;if(Ct?xt=wt:(xt=wt==="v"?"h":"v",Ct=locationCouldBeScrolled(wt,_t)),!Ct)return!1;if(!rt.current&&"changedTouches"in mt&&(yt||bt)&&(rt.current=xt),!xt)return!0;var kt=rt.current||xt;return handleScroll(kt,ht,mt,kt==="h"?yt:bt,!0)},[]),at=x$3(function(mt){var ht=mt;if(!(!lockStack.length||lockStack[lockStack.length-1]!==it)){var gt="deltaY"in ht?getDeltaXY(ht):getTouchXY(ht),vt=_e.current.filter(function(xt){return xt.name===ht.type&&xt.target===ht.target&&deltaCompare(xt.delta,gt)})[0];if(vt&&vt.should){ht.cancelable&&ht.preventDefault();return}if(!vt){var yt=(st.current.shards||[]).map(extractRef).filter(Boolean).filter(function(xt){return xt.contains(ht.target)}),bt=yt.length>0?ot(ht,yt[0]):!st.current.noIsolation;bt&&ht.cancelable&&ht.preventDefault()}}},[]),lt=x$3(function(mt,ht,gt,vt){var yt={name:mt,delta:ht,target:gt,should:vt};_e.current.push(yt),setTimeout(function(){_e.current=_e.current.filter(function(bt){return bt!==yt})},1)},[]),ut=x$3(function(mt){tt.current=getTouchXY(mt),rt.current=void 0},[]),ct=x$3(function(mt){lt(mt.type,getDeltaXY(mt),mt.target,ot(mt,et.lockRef.current))},[]),dt=x$3(function(mt){lt(mt.type,getTouchXY(mt),mt.target,ot(mt,et.lockRef.current))},[]);_(function(){return lockStack.push(it),et.setCallbacks({onScrollCapture:ct,onWheelCapture:ct,onTouchMoveCapture:dt}),document.addEventListener("wheel",at,nonPassive),document.addEventListener("touchmove",at,nonPassive),document.addEventListener("touchstart",ut,nonPassive),function(){lockStack=lockStack.filter(function(mt){return mt!==it}),document.removeEventListener("wheel",at,nonPassive),document.removeEventListener("touchmove",at,nonPassive),document.removeEventListener("touchstart",ut,nonPassive)}},[]);var ft=et.removeScrollBar,pt=et.inert;return y$3(g$3,null,pt?y$3(it,{styles:generateStyle(nt)}):null,ft?y$3(RemoveScrollBar,{gapMode:"margin"}):null)}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=N$2(function(et,_e){return y$3(RemoveScroll,__assign({},et,{ref:_e,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;const $01b9c$RemoveScroll=ReactRemoveScroll,$cb5cc270b50c6fcd$var$POPOVER_NAME="Popover",[$cb5cc270b50c6fcd$var$createPopoverContext,$cb5cc270b50c6fcd$export$c8393c9e73286932]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cb5cc270b50c6fcd$var$POPOVER_NAME,[$cf1ac5d9fe0e8206$export$722aac194ae923]),$cb5cc270b50c6fcd$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cb5cc270b50c6fcd$var$PopoverProvider,$cb5cc270b50c6fcd$var$usePopoverContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$POPOVER_NAME),$cb5cc270b50c6fcd$export$5b6b19405a83ff9d=et=>{const{__scopePopover:_e,children:tt,open:rt,defaultOpen:nt,onOpenChange:it,modal:st=!1}=et,ot=$cb5cc270b50c6fcd$var$usePopperScope(_e),at=F$2(null),[lt,ut]=p$2(!1),[ct=!1,dt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:rt,defaultProp:nt,onChange:it});return y$3($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,ot,y$3($cb5cc270b50c6fcd$var$PopoverProvider,{scope:_e,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),triggerRef:at,open:ct,onOpenChange:dt,onOpenToggle:x$3(()=>dt(ft=>!ft),[dt]),hasCustomAnchor:lt,onCustomAnchorAdd:x$3(()=>ut(!0),[]),onCustomAnchorRemove:x$3(()=>ut(!1),[]),modal:st},tt))},$cb5cc270b50c6fcd$var$TRIGGER_NAME="PopoverTrigger",$cb5cc270b50c6fcd$export$7dacb05d26466c3=N$2((et,_e)=>{const{__scopePopover:tt,...rt}=et,nt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$TRIGGER_NAME,tt),it=$cb5cc270b50c6fcd$var$usePopperScope(tt),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,nt.triggerRef),ot=y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-haspopup":"dialog","aria-expanded":nt.open,"aria-controls":nt.contentId,"data-state":$cb5cc270b50c6fcd$var$getState(nt.open)},rt,{ref:st,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onClick,nt.onOpenToggle)}));return nt.hasCustomAnchor?ot:y$3($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},it),ot)}),$cb5cc270b50c6fcd$var$PORTAL_NAME="PopoverPortal",[$cb5cc270b50c6fcd$var$PortalProvider,$cb5cc270b50c6fcd$var$usePortalContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$PORTAL_NAME,{forceMount:void 0}),$cb5cc270b50c6fcd$var$CONTENT_NAME="PopoverContent",$cb5cc270b50c6fcd$export$d7e1f420b25549ff=N$2((et,_e)=>{const tt=$cb5cc270b50c6fcd$var$usePortalContext($cb5cc270b50c6fcd$var$CONTENT_NAME,et.__scopePopover),{forceMount:rt=tt.forceMount,...nt}=et,it=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,et.__scopePopover);return y$3($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:rt||it.open},it.modal?y$3($cb5cc270b50c6fcd$var$PopoverContentModal,_extends$1({},nt,{ref:_e})):y$3($cb5cc270b50c6fcd$var$PopoverContentNonModal,_extends$1({},nt,{ref:_e})))}),$cb5cc270b50c6fcd$var$PopoverContentModal=N$2((et,_e)=>{const tt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,et.__scopePopover),rt=F$2(null),nt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,rt),it=F$2(!1);return _(()=>{const st=rt.current;if(st)return hideOthers(st)},[]),y$3($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},y$3($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},et,{ref:nt,trapFocus:tt.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onCloseAutoFocus,st=>{var ot;st.preventDefault(),it.current||(ot=tt.triggerRef.current)===null||ot===void 0||ot.focus()}),onPointerDownOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onPointerDownOutside,st=>{const ot=st.detail.originalEvent,at=ot.button===0&&ot.ctrlKey===!0,lt=ot.button===2||at;it.current=lt},{checkForDefaultPrevented:!1}),onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onFocusOutside,st=>st.preventDefault(),{checkForDefaultPrevented:!1})})))}),$cb5cc270b50c6fcd$var$PopoverContentNonModal=N$2((et,_e)=>{const tt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,et.__scopePopover),rt=F$2(!1),nt=F$2(!1);return y$3($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},et,{ref:_e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:it=>{var st;if((st=et.onCloseAutoFocus)===null||st===void 0||st.call(et,it),!it.defaultPrevented){var ot;rt.current||(ot=tt.triggerRef.current)===null||ot===void 0||ot.focus(),it.preventDefault()}rt.current=!1,nt.current=!1},onInteractOutside:it=>{var st,ot;(st=et.onInteractOutside)===null||st===void 0||st.call(et,it),it.defaultPrevented||(rt.current=!0,it.detail.originalEvent.type==="pointerdown"&&(nt.current=!0));const at=it.target;((ot=tt.triggerRef.current)===null||ot===void 0?void 0:ot.contains(at))&&it.preventDefault(),it.detail.originalEvent.type==="focusin"&&nt.current&&it.preventDefault()}}))}),$cb5cc270b50c6fcd$var$PopoverContentImpl=N$2((et,_e)=>{const{__scopePopover:tt,trapFocus:rt,onOpenAutoFocus:nt,onCloseAutoFocus:it,disableOutsidePointerEvents:st,onEscapeKeyDown:ot,onPointerDownOutside:at,onFocusOutside:lt,onInteractOutside:ut,...ct}=et,dt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt),ft=$cb5cc270b50c6fcd$var$usePopperScope(tt);return $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(),y$3($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,loop:!0,trapped:rt,onMountAutoFocus:nt,onUnmountAutoFocus:it},y$3($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:st,onInteractOutside:ut,onEscapeKeyDown:ot,onPointerDownOutside:at,onFocusOutside:lt,onDismiss:()=>dt.onOpenChange(!1)},y$3($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({"data-state":$cb5cc270b50c6fcd$var$getState(dt.open),role:"dialog",id:dt.contentId},ft,ct,{ref:_e,style:{...ct.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),$cb5cc270b50c6fcd$var$CLOSE_NAME="PopoverClose",$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e=N$2((et,_e)=>{const{__scopePopover:tt,...rt}=et,nt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CLOSE_NAME,tt);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button"},rt,{ref:_e,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onClick,()=>nt.onOpenChange(!1))}))}),$cb5cc270b50c6fcd$export$3152841115e061b2=N$2((et,_e)=>{const{__scopePopover:tt,...rt}=et,nt=$cb5cc270b50c6fcd$var$usePopperScope(tt);return y$3($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$1({},nt,rt,{ref:_e}))});function $cb5cc270b50c6fcd$var$getState(et){return et?"open":"closed"}const $cb5cc270b50c6fcd$export$be92b6f5f03c0fe9=$cb5cc270b50c6fcd$export$5b6b19405a83ff9d,$cb5cc270b50c6fcd$export$41fb9f06171c75f4=$cb5cc270b50c6fcd$export$7dacb05d26466c3,$cb5cc270b50c6fcd$export$7c6e2c02157bb7d2=$cb5cc270b50c6fcd$export$d7e1f420b25549ff,$cb5cc270b50c6fcd$export$f39c2d165cd861fe=$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e,$cb5cc270b50c6fcd$export$21b07c8f274aebd5=$cb5cc270b50c6fcd$export$3152841115e061b2,slideDown=keyframes({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),slideUp=keyframes({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),StyledArrow=styled($cb5cc270b50c6fcd$export$21b07c8f274aebd5,{fill:"$secondaryAlt"}),StyledClose=styled($cb5cc270b50c6fcd$export$f39c2d165cd861fe,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),StyledContent=styled($cb5cc270b50c6fcd$export$7c6e2c02157bb7d2,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:slideUp},'&[data-side="bottom"]':{animationName:slideDown},'&[data-align="end"]':{[`& ${StyledArrow}`]:{margin:"0 0.7rem"}}}),StyledTrigger=styled($cb5cc270b50c6fcd$export$41fb9f06171c75f4,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),StyledPopover=styled($cb5cc270b50c6fcd$export$be92b6f5f03c0fe9,{boxSizing:"content-box"}),Trigger=et=>y$3(StyledTrigger,{...et},et.children),Content=et=>y$3(StyledContent,{...et},y$3(StyledArrow,null),y$3(StyledClose,null,y$3(Icon,{isSmall:!0},y$3(Icon.Close,null))),et.children),Popover=({children:et})=>y$3(StyledPopover,null,et);Popover.Trigger=Trigger,Popover.Content=Content;const Tag=styled("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"5px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${StyledIcon}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),Type=styled("span",{display:"flex"}),Spacer=styled("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),Duration=styled("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Item$1=styled($f99a8c78507165f7$export$6d08773d2e66f8f2,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${Type}`]:{position:"absolute",right:"0",bottom:"0",[`& ${Tag}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${Type}`]:{[`& ${Tag}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700"}}}),IconPath=({type:et})=>{switch(et){case"Sound":return y$3(Icon.Audio,null);case"Image":return y$3(Icon.Image,null);case"Video":return y$3(Icon.Video,null);default:return y$3(Icon.Image,null)}},Thumbnail=({canvas:et,canvasIndex:_e,isActive:tt,thumbnail:rt,type:nt,handleChange:it})=>y$3(Item$1,{"aria-checked":tt,"data-testid":"media-thumbnail","data-canvas":_e,onClick:()=>it(et.id),value:et.id},y$3("figure",null,y$3("div",null,(rt==null?void 0:rt.id)&&y$3("img",{src:rt.id,alt:et!=null&&et.label?getLabel(et.label):""}),y$3(Type,null,y$3(Tag,{isIcon:!0,"data-testid":"thumbnail-tag"},y$3(Spacer,null),y$3(Icon,{"aria-label":nt},y$3(IconPath,{type:nt})),["Video","Sound"].includes(nt)&&y$3(Duration,null,convertTime(et.duration))))),(et==null?void 0:et.label)&&y$3("figcaption",{"data-testid":"fig-caption"},y$3(Label$1,{label:et.label})))),getResourceType=et=>et.body?et.body.type:"Image",Media=({items:et})=>{const _e=useViewerDispatch(),tt=useViewerState(),{activeCanvas:rt,vault:nt}=tt,[it,st]=p$2(""),[ot,at]=p$2([]),[lt,ut]=p$2(0),ct=wn.useRef(null),dt="painting",ft=ht=>{rt!==ht&&_e({type:"updateActiveCanvas",canvasId:ht})};return _(()=>{if(!ot.length){const ht=["Image","Sound","Video"],gt=et.map(vt=>getCanvasByCriteria(nt,vt,dt,ht)).filter(vt=>vt.annotations.length>0);at(gt)}},[et,ot.length,nt]),_(()=>{ot.forEach((ht,gt)=>{ht!=null&&ht.canvas&&ht.canvas.id===rt&&ut(gt)})},[rt,ot]),_(()=>{const ht=document.querySelector(`[data-canvas="${lt}"]`);if(ht instanceof HTMLElement&&ct.current){const gt=ht.offsetLeft-ct.current.offsetWidth/2+ht.offsetWidth/2;ct.current.scrollTo({left:gt,behavior:"smooth"})}},[lt]),y$3(g$3,null,y$3(Controls$1,{handleFilter:ht=>st(ht),handleCanvasToggle:ht=>{const gt=ot[lt+ht];gt!=null&&gt.canvas&&ft(gt.canvas.id)},activeIndex:lt,canvasLength:ot.length}),y$3(Group,{"aria-label":"select item","data-testid":"media",ref:ct},ot.filter(ht=>{var gt;if((gt=ht.canvas)!=null&&gt.label){const vt=getLabel(ht.canvas.label);if(Array.isArray(vt))return vt[0].toLowerCase().includes(it.toLowerCase())}}).map((ht,gt)=>{var vt,yt;return y$3(Thumbnail,{canvas:ht.canvas,canvasIndex:gt,handleChange:ft,isActive:rt===((vt=ht==null?void 0:ht.canvas)==null?void 0:vt.id),key:(yt=ht==null?void 0:ht.canvas)==null?void 0:yt.id,thumbnail:getThumbnail(nt,ht,200,200),type:getResourceType(ht.annotations[0])})})))},PlaceholderStyled=styled("button",{background:"none",border:"none",cursor:"zoom-in",width:"100%",height:"100%",margin:"0",padding:"0",transition:"$all","& img":{width:"100%",height:"100%",objectFit:"contain",color:"transparent",transition:"$all"},variants:{isMedia:{true:{cursor:"pointer"}}}}),Item=styled("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"$primary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#rotateRight":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#rotateLeft":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#reset":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),ToggleStyled=styled(Item,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),PaintingStyled=styled("div",{position:"relative",zIndex:"0",display:"flex",flexDirection:"column",gap:"1rem","&:hover":{[`${ToggleStyled}`]:{backgroundColor:"$accent"},[`${PlaceholderStyled}`]:{backgroundColor:"#6662",img:{filter:"brightness(0.85)"}}}}),PaintingCanvas=styled("div",{});function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(et,[_e,tt]){return Math.min(tt,Math.max(_e,et))}const $ea1ef594cf570d83$export$439d29a4e110a164=N$2((et,_e)=>y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},et,{ref:_e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...et.style}}))),$cc7e05a45900e73f$var$OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],$cc7e05a45900e73f$var$SELECTION_KEYS=[" ","Enter"],$cc7e05a45900e73f$var$SELECT_NAME="Select",[$cc7e05a45900e73f$var$Collection,$cc7e05a45900e73f$var$useCollection,$cc7e05a45900e73f$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$createSelectContext,$cc7e05a45900e73f$export$286727a75dc039bd]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cc7e05a45900e73f$var$SELECT_NAME,[$cc7e05a45900e73f$var$createCollectionScope,$cf1ac5d9fe0e8206$export$722aac194ae923]),$cc7e05a45900e73f$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cc7e05a45900e73f$var$SelectProvider,$cc7e05a45900e73f$var$useSelectContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$SelectNativeOptionsProvider,$cc7e05a45900e73f$var$useSelectNativeOptionsContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),$cc7e05a45900e73f$export$ef9b1a59e592288f=et=>{const{__scopeSelect:_e,children:tt,open:rt,defaultOpen:nt,onOpenChange:it,value:st,defaultValue:ot,onValueChange:at,dir:lt,name:ut,autoComplete:ct,disabled:dt,required:ft}=et,pt=$cc7e05a45900e73f$var$usePopperScope(_e),[mt,ht]=p$2(null),[gt,vt]=p$2(null),[yt,bt]=p$2(!1),xt=$f631663db3294ace$export$b39126d51d94e6f3(lt),[_t=!1,wt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:rt,defaultProp:nt,onChange:it}),[Ct,kt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:st,defaultProp:ot,onChange:at}),At=F$2(null),$t=mt?!!mt.closest("form"):!0,[Lt,Mt]=p$2(new Set),Bt=Array.from(Lt).map(Pt=>Pt.props.value).join(";");return y$3($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,pt,y$3($cc7e05a45900e73f$var$SelectProvider,{required:ft,scope:_e,trigger:mt,onTriggerChange:ht,valueNode:gt,onValueNodeChange:vt,valueNodeHasChildren:yt,onValueNodeHasChildrenChange:bt,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),value:Ct,onValueChange:kt,open:_t,onOpenChange:wt,dir:xt,triggerPointerDownPosRef:At,disabled:dt},y$3($cc7e05a45900e73f$var$Collection.Provider,{scope:_e},y$3($cc7e05a45900e73f$var$SelectNativeOptionsProvider,{scope:et.__scopeSelect,onNativeOptionAdd:x$3(Pt=>{Mt(Nt=>new Set(Nt).add(Pt))},[]),onNativeOptionRemove:x$3(Pt=>{Mt(Nt=>{const It=new Set(Nt);return It.delete(Pt),It})},[])},tt)),$t?y$3($cc7e05a45900e73f$var$BubbleSelect,{key:Bt,"aria-hidden":!0,required:ft,tabIndex:-1,name:ut,autoComplete:ct,value:Ct,onChange:Pt=>kt(Pt.target.value),disabled:dt},Ct===void 0?y$3("option",{value:""}):null,Array.from(Lt)):null))},$cc7e05a45900e73f$var$TRIGGER_NAME="SelectTrigger",$cc7e05a45900e73f$export$3ac1e88a1c0b9f1=N$2((et,_e)=>{const{__scopeSelect:tt,disabled:rt=!1,...nt}=et,it=$cc7e05a45900e73f$var$usePopperScope(tt),st=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$TRIGGER_NAME,tt),ot=st.disabled||rt,at=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,st.onTriggerChange),lt=$cc7e05a45900e73f$var$useCollection(tt),[ut,ct,dt]=$cc7e05a45900e73f$var$useTypeaheadSearch(pt=>{const mt=lt().filter(vt=>!vt.disabled),ht=mt.find(vt=>vt.value===st.value),gt=$cc7e05a45900e73f$var$findNextItem(mt,pt,ht);gt!==void 0&&st.onValueChange(gt.value)}),ft=()=>{ot||(st.onOpenChange(!0),dt())};return y$3($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},it),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"combobox","aria-controls":st.contentId,"aria-expanded":st.open,"aria-required":st.required,"aria-autocomplete":"none",dir:st.dir,"data-state":st.open?"open":"closed",disabled:ot,"data-disabled":ot?"":void 0,"data-placeholder":$cc7e05a45900e73f$var$shouldShowPlaceholder(st.value)?"":void 0},nt,{ref:at,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onClick,pt=>{pt.currentTarget.focus()}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onPointerDown,pt=>{const mt=pt.target;mt.hasPointerCapture(pt.pointerId)&&mt.releasePointerCapture(pt.pointerId),pt.button===0&&pt.ctrlKey===!1&&(ft(),st.triggerPointerDownPosRef.current={x:Math.round(pt.pageX),y:Math.round(pt.pageY)},pt.preventDefault())}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onKeyDown,pt=>{const mt=ut.current!=="";!(pt.ctrlKey||pt.altKey||pt.metaKey)&&pt.key.length===1&&ct(pt.key),!(mt&&pt.key===" ")&&$cc7e05a45900e73f$var$OPEN_KEYS.includes(pt.key)&&(ft(),pt.preventDefault())})})))}),$cc7e05a45900e73f$var$VALUE_NAME="SelectValue",$cc7e05a45900e73f$export$e288731fd71264f0=N$2((et,_e)=>{const{__scopeSelect:tt,className:rt,style:nt,children:it,placeholder:st="",...ot}=et,at=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$VALUE_NAME,tt),{onValueNodeHasChildrenChange:lt}=at,ut=it!==void 0,ct=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,at.onValueNodeChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{lt(ut)},[lt,ut]),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},ot,{ref:ct,style:{pointerEvents:"none"}}),$cc7e05a45900e73f$var$shouldShowPlaceholder(at.value)?y$3(g$3,null,st):it)}),$cc7e05a45900e73f$export$99b400cabb58c515=N$2((et,_e)=>{const{__scopeSelect:tt,children:rt,...nt}=et;return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},nt,{ref:_e}),rt||"")}),$cc7e05a45900e73f$export$b2af6c9944296213=et=>y$3($f1701beae083dbae$export$602eac185826482c,_extends$1({asChild:!0},et)),$cc7e05a45900e73f$var$CONTENT_NAME="SelectContent",$cc7e05a45900e73f$export$c973a4b3cb86a03d=N$2((et,_e)=>{const tt=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,et.__scopeSelect),[rt,nt]=p$2();if($9f79659886946c16$export$e5c5a5f917a5871c(()=>{nt(new DocumentFragment)},[]),!tt.open){const it=rt;return it?reactDomExports.createPortal(y$3($cc7e05a45900e73f$var$SelectContentProvider,{scope:et.__scopeSelect},y$3($cc7e05a45900e73f$var$Collection.Slot,{scope:et.__scopeSelect},y$3("div",null,et.children))),it):null}return y$3($cc7e05a45900e73f$var$SelectContentImpl,_extends$1({},et,{ref:_e}))}),$cc7e05a45900e73f$var$CONTENT_MARGIN=10,[$cc7e05a45900e73f$var$SelectContentProvider,$cc7e05a45900e73f$var$useSelectContentContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME),$cc7e05a45900e73f$var$SelectContentImpl=N$2((et,_e)=>{const{__scopeSelect:tt,position:rt="item-aligned",onCloseAutoFocus:nt,onEscapeKeyDown:it,onPointerDownOutside:st,side:ot,sideOffset:at,align:lt,alignOffset:ut,arrowPadding:ct,collisionBoundary:dt,collisionPadding:ft,sticky:pt,hideWhenDetached:mt,avoidCollisions:ht,...gt}=et,vt=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,tt),[yt,bt]=p$2(null),[xt,_t]=p$2(null),wt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,qt=>bt(qt)),[Ct,kt]=p$2(null),[At,$t]=p$2(null),Lt=$cc7e05a45900e73f$var$useCollection(tt),[Mt,Bt]=p$2(!1),Pt=F$2(!1);_(()=>{if(yt)return hideOthers(yt)},[yt]),$3db38b7d1fb3fe6a$export$b7ece24a22aeda8c();const Nt=x$3(qt=>{const[nr,...vr]=Lt().map(pr=>pr.ref.current),[fr]=vr.slice(-1),hr=document.activeElement;for(const pr of qt)if(pr===hr||(pr==null||pr.scrollIntoView({block:"nearest"}),pr===nr&&xt&&(xt.scrollTop=0),pr===fr&&xt&&(xt.scrollTop=xt.scrollHeight),pr==null||pr.focus(),document.activeElement!==hr))return},[Lt,xt]),It=x$3(()=>Nt([Ct,yt]),[Nt,Ct,yt]);_(()=>{Mt&&It()},[Mt,It]);const{onOpenChange:Ft,triggerPointerDownPosRef:Ut}=vt;_(()=>{if(yt){let qt={x:0,y:0};const nr=fr=>{var hr,pr,Et,Rt;qt={x:Math.abs(Math.round(fr.pageX)-((hr=(pr=Ut.current)===null||pr===void 0?void 0:pr.x)!==null&&hr!==void 0?hr:0)),y:Math.abs(Math.round(fr.pageY)-((Et=(Rt=Ut.current)===null||Rt===void 0?void 0:Rt.y)!==null&&Et!==void 0?Et:0))}},vr=fr=>{qt.x<=10&&qt.y<=10?fr.preventDefault():yt.contains(fr.target)||Ft(!1),document.removeEventListener("pointermove",nr),Ut.current=null};return Ut.current!==null&&(document.addEventListener("pointermove",nr),document.addEventListener("pointerup",vr,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",nr),document.removeEventListener("pointerup",vr,{capture:!0})}}},[yt,Ft,Ut]),_(()=>{const qt=()=>Ft(!1);return window.addEventListener("blur",qt),window.addEventListener("resize",qt),()=>{window.removeEventListener("blur",qt),window.removeEventListener("resize",qt)}},[Ft]);const[Ht,jt]=$cc7e05a45900e73f$var$useTypeaheadSearch(qt=>{const nr=Lt().filter(hr=>!hr.disabled),vr=nr.find(hr=>hr.ref.current===document.activeElement),fr=$cc7e05a45900e73f$var$findNextItem(nr,qt,vr);fr&&setTimeout(()=>fr.ref.current.focus())}),Gt=x$3((qt,nr,vr)=>{const fr=!Pt.current&&!vr;(vt.value!==void 0&&vt.value===nr||fr)&&(kt(qt),fr&&(Pt.current=!0))},[vt.value]),tr=x$3(()=>yt==null?void 0:yt.focus(),[yt]),Yt=x$3((qt,nr,vr)=>{const fr=!Pt.current&&!vr;(vt.value!==void 0&&vt.value===nr||fr)&&$t(qt)},[vt.value]),Jt=rt==="popper"?$cc7e05a45900e73f$var$SelectPopperPosition:$cc7e05a45900e73f$var$SelectItemAlignedPosition,rr=Jt===$cc7e05a45900e73f$var$SelectPopperPosition?{side:ot,sideOffset:at,align:lt,alignOffset:ut,arrowPadding:ct,collisionBoundary:dt,collisionPadding:ft,sticky:pt,hideWhenDetached:mt,avoidCollisions:ht}:{};return y$3($cc7e05a45900e73f$var$SelectContentProvider,{scope:tt,content:yt,viewport:xt,onViewportChange:_t,itemRefCallback:Gt,selectedItem:Ct,onItemLeave:tr,itemTextRefCallback:Yt,focusSelectedItem:It,selectedItemText:At,position:rt,isPositioned:Mt,searchRef:Ht},y$3($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},y$3($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,trapped:vt.open,onMountAutoFocus:qt=>{qt.preventDefault()},onUnmountAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt,qt=>{var nr;(nr=vt.trigger)===null||nr===void 0||nr.focus({preventScroll:!0}),qt.preventDefault()})},y$3($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:it,onPointerDownOutside:st,onFocusOutside:qt=>qt.preventDefault(),onDismiss:()=>vt.onOpenChange(!1)},y$3(Jt,_extends$1({role:"listbox",id:vt.contentId,"data-state":vt.open?"open":"closed",dir:vt.dir,onContextMenu:qt=>qt.preventDefault()},gt,rr,{onPlaced:()=>Bt(!0),ref:wt,style:{display:"flex",flexDirection:"column",outline:"none",...gt.style},onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(gt.onKeyDown,qt=>{const nr=qt.ctrlKey||qt.altKey||qt.metaKey;if(qt.key==="Tab"&&qt.preventDefault(),!nr&&qt.key.length===1&&jt(qt.key),["ArrowUp","ArrowDown","Home","End"].includes(qt.key)){let fr=Lt().filter(hr=>!hr.disabled).map(hr=>hr.ref.current);if(["ArrowUp","End"].includes(qt.key)&&(fr=fr.slice().reverse()),["ArrowUp","ArrowDown"].includes(qt.key)){const hr=qt.target,pr=fr.indexOf(hr);fr=fr.slice(pr+1)}setTimeout(()=>Nt(fr)),qt.preventDefault()}})}))))))}),$cc7e05a45900e73f$var$SelectItemAlignedPosition=N$2((et,_e)=>{const{__scopeSelect:tt,onPlaced:rt,...nt}=et,it=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,tt),st=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$CONTENT_NAME,tt),[ot,at]=p$2(null),[lt,ut]=p$2(null),ct=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,wt=>ut(wt)),dt=$cc7e05a45900e73f$var$useCollection(tt),ft=F$2(!1),pt=F$2(!0),{viewport:mt,selectedItem:ht,selectedItemText:gt,focusSelectedItem:vt}=st,yt=x$3(()=>{if(it.trigger&&it.valueNode&&ot&&lt&&mt&&ht&&gt){const wt=it.trigger.getBoundingClientRect(),Ct=lt.getBoundingClientRect(),kt=it.valueNode.getBoundingClientRect(),At=gt.getBoundingClientRect();if(it.dir!=="rtl"){const hr=At.left-Ct.left,pr=kt.left-hr,Et=wt.left-pr,Rt=wt.width+Et,Vt=Math.max(Rt,Ct.width),zt=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,Wt=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(pr,[$cc7e05a45900e73f$var$CONTENT_MARGIN,zt-Vt]);ot.style.minWidth=Rt+"px",ot.style.left=Wt+"px"}else{const hr=Ct.right-At.right,pr=window.innerWidth-kt.right-hr,Et=window.innerWidth-wt.right-pr,Rt=wt.width+Et,Vt=Math.max(Rt,Ct.width),zt=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,Wt=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(pr,[$cc7e05a45900e73f$var$CONTENT_MARGIN,zt-Vt]);ot.style.minWidth=Rt+"px",ot.style.right=Wt+"px"}const $t=dt(),Lt=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,Mt=mt.scrollHeight,Bt=window.getComputedStyle(lt),Pt=parseInt(Bt.borderTopWidth,10),Nt=parseInt(Bt.paddingTop,10),It=parseInt(Bt.borderBottomWidth,10),Ft=parseInt(Bt.paddingBottom,10),Ut=Pt+Nt+Mt+Ft+It,Ht=Math.min(ht.offsetHeight*5,Ut),jt=window.getComputedStyle(mt),Gt=parseInt(jt.paddingTop,10),tr=parseInt(jt.paddingBottom,10),Yt=wt.top+wt.height/2-$cc7e05a45900e73f$var$CONTENT_MARGIN,Jt=Lt-Yt,rr=ht.offsetHeight/2,qt=ht.offsetTop+rr,nr=Pt+Nt+qt,vr=Ut-nr;if(nr<=Yt){const hr=ht===$t[$t.length-1].ref.current;ot.style.bottom="0px";const pr=lt.clientHeight-mt.offsetTop-mt.offsetHeight,Et=Math.max(Jt,rr+(hr?tr:0)+pr+It),Rt=nr+Et;ot.style.height=Rt+"px"}else{const hr=ht===$t[0].ref.current;ot.style.top="0px";const Et=Math.max(Yt,Pt+mt.offsetTop+(hr?Gt:0)+rr)+vr;ot.style.height=Et+"px",mt.scrollTop=nr-Yt+mt.offsetTop}ot.style.margin=`${$cc7e05a45900e73f$var$CONTENT_MARGIN}px 0`,ot.style.minHeight=Ht+"px",ot.style.maxHeight=Lt+"px",rt==null||rt(),requestAnimationFrame(()=>ft.current=!0)}},[dt,it.trigger,it.valueNode,ot,lt,mt,ht,gt,it.dir,rt]);$9f79659886946c16$export$e5c5a5f917a5871c(()=>yt(),[yt]);const[bt,xt]=p$2();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{lt&&xt(window.getComputedStyle(lt).zIndex)},[lt]);const _t=x$3(wt=>{wt&&pt.current===!0&&(yt(),vt==null||vt(),pt.current=!1)},[yt,vt]);return y$3($cc7e05a45900e73f$var$SelectViewportProvider,{scope:tt,contentWrapper:ot,shouldExpandOnScrollRef:ft,onScrollButtonChange:_t},y$3("div",{ref:at,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:bt}},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},nt,{ref:ct,style:{boxSizing:"border-box",maxHeight:"100%",...nt.style}}))))}),$cc7e05a45900e73f$var$SelectPopperPosition=N$2((et,_e)=>{const{__scopeSelect:tt,align:rt="start",collisionPadding:nt=$cc7e05a45900e73f$var$CONTENT_MARGIN,...it}=et,st=$cc7e05a45900e73f$var$usePopperScope(tt);return y$3($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({},st,it,{ref:_e,align:rt,collisionPadding:nt,style:{boxSizing:"border-box",...it.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}}))}),[$cc7e05a45900e73f$var$SelectViewportProvider,$cc7e05a45900e73f$var$useSelectViewportContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,{}),$cc7e05a45900e73f$var$VIEWPORT_NAME="SelectViewport",$cc7e05a45900e73f$export$9ed6e7b40248d36d=N$2((et,_e)=>{const{__scopeSelect:tt,...rt}=et,nt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$VIEWPORT_NAME,tt),it=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$VIEWPORT_NAME,tt),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,nt.onViewportChange),ot=F$2(0);return y$3(g$3,null,y$3("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"}}),y$3($cc7e05a45900e73f$var$Collection.Slot,{scope:tt},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-radix-select-viewport":"",role:"presentation"},rt,{ref:st,style:{position:"relative",flex:1,overflow:"auto",...rt.style},onScroll:$e42e1063c40fb3ef$export$b9ecd428b558ff10(rt.onScroll,at=>{const lt=at.currentTarget,{contentWrapper:ut,shouldExpandOnScrollRef:ct}=it;if(ct!=null&&ct.current&&ut){const dt=Math.abs(ot.current-lt.scrollTop);if(dt>0){const ft=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,pt=parseFloat(ut.style.minHeight),mt=parseFloat(ut.style.height),ht=Math.max(pt,mt);if(ht<ft){const gt=ht+dt,vt=Math.min(ft,gt),yt=gt-vt;ut.style.height=vt+"px",ut.style.bottom==="0px"&&(lt.scrollTop=yt>0?yt:0,ut.style.justifyContent="flex-end")}}}ot.current=lt.scrollTop})}))))}),$cc7e05a45900e73f$var$GROUP_NAME="SelectGroup",[$cc7e05a45900e73f$var$SelectGroupContextProvider,$cc7e05a45900e73f$var$useSelectGroupContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$GROUP_NAME),$cc7e05a45900e73f$export$ee25a334c55de1f4=N$2((et,_e)=>{const{__scopeSelect:tt,...rt}=et,nt=$1746a345f3d73bb7$export$f680877a34711e37();return y$3($cc7e05a45900e73f$var$SelectGroupContextProvider,{scope:tt,id:nt},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"group","aria-labelledby":nt},rt,{ref:_e})))}),$cc7e05a45900e73f$var$LABEL_NAME="SelectLabel",$cc7e05a45900e73f$export$f67338d29bd972f8=N$2((et,_e)=>{const{__scopeSelect:tt,...rt}=et,nt=$cc7e05a45900e73f$var$useSelectGroupContext($cc7e05a45900e73f$var$LABEL_NAME,tt);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({id:nt.id},rt,{ref:_e}))}),$cc7e05a45900e73f$var$ITEM_NAME="SelectItem",[$cc7e05a45900e73f$var$SelectItemContextProvider,$cc7e05a45900e73f$var$useSelectItemContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$ITEM_NAME),$cc7e05a45900e73f$export$13ef48a934230896=N$2((et,_e)=>{const{__scopeSelect:tt,value:rt,disabled:nt=!1,textValue:it,...st}=et,ot=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_NAME,tt),at=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_NAME,tt),lt=ot.value===rt,[ut,ct]=p$2(it??""),[dt,ft]=p$2(!1),pt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,gt=>{var vt;return(vt=at.itemRefCallback)===null||vt===void 0?void 0:vt.call(at,gt,rt,nt)}),mt=$1746a345f3d73bb7$export$f680877a34711e37(),ht=()=>{nt||(ot.onValueChange(rt),ot.onOpenChange(!1))};if(rt==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return y$3($cc7e05a45900e73f$var$SelectItemContextProvider,{scope:tt,value:rt,disabled:nt,textId:mt,isSelected:lt,onItemTextChange:x$3(gt=>{ct(vt=>{var yt;return vt||((yt=gt==null?void 0:gt.textContent)!==null&&yt!==void 0?yt:"").trim()})},[])},y$3($cc7e05a45900e73f$var$Collection.ItemSlot,{scope:tt,value:rt,disabled:nt,textValue:ut},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"option","aria-labelledby":mt,"data-highlighted":dt?"":void 0,"aria-selected":lt&&dt,"data-state":lt?"checked":"unchecked","aria-disabled":nt||void 0,"data-disabled":nt?"":void 0,tabIndex:nt?void 0:-1},st,{ref:pt,onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(st.onFocus,()=>ft(!0)),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(st.onBlur,()=>ft(!1)),onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(st.onPointerUp,ht),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(st.onPointerMove,gt=>{if(nt){var vt;(vt=at.onItemLeave)===null||vt===void 0||vt.call(at)}else gt.currentTarget.focus({preventScroll:!0})}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(st.onPointerLeave,gt=>{if(gt.currentTarget===document.activeElement){var vt;(vt=at.onItemLeave)===null||vt===void 0||vt.call(at)}}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(st.onKeyDown,gt=>{var vt;((vt=at.searchRef)===null||vt===void 0?void 0:vt.current)!==""&&gt.key===" "||($cc7e05a45900e73f$var$SELECTION_KEYS.includes(gt.key)&&ht(),gt.key===" "&&gt.preventDefault())})}))))}),$cc7e05a45900e73f$var$ITEM_TEXT_NAME="SelectItemText",$cc7e05a45900e73f$export$3572fb0fb821ff49=N$2((et,_e)=>{const{__scopeSelect:tt,className:rt,style:nt,...it}=et,st=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,tt),ot=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,tt),at=$cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,tt),lt=$cc7e05a45900e73f$var$useSelectNativeOptionsContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,tt),[ut,ct]=p$2(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,gt=>ct(gt),at.onItemTextChange,gt=>{var vt;return(vt=ot.itemTextRefCallback)===null||vt===void 0?void 0:vt.call(ot,gt,at.value,at.disabled)}),ft=ut==null?void 0:ut.textContent,pt=q$2(()=>y$3("option",{key:at.value,value:at.value,disabled:at.disabled},ft),[at.disabled,at.value,ft]),{onNativeOptionAdd:mt,onNativeOptionRemove:ht}=lt;return $9f79659886946c16$export$e5c5a5f917a5871c(()=>(mt(pt),()=>ht(pt)),[mt,ht,pt]),y$3(g$3,null,y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({id:at.textId},it,{ref:dt})),at.isSelected&&st.valueNode&&!st.valueNodeHasChildren?reactDomExports.createPortal(it.children,st.valueNode):null)}),$cc7e05a45900e73f$var$ITEM_INDICATOR_NAME="SelectItemIndicator",$cc7e05a45900e73f$export$6b9198de19accfe6=N$2((et,_e)=>{const{__scopeSelect:tt,...rt}=et;return $cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_INDICATOR_NAME,tt).isSelected?y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},rt,{ref:_e})):null}),$cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",$cc7e05a45900e73f$export$d8117927658af6d7=N$2((et,_e)=>{const tt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,et.__scopeSelect),rt=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,et.__scopeSelect),[nt,it]=p$2(!1),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,rt.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(tt.viewport&&tt.isPositioned){let at=function(){const lt=ot.scrollTop>0;it(lt)};const ot=tt.viewport;return at(),ot.addEventListener("scroll",at),()=>ot.removeEventListener("scroll",at)}},[tt.viewport,tt.isPositioned]),nt?y$3($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},et,{ref:st,onAutoScroll:()=>{const{viewport:ot,selectedItem:at}=tt;ot&&at&&(ot.scrollTop=ot.scrollTop-at.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",$cc7e05a45900e73f$export$ff951e476c12189=N$2((et,_e)=>{const tt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,et.__scopeSelect),rt=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,et.__scopeSelect),[nt,it]=p$2(!1),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,rt.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(tt.viewport&&tt.isPositioned){let at=function(){const lt=ot.scrollHeight-ot.clientHeight,ut=Math.ceil(ot.scrollTop)<lt;it(ut)};const ot=tt.viewport;return at(),ot.addEventListener("scroll",at),()=>ot.removeEventListener("scroll",at)}},[tt.viewport,tt.isPositioned]),nt?y$3($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},et,{ref:st,onAutoScroll:()=>{const{viewport:ot,selectedItem:at}=tt;ot&&at&&(ot.scrollTop=ot.scrollTop+at.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SelectScrollButtonImpl=N$2((et,_e)=>{const{__scopeSelect:tt,onAutoScroll:rt,...nt}=et,it=$cc7e05a45900e73f$var$useSelectContentContext("SelectScrollButton",tt),st=F$2(null),ot=$cc7e05a45900e73f$var$useCollection(tt),at=x$3(()=>{st.current!==null&&(window.clearInterval(st.current),st.current=null)},[]);return _(()=>()=>at(),[at]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{var lt;const ut=ot().find(ct=>ct.ref.current===document.activeElement);ut==null||(lt=ut.ref.current)===null||lt===void 0||lt.scrollIntoView({block:"nearest"})},[ot]),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"aria-hidden":!0},nt,{ref:_e,style:{flexShrink:0,...nt.style},onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onPointerDown,()=>{st.current===null&&(st.current=window.setInterval(rt,50))}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onPointerMove,()=>{var lt;(lt=it.onItemLeave)===null||lt===void 0||lt.call(it),st.current===null&&(st.current=window.setInterval(rt,50))}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onPointerLeave,()=>{at()})}))});function $cc7e05a45900e73f$var$shouldShowPlaceholder(et){return et===""||et===void 0}const $cc7e05a45900e73f$var$BubbleSelect=N$2((et,_e)=>{const{value:tt,...rt}=et,nt=F$2(null),it=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,nt),st=$010c2913dbd2fe3d$export$5cae361ad82dce8b(tt);return _(()=>{const ot=nt.current,at=window.HTMLSelectElement.prototype,ut=Object.getOwnPropertyDescriptor(at,"value").set;if(st!==tt&&ut){const ct=new Event("change",{bubbles:!0});ut.call(ot,tt),ot.dispatchEvent(ct)}},[st,tt]),y$3($ea1ef594cf570d83$export$439d29a4e110a164,{asChild:!0},y$3("select",_extends$1({},rt,{ref:it,defaultValue:tt})))});$cc7e05a45900e73f$var$BubbleSelect.displayName="BubbleSelect";function $cc7e05a45900e73f$var$useTypeaheadSearch(et){const _e=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(et),tt=F$2(""),rt=F$2(0),nt=x$3(st=>{const ot=tt.current+st;_e(ot),function at(lt){tt.current=lt,window.clearTimeout(rt.current),lt!==""&&(rt.current=window.setTimeout(()=>at(""),1e3))}(ot)},[_e]),it=x$3(()=>{tt.current="",window.clearTimeout(rt.current)},[]);return _(()=>()=>window.clearTimeout(rt.current),[]),[tt,nt,it]}function $cc7e05a45900e73f$var$findNextItem(et,_e,tt){const nt=_e.length>1&&Array.from(_e).every(lt=>lt===_e[0])?_e[0]:_e,it=tt?et.indexOf(tt):-1;let st=$cc7e05a45900e73f$var$wrapArray(et,Math.max(it,0));nt.length===1&&(st=st.filter(lt=>lt!==tt));const at=st.find(lt=>lt.textValue.toLowerCase().startsWith(nt.toLowerCase()));return at!==tt?at:void 0}function $cc7e05a45900e73f$var$wrapArray(et,_e){return et.map((tt,rt)=>et[(_e+rt)%et.length])}const $cc7e05a45900e73f$export$be92b6f5f03c0fe9=$cc7e05a45900e73f$export$ef9b1a59e592288f,$cc7e05a45900e73f$export$41fb9f06171c75f4=$cc7e05a45900e73f$export$3ac1e88a1c0b9f1,$cc7e05a45900e73f$export$7c6e2c02157bb7d2=$cc7e05a45900e73f$export$c973a4b3cb86a03d,$cc7e05a45900e73f$export$b04be29aa201d4f5=$cc7e05a45900e73f$export$f67338d29bd972f8,$cc7e05a45900e73f$export$6d08773d2e66f8f2=$cc7e05a45900e73f$export$13ef48a934230896,StyledSelectIcon=styled("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),StyledSelectButton=styled($cc7e05a45900e73f$export$41fb9f06171c75f4,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),StyledSelectContent=styled($cc7e05a45900e73f$export$7c6e2c02157bb7d2,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),StyledSelectItem=styled($cc7e05a45900e73f$export$6d08773d2e66f8f2,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),StyledSelectLabel=styled($cc7e05a45900e73f$export$b04be29aa201d4f5,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),StyledSelect=styled($cc7e05a45900e73f$export$be92b6f5f03c0fe9,{position:"relative",zIndex:"5",width:"100%"}),SelectIcon=({direction:et,title:_e})=>y$3(StyledSelectIcon,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},y$3("title",null,_e),et==="up"&&y$3(()=>y$3("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),null),et==="down"&&y$3(()=>y$3("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"}),null)),Select=({children:et,label:_e,maxHeight:tt,onValueChange:rt,value:nt})=>y$3(StyledSelect,{onValueChange:rt,value:nt},y$3(StyledSelectButton,{"data-testid":"select-button"},y$3($cc7e05a45900e73f$export$e288731fd71264f0,{"data-testid":"select-button-value"}),y$3($cc7e05a45900e73f$export$99b400cabb58c515,null,y$3(SelectIcon,{direction:"down",title:"select"}))),y$3($cc7e05a45900e73f$export$b2af6c9944296213,null,y$3(StyledSelectContent,{css:{maxHeight:`${tt} !important`},"data-testid":"select-content"},y$3($cc7e05a45900e73f$export$d8117927658af6d7,null,y$3(SelectIcon,{direction:"up",title:"scroll up for more"})),y$3($cc7e05a45900e73f$export$9ed6e7b40248d36d,null,y$3($cc7e05a45900e73f$export$ee25a334c55de1f4,null,_e&&y$3(StyledSelectLabel,null,y$3(Label$1,{"data-testid":"select-label",label:_e})),et)),y$3($cc7e05a45900e73f$export$ff951e476c12189,null,y$3(SelectIcon,{direction:"down",title:"scroll down for more"}))))),SelectOption=et=>y$3(StyledSelectItem,{...et},et.thumbnail&&y$3(Thumbnail$1,{thumbnail:et.thumbnail}),y$3($cc7e05a45900e73f$export$3572fb0fb821ff49,null,y$3(Label$1,{label:et.label})),y$3($cc7e05a45900e73f$export$6b9198de19accfe6,null)),Navigator=styled("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),Viewport=styled("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),Wrapper$1=styled("div",{width:"100%",height:"61.8vh",maxHeight:"100vh",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"}),Button=({id:et,label:_e,children:tt})=>y$3(Item,{id:et,"data-testid":"openseadragon-button"},y$3("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${et}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},y$3("title",{id:`${et}-svg-title`},_e),tt)),Wrapper=styled("div",{position:"absolute",zIndex:"1",top:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),ZoomIn=()=>y$3("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),ZoomOut=()=>y$3("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),ZoomFullScreen=()=>y$3("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),Reset=()=>y$3("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),Rotate=()=>y$3(g$3,null,y$3("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),y$3("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),Controls=({hasPlaceholder:et,options:_e})=>y$3(Wrapper,{"data-testid":"openseadragon-controls",hasPlaceholder:et,id:"openseadragon-controls"},_e.showZoomControl&&y$3(g$3,null,y$3(Button,{id:"zoomIn",label:"zoom in"},y$3(ZoomIn,null)),y$3(Button,{id:"zoomOut",label:"zoom out"},y$3(ZoomOut,null))),_e.showFullPageControl&&y$3(Button,{id:"fullPage",label:"full page"},y$3(ZoomFullScreen,null)),_e.showRotationControl&&y$3(g$3,null,y$3(Button,{id:"rotateRight",label:"rotate right"},y$3(Rotate,null)),y$3(Button,{id:"rotateLeft",label:"rotate left"},y$3(Rotate,null))),_e.showHomeControl&&y$3(Button,{id:"reset",label:"reset"},y$3(Reset,null))),getInfoResponse=et=>fetch(`${et.replace(/\/$/,"")}/info.json`).then(_e=>_e.json()).then(_e=>_e).catch(_e=>{console.error(`The IIIF tilesource ${et.replace(/\/$/,"")}/info.json failed to load: ${_e}`)}),getImageServiceURI=et=>{let _e,tt;if(Array.isArray(et)&&(_e=et[0],_e)){let rt;"@id"in _e?rt=_e["@id"]:rt=_e.id,tt=rt}return tt},OSD=({uri:et,hasPlaceholder:_e,imageType:tt,annotationResources:rt})=>{var ht,gt;const[nt,it]=p$2(),[st,ot]=p$2(),at=useViewerState(),{configOptions:lt,vault:ut,activeCanvas:ct}=at,dt=useViewerDispatch(),ft=ut.get({id:ct,type:"Canvas"}),pt={id:`openseadragon-viewport-${st}`,loadTilesWithAjax:!0,fullPageButton:"fullPage",homeButton:"reset",rotateLeftButton:"rotateLeft",rotateRightButton:"rotateRight",zoomInButton:"zoomIn",zoomOutButton:"zoomOut",showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",navigatorId:`openseadragon-navigator-${st}`,gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!0},...lt.openSeadragon,ajaxWithCredentials:lt.withCredentials},mt=[];return(gt=(ht=rt[0])==null?void 0:ht.items)==null||gt.forEach(vt=>{const yt=ut.get(vt.id);mt.push(yt)}),_(()=>{et!==nt&&(it(et),ot(v4()))},[nt,et]),_(()=>{var vt;if(nt)switch(tt){case"simpleImage":const yt=OpenSeadragon(pt);yt.addSimpleImage({url:nt}),dt({type:"updateOpenSeadragonViewer",openSeadragonViewer:yt}),(vt=lt.annotationOverlays)!=null&&vt.renderOverlays&&addOverlaysToViewer(yt,ft,lt,mt);break;case"tiledImage":getInfoResponse(nt).then(bt=>{var _t;const xt=OpenSeadragon(pt);xt.addTiledImage({tileSource:bt}),dt({type:"updateOpenSeadragonViewer",openSeadragonViewer:xt}),(_t=lt.annotationOverlays)!=null&&_t.renderOverlays&&addOverlaysToViewer(xt,ft,lt,mt)});break;default:console.warn(`Unable to render ${nt} in OpenSeadragon as type: "${tt}"`);break}},[nt]),st?y$3(Wrapper$1,{css:{backgroundColor:lt.canvasBackgroundColor,height:lt.canvasHeight},className:"clover-viewer-osd-wrapper","data-testid":"clover-viewer-osd-wrapper"},y$3(Controls,{hasPlaceholder:_e,options:pt}),y$3(Navigator,{id:`openseadragon-navigator-${st}`}),y$3(Viewport,{id:`openseadragon-viewport-${st}`})):null},ImageViewer=({painting:et,hasPlaceholder:_e,annotationResources:tt})=>{const[rt,nt]=p$2(),[it,st]=p$2();return _(()=>{Array.isArray(et==null?void 0:et.service)&&(et==null?void 0:et.service.length)>0?(nt("tiledImage"),st(getImageServiceURI(et==null?void 0:et.service))):(nt("simpleImage"),st(et==null?void 0:et.id))},[et]),y$3(OSD,{uri:it,key:it,hasPlaceholder:_e,imageType:rt,annotationResources:tt})},PaintingPlaceholder=({isMedia:et,label:_e,placeholderCanvas:tt,setIsInteractive:rt})=>{const{vault:nt}=useViewerState(),it=getPaintingResource(nt,tt),st=it?it[0]:void 0,ot=_e?getLabel(_e):["placeholder image"];return y$3(PlaceholderStyled,{onClick:()=>rt(!0),isMedia:et,className:"clover-viewer-placeholder"},y$3("img",{src:(st==null?void 0:st.id)||"",alt:ot.join(),height:st==null?void 0:st.height,width:st==null?void 0:st.width}))},AudioVisualizerWrapper=styled("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),AudioVisualizer=wn.forwardRef((et,_e)=>{const tt=wn.useRef(null),rt=x$3(()=>{var ft,pt;if((ft=_e.current)!=null&&ft.currentTime&&((pt=_e.current)==null?void 0:pt.currentTime)>0)return;const it=_e.current;if(!it)return;const st=new AudioContext,ot=st.createMediaElementSource(it),at=st.createAnalyser(),lt=tt.current;if(!lt)return;lt.width=it.offsetWidth,lt.height=it.offsetHeight;const ut=lt.getContext("2d");ot.connect(at),at.connect(st.destination),at.fftSize=256;const ct=at.frequencyBinCount,dt=new Uint8Array(ct);setInterval(function(){nt(at,ut,ct,dt,lt.width,lt.height)},20)},[_e]);wn.useEffect(()=>{!_e||!_e.current||(_e.current.onplay=rt)},[rt,_e]);function nt(it,st,ot,at,lt,ut){const ct=lt/ot*2.6;let dt,ft=0;it.getByteFrequencyData(at),st.fillStyle="#000000",st.fillRect(0,0,lt,ut);for(let pt=0;pt<ot;pt++)dt=at[pt]*2,st.fillStyle="rgba(78, 42, 132, 1)",st.fillRect(ft,ut-dt,ct,dt),ft+=ct+6}return y$3(AudioVisualizerWrapper,{ref:tt,role:"presentation"})}),PlayerWrapper=styled("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"500px",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),Track=({resource:et,ignoreCaptionLabels:_e})=>{const tt=getLabel(et.label,"en");return Array.isArray(tt)&&tt.some(nt=>_e.includes(nt))?null:y$3("track",{key:et.id,src:et.id,label:Array.isArray(tt)?tt[0]:tt,srcLang:"en","data-testid":"player-track"})},Player=({allSources:et,annotationResources:_e,painting:tt})=>{const[rt,nt]=wn.useState(0),[it,st]=wn.useState(),ot=wn.useRef(null),at=(tt==null?void 0:tt.type)==="Sound",lt=useViewerState(),{activeCanvas:ut,configOptions:ct,vault:dt}=lt;return _(()=>{if(!tt.id||!ot.current)return;if(ot!=null&&ot.current){const mt=ot.current;mt.src=tt.id,mt.load()}if(tt.id.split(".").pop()!=="m3u8")return;const ft={xhrSetup:function(mt,ht){mt.withCredentials=!!ct.withCredentials}},pt=new Hls(ft);return pt.attachMedia(ot.current),pt.on(Hls.Events.MEDIA_ATTACHED,function(){pt.loadSource(tt.id)}),pt.on(Hls.Events.ERROR,function(mt,ht){if(ht.fatal)switch(ht.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${mt} network error encountered, try to recover`),pt.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${mt} media error encountered, try to recover`),pt.recoverMediaError();break;default:pt.destroy();break}}),()=>{if(pt&&ot.current){const mt=ot.current;pt.detachMedia(),pt.destroy(),mt.currentTime=0}}},[ct.withCredentials,tt.id]),_(()=>{var gt,vt,yt,bt;const ft=dt.get(ut),pt=(gt=ft.accompanyingCanvas)!=null&&gt.id?getPaintingResource(dt,(vt=ft.accompanyingCanvas)==null?void 0:vt.id):null,mt=(yt=ft.placeholderCanvas)!=null&&yt.id?getPaintingResource(dt,(bt=ft.placeholderCanvas)==null?void 0:bt.id):null;!!(pt&&mt)?st(rt===0?mt[0].id:pt[0].id):(pt&&st(pt[0].id),mt&&st(mt[0].id))},[ut,rt,dt]),_(()=>{if(ot!=null&&ot.current){const ft=ot.current;return ft==null||ft.addEventListener("timeupdate",()=>nt(ft.currentTime)),()=>document.removeEventListener("timeupdate",()=>{})}},[]),y$3(PlayerWrapper,{css:{backgroundColor:ct.canvasBackgroundColor,maxHeight:ct.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},y$3("video",{id:"clover-iiif-video",key:tt.id,ref:ot,controls:!0,height:tt.height,width:tt.width,crossOrigin:"anonymous",poster:it,style:{maxHeight:ct.canvasHeight,position:"relative",zIndex:"1"}},et.map(ft=>y$3("source",{src:ft.id,type:ft.format,key:ft.id})),(_e==null?void 0:_e.length)>0&&_e.map(ft=>{const pt=[];return ft.items.forEach(mt=>{dt.get(mt.id).body.forEach(gt=>{const vt=dt.get(gt.id);pt.push(vt)})}),pt.map(mt=>y$3(Track,{resource:mt,ignoreCaptionLabels:ct.ignoreCaptionLabels||[],key:mt.id}))}),"Sorry, your browser doesn't support embedded videos."),at&&y$3(AudioVisualizer,{ref:ot}))},CloseIcon=()=>y$3("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},y$3("title",{id:"close-svg-title"},"close"),y$3("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),OpenIcon=({isMedia:et})=>y$3("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},y$3("title",{id:"open-svg-title"},"open"),et?y$3("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):y$3(g$3,null,y$3("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),y$3("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),Toggle$1=({handleToggle:et,isInteractive:_e,isMedia:tt})=>y$3(ToggleStyled,{onClick:et,isInteractive:_e,isMedia:tt,"data-testid":"placeholder-toggle"},_e?y$3(CloseIcon,null):y$3(OpenIcon,{isMedia:tt})),Painting=({activeCanvas:et,annotationResources:_e,isMedia:tt,painting:rt})=>{var bt,xt,_t;const[nt,it]=wn.useState(0),[st,ot]=wn.useState(!1),{configOptions:at,customDisplays:lt,vault:ut}=useViewerState(),ct=ut.get(et),dt=(bt=ct==null?void 0:ct.placeholderCanvas)==null?void 0:bt.id,ft=!!dt,pt=(rt==null?void 0:rt.length)>1,mt=dt&&!st&&!tt,ht=()=>ot(!st),gt=wt=>{const Ct=rt.findIndex(kt=>kt.id===wt);it(Ct)},vt=lt.find(wt=>{var $t;let Ct=!1;const{canvasId:kt,paintingFormat:At}=wt.target;if(Array.isArray(kt)&&kt.length>0&&(Ct=kt.includes(et)),Array.isArray(At)&&At.length>0){const Lt=(($t=rt[nt])==null?void 0:$t.format)||"";Ct=!!(Lt&&At.includes(Lt))}return Ct}),yt=(xt=vt==null?void 0:vt.display)==null?void 0:xt.component;return y$3(PaintingStyled,{className:"clover-viewer-painting"},y$3(PaintingCanvas,{style:{backgroundColor:at.canvasBackgroundColor,maxHeight:at.canvasHeight}},dt&&!tt&&y$3(Toggle$1,{handleToggle:ht,isInteractive:st,isMedia:tt}),mt&&!tt&&y$3(PaintingPlaceholder,{isMedia:tt,label:ct==null?void 0:ct.label,placeholderCanvas:dt,setIsInteractive:ot}),!mt&&!vt&&(tt?y$3(Player,{allSources:rt,painting:rt[nt],annotationResources:_e}):rt&&y$3(ImageViewer,{painting:rt[nt],hasPlaceholder:ft,key:et,annotationResources:_e})),!mt&&yt&&y$3(yt,{id:et,annotationBody:rt[nt],...vt==null?void 0:vt.display.componentProps})),pt&&y$3(Select,{value:(_t=rt[nt])==null?void 0:_t.id,onValueChange:gt,maxHeight:"200px"},rt==null?void 0:rt.map(wt=>y$3(SelectOption,{value:wt==null?void 0:wt.id,key:wt==null?void 0:wt.id,label:wt==null?void 0:wt.label}))))},ViewerContent=({activeCanvas:et,annotationResources:_e,isAudioVideo:tt,items:rt,painting:nt})=>{const{informationOpen:it,configOptions:st}=useViewerState(),{informationPanel:ot}=st,at=(ot==null?void 0:ot.renderAbout)||(ot==null?void 0:ot.renderAnnotation)&&_e.length>0;return y$3(Content$2,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},y$3(Main,null,y$3(Painting,{activeCanvas:et,annotationResources:_e,isMedia:tt,painting:nt}),at&&y$3(CollapsibleTrigger,null,y$3("span",null,it?"View Items":"More Information")),rt.length>1&&y$3(MediaWrapper,{className:"clover-viewer-media-wrapper"},y$3(Media,{items:rt,activeItem:0}))),it&&at&&y$3(Aside,null,y$3(CollapsibleContent,null,y$3(InformationPanel,{activeCanvas:et,annotationResources:_e}))))},IIIFBadgeButton=styled(Popover.Trigger,{width:"30px",padding:"5px"}),IIIFBadgeContent=styled(Popover.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),ManifestLabel=styled("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Header=styled("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${StyledSelect}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),HeaderOptions=styled("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Collection=()=>{var at;const et=useViewerDispatch(),_e=useViewerState(),{activeManifest:tt,collection:rt,configOptions:nt,vault:it}=_e,st=nt==null?void 0:nt.canvasHeight,ot=lt=>{et({type:"updateActiveManifest",manifestId:lt})};return y$3("div",{style:{margin:"0.75rem"}},y$3(Select,{label:rt.label,maxHeight:st,value:tt,onValueChange:ot},(at=rt==null?void 0:rt.items)==null?void 0:at.map(lt=>y$3(SelectOption,{value:lt.id,key:lt.id,thumbnail:lt!=null&&lt.thumbnail?it.get(lt==null?void 0:lt.thumbnail):void 0,label:lt.label}))))},useCopyToClipboard=(et,_e=2500)=>{const[tt,rt]=p$2(),nt=x$3(()=>{navigator.clipboard.writeText(et).then(()=>rt("copied"),()=>rt("failed"))},[et]);return _(()=>{if(!tt)return;const it=setTimeout(()=>rt(void 0),_e);return()=>clearTimeout(it)},[tt]),[tt,nt]},Status=styled("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),CopyTextStatus=({status:et})=>et?y$3(Status,{"data-copy-status":et},et):null,CopyText=({textPrompt:et,textToCopy:_e})=>{const[tt,rt]=useCopyToClipboard(_e);return y$3("button",{onClick:rt},et," ",y$3(CopyTextStatus,{status:tt}))},IIIFBadge=()=>{const et="#ed1d33",_e="#2873ab";return y$3("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},y$3("title",null,"IIIF Manifest Options"),y$3("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},y$3("g",{transform:"scale(0.1)"},y$3("path",{style:{fill:_e},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),y$3("path",{style:{fill:_e},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),y$3("path",{style:{fill:et},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),y$3("path",{style:{fill:et},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),y$3("path",{style:{fill:_e},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),y$3("path",{style:{fill:_e},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),y$3("path",{style:{fill:et},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},$6be4966fd9bbc698$var$SWITCH_NAME="Switch",[$6be4966fd9bbc698$var$createSwitchContext,$6be4966fd9bbc698$export$cf7f5f17f69cbd43]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($6be4966fd9bbc698$var$SWITCH_NAME),[$6be4966fd9bbc698$var$SwitchProvider,$6be4966fd9bbc698$var$useSwitchContext]=$6be4966fd9bbc698$var$createSwitchContext($6be4966fd9bbc698$var$SWITCH_NAME),$6be4966fd9bbc698$export$b5d5cf8927ab7262=N$2((et,_e)=>{const{__scopeSwitch:tt,name:rt,checked:nt,defaultChecked:it,required:st,disabled:ot,value:at="on",onCheckedChange:lt,...ut}=et,[ct,dt]=p$2(null),ft=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_e,vt=>dt(vt)),pt=F$2(!1),mt=ct?!!ct.closest("form"):!0,[ht=!1,gt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:nt,defaultProp:it,onChange:lt});return y$3($6be4966fd9bbc698$var$SwitchProvider,{scope:tt,checked:ht,disabled:ot},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"switch","aria-checked":ht,"aria-required":st,"data-state":$6be4966fd9bbc698$var$getState(ht),"data-disabled":ot?"":void 0,disabled:ot,value:at},ut,{ref:ft,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(et.onClick,vt=>{gt(yt=>!yt),mt&&(pt.current=vt.isPropagationStopped(),pt.current||vt.stopPropagation())})})),mt&&y$3($6be4966fd9bbc698$var$BubbleInput,{control:ct,bubbles:!pt.current,name:rt,value:at,checked:ht,required:st,disabled:ot,style:{transform:"translateX(-100%)"}}))}),$6be4966fd9bbc698$var$THUMB_NAME="SwitchThumb",$6be4966fd9bbc698$export$4d07bf653ea69106=N$2((et,_e)=>{const{__scopeSwitch:tt,...rt}=et,nt=$6be4966fd9bbc698$var$useSwitchContext($6be4966fd9bbc698$var$THUMB_NAME,tt);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"data-state":$6be4966fd9bbc698$var$getState(nt.checked),"data-disabled":nt.disabled?"":void 0},rt,{ref:_e}))}),$6be4966fd9bbc698$var$BubbleInput=et=>{const{control:_e,checked:tt,bubbles:rt=!0,...nt}=et,it=F$2(null),st=$010c2913dbd2fe3d$export$5cae361ad82dce8b(tt),ot=$db6c3485150b8e66$export$1ab7ae714698c4b8(_e);return _(()=>{const at=it.current,lt=window.HTMLInputElement.prototype,ct=Object.getOwnPropertyDescriptor(lt,"checked").set;if(st!==tt&&ct){const dt=new Event("click",{bubbles:rt});ct.call(at,tt),at.dispatchEvent(dt)}},[st,tt,rt]),y$3("input",_extends$1({type:"checkbox","aria-hidden":!0,defaultChecked:tt},nt,{tabIndex:-1,ref:it,style:{...et.style,...ot,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $6be4966fd9bbc698$var$getState(et){return et?"checked":"unchecked"}const $6be4966fd9bbc698$export$be92b6f5f03c0fe9=$6be4966fd9bbc698$export$b5d5cf8927ab7262,$6be4966fd9bbc698$export$6521433ed15a34db=$6be4966fd9bbc698$export$4d07bf653ea69106,StyledSwitch=styled($6be4966fd9bbc698$export$be92b6f5f03c0fe9,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),StyledThumb=styled($6be4966fd9bbc698$export$6521433ed15a34db,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),Label=styled("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"}),StyledToggle=styled("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Toggle=()=>{var nt;const{configOptions:et}=useViewerState(),_e=useViewerDispatch(),[tt,rt]=p$2((nt=et==null?void 0:et.informationPanel)==null?void 0:nt.open);return _(()=>{_e({type:"updateInformationOpen",informationOpen:tt})},[tt]),y$3(StyledToggle,null,y$3(Label,{htmlFor:"information-toggle",css:tt?{opacity:"1"}:{}},"More Information"),y$3(StyledSwitch,{checked:tt,onCheckedChange:()=>rt(!tt),id:"information-toggle","aria-label":"information panel toggle",name:"toggled?"},y$3(StyledThumb,null)))},useMediaQuery=et=>{const _e=()=>window.matchMedia?window.matchMedia(et).matches:!1,[tt,rt]=p$2(_e);return _(()=>{const nt=()=>rt(_e);return window.addEventListener("resize",nt),()=>window.removeEventListener("resize",nt)}),tt},ViewerHeader=({manifestId:et,manifestLabel:_e})=>{const tt=useViewerState(),{collection:rt,configOptions:nt}=tt,{showTitle:it,showIIIFBadge:st,informationPanel:ot}=nt,at=st||(ot==null?void 0:ot.renderToggle),lt=useMediaQuery(media.sm);return y$3(Header,{className:"clover-viewer-header"},rt!=null&&rt.items?y$3(Collection,null):y$3(ManifestLabel,{className:it?"":"visually-hidden"},it&&y$3(Label$1,{label:_e,className:"label"})),at&&y$3(HeaderOptions,null,st&&y$3(Popover,null,y$3(IIIFBadgeButton,null,y$3(IIIFBadge,null)),y$3(IIIFBadgeContent,null,(rt==null?void 0:rt.items)&&y$3("button",{onClick:ut=>{ut.preventDefault(),window.open(rt.id,"_blank")}},"View Collection"),y$3("button",{onClick:ut=>{ut.preventDefault(),window.open(et,"_blank")}},"View Manifest")," ",(rt==null?void 0:rt.items)&&y$3(CopyText,{textPrompt:"Copy Collection URL",textToCopy:rt.id}),y$3(CopyText,{textPrompt:"Copy Manifest URL",textToCopy:et}))),(ot==null?void 0:ot.renderToggle)&&!lt&&y$3(Toggle,null)))},useBodyLocked=(et=!1)=>{const[_e,tt]=p$2(et);return A$3(()=>{if(!_e)return;const rt=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=rt}},[_e]),_(()=>{_e!==et&&tt(et)},[et]),[_e,tt]},Viewer=({manifest:et,theme:_e})=>{var bt;const tt=useViewerState(),rt=useViewerDispatch(),{activeCanvas:nt,informationOpen:it,vault:st,configOptions:ot}=tt,[at,lt]=p$2(!1),[ut,ct]=p$2(!1),[dt,ft]=p$2([]),[pt,mt]=p$2([]),[ht,gt]=useBodyLocked(!1),vt=useMediaQuery(media.sm),yt=x$3(xt=>{rt({type:"updateInformationOpen",informationOpen:xt})},[rt]);return _(()=>{var xt;(xt=ot==null?void 0:ot.informationPanel)!=null&&xt.open&&yt(!vt)},[vt,(bt=ot==null?void 0:ot.informationPanel)==null?void 0:bt.open,yt]),_(()=>{if(!vt){gt(!1);return}gt(it)},[it,vt,gt]),_(()=>{const xt=getPaintingResource(st,nt);xt&&(ct(["Sound","Video"].indexOf(xt[0].type)>-1),ft(xt)),mt(getAnnotationResources(st,nt)),lt(pt.length!==0)},[nt,pt.length,st]),y$3(ErrorBoundary,{FallbackComponent:ErrorFallback},y$3(Wrapper$4,{className:`${_e} clover-viewer`,css:{background:ot==null?void 0:ot.background},"data-body-locked":ht,"data-information-panel":at,"data-information-panel-open":it},y$3($409067139f391064$export$be92b6f5f03c0fe9,{open:it,onOpenChange:yt},y$3(ViewerHeader,{manifestLabel:et.label,manifestId:et.id}),y$3(ViewerContent,{activeCanvas:nt,painting:dt,annotationResources:pt,items:et.items,isAudioVideo:ut}))))},DEFAULT_REQUEST_OPTIONS={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function parseXHRResult(et){return{ok:et.status>=200&&et.status<300,status:et.status,statusText:et.statusText,headers:et.getAllResponseHeaders(),data:et.responseText,json:()=>JSON.parse(et.responseText)}}function errorResponse(et,_e=null){return{ok:!1,status:et.status,statusText:et.statusText,headers:et.getAllResponseHeaders(),data:_e||et.statusText,json:()=>JSON.parse(_e||et.statusText)}}function getRequest(et,_e=DEFAULT_REQUEST_OPTIONS){const tt=_e.headers||DEFAULT_REQUEST_OPTIONS.headers;return new Promise((rt,nt)=>{const it=new XMLHttpRequest;it.open("get",et),it.withCredentials=_e.withCredentials,tt&&Object.keys(tt).forEach(st=>it.setRequestHeader(st,tt[st])),it.onload=()=>{rt(parseXHRResult(it))},it.onerror=()=>{nt(errorResponse(it,"Failed to make request."))},it.ontimeout=()=>{nt(errorResponse(it,"Request took longer than expected."))},it.send()})}const CloverViewer=({canvasIdCallback:et=()=>{},customDisplays:_e=[],customTheme:tt,iiifContent:rt,id:nt,manifestId:it,options:st})=>{var at;let ot=rt;return nt&&(ot=nt),it&&(ot=it),y$3(ViewerProvider,{initialState:{...defaultState$1,customDisplays:_e,informationOpen:!!((at=st==null?void 0:st.informationPanel)!=null&&at.open),vault:new Vault({customFetcher:lt=>getRequest(lt,{withCredentials:st==null?void 0:st.withCredentials,headers:st==null?void 0:st.requestHeaders}).then(ut=>JSON.parse(ut.data))})}},y$3(RenderViewer,{iiifContent:ot,canvasIdCallback:et,customTheme:tt,options:st}))},RenderViewer=({canvasIdCallback:et,customTheme:_e,iiifContent:tt,options:rt})=>{const nt=useViewerDispatch(),it=useViewerState(),{activeCanvas:st,activeManifest:ot,isLoaded:at,vault:lt}=it,[ut,ct]=p$2(),[dt,ft]=p$2();let pt={};return _e&&(pt=Q("custom",_e)),_(()=>{et&&et(st)},[st,et]),_(()=>{ot&&lt.loadManifest(ot).then(mt=>{ft(mt),nt({type:"updateActiveCanvas",canvasId:mt.items[0]&&mt.items[0].id})}).catch(mt=>{console.error(`Manifest failed to load: ${mt}`)}).finally(()=>{nt({type:"updateIsLoaded",isLoaded:!0})})},[ot,nt,lt]),_(()=>{nt({type:"updateConfigOptions",configOptions:rt}),lt.load(tt).then(mt=>{ct(mt)}).catch(mt=>{console.error(`The IIIF resource ${tt} failed to load: ${mt}`)})},[nt,tt,rt,lt]),_(()=>{let mt=[];(ut==null?void 0:ut.type)==="Collection"?(nt({type:"updateCollection",collection:ut}),mt=ut.items.filter(ht=>ht.type==="Manifest").map(ht=>ht.id),mt.length>0&&nt({type:"updateActiveManifest",manifestId:mt[0]})):(ut==null?void 0:ut.type)==="Manifest"&&nt({type:"updateActiveManifest",manifestId:ut.id})},[nt,ut]),at?!dt||!dt.items?(console.log(`The IIIF manifest ${tt} failed to load.`),y$3(g$3,null)):dt.items.length===0?(console.log(`The IIIF manifest ${tt} does not contain canvases.`),y$3(g$3,null)):y$3(Viewer,{manifest:dt,theme:pt,key:dt.id}):y$3(g$3,null,"Loading")};function register(et,_e,tt,rt){function nt(){const st=Reflect.construct(HTMLElement,[],nt);return st._vdomComponent=et,st._shadowEnabled=rt&&rt.shadow,st._root=st._shadowEnabled?st.attachShadow({mode:"open"}):st,rt.onConstruct&&rt.onConstruct(st),st.ready=!1,st.whenReady=ot=>{st.ready?ot():st.addEventListener("ready",ot)},st}nt.prototype=Object.create(HTMLElement.prototype),nt.prototype.constructor=nt,nt.prototype.connectedCallback=connectedCallback,nt.prototype.attributeChangedCallback=attributeChangedCallback,nt.prototype.disconnectedCallback=disconnectedCallback,tt=tt||et.observedAttributes||Object.keys(et.propTypes||{}),nt.observedAttributes=tt,tt.forEach(st=>{Object.defineProperty(nt.prototype,st,{get(){return this._vdom?this._vdom.props[st]:(this._props||(this._props={}),this._props[st])},set(ot){this._vdom?(this._props[st]=ot,this.attributeChangedCallback(st,null,ot)):(this._props||(this._props={}),this._props[st]=ot,this._props[toCamelCase(st)]=ot);const at=typeof ot;(ot==null||at==="string"||at==="boolean"||at==="number")&&this.setAttribute(st,ot)}})}),rt.beforeCreate&&rt.beforeCreate(nt);const it=_e||et.tagName||et.displayName||et.name;if(!customElements.get(it))return customElements.define(_e||et.tagName||et.displayName||et.name,nt)}function ContextProvider(et){this.getChildContext=()=>et.context;const{context:_e,children:tt,...rt}=et;return F$3(tt,rt)}function connectedCallback(){const et=new CustomEvent("_preact",{detail:{},bubbles:!0,cancelable:!0});this.dispatchEvent(et);const _e=et.detail.context;this._vdom=y$3(ContextProvider,{...this._props,context:_e},toVdom(this,this._vdomComponent,this._shadowEnabled)),(this.hasAttribute("hydrate")?E$3:B$4)(this._vdom,this._root),this.ready||(this.ready=!0,this.dispatchEvent(new CustomEvent("ready",{detail:{},bubbles:!1,cancelable:!1})))}function toCamelCase(et){return et.replace(/-(\w)/g,(_e,tt)=>tt?tt.toUpperCase():"")}function attributeChangedCallback(et,_e,tt){if(!this._vdom)return;tt=tt??void 0;const rt={};rt[et]=tt,rt[toCamelCase(et)]=tt,this._vdom=F$3(this._vdom,rt),B$4(this._vdom,this._root)}function disconnectedCallback(){B$4(this._vdom=null,this._root)}function Slot(et,_e){const{shadow:tt,addContextListener:rt,removeContextListener:nt,...it}=et,st=ot=>{ot?(this.ref=ot,this._listener||(this._listener=at=>{at.stopPropagation(),at.detail.context=_e},rt(this._listener,this.ref))):nt(this._listener,this.ref)};return!tt&&!this._listener&&(this._listener=ot=>{ot.stopPropagation(),ot.detail.context=_e},rt(this._listener)),y$3(tt?"slot":g$3,{...it,ref:st})}function toVdom(et,_e,tt){if(et.nodeType===3)return et.data;if(et.nodeType!==1)return null;let rt=[],nt={},it=0,st=et.attributes,ot=et.childNodes;for(it=st.length;it--;)st[it].name!=="slot"&&(nt[st[it].name]=st[it].value,nt[toCamelCase(st[it].name)]=st[it].value);for(it=ot.length;it--;){const ut=ot[it],ct=toVdom(ut,null,tt),dt=ut.slot;dt?nt[dt]=y$3(Slot,{name:dt,shadow:tt,addContextListener(ft,pt=ut){pt.addEventListener("_preact",ft)},removeContextListener(ft,pt=ut){pt.removeEventListener("_preact",ft)}},ct):rt[it]=ct}const lt=_e?y$3(Slot,{shadow:tt,addContextListener(ut,ct=et){ct.addEventListener("_preact",ut)},removeContextListener(ut,ct=et){ct.removeEventListener("_preact",ut)}},rt):rt;return!tt&&_e&&(et.innerHTML=""),y$3(_e||et.nodeName.toLowerCase(),nt,lt)}function CloverViewerWebComponent(et){const _e=F$2(),{id:tt}=et;return A$3(()=>{et.__registerPublicApi&&et.__registerPublicApi(rt=>{_e.current=rt})},[]),y$3(CloverViewer,{id:tt})}const cloverViewerWCProps=["id"];typeof window<"u"&&register(CloverViewerWebComponent,"clover-viewer",cloverViewerWCProps,{shadow:!1,onConstruct(et){et._props={__registerPublicApi:_e=>{Object.assign(et,_e(et))}}}})});
//# sourceMappingURL=index.umd.js.map
